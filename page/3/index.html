<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2">






<meta name="description" content="The Pursuit of Happyness">
<meta property="og:type" content="website">
<meta property="og:title" content="Airthink">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="Airthink">
<meta property="og:description" content="The Pursuit of Happyness">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Airthink">
<meta name="twitter:description" content="The Pursuit of Happyness">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/3/">





  <title>Airthink</title>
  














</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Airthink</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            å…³äº
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            æœç´¢
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="æœç´¢..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/29/qaå‡½æ•°/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Airthink">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Airthink">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/08/29/qaå‡½æ•°/" itemprop="url">qaå‡½æ•°</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2020-08-29T11:08:26+08:00">
                2020-08-29
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/æŠ•èµ„/" itemprop="url" rel="index">
                    <span itemprop="name">æŠ•èµ„</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="æ•°æ®"><a href="#æ•°æ®" class="headerlink" title="æ•°æ®"></a>æ•°æ®</h2><h2 id="ä¸‹å•"><a href="#ä¸‹å•" class="headerlink" title="ä¸‹å•"></a>ä¸‹å•</h2><h3 id="QA-Account"><a href="#QA-Account" class="headerlink" title="QA_Account()"></a>QA_Account()</h3><p>QA_Account() æ˜¯quantaxisçš„æ ¸å¿ƒç±», å…¶ä½œç”¨æ˜¯ä¸€ä¸ªå¯ä»¥ä½¿ç”¨è§„åˆ™å…¼å®¹å„ç§å¸‚åœºçš„è´¦æˆ·ç±»<br>1.3.0ä»¥å, QA_Accountéœ€è¦ç”±ç»„åˆæ¥è¿›è¡Œåˆ›å»º(æ¨è)</p>
<pre><code>è°ƒç”¨æ–¹å¼
import QUANTAXIS as QA
user = QA.QA_User(username =&apos;quantaxis&apos;, password = &apos;quantaxis&apos;)
portfolio=user.new_portfolio(&apos;x1&apos;)
account = *portfolio.new_account*(account_cookie=&apos;test&apos;)

QA_AccountPRO?
Init signature:
QA_AccountPRO(
    user_cookie:str,
    portfolio_cookie:str,
    account_cookie=None,
    strategy_name=None,
    market_type=&apos;stock_cn&apos;,
    frequence=&apos;day&apos;,
    broker=&apos;backtest&apos;,
    init_hold={},
    init_cash=1000000,
    commission_coeff=0.00025,
    tax_coeff=0.001,
    margin_level={},
    allow_t0=False,
    allow_sellopen=False,
    allow_margin=False,
    running_environment=&apos;backtest&apos;,
    auto_reload=False,
    generated=&apos;direct&apos;,
    start=None,
    end=None,
)
Docstring:     
JOBæ˜¯worker éœ€è¦æ¥å—QA_EVENT éœ€è¦å®Œå–„RUNæ–¹æ³•
ğŸ‘»QA_Broker ç»§æ‰¿è¿™ä¸ªç±»
ğŸ‘»QA_Account ç»§æ‰¿è¿™ä¸ªç±»
ğŸ‘»QA_OrderHandler ç»§æ‰¿è¿™ä¸ªç±»
è¿™äº›ç±»éƒ½è¦å®ç°runæ–¹æ³•ï¼Œåœ¨å…¶å®ƒçº¿ç¨‹ğŸŒ€ä¸­å…è®¸è‡ªå·±çš„ä¸šåŠ¡ä»£ç 
File:           /usr/local/lib/python3.6/site-packages/QUANTAXIS/QAARP/QAAccountPro.py
Type:           type
Subclasses:     
accpro = *portfolio.new_accountpro*(&apos;pro2&apos;,market_type=QA.MARKET_TYPE.STOCK_CN)
accpro.positions
{}
*accpro.receive_deal*?
Signature:
accpro.receive_deal(
    code,
    trade_id:str,
    order_id:str,
    realorder_id:str,
    trade_price,
    trade_amount,
    trade_towards,
    trade_time,
    message=None,
)
Docstring: &lt;no docstring&gt;
File:      /usr/local/lib/python3.6/site-packages/QUANTAXIS/QAARP/QAAccountPro.py
Type:      method
`accpro.receive_deal`(&apos;000001&apos;,&apos;001&apos;,&apos;001&apos;,&apos;0001&apos;,trade_price=12,trade_amount=10000,trade_towards=QA.ORDER_DIRECTION.BUY,trade_time=&apos;2020-08-18&apos;)
*accpro.positions*
{&apos;000001&apos;: &lt; QAPOSITION 000001 amount 10000/0 &gt;}
*accpro.history_table*


*accpro.send_order?*
Signature:
accpro.send_order(
    code=None,
    amount=None,
    time=None,
    towards=None,
    price=None,
    money=None,
    order_model=&apos;LIMIT&apos;,
    amount_model=&apos;by_amount&apos;,
    order_id=None,
    position_id=None,
    *args,
    **kwargs,
)
Docstring: &lt;no docstring&gt;
File:      /usr/local/lib/python3.6/site-packages/QUANTAXIS/QAARP/QAAccountPro.py
Type:      method

åŸºäºæœŸè´§å¸‚åœºçš„è´¦æˆ·åˆå§‹åŒ–
future_account = portfolio.new_account(account_cookie =&apos;future&apos;,allow_t0=True,allow_margin=True,allow_sellopen=True, running_environment=QA.MARKET_TYPE.FUTURE_CN)

accountçš„å…¶ä»–å±æ€§å¯ä»¥.å‡ºæ¥ï¼Œå¯ä»¥è‡ªå·±è¯•ç€çœ‹
*accpro.cash*
[1000000, 879970.0, 779945.0]
*accpro.cash_available*
779945.0
*accpro.get_history*
*accpro.get_position*(&apos;000001&apos;)

pos2 = accpro.get_position(&apos;000002&apos;)

*pos2.message*
{&apos;code&apos;: &apos;000002&apos;,
 &apos;instrument_id&apos;: &apos;000002&apos;,
 &apos;user_id&apos;: &apos;pro2&apos;,
 &apos;portfolio_cookie&apos;: &apos;x1&apos;,
 &apos;username&apos;: &apos;quantaxis&apos;,
 &apos;position_id&apos;: &apos;3e2cd89e-7143-4e0e-b344-40571e84eda5&apos;,
 &apos;account_cookie&apos;: &apos;pro2&apos;,
 &apos;frozen&apos;: {},
 &apos;name&apos;: None,
 &apos;spms_id&apos;: None,
 &apos;oms_id&apos;: None,
 &apos;market_type&apos;: &apos;stock_cn&apos;,
 &apos;exchange_id&apos;: None,
 &apos;moneypreset&apos;: 100000,
 &apos;moneypresetLeft&apos;: 0.0,
 &apos;lastupdatetime&apos;: &apos;&apos;,
 &apos;volume_long_today&apos;: 5000,
 &apos;volume_long_his&apos;: 0,
 &apos;volume_long&apos;: 5000,
 &apos;volume_short_today&apos;: 0,
 &apos;volume_short_his&apos;: 0,
 &apos;volume_short&apos;: 0,
 &apos;volume_long_frozen_today&apos;: 0,
 &apos;volume_long_frozen_his&apos;: 0,
 &apos;volume_long_frozen&apos;: 0,
 &apos;volume_short_frozen_today&apos;: 0,
 &apos;volume_short_frozen_his&apos;: 0,
 &apos;volume_short_frozen&apos;: 0,
 &apos;margin_long&apos;: 100000.0,
 &apos;margin_short&apos;: 0,
 &apos;margin&apos;: 100000.0,
 &apos;position_price_long&apos;: 20.0,
 &apos;position_cost_long&apos;: 100000.0,
 &apos;position_price_short&apos;: 0,
 &apos;position_cost_short&apos;: 0.0,
 &apos;open_price_long&apos;: 20.0,
 &apos;open_cost_long&apos;: 100000.0,
 &apos;open_price_short&apos;: 0,
 &apos;open_cost_short&apos;: 0.0,
 &apos;trades&apos;: [],
 &apos;orders&apos;: {},
 &apos;last_price&apos;: 20,
 &apos;float_profit_long&apos;: 0.0,
 &apos;float_profit_short&apos;: 0.0,
 &apos;float_profit&apos;: 0.0,
 &apos;position_profit_long&apos;: 0.0,
 &apos;position_profit_short&apos;: 0.0,
 &apos;position_profit&apos;: 0.0}

*pos2.volume_long*
5000
*pos2.volume_long_today*
5000
*pos2.volume_long_his*
0
*pos2.last_price*
20
*pos2.on_price_change*(21)
if pos2.float_profit_long &gt; 2000:
    print(&apos;sell&apos;)
sell
</code></pre><h3 id="QIFIAccount"><a href="#QIFIAccount" class="headerlink" title="QIFIAccount"></a>QIFIAccount</h3><pre><code>from QIFIAccount import QIFI_Account
aifiacc = QIFI_Account(username=&apos;x2&apos;,password=&apos;x2&apos;,)
aifiacc.initial()
Create new Account
aifiacc?
Type:           QIFI_Account
String form:    &lt;QIFIAccount.QAQIFIAccount.QIFI_Account object at 0x7f6e3b2dfc18&gt;
File:           /usr/local/lib/python3.6/site-packages/QIFIAccount/QAQIFIAccount.py
Docstring:      &lt;no docstring&gt;
Init docstring:
Initial
QIFI Accountæ˜¯ä¸€ä¸ªåŸºäº DIFF/ QIFI/ QAAccountåçš„ä¸€ä¸ªå®ç›˜é€‚ç”¨çš„AccountåŸºç±»


1. å…¼å®¹å¤šæŒä»“ç»„åˆ
2. åŠ¨æ€è®¡ç®—æƒç›Š

ä½¿ç”¨ model = SIM/ REALæ¥åˆ‡æ¢


sr = aifiacc.send_order(&apos;003&apos;,10,12,ORDER_DIRECTION.BUY)
aifiacc.send_order?
Signature:
aifiacc.send_order(
    code:str,
    amount:float,
    price:float,
    towards:int,
    order_id:str=&apos;&apos;,
)
Docstring: &lt;no docstring&gt;
File:      /usr/local/lib/python3.6/site-packages/QIFIAccount/QAQIFIAccount.py
Type:      method
sr = aifiacc.send_order(&apos;004&apos;,10.0,12.0,QA.ORDER_DIRECTION.BUY)
{&apos;volume_long&apos;: 0, &apos;volume_short&apos;: 0, &apos;volume_long_frozen&apos;: 0, &apos;volume_short_frozen&apos;: 0}
{&apos;volume_long&apos;: 0, &apos;volume_short&apos;: 0}
order check success
ä¸‹å•æˆåŠŸ b3f155c7-ab2b-4ac1-94b7-08b6af152738
td = aifiacc.make_deal(sr)
å…¨éƒ¨æˆäº¤ b3f155c7-ab2b-4ac1-94b7-08b6af152738
update trade
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/20/QUANTAXIS/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Airthink">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Airthink">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/08/20/QUANTAXIS/" itemprop="url">QUANTAXIS</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2020-08-20T21:47:00+08:00">
                2020-08-20
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/æŠ•èµ„/" itemprop="url" rel="index">
                    <span itemprop="name">æŠ•èµ„</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h1><h2 id="å®‰è£…cmder"><a href="#å®‰è£…cmder" class="headerlink" title="å®‰è£…cmder"></a>å®‰è£…cmder</h2><ol>
<li><p>å®˜ç½‘ä¸‹è½½åœ°å€</p>
<p> <code>http://cmder.net/</code></p>
<p> ä¸‹è½½å¥½è§£å‹åŒ…å¯ç›´æ¥ä½¿ç”¨</p>
</li>
<li><p>ç¯å¢ƒå˜é‡é…ç½®</p>
<p> åœ¨ç³»ç»Ÿå±æ€§é‡Œé¢é…ç½®ç¯å¢ƒå˜é‡ï¼Œå°†Cmder.exeæ‰€åœ¨æ–‡ä»¶è·¯å¾„æ·»åŠ è‡³pathé‡Œ</p>
</li>
</ol>
<p><img src="/2020/08/20/QUANTAXIS/1.webp" alt=""></p>
<p>win+R,è¾“å…¥cmder,ç¡®å®šï¼Œå³å¯è¿è¡Œcmder</p>
<ol start="3">
<li><p>é…ç½®å³é”®å¿«æ·å¯åŠ¨</p>
<pre><code>// è®¾ç½®ä»»æ„åœ°æ–¹é¼ æ ‡å³é”®å¯åŠ¨Cmder
Cmder.exe /REGISTER ALL
</code></pre></li>
</ol>
<p><img src="/2020/08/20/QUANTAXIS/2.webp" alt=""></p>
<ol start="4">
<li><p>å¿«æ·é”®</p>
<p> Tab       è‡ªåŠ¨è·¯å¾„è¡¥å…¨<br> Ctrl+T    å»ºç«‹æ–°é¡µç­¾<br> Ctrl+W    å…³é—­é¡µç­¾<br> Ctrl+Tab  åˆ‡æ¢é¡µç­¾<br> Alt+F4    å…³é—­æ‰€æœ‰é¡µç­¾<br> Alt+Shift+1 å¼€å¯cmd.exe<br> Alt+Shift+2 å¼€å¯powershell.exe<br> Alt+Shift+3 å¼€å¯powershell.exe (ç³»ç»Ÿç®¡ç†å‘˜æƒé™)<br> Ctrl+1      å¿«é€Ÿåˆ‡æ¢åˆ°ç¬¬1ä¸ªé¡µç­¾<br> Ctrl+n      å¿«é€Ÿåˆ‡æ¢åˆ°ç¬¬nä¸ªé¡µç­¾( nå€¼æ— ä¸Šé™)<br> Alt + enter åˆ‡æ¢åˆ°å…¨å±çŠ¶æ€<br> Ctr+r       å†å²å‘½ä»¤æœç´¢<br> Tab         è‡ªåŠ¨è·¯å¾„è¡¥å…¨<br> Ctrl+T      å»ºç«‹æ–°é¡µç­¾<br> Ctrl+W      å…³é—­é¡µç­¾<br> Ctrl+Tab    åˆ‡æ¢é¡µç­¾<br> Alt+F4      å…³é—­æ‰€æœ‰é¡µç­¾<br> Alt+Shift+1 å¼€å¯cmd.exe<br> Alt+Shift+2 å¼€å¯powershell.exe<br> Alt+Shift+3 å¼€å¯powershell.exe (ç³»ç»Ÿç®¡ç†å‘˜æƒé™)<br> Ctrl+1      å¿«é€Ÿåˆ‡æ¢åˆ°ç¬¬1ä¸ªé¡µç­¾<br> Ctrl+n      å¿«é€Ÿåˆ‡æ¢åˆ°ç¬¬nä¸ªé¡µç­¾( nå€¼æ— ä¸Šé™)<br> Alt + enter åˆ‡æ¢åˆ°å…¨å±çŠ¶æ€<br> Ctr+r       å†å²å‘½ä»¤æœç´¢<br> Win+Alt+P   å¼€å¯å·¥å…·é€‰é¡¹è§†çª—</p>
</li>
<li><p>ä¸­æ–‡ä¹±ç é—®é¢˜</p>
</li>
</ol>
<p>å°†ä¸‹é¢çš„4è¡Œå‘½ä»¤æ·»åŠ åˆ°cmder/config/aliasesæ–‡ä»¶æœ«å°¾ã€‚</p>
<pre><code>l=ls --show-control-chars 
la=ls -aF --show-control-chars 
ll=ls -alF --show-control-chars 
ls=ls --show-control-chars -F
</code></pre><h2 id="å®‰è£…dockeræ¡Œé¢ç‰ˆ"><a href="#å®‰è£…dockeræ¡Œé¢ç‰ˆ" class="headerlink" title="å®‰è£…dockeræ¡Œé¢ç‰ˆ"></a>å®‰è£…dockeræ¡Œé¢ç‰ˆ</h2><h3 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h3><pre><code>https://www.docker.com/
</code></pre><p>ä¸‹è½½Docker Desktop</p>
<h3 id="å®‰è£…å¯èƒ½é‡åˆ°çš„é—®é¢˜"><a href="#å®‰è£…å¯èƒ½é‡åˆ°çš„é—®é¢˜" class="headerlink" title="å®‰è£…å¯èƒ½é‡åˆ°çš„é—®é¢˜"></a>å®‰è£…å¯èƒ½é‡åˆ°çš„é—®é¢˜</h3><pre><code>Installation failed:one pre-requisite is not fullfilled
</code></pre><p>æç¤ºæˆ‘ä»¬ç³»ç»Ÿç‰ˆæœ¬ä½ï¼Œè§£å†³åŠæ³•ï¼Œä¼ªè£…æˆä¸“ä¸šç‰ˆç³»ç»Ÿã€‚ç”¨ç®¡ç†å‘˜æƒé™å¼€å¯è¿è¡Œ[cmd]å‘½ä»¤å¼€å¯å‘½ä»¤è¡Œï¼Œè¾“å…¥å¦‚ä¸‹æŒ‡ä»¤</p>
<pre><code>REG ADD &quot;HKEY_LOCAL_MACHINE\software\Microsoft\Windows NT\CurrentVersion&quot; /v EditionId /T REG_EXPAND_SZ /d Professional /F
</code></pre><p>å†æ¬¡å®‰è£…dockerå¯ä»¥æˆåŠŸ</p>
<h2 id="ä¸‹è½½QUANTAXISçš„docker-compose-yamlæ–‡ä»¶"><a href="#ä¸‹è½½QUANTAXISçš„docker-compose-yamlæ–‡ä»¶" class="headerlink" title="ä¸‹è½½QUANTAXISçš„docker-compose.yamlæ–‡ä»¶"></a>ä¸‹è½½QUANTAXISçš„docker-compose.yamlæ–‡ä»¶</h2><pre><code>`https://github.com/QUANTAXIS/QUANTAXIS`
</code></pre><p>å¦‚æœä½ æ˜¯è‚¡ç¥¨æ–¹å‘çš„ ==&gt;  é€‰æ‹© qa-service ä¸‹çš„docker-compose.yaml</p>
<p>å¦‚æœä½ æ˜¯æœŸè´§æ–¹å‘çš„ ==&gt; é€‰æ‹© qa-service-future ä¸‹çš„docker-compose.yaml</p>
<p>ä½ å¯ä»¥ç†è§£ dockerçš„æ„æˆç±»ä¼¼æ­ç§¯æœ¨çš„æ¨¡å¼,  ä½ éœ€è¦è¿™ä¸ªåŠŸèƒ½çš„ç§¯æœ¨, å°±é€‰æ‹©ä»–æ”¾åœ¨ä½ çš„docker-compose.yamlé‡Œé¢</p>
<p>æœŸè´§æ–¹å‘çš„yaml æ¯”è‚¡ç¥¨å¤šä¸€ä¸ª  QACTPBEEçš„docker-container  [è¿™æ˜¯ç”¨äºåˆ†å‘æœŸè´§çš„tickè¡Œæƒ…æ‰€éœ€çš„ è‚¡ç¥¨åˆ™æ— éœ€æ­¤ç§¯æœ¨]</p>
<p>å¯é€šè¿‡gitæ‹‰å–å…¨éƒ¨ä»£ç åˆ°æœ¬åœ°ï¼Œä»æœ¬åœ°æ‹·è´å‡ºéœ€è¦çš„dockerfileæ–‡ä»¶</p>
<h2 id="dockeréƒ¨ç½²quantaxis"><a href="#dockeréƒ¨ç½²quantaxis" class="headerlink" title="dockeréƒ¨ç½²quantaxis"></a>dockeréƒ¨ç½²quantaxis</h2><ol>
<li>é€‰å–ä¸€ä¸ªç©ºé—´è¾ƒå¤§çš„ç›˜ï¼Œæœ€å¥½ä¸æ”¾cç›˜ï¼Œæ–°å»ºquantaxisæ–‡ä»¶å¤¹ï¼Œå°†docker-compose.yamlæ‹·è´åˆ°quantaxisæ–‡ä»¶å¤¹</li>
<li><p>cdåˆ°quantaxisæ–‡ä»¶å¤¹ï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤</p>
<pre><code>docker volume create --name=qamg
docker volume create --name=qacode
docker-compose up -d
</code></pre></li>
</ol>
<p>æ„æ€åœ¨åå°å¯åŠ¨è¿™ä¸ªdockerç¯å¢ƒï¼Œå¦‚æœéœ€è¦æ§åˆ¶å°æ‰“å°è¾“å‡ºï¼Œåˆ™æŠŠ-då»æ‰</p>
<ol start="3">
<li>åœ¨æ— æŠ¥é”™çš„æƒ…å†µä¸‹ï¼Œæ‰“å¼€æµè§ˆå™¨è¾“å…¥localhost:81å³å¯çœ‹åˆ°</li>
</ol>
<p><img src="/2020/08/20/QUANTAXIS/3.jpg" alt=""></p>
<p>åœ¨ä¸Šæ–¹éšæ„ç‚¹å‡»æ ç›®ï¼Œéƒ½å¯è¿›å…¥ç™»é™†ç•Œé¢ï¼Œé»˜è®¤å¯†ç æ˜¯quantaxis</p>
<ol start="4">
<li>dockeråšäº†ä»€ä¹ˆ</li>
</ol>
<p>å¸®ä½ ç›´æ¥å¼€å¯ä½ éœ€è¦çš„æœåŠ¡</p>
<ul>
<li>27017 mongodb</li>
<li>8888 jupyter   ï¼ˆå¯†ç ï¼‰quantaxis</li>
<li>8010 quantaxis_webserver</li>
<li>81 quantaxis_community ç¤¾åŒºç‰ˆç•Œé¢</li>
<li>61208 ç³»ç»Ÿç›‘æ§</li>
<li>15672 qa-eventmq ï¼ˆå¯†ç ï¼‰admin admin</li>
</ul>
<ol start="5">
<li><p>æ—¥å¿—æŸ¥çœ‹</p>
<pre><code>docker logs cronå®¹å™¨å
</code></pre></li>
<li><p>å…¶ä»–å‘½ä»¤</p>
<pre><code>docker ps

docker stats

docker-compose top ï¼ˆå¿…é¡»åˆ°dockerfileæ–‡ä»¶å¤¹ç›®å½•ä¸‹ï¼‰

docker-compose ps ï¼ˆå¿…é¡»åˆ°dockerfileæ–‡ä»¶å¤¹ç›®å½•ä¸‹ï¼‰

docker stop $(docker ps -a -q)åœæ­¢å®¹å™¨

docker rm $(docker ps -a -q)åˆ é™¤å®¹å™¨

docker-compose pull æ›´æ–°ï¼ˆå¿…é¡»åˆ°dockerfileæ–‡ä»¶å¤¹ç›®å½•ä¸‹ï¼‰
docker-compose up -d é‡å¯æœåŠ¡ï¼ˆå¿…é¡»åˆ°dockerfileæ–‡ä»¶å¤¹ç›®å½•ä¸‹ï¼‰
docker-compose stop åœæ­¢æœåŠ¡ï¼ˆå¿…é¡»åˆ°dockerfileæ–‡ä»¶å¤¹ç›®å½•ä¸‹ï¼‰

docker run  --rm -v qamg:/data/db \ -v $(pwd):/backup alpine \tar zcvf /backup/dbbackup.tar /data/db  å¤‡ä»½æ•°æ®åº“åˆ°å½“å‰ç›®å½•ä¸‹
docker run  --rm -v qamg:/data/db \
-v $(pwd):/backup alpine \
sh -c &quot;cd /data/db \
&amp;&amp; rm -rf diagnostic.data \
&amp;&amp; rm -rf journal \
&amp;&amp; rm -rf configdb \
&amp;&amp; cd / \
&amp;&amp; tar xvf /backup/dbbackup.tar&quot; è¿˜åŸå½“å‰ç›®å½•ä¸‹çš„dbbackup.taråˆ°mongodæ•°æ®åº“

å½“æ›´æ–°äº†dockerfileåé‡å¯æœåŠ¡ï¼Œä¹‹å‰ä¿å­˜çš„æ•°æ®ä¸ä¼šè¢«æ¸…é™¤
</code></pre></li>
</ol>
<h2 id="ä¿å­˜æ•°æ®"><a href="#ä¿å­˜æ•°æ®" class="headerlink" title="ä¿å­˜æ•°æ®"></a>ä¿å­˜æ•°æ®</h2><ol>
<li>å…ˆè¿›å…¥åˆ°jupyterçš„ç™»é™†é¡µç™»é™†ï¼Œæ‰¾åˆ°terminal</li>
</ol>
<p><img src="/2020/08/20/QUANTAXIS/4.jpg" alt=""></p>
<ol start="2">
<li>åœ¨ç‚¹å¼€çš„terminalç•Œé¢ä¸­ï¼Œè¾“å…¥quantaxis å›è½¦, è¿›å…¥quantaxis cliçš„å‘½ä»¤è¡Œç•Œé¢</li>
</ol>
<p><img src="/2020/08/20/QUANTAXIS/5.jpg" alt=""></p>
<ol start="3">
<li>åœ¨å‘½ä»¤è¡Œç•Œé¢ è¾“å…¥ save  æŒ‰å›è½¦, ä½ å¯ä»¥çœ‹åˆ°è®¸å¤šå‘½ä»¤è¡Œé€‰é¡¹</li>
</ol>
<p><img src="/2020/08/20/QUANTAXIS/6.jpg" alt=""></p>
<ol start="4">
<li><p>å‚è€ƒ</p>
<pre><code>save all  (è‚¡ç¥¨/æŒ‡æ•° çš„æ—¥çº¿æ•°æ® | æƒæ¯æ•°æ® | æ¿å—æ•°æ®)  
save x   (è‚¡ç¥¨/æŒ‡æ•°çš„ æ—¥çº¿/åˆ†é’Ÿçº¿æ•°æ®  | æƒæ¯æ•°æ®| æ¿å—æ•°æ®)

save future_min_all  (æœŸè´§çš„å…¨éƒ¨åˆçº¦çš„åˆ†é’Ÿçº¿æ•°æ®)
save future_min  (qæœŸè´§ä¸»è¿çš„åˆ†é’Ÿçº¿æ•°æ®)

save future_day_all (æœŸè´§å…¨éƒ¨åˆçº¦çš„æ—¥çº¿æ•°æ®)
save future_day (æœŸè´§ä¸»è¿çš„æ—¥çº¿æ•°æ®)

save index_day    (æŒ‡æ•°æ•°æ®  æ­¤å¤„ä¹Ÿè¦å­˜, å› ä¸ºåœ¨åšå›æµ‹çš„æ—¶å€™, éœ€è¦æ²ªæ·±300ä½œä¸ºæ ‡çš„å¯¹ç…§ç‰©)
</code></pre></li>
<li><p>å­˜å®Œæ•°æ®åå¯ä»¥æ‰“å¼€notebook,åšä¸€ä¸ªå›æµ‹</p>
<pre><code>import QUANTAXIS as QA
import numpy as np
import pandas as pd
import datetime
st1=datetime.datetime.now()
# define the MACD strategy
def MACD_JCSC(dataframe, SHORT=12, LONG=26, M=9):
    &quot;&quot;&quot;
    1.DIFå‘ä¸Šçªç ´DEAï¼Œä¹°å…¥ä¿¡å·å‚è€ƒã€‚
    2.DIFå‘ä¸‹è·Œç ´DEAï¼Œå–å‡ºä¿¡å·å‚è€ƒã€‚
    &quot;&quot;&quot;
    CLOSE = dataframe.close
    DIFF = QA.EMA(CLOSE, SHORT) - QA.EMA(CLOSE, LONG)
    DEA = QA.EMA(DIFF, M)
    MACD = 2*(DIFF-DEA)

    CROSS_JC = QA.CROSS(DIFF, DEA)
    CROSS_SC = QA.CROSS(DEA, DIFF)
    ZERO = 0
    return pd.DataFrame({&apos;DIFF&apos;: DIFF, &apos;DEA&apos;: DEA, &apos;MACD&apos;: MACD, &apos;CROSS_JC&apos;: CROSS_JC, &apos;CROSS_SC&apos;: CROSS_SC, &apos;ZERO&apos;: ZERO})
</code></pre></li>
</ol>
<pre><code># create account
user = QA.QA_User(username=&apos;quantaxis&apos;, password=&apos;quantaxis&apos;)
portfolio = user.new_portfolio(&apos;qatestportfolio&apos;)


Account = portfolio.new_account(account_cookie=&apos;macd_stock&apos;, init_cash=1000000)
Broker = QA.QA_BacktestBroker()

QA.QA_SU_save_strategy(&apos;MACD_JCSC&apos;,&apos;Indicator&apos;,Account.account_cookie)
# get data from mongodb
QA.QA_SU_save_strategy(&apos;MACD_JCSC&apos;, &apos;Indicator&apos;,
                       Account.account_cookie, if_save=True)
data = QA.QA_fetch_stock_day_adv(
    [&apos;000001&apos;, &apos;000002&apos;, &apos;000004&apos;, &apos;600000&apos;], &apos;2017-09-01&apos;, &apos;2018-05-20&apos;)
data = data.to_qfq()

# add indicator
ind = data.add_func(MACD_JCSC)
# ind.xs(&apos;000001&apos;,level=1)[&apos;2018-01&apos;].plot()

data_forbacktest=data.select_time(&apos;2018-01-01&apos;,&apos;2018-05-01&apos;)


for items in data_forbacktest.panel_gen:
    for item in items.security_gen:
        ###################
        daily_ind=ind.loc[item.index]

        if daily_ind.CROSS_JC.iloc[0]&gt;0:
            order=Account.send_order(
                code=item.code[0], 
                time=item.date[0], 
                amount=1000, 
                towards=QA.ORDER_DIRECTION.BUY, 
                price=0, 
                order_model=QA.ORDER_MODEL.CLOSE, 
                amount_model=QA.AMOUNT_MODEL.BY_AMOUNT
                )
            #print(item.to_json()[0])
            Broker.receive_order(QA.QA_Event(order=order,market_data=item))
            trade_mes=Broker.query_orders(Account.account_cookie,&apos;filled&apos;)
            res=trade_mes.loc[order.account_cookie,order.realorder_id]
            order.trade(res.trade_id,res.trade_price,res.trade_amount,res.trade_time)
        elif daily_ind.CROSS_SC.iloc[0]&gt;0:
            #print(item.code)
            if Account.sell_available.get(item.code[0], 0)&gt;0:
                order=Account.send_order(
                    code=item.code[0], 
                    time=item.date[0], 
                    amount=Account.sell_available.get(item.code[0], 0), 
                    towards=QA.ORDER_DIRECTION.SELL, 
                    price=0, 
                    order_model=QA.ORDER_MODEL.MARKET, 
                    amount_model=QA.AMOUNT_MODEL.BY_AMOUNT
                    )
                #print
                Broker.receive_order(QA.QA_Event(order=order,market_data=item))
                trade_mes=Broker.query_orders(Account.account_cookie,&apos;filled&apos;)
                res=trade_mes.loc[order.account_cookie,order.realorder_id]
                order.trade(res.trade_id,res.trade_price,res.trade_amount,res.trade_time)
    Account.settle()

print(&apos;TIME -- {}&apos;.format(datetime.datetime.now()-st1))
print(Account.history)
print(Account.history_table)
print(Account.daily_hold)

# create Risk analysis
Risk = QA.QA_Risk(Account)

Account.save()
Risk.save()
</code></pre><ol start="6">
<li>æ¨èçš„åšæ³•</li>
</ol>
<p>ä½¿ç”¨æœ€æ–°çš„QAStrategyæ¥åšå›æµ‹/æ¨¡æ‹Ÿ</p>
<p>é¦–å…ˆ æ‰“å¼€terminal (ä¸Šé¢æœ‰è®²), è¾“å…¥</p>
<pre><code>pip install qastrategy
</code></pre><p>ç„¶å æ–°å»ºä¸€ä¸ªnotebook, è¾“å…¥</p>
<pre><code>from QAStrategy import QAStrategyCTABase
import QUANTAXIS as QA
import pprint


class CCI(QAStrategyCTABase):

    def on_bar(self, bar):

        res = self.cci()

        print(res.iloc[-1])

        if res.CCI[-1] &lt; -100:

            print(&apos;LONG&apos;)

            if self.positions.volume_long == 0:
                self.send_order(&apos;BUY&apos;, &apos;OPEN&apos;, price=bar[&apos;close&apos;], volume=1)

            if self.positions.volume_short &gt; 0:
                self.send_order(&apos;SELL&apos;, &apos;CLOSE&apos;, price=bar[&apos;close&apos;], volume=1)

        elif res.CCI[-1] &gt; 100:
            print(&apos;SHORT&apos;)
            if self.positions.volume_short == 0:
                self.send_order(&apos;SELL&apos;, &apos;OPEN&apos;, price=bar[&apos;close&apos;], volume=1)
            if self.positions.volume_long &gt; 0:
                self.send_order(&apos;BUY&apos;, &apos;CLOSE&apos;, price=bar[&apos;close&apos;], volume=1)

    def cci(self,):
        return QA.QA_indicator_CCI(self.market_data, 61)

    def risk_check(self):
        pass
        # pprint.pprint(self.qifiacc.message)
</code></pre><p>ç„¶å ä½ å¯ä»¥è‡ªç”±æŒ‡å®šå›æµ‹/æ¨¡æ‹Ÿ</p>
<p>é¦–å…ˆå®ä¾‹åŒ–è¿™ä¸ªç±»</p>
<pre><code>strategy =CCI(code=&apos;RB2005&apos;, frequence=&apos;1min&apos;,strategy_id=&apos;a3916de0-bd28-4b9c-bea1-94d91f1744ac&apos;, start=â€˜2020-01-01â€˜, end=â€˜2020-02-07â€™)
</code></pre><p>å¦‚æœä½ éœ€è¦æµ‹è¯•è¿™ä¸ªç­–ç•¥</p>
<pre><code>strategy.debug()
</code></pre><p>å¦‚æœä½ éœ€è¦åšå›æµ‹</p>
<pre><code>strategy.run_backtest()
</code></pre><p>å¦‚æœä½ éœ€è¦è®©ä»–ç›´æ¥æŒ‚æ¨¡æ‹Ÿ</p>
<p>åœ¨æŒ‚æ¨¡æ‹Ÿçš„æ—¶å€™, ä½ éœ€è¦æ³¨æ„ä¸€äº›ä¸œè¥¿</p>
<p>æŒ‚æ¨¡æ‹Ÿçš„æ ‡çš„éœ€è¦å’ŒçœŸå®æ ‡çš„ä¸€è‡´<br>æŒ‚æ¨¡æ‹Ÿçš„æ—¶å€™, ä½ çš„è¡Œæƒ…å¿…é¡»æ˜¯æœ‰æ¨é€çš„, å¹¶ä¸”ç”³è¯·äº†ä½ æ‰€éœ€è¦çš„çš„åˆ†é’Ÿçº¿çº§åˆ«çš„æ•°æ®</p>
<p>(å¦‚ä½•ç”³è¯·è¡Œæƒ…æ•°æ®? ä½ å¯ä»¥çœ‹è¿™é‡Œ )<br><a href="https://github.com/yutiansut/QUANTAXIS_RealtimeCollector" target="_blank" rel="noopener">https://github.com/yutiansut/QUANTAXIS_RealtimeCollector</a></p>
<pre><code># æœŸè´§è®¢é˜…è¯·æ±‚
  curl -X POST &quot;http://127.0.0.1:8011?action=new_handler&amp;market_type=future_cn&amp;code=au1911&quot;
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è‚¡ç¥¨è®¢é˜…è¯·æ±‚</span></span><br><span class="line">curl -X POST <span class="string">"http://127.0.0.1:8011?action=new_handler&amp;market_type=stock_cn&amp;code=000001"</span></span><br><span class="line"><span class="comment"># äºŒæ¬¡é‡‡æ ·è¯·æ±‚</span></span><br><span class="line">curl -X POST <span class="string">"http://127.0.0.1:8011?action=new_resampler&amp;market_type=future_cn&amp;code=au1911&amp;frequence=2min"</span></span><br><span class="line"></span><br><span class="line">å¯¹äºå°ç™½å¯èƒ½éš¾ä»¥ç†è§£curlæ˜¯ä¸ªå•¥, æ­¤å¤„ç»™å‡ºä¸€ä¸ªç®€å•æ˜“æ‡‚çš„ä»£ç </span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line">requests.post(<span class="string">"http://127.0.0.1:8011?action=new_handler&amp;market_type=future_cn&amp;code=&#123;&#125;"</span>.format(<span class="string">"rb2001"</span>)</span><br><span class="line">ä»¥æ­¤ç±»æ¨å…¶ä»–çš„è¯·æ±‚éƒ½å¯ä»¥è¿™ä¹ˆåš</span><br></pre></td></tr></table></figure>

åƒ èºçº¹2001 åˆçº¦, ä½ éœ€è¦æ”¹æˆ rb2001  æ³¨æ„æ­¤å¤„æ˜¯å°å†™

strategy =CCI(code=&apos;rb2001&apos;, frequence=&apos;1min&apos;,strategy_id=&apos;a3916de0-bd28-4b9c-bea1-94d91f1744ac&apos;)
strategy.debug_sim()
</code></pre><p>åšå®Œäº†è¿™äº›æ“ä½œä»¥å, ä½ å¯ä»¥ç‚¹å‡» å›æµ‹ ä½ å°±å¯ä»¥çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„ç»“æœ</p>
<p><img src="/2020/08/20/QUANTAXIS/7.jpg" alt=""></p>
<ol start="7">
<li><p>æ›´å¤šå‚è€ƒ</p>
<p> <a href="http://www.yutiansut.com:3000/topic/5dc5da7dc466af76e9e3bc5d" target="_blank" rel="noopener">http://www.yutiansut.com:3000/topic/5dc5da7dc466af76e9e3bc5d</a></p>
<p> å¦‚ä½•ä¿®æ”¹æœŸè´§çš„å®ç›˜è¡Œæƒ…åœ°å€   <a href="http://www.yutiansut.com:3000/topic/5dfade9efe01257b44740e70" target="_blank" rel="noopener">http://www.yutiansut.com:3000/topic/5dfade9efe01257b44740e70</a></p>
<p> å®æ—¶å¦‚ä½•ç”³è¯·è¡Œæƒ…  <a href="http://www.yutiansut.com:3000/topic/5dd1be9b0c8e672840f3fea7" target="_blank" rel="noopener">http://www.yutiansut.com:3000/topic/5dd1be9b0c8e672840f3fea7</a></p>
<p> å¦‚ä½•æ¥å…¥ä½ çš„å®ç›˜æœŸè´§è´¦æˆ·  <a href="http://www.yutiansut.com:3000/topic/5dc865e8c466af76e9e3bdd1" target="_blank" rel="noopener">http://www.yutiansut.com:3000/topic/5dc865e8c466af76e9e3bdd1</a></p>
<p> å¦‚ä½•å®ç°æ¨¡æ‹Ÿç›˜/å®ç›˜çš„è·Ÿå•  <a href="http://www.yutiansut.com:3000/topic/5ddb5ba8fe01257b4474080a" target="_blank" rel="noopener">http://www.yutiansut.com:3000/topic/5ddb5ba8fe01257b4474080a</a></p>
<p> docker å¦‚ä½•è®¿é—®å¤–éƒ¨æ•°æ®åº“  <a href="https://github.com/QUANTAXIS/QUANTAXIS/issues/1346" target="_blank" rel="noopener">https://github.com/QUANTAXIS/QUANTAXIS/issues/1346</a>   <a href="http://www.yutiansut.com:3000/topic/5e4531c96d3b182e88b4ebb4" target="_blank" rel="noopener">http://www.yutiansut.com:3000/topic/5e4531c96d3b182e88b4ebb4</a></p>
<p> dockerå°ç™½ç”¨æˆ·çš„æ¨è <a href="http://www.yutiansut.com:3000/topic/5e4cb13f6d3b182e88b4ef64" target="_blank" rel="noopener">http://www.yutiansut.com:3000/topic/5e4cb13f6d3b182e88b4ef64</a></p>
</li>
</ol>
<h2 id="æ•´ä¸ªç¯å¢ƒä¸€è§ˆ"><a href="#æ•´ä¸ªç¯å¢ƒä¸€è§ˆ" class="headerlink" title="æ•´ä¸ªç¯å¢ƒä¸€è§ˆ"></a>æ•´ä¸ªç¯å¢ƒä¸€è§ˆ</h2><p><img src="/2020/08/20/QUANTAXIS/8.jpg" alt=""></p>
<p>é…ç½®çš„ä¸€äº›å¤‡å¿˜</p>
<p><img src="/2020/08/20/QUANTAXIS/9.jpg" alt=""></p>
<p><img src="/2020/08/20/QUANTAXIS/10.jpg" alt=""></p>
<p><img src="/2020/08/20/QUANTAXIS/11.jpg" alt=""></p>
<ol start="8">
<li>å®‰è£…vscodeå¯ä»¥è°ƒè¯•docker</li>
</ol>
<h2 id="ä¿®æ”¹å®šæ—¶ä¿å­˜æ•°æ®çš„æ—¶é—´"><a href="#ä¿®æ”¹å®šæ—¶ä¿å­˜æ•°æ®çš„æ—¶é—´" class="headerlink" title="ä¿®æ”¹å®šæ—¶ä¿å­˜æ•°æ®çš„æ—¶é—´"></a>ä¿®æ”¹å®šæ—¶ä¿å­˜æ•°æ®çš„æ—¶é—´</h2><p>ä½¿ç”¨vscodeè¿›å…¥qa-cronçš„å®¹å™¨ä¸­ï¼Œè¿›å…¥ç›®å½• /etc/cron.d ä¿®æ”¹daily_updateé‡Œçš„æ—¶é—´å³å¯ï¼Œå¦‚æœåªéœ€è¦ä¿å­˜æœŸè´§æ•°æ®ï¼Œè¦æ”¹æ‰è„šæœ¬é‡Œçš„  update_future.py</p>
<pre><code>éƒ¨ç½²
crontab daily_update
crontab -l
æ£€æŸ¥
/etc/init.d/cron start
/etc/init.d/cron status

è§£å†³åœ¨æ‰§è¡Œæ—¶æç¤º cron: canâ€™t lock /var/run/crond.pid, otherpid may be 2699: Resource temporarily unavailable

è§£å†³æ–¹æ¡ˆï¼š 

    rm -rf /var/run/crond.pid

    /etc/init.d/cron reload

    sudo /usr/sbin/service cron restart

å¦‚æœå®šæ—¶ä¸å¯ç”¨ï¼Œå¯ä»¥åœ¨æœ¬åœ°saveä¿å­˜æ•°æ®ï¼Œsaveä¸ä¼šè¦†ç›–ä¹‹å‰å·²ç»ä¸‹è½½å¥½çš„æ•°æ®
</code></pre><h2 id="åœ¨ç•Œé¢å®‰è£…åŒ…"><a href="#åœ¨ç•Œé¢å®‰è£…åŒ…" class="headerlink" title="åœ¨ç•Œé¢å®‰è£…åŒ…"></a>åœ¨ç•Œé¢å®‰è£…åŒ…</h2><pre><code>!ls
!pip -v
!pip install
!pip install qastrategy -U
åœ¨terminalç•Œé¢ä¹Ÿå¯ä»¥å®‰è£…

from QUANTAXIS.QAARP.QAAccountPro import QA_AccountPRO
QA_AccountPRO?
</code></pre><h2 id="docker-composeå¸¸ç”¨å‘½ä»¤"><a href="#docker-composeå¸¸ç”¨å‘½ä»¤" class="headerlink" title="docker-composeå¸¸ç”¨å‘½ä»¤"></a>docker-composeå¸¸ç”¨å‘½ä»¤</h2><pre><code>docker-compose up -d nginx                     æ„å»ºå»ºå¯åŠ¨nignxå®¹å™¨

docker-compose exec nginx bash            ç™»å½•åˆ°nginxå®¹å™¨ä¸­

docker-compose down                              åˆ é™¤æ‰€æœ‰nginxå®¹å™¨,é•œåƒ

docker-compose ps                                   æ˜¾ç¤ºæ‰€æœ‰å®¹å™¨

docker-compose restart nginx                   é‡æ–°å¯åŠ¨nginxå®¹å™¨

docker-compose run --no-deps --rm php-fpm php -v  åœ¨php-fpmä¸­ä¸å¯åŠ¨å…³è”å®¹å™¨ï¼Œå¹¶å®¹å™¨æ‰§è¡Œphp -v æ‰§è¡Œå®Œæˆååˆ é™¤å®¹å™¨

docker-compose build nginx                     æ„å»ºé•œåƒ ã€‚        

docker-compose build --no-cache nginx   ä¸å¸¦ç¼“å­˜çš„æ„å»ºã€‚

docker-compose logs  nginx                     æŸ¥çœ‹nginxçš„æ—¥å¿— 

docker-compose logs -f nginx                   æŸ¥çœ‹nginxçš„å®æ—¶æ—¥å¿—



docker-compose config  -q                        éªŒè¯ï¼ˆdocker-compose.ymlï¼‰æ–‡ä»¶é…ç½®ï¼Œå½“é…ç½®æ­£ç¡®æ—¶ï¼Œä¸è¾“å‡ºä»»ä½•å†…å®¹ï¼Œå½“æ–‡ä»¶é…ç½®é”™è¯¯ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯ã€‚ 

docker-compose events --json nginx       ä»¥jsonçš„å½¢å¼è¾“å‡ºnginxçš„dockeræ—¥å¿—

docker-compose pause nginx                 æš‚åœnignxå®¹å™¨

docker-compose unpause nginx             æ¢å¤ningxå®¹å™¨

docker-compose rm nginx                       åˆ é™¤å®¹å™¨ï¼ˆåˆ é™¤å‰å¿…é¡»å…³é—­å®¹å™¨ï¼‰

docker-compose stop nginx                    åœæ­¢nignxå®¹å™¨

docker-compose start nginx                    å¯åŠ¨nignxå®¹å™¨
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/17/GITä½¿ç”¨è¯¦è§£/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Airthink">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Airthink">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/17/GITä½¿ç”¨è¯¦è§£/" itemprop="url">Gitä½¿ç”¨è¯¦è§£</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2020-06-17T17:23:22+08:00">
                2020-06-17
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Gitçš„å®‰è£…å’Œä½¿ç”¨"><a href="#Gitçš„å®‰è£…å’Œä½¿ç”¨" class="headerlink" title="Gitçš„å®‰è£…å’Œä½¿ç”¨"></a>Gitçš„å®‰è£…å’Œä½¿ç”¨</h1><h2 id="ä¸‹è½½å®‰è£…Git"><a href="#ä¸‹è½½å®‰è£…Git" class="headerlink" title="ä¸‹è½½å®‰è£…Git"></a>ä¸‹è½½å®‰è£…Git</h2><pre><code>[https://git-scm.com/download/win](https://git-scm.com/download/win &quot;ä¸‹è½½Git&quot;)
</code></pre><p><img src="/2020/06/17/GITä½¿ç”¨è¯¦è§£/1.png" alt=""></p>
<h2 id="ä¸‹è½½å®ŒæˆååŒå‡»å®‰è£…"><a href="#ä¸‹è½½å®ŒæˆååŒå‡»å®‰è£…" class="headerlink" title="ä¸‹è½½å®ŒæˆååŒå‡»å®‰è£…"></a>ä¸‹è½½å®ŒæˆååŒå‡»å®‰è£…</h2><h2 id="æ£€éªŒæ˜¯å¦å®‰è£…å®Œæˆ"><a href="#æ£€éªŒæ˜¯å¦å®‰è£…å®Œæˆ" class="headerlink" title="æ£€éªŒæ˜¯å¦å®‰è£…å®Œæˆ"></a>æ£€éªŒæ˜¯å¦å®‰è£…å®Œæˆ</h2><p>é¼ æ ‡å³å‡»å¦‚æœçœ‹åˆ°æœ‰ä¸¤ä¸ªgitå•è¯åˆ™å®‰è£…æˆåŠŸ</p>
<p><img src="/2020/06/17/GITä½¿ç”¨è¯¦è§£/2.png" alt=""></p>
<h1 id="GitåŸºæœ¬å·¥ä½œæµç¨‹"><a href="#GitåŸºæœ¬å·¥ä½œæµç¨‹" class="headerlink" title="GitåŸºæœ¬å·¥ä½œæµç¨‹"></a>GitåŸºæœ¬å·¥ä½œæµç¨‹</h1><h2 id="Gitçš„å·¥ä½œåŒºåŸŸ"><a href="#Gitçš„å·¥ä½œåŒºåŸŸ" class="headerlink" title="Gitçš„å·¥ä½œåŒºåŸŸ"></a>Gitçš„å·¥ä½œåŒºåŸŸ</h2><p><img src="/2020/06/17/GITä½¿ç”¨è¯¦è§£/3.png" alt=""></p>
<h2 id="å‘ä»“åº“ä¸­æ·»åŠ æ–‡ä»¶æµç¨‹"><a href="#å‘ä»“åº“ä¸­æ·»åŠ æ–‡ä»¶æµç¨‹" class="headerlink" title="å‘ä»“åº“ä¸­æ·»åŠ æ–‡ä»¶æµç¨‹"></a>å‘ä»“åº“ä¸­æ·»åŠ æ–‡ä»¶æµç¨‹</h2><p><img src="/2020/06/17/GITä½¿ç”¨è¯¦è§£/4.png" alt=""></p>
<h1 id="Gitåˆå§‹åŒ–åŠä»“åº“åˆ›å»ºå’Œæ“ä½œ"><a href="#Gitåˆå§‹åŒ–åŠä»“åº“åˆ›å»ºå’Œæ“ä½œ" class="headerlink" title="Gitåˆå§‹åŒ–åŠä»“åº“åˆ›å»ºå’Œæ“ä½œ"></a>Gitåˆå§‹åŒ–åŠä»“åº“åˆ›å»ºå’Œæ“ä½œ</h1><h2 id="Gitå®‰è£…ä¹‹åéœ€è¦è¿›è¡Œä¸€äº›åŸºæœ¬ä¿¡æ¯è®¾ç½®"><a href="#Gitå®‰è£…ä¹‹åéœ€è¦è¿›è¡Œä¸€äº›åŸºæœ¬ä¿¡æ¯è®¾ç½®" class="headerlink" title="Gitå®‰è£…ä¹‹åéœ€è¦è¿›è¡Œä¸€äº›åŸºæœ¬ä¿¡æ¯è®¾ç½®"></a>Gitå®‰è£…ä¹‹åéœ€è¦è¿›è¡Œä¸€äº›åŸºæœ¬ä¿¡æ¯è®¾ç½®</h2><ol>
<li>è®¾ç½®ç”¨æˆ·åï¼šgit  config â€“ global  user.name  â€˜ä½ å†githubä¸Šæ³¨å†Œçš„ç”¨æˆ·åâ€™;</li>
<li>è®¾ç½®ç”¨æˆ·é‚®ç®±ï¼šgit  config â€“ global  user.email  â€˜æ³¨å†Œæ—¶å€™çš„é‚®ç®±â€™;</li>
</ol>
<p>æ³¨æ„ï¼šè¯¥é…ç½®ä¼šåœ¨githubä¸»é¡µä¸Šæ˜¾ç¤ºè°æäº¤äº†è¯¥æ–‡ä»¶</p>
<ol start="3">
<li>é…ç½®okä¹‹åï¼Œæˆ‘ä»¬ç”¨å¦‚ä¸‹å‘½ä»¤æ¥çœ‹çœ‹æ˜¯å¦é…ç½®æˆåŠŸ</li>
</ol>
<p>ã€€ã€€git config â€“list</p>
<p>æ³¨æ„ï¼šgit  config â€“global å‚æ•°ï¼Œæœ‰äº†è¿™ä¸ªå‚æ•°è¡¨ç¤ºä½ è¿™å°æœºå™¨ä¸Šæ‰€æœ‰çš„gitä»“åº“éƒ½ä¼šä½¿ç”¨è¿™ä¸ªé…ç½®ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥å¯¹æŸä¸ªä»“åº“æŒ‡å®šä¸åŒçš„ç”¨æˆ·åå’Œé‚®ç®±</p>
<h2 id="åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„gitä»“åº“"><a href="#åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„gitä»“åº“" class="headerlink" title="åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„gitä»“åº“"></a>åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„gitä»“åº“</h2><ol>
<li>åˆ›å»ºæ–‡ä»¶å¤¹</li>
</ol>
<p>ã€€ã€€ã€€ã€€æ–¹æ³•ä¸€ï¼šå¯ä»¥é¼ æ ‡å³å‡»-ã€‹ç‚¹å‡»æ–°å»ºæ–‡ä»¶å¤¹test1</p>
<p>ã€€ã€€ã€€ã€€æ–¹æ³•äºŒï¼šä½¿ç”¨gitæ–°å»ºï¼š$  mkdir test1</p>
<p><img src="/2020/06/17/GITä½¿ç”¨è¯¦è§£/5.png" alt=""></p>
<ol start="2">
<li>åœ¨æ–‡ä»¶å†…åˆå§‹åŒ–gitï¼ˆåˆ›å»ºgitä»“åº“ï¼‰</li>
</ol>
<p>ã€€ã€€ã€€ã€€æ–¹æ³•ä¸€ï¼šç›´æ¥è¾“å…¥ $ cd test1</p>
<p>ã€€ã€€ã€€ã€€æ–¹æ³•ä¸€ï¼šç‚¹å‡»test1æ–‡ä»¶ä¸‹è¿›å»ä¹‹å-ã€‹é¼ æ ‡å³å‡»é€‰æ‹©Git Bash Here-&gt;è¾“å…¥$ git int</p>
<p><img src="/2020/06/17/GITä½¿ç”¨è¯¦è§£/6.png" alt=""></p>
<ol start="3">
<li>å‘ä»“åº“ä¸­æ·»åŠ æ–‡ä»¶ã€€ã€€</li>
</ol>
<p>ã€€ã€€æ–¹æ³•ä¸€ï¼šç”¨æ‰“å¼€ç¼–è¾‘å™¨æ–°å»ºindex.htmlæ–‡ä»¶</p>
<p>ã€€ã€€æ–¹æ³•äºŒï¼šä½¿ç”¨gitå‘½ä»¤ã€‚$  touch â€˜æ–‡ä»¶åâ€™ï¼Œç„¶åæŠŠæ–‡ä»¶é€šè¿‡$ git add â€˜æ–‡ä»¶åâ€™æ·»åŠ åˆ°æš‚å­˜åŒºï¼Œæœ€åæäº¤æ“ä½œ</p>
<p><img src="/2020/06/17/GITä½¿ç”¨è¯¦è§£/7.png" alt=""></p>
<ol start="4">
<li>ä¿®æ”¹ä»“åº“æ–‡ä»¶</li>
</ol>
<p>ã€€ã€€æ–¹æ³•ä¸€ï¼šç”¨ç¼–è¾‘å™¨æ‰“å¼€index.htmlè¿›è¡Œä¿®æ”¹</p>
<p>ã€€ã€€æ–¹æ³•äºŒï¼šä½¿ç”¨gitå‘½ä»¤ã€‚$  vi  â€˜æ–‡ä»¶åâ€™ï¼Œç„¶ååœ¨ä¸­é—´å†™å†…å®¹ï¼Œæœ€åæäº¤æ“ä½œ</p>
<p><img src="/2020/06/17/GITä½¿ç”¨è¯¦è§£/8.png" alt=""></p>
<p><img src="/2020/06/17/GITä½¿ç”¨è¯¦è§£/9.png" alt=""></p>
<ol start="5">
<li>åˆ é™¤ä»“åº“æ–‡ä»¶</li>
</ol>
<p>ã€€ã€€æ–¹æ³•ä¸€ï¼šåœ¨ç¼–è¾‘å™¨ä¸­ç›´æ¥æŠŠè¦åˆ é™¤çš„æ–‡ä»¶åˆ é™¤æ‰</p>
<p>ã€€ã€€æ–¹æ³•äºŒï¼šä½¿ç”¨gitåˆ é™¤ï¼š$ git rm â€˜æ–‡ä»¶åâ€™ï¼Œç„¶åæäº¤æ“ä½œ</p>
<p><img src="/2020/06/17/GITä½¿ç”¨è¯¦è§£/10.png" alt=""></p>
<h1 id="Gitç®¡ç†è¿œç¨‹ä»“åº“"><a href="#Gitç®¡ç†è¿œç¨‹ä»“åº“" class="headerlink" title="Gitç®¡ç†è¿œç¨‹ä»“åº“"></a>Gitç®¡ç†è¿œç¨‹ä»“åº“</h1><p><img src="/2020/06/17/GITä½¿ç”¨è¯¦è§£/11.png" alt=""></p>
<h1 id="Gitå…‹éš†æ“ä½œ"><a href="#Gitå…‹éš†æ“ä½œ" class="headerlink" title="Gitå…‹éš†æ“ä½œ"></a>Gitå…‹éš†æ“ä½œ</h1><p>ç›®çš„ï¼šå°†è¿œç¨‹ä»“åº“ï¼ˆgithubä¸Šå¯¹åº”çš„é¡¹ç›®ï¼‰å¤åˆ¶åˆ°æœ¬åœ°</p>
<p><img src="/2020/06/17/GITä½¿ç”¨è¯¦è§£/12.png" alt=""></p>
<h2 id="ä»£ç ï¼šgit-clone-ä»“åº“åœ°å€"><a href="#ä»£ç ï¼šgit-clone-ä»“åº“åœ°å€" class="headerlink" title="ä»£ç ï¼šgit clone ä»“åº“åœ°å€"></a>ä»£ç ï¼šgit clone ä»“åº“åœ°å€</h2><p>ä»“åº“åœ°å€ç”±æ¥å¦‚ä¸‹ï¼š</p>
<h2 id="å…‹éš†é¡¹ç›®"><a href="#å…‹éš†é¡¹ç›®" class="headerlink" title="å…‹éš†é¡¹ç›®"></a>å…‹éš†é¡¹ç›®</h2><p><img src="/2020/06/17/GITä½¿ç”¨è¯¦è§£/13.png" alt=""></p>
<h2 id="å°†æœ¬åœ°ä»“åº“åŒæ­¥åˆ°gitè¿œç¨‹ä»“åº“ä¸­ï¼šgit-push"><a href="#å°†æœ¬åœ°ä»“åº“åŒæ­¥åˆ°gitè¿œç¨‹ä»“åº“ä¸­ï¼šgit-push" class="headerlink" title="å°†æœ¬åœ°ä»“åº“åŒæ­¥åˆ°gitè¿œç¨‹ä»“åº“ä¸­ï¼šgit push"></a>å°†æœ¬åœ°ä»“åº“åŒæ­¥åˆ°gitè¿œç¨‹ä»“åº“ä¸­ï¼šgit push</h2><p><img src="/2020/06/17/GITä½¿ç”¨è¯¦è§£/14.png" alt=""></p>
<h1 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h1><p><img src="/2020/06/17/GITä½¿ç”¨è¯¦è§£/15.png" alt=""></p>
<p>è§£å†³ï¼šè¿™æ˜¯é€šè¿‡Git GUIè¿›è¡Œæäº¤æ—¶å‘ç”Ÿçš„é”™è¯¯ï¼Œç”± .git æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶è¢«è®¾ä¸ºâ€œåªè¯»â€æ‰€è‡´ï¼Œå°† .git æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ã€æ–‡ä»¶å¤¹åŠå…¶å­æ–‡ä»¶çš„åªè¯»å±æ€§å»æ‰å³å¯ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/08/æ¶ˆæ¯é˜Ÿåˆ—5ä¸ªåº”ç”¨åœºæ™¯/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Airthink">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Airthink">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/08/æ¶ˆæ¯é˜Ÿåˆ—5ä¸ªåº”ç”¨åœºæ™¯/" itemprop="url">æ¶ˆæ¯é˜Ÿåˆ—5ä¸ªåº”ç”¨åœºæ™¯</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2020-06-08T15:49:23+08:00">
                2020-06-08
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>æ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­é‡è¦çš„ç»„ä»¶ï¼Œä¸»è¦è§£å†³åº”ç”¨è§£è€¦ï¼Œå¼‚æ­¥æ¶ˆæ¯ï¼Œæµé‡å‰Šå³°ç­‰é—®é¢˜ï¼Œå®ç°é«˜æ€§èƒ½ã€é«˜å¯ç”¨ã€å¯ä¼¸ç¼©å’Œæœ€ç»ˆä¸€è‡´æ€§æ¶æ„ï¼Œä½¿ç”¨è¾ƒå¤šçš„æ¶ˆæ¯é˜Ÿåˆ—æœ‰ActiveMQã€RabbitMQã€ZeroMQã€Kafkaã€MetaMQã€RocketMQã€‚</p>
<h2 id="æ¶ˆæ¯é˜Ÿåˆ—åº”ç”¨åœºæ™¯"><a href="#æ¶ˆæ¯é˜Ÿåˆ—åº”ç”¨åœºæ™¯" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—åº”ç”¨åœºæ™¯"></a>æ¶ˆæ¯é˜Ÿåˆ—åº”ç”¨åœºæ™¯</h2><h3 id="å¼‚æ­¥å¤„ç†"><a href="#å¼‚æ­¥å¤„ç†" class="headerlink" title="å¼‚æ­¥å¤„ç†"></a>å¼‚æ­¥å¤„ç†</h3><p>åœºæ™¯è¯´æ˜ï¼šç”¨æˆ·æ³¨å†Œåï¼Œéœ€è¦å‘é€æ³¨å†Œé‚®ä»¶å’Œæ³¨å†ŒçŸ­ä¿¡ï¼Œä¼ ç»Ÿçš„åšæ³•æœ‰ä¸¤ç§ï¼Œä¸²è¡Œçš„æ–¹å¼å’Œå¹¶è¡Œçš„æ–¹å¼ã€‚</p>
<p>ä¸²è¡Œæ–¹å¼ï¼šå°†æ³¨å†Œä¿¡æ¯å†™å…¥æ•°æ®åº“æˆåŠŸåï¼Œå‘é€æ³¨å†Œé‚®ä»¶ï¼Œåœ¨å‘é€æ³¨å†ŒçŸ­ä¿¡ï¼Œä»¥ä¸Šä¸‰ä¸ªä»»åŠ¡å…¨éƒ¨å®Œæˆåï¼Œè¿”å›ç»™ç”¨æˆ·ã€‚</p>
<p><img src="/2020/06/08/æ¶ˆæ¯é˜Ÿåˆ—5ä¸ªåº”ç”¨åœºæ™¯/æ‰¹æ³¨ 2020-06-08 160339.png" alt=""></p>
<p>å¹¶è¡Œçš„æ–¹å¼ï¼šå°†æ³¨å†Œä¿¡æ¯å†™å…¥æ•°æ®åº“æˆåŠŸåï¼Œå‘é€æ³¨å†Œé‚®ä»¶çš„åŒæ—¶ï¼Œå‘é€æ³¨å†ŒçŸ­ä¿¡ï¼Œä»¥ä¸Šä¸‰ä¸ªä»»åŠ¡å®Œæˆåï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ã€‚ä¸ä¸²è¡Œçš„å·®åˆ«æ˜¯ï¼Œå¹¶è¡Œçš„æ–¹å¼å¯ä»¥æé«˜å¤„ç†çš„æ—¶é—´ã€‚</p>
<p><img src="/2020/06/08/æ¶ˆæ¯é˜Ÿåˆ—5ä¸ªåº”ç”¨åœºæ™¯/æ‰¹æ³¨ 2020-06-08 160514.png" alt=""></p>
<p>å‡è®¾ä¸‰ä¸ªä¸šåŠ¡èŠ‚ç‚¹æ¯ä¸ªä½¿ç”¨50æ¯«ç§’ï¼Œä¸è€ƒè™‘ç½‘ç»œç­‰å…¶ä»–å¼€é”€ï¼Œåˆ™ä¸²è¡Œæ–¹å¼æ—¶é—´æ˜¯150æ¯«ç§’ï¼Œå¹¶è¡Œçš„æ—¶é—´æ˜¯100æ¯«ç§’ã€‚</p>
<p>å› ä¸ºCPUåœ¨å•ä½æ—¶é—´å†…å¤„ç†çš„è¯·æ±‚æ•°æ˜¯ä¸€å®šçš„ï¼Œå‡è®¾CPU1ç§’å†…çš„ååé‡æ˜¯100æ¬¡ã€‚åˆ™ä¸²è¡Œæ–¹å¼1ç§’å†…CPUå¯å¤„ç†çš„è¯·æ±‚é‡æ˜¯7æ¬¡ï¼ˆ1000/150ï¼‰ã€‚å¹¶è¡Œæ–¹å¼å¤„ç†çš„è¯·æ±‚æ˜¯10ï¼ˆ1000/100ï¼‰æ¬¡ã€‚</p>
<p>å¦‚ä»¥ä¸Šæ¡ˆä¾‹æè¿°ï¼Œä¼ ç»Ÿçš„æ–¹å¼ç³»ç»Ÿçš„æ€§èƒ½ï¼ˆå¹¶å‘é‡ï¼Œååé‡ï¼Œå“åº”æ—¶é—´ï¼‰ä¼šæœ‰ç“¶é¢ˆï¼Œå¦‚ä½•è§£å†³å‘¢ï¼Ÿ</p>
<p>å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå°†ä¸æ˜¯å¿…é¡»çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¼‚æ­¥å¤„ç†ï¼Œæ”¹é€ åå¦‚ä¸‹</p>
<p><img src="/2020/06/08/æ¶ˆæ¯é˜Ÿåˆ—5ä¸ªåº”ç”¨åœºæ™¯/æ‰¹æ³¨ 2020-06-08 160530.png" alt=""></p>
<p>æŒ‰ç…§ä»¥ä¸Šçº¦å®šï¼Œç”¨æˆ·çš„å“åº”æ—¶é—´æƒ³å½“ä¸æ˜¯æ³¨å†Œä¿¡æ¯å†™å…¥æ•°æ®åº“çš„æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯50æ¯«ç§’ã€‚æ³¨å†Œé‚®ä»¶ï¼Œå‘é€çŸ­ä¿¡å†™å…¥æ¶ˆæ¯é˜Ÿåˆ—åï¼Œç›´æ¥è¿”å›ï¼Œå› æ­¤å†™å…¥æ¶ˆæ¯é˜Ÿåˆ—çš„é€Ÿåº¦å¾ˆå¿«ï¼ŒåŸºæœ¬å¯ä»¥å¿½ç•¥ï¼Œå› æ­¤ç”¨æˆ·çš„å“åº”æ—¶é—´å¯èƒ½å°±æ˜¯50æ¯«ç§’ã€‚å› æ­¤æ¶æ„æ”¹å˜åï¼Œç³»ç»Ÿçš„ååé‡æé«˜åˆ°æ¯ç§’20QPSã€‚æ¯”ä¸²è¡Œæé«˜äº†3å€ï¼Œæ¯”å¹¶è¡Œæé«˜äº†2å€ã€‚</p>
<h3 id="åº”ç”¨è§£è€¦"><a href="#åº”ç”¨è§£è€¦" class="headerlink" title="åº”ç”¨è§£è€¦"></a>åº”ç”¨è§£è€¦</h3><p>åœºæ™¯è¯´æ˜ï¼šç”¨æˆ·ä¸‹å•åï¼Œè®¢å•ç³»ç»Ÿéœ€è¦é€šçŸ¥åº“å­˜ç³»ç»Ÿã€‚ä¼ ç»Ÿçš„åšæ³•æ˜¯ï¼Œè®¢å•ç³»ç»Ÿè°ƒç”¨åº“å­˜ç³»ç»Ÿçš„æ¥å£ã€‚å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/2020/06/08/æ¶ˆæ¯é˜Ÿåˆ—5ä¸ªåº”ç”¨åœºæ™¯/æ‰¹æ³¨ 2020-06-08 161344.png" alt=""></p>
<p>ç¼ºç‚¹ï¼šå‡å¦‚åº“å­˜ç³»ç»Ÿæ— æ³•è®¿é—®ï¼Œåˆ™è®¢å•å‡åº“å­˜å°†å¤±è´¥ï¼Œä»è€Œå¯¼è‡´è®¢å•å¤±è´¥ï¼Œè®¢å•ç³»ç»Ÿä¸åº“å­˜ç³»ç»Ÿå­˜åœ¨è€¦åˆ</p>
<p>è§£å†³ï¼šå¼•å…¥åº”ç”¨æ¶ˆæ¯é˜Ÿåˆ—</p>
<p><img src="/2020/06/08/æ¶ˆæ¯é˜Ÿåˆ—5ä¸ªåº”ç”¨åœºæ™¯/æ‰¹æ³¨ 2020-06-08 161632.png" alt=""></p>
<p>è®¢å•ç³»ç»Ÿï¼šç”¨æˆ·ä¸‹å•åï¼Œè®¢å•ç³»ç»Ÿå®ŒæˆæŒä¹…åŒ–å¤„ç†ï¼Œå°†æ¶ˆæ¯å†™å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¿”å›ç”¨æˆ·è®¢å•ä¸‹å•æˆåŠŸã€‚</p>
<p>åº“å­˜ç³»ç»Ÿï¼šè®¢é˜…ä¸‹å•çš„æ¶ˆæ¯ï¼Œé‡‡ç”¨æ‹‰/æ¨çš„æ–¹å¼ï¼Œè·å–ä¸‹å•ä¿¡æ¯ï¼Œåº“å­˜ç³»ç»Ÿæ ¹æ®ä¸‹å•ä¿¡æ¯ï¼Œè¿›è¡Œåº“å­˜æ“ä½œã€‚</p>
<p>å‡å¦‚ï¼šåœ¨ä¸‹å•æ—¶åº“å­˜ç³»ç»Ÿä¸èƒ½æ­£å¸¸ä½¿ç”¨ã€‚ä¹Ÿä¸å½±å“æ­£å¸¸ä¸‹å•ï¼Œå› ä¸ºä¸‹å•åï¼Œè®¢å•ç³»ç»Ÿå†™å…¥æ¶ˆæ¯é˜Ÿåˆ—å°±ä¸å†å…³å¿ƒå…¶ä»–çš„åç»­æ“ä½œäº†ã€‚å®ç°è®¢å•ç³»ç»Ÿä¸åº“å­˜ç³»ç»Ÿçš„åº”ç”¨è§£è€¦ã€‚</p>
<h3 id="æµé‡å‰Šå³°"><a href="#æµé‡å‰Šå³°" class="headerlink" title="æµé‡å‰Šå³°"></a>æµé‡å‰Šå³°</h3><p>æµé‡å‰Šå³°ä¹Ÿæ˜¯æ¶ˆæ¯é˜Ÿåˆ—ä¸­å¸¸ç”¨çš„åœºæ™¯ï¼Œä¸€èˆ¬åœ¨ç§’æ€æˆ–å›¢æŠ¢æ´»åŠ¨ä¸­ä½¿ç”¨å¹¿æ³›ã€‚</p>
<p>åº”ç”¨åœºæ™¯ï¼šç§’æ€æ´»åŠ¨ï¼Œä¸€èˆ¬ä¼šå› ä¸ºæµé‡è¿‡å¤§ï¼Œå¯¼è‡´æµé‡æš´å¢ï¼Œåº”ç”¨æŒ‚æ‰ã€‚ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸€èˆ¬éœ€è¦åœ¨åº”ç”¨å‰ç«¯å‡å¦‚æ¶ˆæ¯é˜Ÿåˆ—ã€‚</p>
<p>å¯ä»¥æ§åˆ¶æ´»åŠ¨çš„äººæ•°ï¼Œå¯ä»¥ç¼“è§£çŸ­æ—¶é—´å†…é«˜æµé‡å‹å®åº”ç”¨ã€‚</p>
<p><img src="/2020/06/08/æ¶ˆæ¯é˜Ÿåˆ—5ä¸ªåº”ç”¨åœºæ™¯/æ‰¹æ³¨ 2020-06-08 162324.png" alt=""></p>
<p>ç”¨æˆ·çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨æ¥æ”¶åˆ°åå…ˆå†™å…¥æ¶ˆæ¯é˜Ÿåˆ—ã€‚å‡å¦‚æ¶ˆæ¯é˜Ÿåˆ—é•¿åº¦è¶…è¿‡æœ€å¤§æ•°é‡ï¼Œåˆ™ç›´æ¥æŠ›å¼ƒç”¨æˆ·è¯·æ±‚æˆ–è·³è½¬åˆ°é”™è¯¯çš„é¡µé¢ã€‚</p>
<p>ç§’æ€ä¸šåŠ¡æ ¹æ®æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„è¯·æ±‚ä¿¡æ¯ï¼Œå†åšåç»­å¤„ç†ã€‚</p>
<h3 id="æ—¥å¿—å¤„ç†"><a href="#æ—¥å¿—å¤„ç†" class="headerlink" title="æ—¥å¿—å¤„ç†"></a>æ—¥å¿—å¤„ç†</h3><p>æ—¥å¿—å¤„ç†æ˜¯æŒ‡å°†æ¶ˆæ¯uiåˆ—ç”¨åœ¨æ—¥å¿—å¤„ç†ä¸­ï¼Œæ¯”å¦‚Kafkaçš„åº”ç”¨ï¼Œè§£å†³å¤§é‡æ—¥å¿—ä¼ è¾“çš„é—®é¢˜ã€‚æ¶æ„ç®€åŒ–å¦‚ä¸‹ï¼š</p>
<p><img src="/2020/06/08/æ¶ˆæ¯é˜Ÿåˆ—5ä¸ªåº”ç”¨åœºæ™¯/æ‰¹æ³¨ 2020-06-08 162722.png" alt=""></p>
<p>æ—¥å¿—é‡‡é›†å®¢æˆ·ç«¯ï¼Œè´Ÿè´£æ—¥å¿—æ•°æ®é‡‡é›†ï¼Œå®šæ—¶å†™å…¥Kafkaé˜Ÿåˆ—ï¼›Kafakæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè´Ÿè´£æ—¥å¿—æ•°æ®çš„æ¥æ”¶ï¼Œå­˜å‚¨å’Œè½¬å‘ï¼›æ—¥å¿—å¤„ç†åº”ç”¨ï¼šè®¢é˜…å¹¶æ¶ˆè´¹kafakaé˜Ÿåˆ—ä¸­çš„æ—¥å¿—æ•°æ®ã€‚</p>
<p>ä»¥ä¸‹æ˜¯æ–°æµªkafkaæ—¥å¿—å¤„ç†åº”ç”¨æ¡ˆä¾‹ï¼š</p>
<p><img src="/2020/06/08/æ¶ˆæ¯é˜Ÿåˆ—5ä¸ªåº”ç”¨åœºæ™¯/æ‰¹æ³¨ 2020-06-08 163012.png" alt=""></p>
<p> Kafka:æ¥æ”¶ç”¨æˆ·æ—¥å¿—çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼›</p>
<p> Logstach:åšæ—¥å¿—è§£æï¼Œç»Ÿä¸€æˆJSONä¼ è¾“ç»™Elasticsearch;</p>
<p> Elasticsearch:å®æ—¶æ—¥å¿—åˆ†ææœåŠ¡çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œä¸€ä¸ªschemaless,å®æ—¶çš„æ•°æ®å­˜å‚¨æœåŠ¡ï¼Œé€šè¿‡indexç»„ç»‡æ•°æ®ï¼Œå…¼å…·å¼ºå¤§çš„æœç´¢å’Œç»Ÿè®¡åŠŸèƒ½ã€‚</p>
<p> Kibaba:åŸºäºElasticsearchçš„æ•°æ®å¯è§†åŒ–ç»„ä»¶ï¼Œè¶…å¼ºçš„æ•°æ®å¯è§†åŒ–èƒ½åŠ›</p>
<h3 id="æ¶ˆæ¯é€šè®¯"><a href="#æ¶ˆæ¯é€šè®¯" class="headerlink" title="æ¶ˆæ¯é€šè®¯"></a>æ¶ˆæ¯é€šè®¯</h3><p>æ¶ˆæ¯é€šè®¯æ˜¯æŒ‡ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¸€èˆ¬éƒ½å†…ç½®äº†é«˜æ•ˆçš„é€šä¿¡æœºåˆ¶ï¼Œå› æ­¤ä¹Ÿå¯ä»¥ç”¨åœ¨çº¯çš„æ¶ˆæ¯é€šè®¯ï¼Œæ¯”å¦‚å®ç°ç‚¹å¯¹ç‚¹æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæˆ–è€…èŠå¤©å®¤ç­‰ã€‚</p>
<p><img src="/2020/06/08/æ¶ˆæ¯é˜Ÿåˆ—5ä¸ªåº”ç”¨åœºæ™¯/æ‰¹æ³¨ 2020-06-08 163623.png" alt=""></p>
<p>å®¢æˆ·ç«¯Aï¼Œå®¢æˆ·ç«¯Bï¼Œå®¢æˆ·ç«¯Nè®¢é˜…åŒä¸€ä¸»é¢˜ï¼Œè¿›è¡Œæ¶ˆæ¯å‘å¸ƒå’Œæ¥æ”¶ã€‚å®ç°ç±»ä¼¼èŠå¤©å®¤æ•ˆæœã€‚</p>
<h2 id="å®æˆ˜ç”¨rediså®ç°ç®€å•çš„å‘å¸ƒ-è®¢é˜…"><a href="#å®æˆ˜ç”¨rediså®ç°ç®€å•çš„å‘å¸ƒ-è®¢é˜…" class="headerlink" title="å®æˆ˜ç”¨rediså®ç°ç®€å•çš„å‘å¸ƒ/è®¢é˜…"></a>å®æˆ˜ç”¨rediså®ç°ç®€å•çš„å‘å¸ƒ/è®¢é˜…</h2><p>åœºæ™¯ï¼šä¸¤å°tomcatåšé›†ç¾¤ï¼Œé…ç½®æ–‡ä»¶ä¸åŒæ—¶ç”Ÿæ•ˆçš„é—®é¢˜</p>
<pre><code>&lt;bean id=&quot;messageContainer&quot;
    class=&quot;org.springframework.data.redis.listener.RedisMessageListenerContainer&quot;
    destroy-method=&quot;destroy&quot;&gt;
    &lt;property name=&quot;connectionFactory&quot; ref=&quot;jedisConnectionFactory&quot; /&gt;
    &lt;property name=&quot;messageListeners&quot;&gt;
        &lt;map&gt;
            &lt;entry key-ref=&quot;subService&quot;&gt;
                &lt;ref bean=&quot;channelTopic&quot; /&gt;
            &lt;/entry&gt;
        &lt;/map&gt;
    &lt;/property&gt;
&lt;/bean&gt;
&lt;bean id=&quot;channelTopic&quot; class=&quot;org.springframework.data.redis.listener.ChannelTopic&quot;&gt;
    &lt;constructor-arg value=&quot;server:topic&quot; /&gt;
&lt;/bean&gt;

@Service
public class PubServiceImpl implements PubService {

    private static final Logger logger = Logger.getLogger(PubService.class);

    @Autowired
    private RedisTemplate&lt;String, String&gt; redisTemplate;

    private String channelTopic = &quot;server:topic&quot;;

    public void publish(String str) {
        //String str = JsonUtils.toJson(message);
        logger.error(&quot;Publish message:&quot; + str + &quot;, topic:&quot; + channelTopic);
        redisTemplate.convertAndSend(channelTopic, str);
    }

    public void publish(Map&lt;String, Object&gt; message) {
        String str = JsonUtils.toJson(message);
        logger.error(&quot;Publish message:&quot; + str + &quot;, topic:&quot; + channelTopic);
        redisTemplate.convertAndSend(channelTopic, str);
    }
}

@Service(&quot;subService&quot;)
public class SubServiceImpl implements MessageListener {

    private static final Logger logger = Logger.getLogger(SubServiceImpl.class);

    @Autowired
    private ChannelTopic channelTopic;

    @Override
    public void onMessage(Message message, byte[] pattern) {
        String str = message.toString();
        logger.error(&quot;Subscribe message:&quot; + str + &quot;, topic:&quot; + channelTopic.getTopic());
        try {
            String type =  m.getType();
            if (&quot;config&quot;.equals(type)) {
                System.out.println(&quot;æ¥æ”¶åˆ°æ¶ˆæ¯ï¼ŒdoSomething========&quot;);
            }else if(&quot;me&quot;.equals(type)){
                System.out.println(&quot;æ¥æ”¶åˆ°æ¶ˆæ¯ï¼ŒdoSomething========&quot;);
            }else{
                System.out.println(&quot;æ¥æ”¶åˆ°æ¶ˆæ¯ï¼ŒdoSomething========&quot;);
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/08/JAVAçš„map/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Airthink">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Airthink">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/08/JAVAçš„map/" itemprop="url">JAVAçš„map</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2020-06-08T11:45:45+08:00">
                2020-06-08
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Mapçš„ç”¨æ³•"><a href="#Mapçš„ç”¨æ³•" class="headerlink" title="Mapçš„ç”¨æ³•"></a>Mapçš„ç”¨æ³•</h1><h2 id="ç±»å‹ä»‹ç»"><a href="#ç±»å‹ä»‹ç»" class="headerlink" title="ç±»å‹ä»‹ç»"></a>ç±»å‹ä»‹ç»</h2><ul>
<li><p>HashMap</p>
<p>  æœ€å¸¸ç”¨çš„Map,å®ƒæ ¹æ®é”®çš„HashCodeå€¼å­˜å‚¨æ•°æ®ï¼Œæ ¹æ®é”®å¯ä»¥ç›´æ¥è·å–å®ƒçš„å€¼ï¼Œå…·æœ‰å¾ˆå¿«çš„è®¿é—®é€Ÿåº¦ã€‚HashMapæœ€å¤šåªå…è®¸ä¸€æ¡è®°å½•çš„é”®ä¸ºnullï¼ˆå¤šæ¡ä¼šè¦†ç›–ï¼‰ï¼›å…è®¸å¤šæ¡è®°å½•çš„å€¼ä¸ºnullã€‚éåŒæ­¥çš„ã€‚</p>
</li>
<li><p>TreeMap</p>
<p>  èƒ½å¤ŸæŠŠå®ƒä¿å­˜çš„è®°å½•æ ¹æ®é”®ï¼ˆkeyï¼‰æ’åºï¼Œé»˜è®¤æ˜¯æŒ‰å‡åºæ’åºï¼Œä¹Ÿå¯æŒ‡å®šæ’åºçš„æ¯”è¾ƒå™¨ï¼Œå½“ç”¨Iteratoréå†TreeMapæ—¶ï¼Œå¾—åˆ°çš„è®°å½•æ˜¯æ’è¿‡åºçš„ã€‚TreeMapä¸å…è®¸keyçš„å€¼ä¸ºnullã€‚éåŒæ­¥çš„ã€‚</p>
</li>
<li><p>Hashtable</p>
<p>  ä¸HashMapç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯ï¼škeyå’Œvalueçš„å€¼å‡ä¸å…è®¸ä¸ºnull;å®ƒæ”¯æŒçº¿ç¨‹åŒæ­¥ï¼Œå³ä»»ä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å†™HashTable,å› æ­¤ä¹Ÿå¯¼è‡´äº†HashTableåœ¨å†™å…¥æ—¶ä¼šæ¯”è¾ƒæ…¢ã€‚</p>
</li>
<li><p>LinkedHashMap</p>
<p>  ä¿å­˜äº†è®°å½•çš„æ’å…¥é¡ºåºï¼Œåœ¨ä½¿ç”¨Iteratoréå†LinkedHashMapæ—¶ï¼Œå…ˆå¾—åˆ°çš„è®°å½•è‚¯å®šæ˜¯å…ˆæ’å…¥çš„ï¼Œåœ¨éå†çš„æ—¶å€™ä¼šæ¯”HashMapæ…¢ã€‚keyå’Œvalueå‡å…è®¸ä¸ºç©ºã€‚éåŒæ­¥çš„ã€‚</p>
</li>
</ul>
<h2 id="Mapç”¨æ³•"><a href="#Mapç”¨æ³•" class="headerlink" title="Mapç”¨æ³•"></a>Mapç”¨æ³•</h2><pre><code>ç”¨æ³•
Map&lt;String,String&gt; map = new HashMap&lt;String,String&gt;();

æ’å…¥å…ƒç´ 

map.put(&quot;key1&quot;,&quot;value1&quot;);

è·å–å…ƒç´ 

map.get(&quot;key1&quot;);

ç§»é™¤å…ƒç´ 

map.remove(&quot;key1&quot;)
</code></pre><h2 id="å››ç§å¸¸ç”¨Mapæ’å…¥ä¸è¯»å–æ€§èƒ½æ¯”è¾ƒ"><a href="#å››ç§å¸¸ç”¨Mapæ’å…¥ä¸è¯»å–æ€§èƒ½æ¯”è¾ƒ" class="headerlink" title="å››ç§å¸¸ç”¨Mapæ’å…¥ä¸è¯»å–æ€§èƒ½æ¯”è¾ƒ"></a>å››ç§å¸¸ç”¨Mapæ’å…¥ä¸è¯»å–æ€§èƒ½æ¯”è¾ƒ</h2><p><img src="/2020/06/08/JAVAçš„map/æ‰¹æ³¨ 2020-06-08 124807.png" alt=""></p>
<pre><code>æµ‹è¯•ä»£ç 

package net.xsoftlab.baike;
import java.util.HashMap;
import java.util.Hashtable;
import java.util.LinkedHashMap;
import java.util.Map;
import java.util.Random;
import java.util.TreeMap;
import java.util.UUID;
public class Test {
    static int hashMapW = 0;
    static int hashMapR = 0;
    static int linkMapW = 0;
    static int linkMapR = 0;
    static int treeMapW = 0;
    static int treeMapR = 0;
    static int hashTableW = 0;
    static int hashTableR = 0;
    public static void main(String[] args) {
        for (int i = 0; i &lt; 10; i++) {
            Test test = new Test();
            test.test(100 * 10000);
            System.out.println();
        }
        System.out.println(&quot;hashMapW = &quot; + hashMapW / 10);
        System.out.println(&quot;hashMapR = &quot; + hashMapR / 10);
        System.out.println(&quot;linkMapW = &quot; + linkMapW / 10);
        System.out.println(&quot;linkMapR = &quot; + linkMapR / 10);
        System.out.println(&quot;treeMapW = &quot; + treeMapW / 10);
        System.out.println(&quot;treeMapR = &quot; + treeMapR / 10);
        System.out.println(&quot;hashTableW = &quot; + hashTableW / 10);
        System.out.println(&quot;hashTableR = &quot; + hashTableR / 10);
    }
    public void test(int size) {
        int index;
        Random random = new Random();
        String[] key = new String[size];
        // HashMap æ’å…¥
        Map&lt;String, String&gt; map = new HashMap&lt;String, String&gt;();
        long start = System.currentTimeMillis();
        for (int i = 0; i &lt; size; i++) {
            key[i] = UUID.randomUUID().toString();
            map.put(key[i], UUID.randomUUID().toString());
        }
        long end = System.currentTimeMillis();
        hashMapW += (end - start);
        System.out.println(&quot;HashMapæ’å…¥è€—æ—¶ = &quot; + (end - start) + &quot; ms&quot;);
        // HashMap è¯»å–
        start = System.currentTimeMillis();
        for (int i = 0; i &lt; size; i++) {
            index = random.nextInt(size);
            map.get(key[index]);
        }
        end = System.currentTimeMillis();
        hashMapR += (end - start);
        System.out.println(&quot;HashMapè¯»å–è€—æ—¶ = &quot; + (end - start) + &quot; ms&quot;);
        // LinkedHashMap æ’å…¥
        map = new LinkedHashMap&lt;String, String&gt;();
        start = System.currentTimeMillis();
        for (int i = 0; i &lt; size; i++) {
            key[i] = UUID.randomUUID().toString();
            map.put(key[i], UUID.randomUUID().toString());
        }
        end = System.currentTimeMillis();
        linkMapW += (end - start);
        System.out.println(&quot;LinkedHashMapæ’å…¥è€—æ—¶ = &quot; + (end - start) + &quot; ms&quot;);
        // LinkedHashMap è¯»å–
        start = System.currentTimeMillis();
        for (int i = 0; i &lt; size; i++) {
            index = random.nextInt(size);
            map.get(key[index]);
        }
        end = System.currentTimeMillis();
        linkMapR += (end - start);
        System.out.println(&quot;LinkedHashMapè¯»å–è€—æ—¶ = &quot; + (end - start) + &quot; ms&quot;);
        // TreeMap æ’å…¥
        key = new String[size];
        map = new TreeMap&lt;String, String&gt;();
        start = System.currentTimeMillis();
        for (int i = 0; i &lt; size; i++) {
            key[i] = UUID.randomUUID().toString();
            map.put(key[i], UUID.randomUUID().toString());
        }
        end = System.currentTimeMillis();
        treeMapW += (end - start);
        System.out.println(&quot;TreeMapæ’å…¥è€—æ—¶ = &quot; + (end - start) + &quot; ms&quot;);
        // TreeMap è¯»å–
        start = System.currentTimeMillis();
        for (int i = 0; i &lt; size; i++) {
            index = random.nextInt(size);
            map.get(key[index]);
        }
        end = System.currentTimeMillis();
        treeMapR += (end - start);
        System.out.println(&quot;TreeMapè¯»å–è€—æ—¶ = &quot; + (end - start) + &quot; ms&quot;);
        // Hashtable æ’å…¥
        key = new String[size];
        map = new Hashtable&lt;String, String&gt;();
        start = System.currentTimeMillis();
        for (int i = 0; i &lt; size; i++) {
            key[i] = UUID.randomUUID().toString();
            map.put(key[i], UUID.randomUUID().toString());
        }
        end = System.currentTimeMillis();
        hashTableW += (end - start);
        System.out.println(&quot;Hashtableæ’å…¥è€—æ—¶ = &quot; + (end - start) + &quot; ms&quot;);
        // Hashtable è¯»å–
        start = System.currentTimeMillis();
        for (int i = 0; i &lt; size; i++) {
            index = random.nextInt(size);
            map.get(key[index]);
        }
        end = System.currentTimeMillis();
        hashTableR += (end - start);
        System.out.println(&quot;Hashtableè¯»å–è€—æ—¶ = &quot; + (end - start) + &quot; ms&quot;);
    }
}
</code></pre><h2 id="Mapéå†"><a href="#Mapéå†" class="headerlink" title="Mapéå†"></a>Mapéå†</h2><h3 id="åˆå§‹åŒ–æ•°æ®"><a href="#åˆå§‹åŒ–æ•°æ®" class="headerlink" title="åˆå§‹åŒ–æ•°æ®"></a>åˆå§‹åŒ–æ•°æ®</h3><pre><code>Map&lt;String,String&gt; map = new HashMap&lt;String,String&gt;();
map.put(&quot;key1&quot;,&quot;value1&quot;);
map.put(&quot;key2&quot;,&quot;value2&quot;);
</code></pre><h3 id="å¢å¼ºforå¾ªç¯éå†"><a href="#å¢å¼ºforå¾ªç¯éå†" class="headerlink" title="å¢å¼ºforå¾ªç¯éå†"></a>å¢å¼ºforå¾ªç¯éå†</h3><p>ä½¿ç”¨keySet()éå†</p>
<pre><code>for(String key:map.keySet()){
    System.out.println(key+&quot;:&quot;+map.get(key))
}
</code></pre><p>ä½¿ç”¨entrySet()éå†</p>
<pre><code>for(Map.Entry&lt;String,String&gt; entry:map.entrySet()){
    System.out.println(entry.getKey()+&quot;:&quot;+entry.getValue());
}
</code></pre><h3 id="è¿­ä»£å™¨éå†"><a href="#è¿­ä»£å™¨éå†" class="headerlink" title="è¿­ä»£å™¨éå†"></a>è¿­ä»£å™¨éå†</h3><p>ä½¿ç”¨keySet()éå†</p>
<pre><code>Iterator&lt;String&gt; iterator = map.keySet().iterator();
while(iterator.hasNext()){
    String key = iterator.next();
    System.out.println(key+&quot;:&quot;+map.get(key));
}
</code></pre><p>ä½¿ç”¨entrySet()éå†</p>
<pre><code>Iterator&lt;Map.Entry&lt;String,String&gt;&gt; iterator = map.entrySet().iterator();
while(iterator.hasNext()){
    Map.Entry&lt;String,String&gt; entry = iterator.next();
    System.out.println(entry.getKey()+&quot;:&quot;+entry.getValue());
}
</code></pre><h2 id="HashMapå››ç§éå†æ–¹å¼æ€§èƒ½æ¯”è¾ƒ"><a href="#HashMapå››ç§éå†æ–¹å¼æ€§èƒ½æ¯”è¾ƒ" class="headerlink" title="HashMapå››ç§éå†æ–¹å¼æ€§èƒ½æ¯”è¾ƒ"></a>HashMapå››ç§éå†æ–¹å¼æ€§èƒ½æ¯”è¾ƒ</h2><pre><code>package net.xsoftlab.baike;
import java.util.HashMap;
import java.util.Iterator;
import java.util.Map;
import java.util.Map.Entry;
public class TestMap {
    public static void main(String[] args) {
        // åˆå§‹åŒ–ï¼Œ10Wæ¬¡èµ‹å€¼
        Map&lt;Integer, Integer&gt; map = new HashMap&lt;Integer, Integer&gt;();
        for (int i = 0; i &lt; 100000; i++)
            map.put(i, i);
        /** å¢å¼ºforå¾ªç¯ï¼ŒkeySetè¿­ä»£ **/
        long start = System.currentTimeMillis();
        for (Integer key : map.keySet()) {
            map.get(key);
        }
        long end = System.currentTimeMillis();
        System.out.println(&quot;å¢å¼ºforå¾ªç¯ï¼ŒkeySetè¿­ä»£ -&gt; &quot; + (end - start) + &quot; ms&quot;);
        /** å¢å¼ºforå¾ªç¯ï¼ŒentrySetè¿­ä»£ */
        start = System.currentTimeMillis();
        for (Entry&lt;Integer, Integer&gt; entry : map.entrySet()) {
            entry.getKey();
            entry.getValue();
        }
        end = System.currentTimeMillis();
        System.out.println(&quot;å¢å¼ºforå¾ªç¯ï¼ŒentrySetè¿­ä»£ -&gt; &quot; + (end - start) + &quot; ms&quot;);
        /** è¿­ä»£å™¨ï¼ŒkeySetè¿­ä»£ **/
        start = System.currentTimeMillis();
        Iterator&lt;Integer&gt; iterator = map.keySet().iterator();
        Integer key;
        while (iterator.hasNext()) {
            key = iterator.next();
            map.get(key);
        }
        end = System.currentTimeMillis();
        System.out.println(&quot;è¿­ä»£å™¨ï¼ŒkeySetè¿­ä»£ -&gt; &quot; + (end - start) + &quot; ms&quot;);
        /** è¿­ä»£å™¨ï¼ŒentrySetè¿­ä»£ **/
        start = System.currentTimeMillis();
        Iterator&lt;Map.Entry&lt;Integer, Integer&gt;&gt; iterator1 = map.entrySet().iterator();
        Map.Entry&lt;Integer, Integer&gt; entry;
        while (iterator1.hasNext()) {
            entry = iterator1.next();
            entry.getKey();
            entry.getValue();
        }
        end = System.currentTimeMillis();
        System.out.println(&quot;è¿­ä»£å™¨ï¼ŒentrySetè¿­ä»£ -&gt; &quot; + (end - start) + &quot; ms&quot;);
    }
}

è¿è¡Œä¸‰æ¬¡ï¼Œæ¯”è¾ƒç»“æœ ç¬¬ä¸€æ¬¡
å¢å¼ºforå¾ªç¯ï¼ŒkeySetè¿­ä»£ -&gt; 37 ms
å¢å¼ºforå¾ªç¯ï¼ŒentrySetè¿­ä»£ -&gt; 19 ms
è¿­ä»£å™¨ï¼ŒkeySetè¿­ä»£ -&gt; 14 ms
è¿­ä»£å™¨ï¼ŒentrySetè¿­ä»£ -&gt; 9 ms

å¢å¼ºforå¾ªç¯ï¼ŒkeySetè¿­ä»£ -&gt; 29 ms
å¢å¼ºforå¾ªç¯ï¼ŒentrySetè¿­ä»£ -&gt; 22 ms
è¿­ä»£å™¨ï¼ŒkeySetè¿­ä»£ -&gt; 19 ms
è¿­ä»£å™¨ï¼ŒentrySetè¿­ä»£ -&gt; 12 ms

å¢å¼ºforå¾ªç¯ï¼ŒkeySetè¿­ä»£ -&gt; 27 ms
å¢å¼ºforå¾ªç¯ï¼ŒentrySetè¿­ä»£ -&gt; 19 ms
è¿­ä»£å™¨ï¼ŒkeySetè¿­ä»£ -&gt; 18 ms
è¿­ä»£å™¨ï¼ŒentrySetè¿­ä»£ -&gt; 10 ms
</code></pre><p>æ€»ç»“ï¼š</p>
<ol>
<li>å¢å¼ºforå¾ªç¯ä½¿ç”¨æ–¹ä¾¿ï¼Œä½†æ€§èƒ½è¾ƒå·®ï¼Œä¸é€‚åˆå¤„ç†è¶…å¤§é‡çº§çš„æ•°æ®ã€‚</li>
<li>è¿­ä»£å™¨çš„éå†é€Ÿåº¦è¦æ¯”å¢å¼ºforå¾ªç¯å¿«å¾ˆå¤šï¼Œæ˜¯å¢å¼ºforå¾ªç¯çš„2å€å·¦å³ã€‚</li>
<li>ä½¿ç”¨entrySetéå†çš„é€Ÿåº¦æ¯”keySetå¿«å¾ˆå¤šï¼Œæ˜¯keySetçš„1.5å€å·¦å³ã€‚</li>
</ol>
<h2 id="Mapæ’åº"><a href="#Mapæ’åº" class="headerlink" title="Mapæ’åº"></a>Mapæ’åº</h2><p>HashMapã€HashTableã€LinkedHashMapæ’åº</p>
<h3 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h3><pre><code>Map&lt;String,String&gt; map = new HashMap&lt;String,String&gt;();
map.put(&quot;b&quot;,&quot;b&quot;);
map.put(&quot;a&quot;,&quot;c&quot;);
map.put(&quot;c&quot;,&quot;a&quot;);
//æ’åº
List&lt;Map.Entry&lt;String,String&gt;&gt; list = new ArrayList&lt;Map.Entry&lt;String, String&gt;&gt;(map.entrySet().size());
Collections.sort(list, new Comparator&lt;Map.Entry&lt;String, String&gt;&gt;() {
    @Override
    public int compare(Map.Entry&lt;String, String&gt; o1, Map.Entry&lt;String, String&gt; o2) {
        return o1.getKey().compareTo(o2.getKey());
    }
});

for (Map.Entry&lt;String,String&gt; mapping:
list) {
    System.out.println(mapping.getKey()+&quot;:&quot;+mapping.getValue());
}
</code></pre><h3 id="TreeMap"><a href="#TreeMap" class="headerlink" title="TreeMap"></a>TreeMap</h3><pre><code>Map&lt;String, String&gt; map = new TreeMap&lt;String, String&gt;(new Comparator&lt;String&gt;() {
    @Override
    public int compare(String o1, String o2) {
        // é™åºæ’åº
        return o1.compareTo(o2);
    }
});
map.put(&quot;b&quot;, &quot;b&quot;);
map.put(&quot;a&quot;, &quot;c&quot;);
map.put(&quot;c&quot;, &quot;a&quot;);
for (String key : map.keySet()) {
    System.out.println(key + &quot; ï¼š&quot; + map.get(key));
}
</code></pre><h3 id="æŒ‰valueæ’åº-é€šç”¨"><a href="#æŒ‰valueæ’åº-é€šç”¨" class="headerlink" title="æŒ‰valueæ’åº(é€šç”¨)"></a>æŒ‰valueæ’åº(é€šç”¨)</h3><pre><code>Map&lt;String, String&gt; map = new TreeMap&lt;String, String&gt;();
map.put(&quot;b&quot;, &quot;b&quot;);
map.put(&quot;a&quot;, &quot;c&quot;);
map.put(&quot;c&quot;, &quot;a&quot;);
// é€šè¿‡ArrayListæ„é€ å‡½æ•°æŠŠmap.entrySet()è½¬æ¢æˆlist
List&lt;Map.Entry&lt;String, String&gt;&gt; list = new ArrayList&lt;Map.Entry&lt;String, String&gt;&gt;(map.entrySet());
// é€šè¿‡æ¯”è¾ƒå™¨å®ç°æ¯”è¾ƒæ’åº
Collections.sort(list, new Comparator&lt;Map.Entry&lt;String, String&gt;&gt;() {
    @Override
    public int compare(Map.Entry&lt;String, String&gt; mapping1, Map.Entry&lt;String, String&gt; mapping2) {
        return mapping1.getValue().compareTo(mapping2.getValue());
    }
});
for (String key : map.keySet()) {
    System.out.println(key + &quot; ï¼š&quot; + map.get(key));
}
</code></pre><h2 id="å¸¸ç”¨API"><a href="#å¸¸ç”¨API" class="headerlink" title="å¸¸ç”¨API"></a>å¸¸ç”¨API</h2><p><img src="/2020/06/08/JAVAçš„map/æ‰¹æ³¨ 2020-06-08 141629.png" alt=""></p>
<h2 id="æ‰©å±•Listå¦‚ä½•ä¸€è¾¹éå†ä¸€è¾¹åˆ é™¤"><a href="#æ‰©å±•Listå¦‚ä½•ä¸€è¾¹éå†ä¸€è¾¹åˆ é™¤" class="headerlink" title="æ‰©å±•Listå¦‚ä½•ä¸€è¾¹éå†ä¸€è¾¹åˆ é™¤"></a>æ‰©å±•Listå¦‚ä½•ä¸€è¾¹éå†ä¸€è¾¹åˆ é™¤</h2><pre><code>public static void main(String[] args) {
    List&lt;String&gt; platformList = new ArrayList&lt;&gt;();
    platformList.add(&quot;åšå®¢å›­&quot;);
    platformList.add(&quot;CSDN&quot;);
    platformList.add(&quot;æ˜é‡‘&quot;);

    for (String platform : platformList) {
        if (platform.equals(&quot;åšå®¢å›­&quot;)) {
            platformList.remove(platform);
        }
    }

    System.out.println(platformList);
}

java.util.ConcurrentModificationExceptionå¼‚å¸¸äº†ï¼Œç¿»è¯‘æˆä¸­æ–‡å°±æ˜¯ï¼šå¹¶å‘ä¿®æ”¹å¼‚å¸¸
</code></pre><h3 id="ä½¿ç”¨Iteratorçš„remove-æ–¹æ³•"><a href="#ä½¿ç”¨Iteratorçš„remove-æ–¹æ³•" class="headerlink" title="ä½¿ç”¨Iteratorçš„remove()æ–¹æ³•"></a>ä½¿ç”¨Iteratorçš„remove()æ–¹æ³•</h3><pre><code>public static void main(String[] args) {
    List&lt;String&gt; platformList = new ArrayList&lt;&gt;();
    platformList.add(&quot;åšå®¢å›­&quot;);
    platformList.add(&quot;CSDN&quot;);
    platformList.add(&quot;æ˜é‡‘&quot;);

    Iterator&lt;String&gt; iterator = platformList.iterator();
    while (iterator.hasNext()) {
        String platform = iterator.next();
        if (platform.equals(&quot;åšå®¢å›­&quot;)) {
            iterator.remove();
        }
    }

    System.out.println(platformList);
}
</code></pre><h3 id="ä½¿ç”¨forå¾ªç¯æ­£åºéå†"><a href="#ä½¿ç”¨forå¾ªç¯æ­£åºéå†" class="headerlink" title="ä½¿ç”¨forå¾ªç¯æ­£åºéå†"></a>ä½¿ç”¨forå¾ªç¯æ­£åºéå†</h3><pre><code>public static void main(String[] args) {
    List&lt;String&gt; platformList = new ArrayList&lt;&gt;();
    platformList.add(&quot;åšå®¢å›­&quot;);
    platformList.add(&quot;CSDN&quot;);
    platformList.add(&quot;æ˜é‡‘&quot;);

    for (int i = 0; i &lt; platformList.size(); i++) {
        String item = platformList.get(i);

        if (item.equals(&quot;åšå®¢å›­&quot;)) {
            platformList.remove(i);
            i = i - 1;
        }
    }

    System.out.println(platformList);
}
</code></pre><h3 id="ä½¿ç”¨forå¾ªç¯å€’åºéå†"><a href="#ä½¿ç”¨forå¾ªç¯å€’åºéå†" class="headerlink" title="ä½¿ç”¨forå¾ªç¯å€’åºéå†"></a>ä½¿ç”¨forå¾ªç¯å€’åºéå†</h3><pre><code>public static void main(String[] args) {
    List&lt;String&gt; platformList = new ArrayList&lt;&gt;();
    platformList.add(&quot;åšå®¢å›­&quot;);
    platformList.add(&quot;CSDN&quot;);
    platformList.add(&quot;æ˜é‡‘&quot;);

    for (int i = platformList.size() - 1; i &gt;= 0; i--) {
        String item = platformList.get(i);

        if (item.equals(&quot;æ˜é‡‘&quot;)) {
            platformList.remove(i);
        }
    }

    System.out.println(platformList);
}
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/05/JSONå¯¹è±¡å’ŒJSONå­—ç¬¦ä¸²/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Airthink">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Airthink">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/05/JSONå¯¹è±¡å’ŒJSONå­—ç¬¦ä¸²/" itemprop="url">JSONå¯¹è±¡å’ŒJSONå­—ç¬¦ä¸²</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2020-06-05T18:31:07+08:00">
                2020-06-05
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/JS/" itemprop="url" rel="index">
                    <span itemprop="name">JS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="JSONå¯¹è±¡"><a href="#JSONå¯¹è±¡" class="headerlink" title="JSONå¯¹è±¡"></a>JSONå¯¹è±¡</h1><h2 id="å¯¹è±¡çš„æ¦‚å¿µ"><a href="#å¯¹è±¡çš„æ¦‚å¿µ" class="headerlink" title="å¯¹è±¡çš„æ¦‚å¿µ"></a>å¯¹è±¡çš„æ¦‚å¿µ</h2><p>å¯¹è±¡çš„å±æ€§æ˜¯å¯ä»¥ç”¨ï¼š å¯¹è±¡.å±æ€§è¿›è¡Œè°ƒç”¨çš„ã€‚</p>
<pre><code>var person={&quot;name&quot;:&quot;tom&quot;,&quot;sex&quot;:&quot;ç”·&quot;}//jsonå¯¹è±¡
console.log(person.name);//åœ¨æ§åˆ¶å°è¾“å‡ºtom
alert(typeof(person));//object
</code></pre><p>ä»¥ä¸Šå°±æ˜¯jsonå¯¹è±¡ã€‚æ˜¯ä¸€ä¸ªå¯ä»¥ç”¨person.nameè¿™ç§æ–¹å¼è¿›è¡Œå±æ€§çš„è°ƒç”¨ã€‚<br>ç¬¬ä¸‰è¡Œä»£ç å°±æ˜¯çœ‹personçš„ç±»å‹ä¸ºobjectç±»å‹</p>
<h1 id="JSONå­—ç¬¦ä¸²"><a href="#JSONå­—ç¬¦ä¸²" class="headerlink" title="JSONå­—ç¬¦ä¸²"></a>JSONå­—ç¬¦ä¸²</h1><h2 id="å­—ç¬¦ä¸²ï¼ŒJSä¸­çš„å­—ç¬¦ä¸²æ˜¯å•å¼•å·æˆ–è€…åŒå¼•å·å¼•èµ·æ¥çš„ã€‚é‚£ä¹ˆjsonå­—ç¬¦ä¸²å°±æ˜¯å¦‚ä¸‹"><a href="#å­—ç¬¦ä¸²ï¼ŒJSä¸­çš„å­—ç¬¦ä¸²æ˜¯å•å¼•å·æˆ–è€…åŒå¼•å·å¼•èµ·æ¥çš„ã€‚é‚£ä¹ˆjsonå­—ç¬¦ä¸²å°±æ˜¯å¦‚ä¸‹" class="headerlink" title="å­—ç¬¦ä¸²ï¼ŒJSä¸­çš„å­—ç¬¦ä¸²æ˜¯å•å¼•å·æˆ–è€…åŒå¼•å·å¼•èµ·æ¥çš„ã€‚é‚£ä¹ˆjsonå­—ç¬¦ä¸²å°±æ˜¯å¦‚ä¸‹"></a>å­—ç¬¦ä¸²ï¼ŒJSä¸­çš„å­—ç¬¦ä¸²æ˜¯å•å¼•å·æˆ–è€…åŒå¼•å·å¼•èµ·æ¥çš„ã€‚é‚£ä¹ˆjsonå­—ç¬¦ä¸²å°±æ˜¯å¦‚ä¸‹</h2><pre><code>var b = &apos;{&quot;name&quot;:&quot;tom&quot;,&quot;sex&quot;:&quot;ç”·&quot;}&apos;;//jsonå­—ç¬¦ä¸²
console.log(b);//{&quot;name&quot;:&quot;tom&quot;,&quot;sex&quot;:&quot;ç”·&quot;};
alert(typeof(b));//string
</code></pre><p>ä»¥ä¸Šbå°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ˜¯ä¸€ä¸ªstringç±»å‹</p>
<h1 id="JSONå­—ç¬¦ä¸²å’ŒJSONå¯¹è±¡çš„è½¬æ¢"><a href="#JSONå­—ç¬¦ä¸²å’ŒJSONå¯¹è±¡çš„è½¬æ¢" class="headerlink" title="JSONå­—ç¬¦ä¸²å’ŒJSONå¯¹è±¡çš„è½¬æ¢"></a>JSONå­—ç¬¦ä¸²å’ŒJSONå¯¹è±¡çš„è½¬æ¢</h1><h2 id="JSONå­—ç¬¦ä¸²è½¬jsonå¯¹è±¡ï¼Œè°ƒç”¨parseæ–¹æ³•ï¼›"><a href="#JSONå­—ç¬¦ä¸²è½¬jsonå¯¹è±¡ï¼Œè°ƒç”¨parseæ–¹æ³•ï¼›" class="headerlink" title="JSONå­—ç¬¦ä¸²è½¬jsonå¯¹è±¡ï¼Œè°ƒç”¨parseæ–¹æ³•ï¼›"></a>JSONå­—ç¬¦ä¸²è½¬jsonå¯¹è±¡ï¼Œè°ƒç”¨parseæ–¹æ³•ï¼›</h2><pre><code>var b = &apos;{&quot;name&quot;:&quot;tom&quot;,&quot;sex&quot;:&quot;ç”·&quot;}&apos;;//jsonå­—ç¬¦ä¸²
console.log(b);//{&quot;name&quot;:&quot;tom&quot;,&quot;sex&quot;:&quot;ç”·&quot;};
alert(typeof(b));//string
var objb = JSON.parse(b);
console.log(objb.name);
</code></pre><h2 id="JSONå¯¹è±¡è½¬JSONå­—ç¬¦ä¸²"><a href="#JSONå¯¹è±¡è½¬JSONå­—ç¬¦ä¸²" class="headerlink" title="JSONå¯¹è±¡è½¬JSONå­—ç¬¦ä¸²"></a>JSONå¯¹è±¡è½¬JSONå­—ç¬¦ä¸²</h2><pre><code>var person={&quot;name&quot;:&quot;tom&quot;,&quot;sex&quot;:&quot;ç”·&quot;}//jsonå¯¹è±¡
console.log(person.name);//åœ¨æ§åˆ¶å°è¾“å‡ºtom
alert(typeof(person));//object
var personStr = JSON.stringify(person);
alert(typeof(personStr));//string
console.log(personStr);//{&quot;name&quot;:&quot;tom&quot;,&quot;sex&quot;:&quot;ç”·&quot;}
</code></pre><h2 id="å­—ç¬¦ä¸²è½¬jsonå¯¹è±¡"><a href="#å­—ç¬¦ä¸²è½¬jsonå¯¹è±¡" class="headerlink" title="å­—ç¬¦ä¸²è½¬jsonå¯¹è±¡"></a>å­—ç¬¦ä¸²è½¬jsonå¯¹è±¡</h2><pre><code>åœºæ™¯ï¼š
    åå°è¿”å›çš„personå¯¹è±¡ä¸Šæœ‰herfå±æ€§ï¼Œæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²
href = {&apos;href&apos;:&apos;../juvenile/summerCamp/summerCamp.html&apos;,&apos;isLogined&apos;:&apos;1&apos;,&apos;param&apos;:{&apos;activityId&apos;:&apos;2141108450038362510&apos;}}

è¦è§£æåˆ°herf

var configData = eval(&apos;(&apos; + href + &apos;)&apos;);//ç”±å­—ç¬¦ä¸²è½¬æ¢ä¸ºJSONå¯¹è±¡

console.log(configData.href)
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/28/SpringSecurityéªŒè¯æµç¨‹è§£æ/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Airthink">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Airthink">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/28/SpringSecurityéªŒè¯æµç¨‹è§£æ/" itemprop="url">SpringSecurityéªŒè¯æµç¨‹è§£æ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2020-05-28T21:08:05+08:00">
                2020-05-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="SpringSecurity"><a href="#SpringSecurity" class="headerlink" title="SpringSecurity"></a>SpringSecurity</h2><ol>
<li><p>TokenAuthenticationFilter</p>
<pre><code>if (httpRequest.getServletPath().equals(loginLink)) {
    //å¦‚æœæ˜¯ç™»å½•æˆ–æ³¨é”€çš„è¯ï¼Œè®¾ç½®ä¸æ²¿ç€è¿‡æ»¤å™¨å‘ä¸‹
    doNotContinueWithRequestProcessing(httpRequest);
    checkLoginAnDoSomething(httpRequest, httpResponse, token);
}
</code></pre></li>
<li><p>checkLoginAnDoSomething(httpRequest, httpResponse, token);</p>
<pre><code>example: Authorization=Basic YWRtaW46MTIzNDU2 (admin:123456)

private boolean checkLoginAnDoSomething(HttpServletRequest httpRequest, HttpServletResponse httpResponse,
    String token) throws IOException {
    String authorization = httpRequest.getHeader(CacheConstant.AUTHORIZATION);
    ReturnStatus result = null;
    if (authorization != null) {
        result = checkBasicAuthorization(authorization, httpRequest, httpResponse, token);
    }

    if (null == result) {
        result = new ReturnStatus(false);
        result.getErrors().add(new MError(MErrorCode.e9000));
        result.setMessage(MErrorCode.e9000.desc());
    }

    String body;
    try {
        body = JsonUtils.toJson(result);// JsonParserFactory.getParser().toJson(result).toString();
        httpResponse.setContentType(&quot;text/html;charset=UTF-8&quot;);
        httpResponse.getWriter().write(body);
    } catch (Exception e) {
        throw new IOException(e);
    }

    return result.isSuccess();
</code></pre><p> }</p>
</li>
<li><p>checkBasicAuthorization(authorization, httpRequest, httpResponse, token);</p>
<pre><code>private ReturnStatus checkBasicAuthorization(String authorization, HttpServletRequest httpRequest,
        HttpServletResponse httpResponse, String token) throws IOException {
    StringTokenizer tokenizer = new StringTokenizer(authorization);
    if (tokenizer.countTokens() &lt; 2) {
        return null;
    }
    if (!tokenizer.nextToken().equalsIgnoreCase(CacheConstant.BASIC_AUTH_PREFIX)) {
        return null;
    }

    String base64 = tokenizer.nextToken();
    String loginPassword = new String(Base64.decode(base64.getBytes(StandardCharsets.UTF_8)));
    tokenizer = new StringTokenizer(loginPassword, &quot;:&quot;);
    String username = tokenizer.nextToken();
    String pwd = tokenizer.nextToken();
    String password = passwordEncoder.encodePassword(pwd, null);
    ReturnStatus status = checkUsernameAndPassword(username, password, httpRequest, httpResponse, token);
    // ç™»å½•æˆåŠŸåè¿”å›ç™»å½•çŠ¶æ€
    return status;
}
</code></pre></li>
<li><p>private ReturnStatus checkUsernameAndPassword(String username, String password, HttpServletRequest httpRequest,HttpServletResponse httpResponse, String oldtoken)</p>
<pre><code>private ReturnStatus checkUsernameAndPassword(String username, String password, HttpServletRequest httpRequest,
        HttpServletResponse httpResponse, String oldtoken) throws IOException {
    ReturnStatus returnResult = new ReturnStatus(false);
    TokenInfo tokenInfo = authenticationService.authenticate(username, password, httpRequest);
    if (tokenInfo != null &amp;&amp; tokenInfo.getUserDetails() != null) {
        VerifyContext verifyContext = (VerifyContext) tokenInfo.getUserDetails();
        Account account = (Account) verifyContext.getUser().getEntity();
        if (account.isLogin()) {
            if (null != oldtoken &amp;&amp; !&quot;&quot;.equals(oldtoken) &amp;&amp; !&quot;null&quot;.equals(oldtoken)
                    &amp;&amp; !&quot;undefined&quot;.equals(oldtoken)) {
                logger.info(&quot;tokenInfo.setToken use the oldtoken Token :{}&quot;, tokenInfo.getToken());
                tokenInfo.setToken(oldtoken);
            }
            logger.info(&quot;the new Token :{},entity:{}&quot;, tokenInfo.getToken(), tokenInfo);
            this.cacheManager.saveObject(CacheEnum.TOKEN, tokenInfo.getToken(), tokenInfo.getUserDetails(),
                    CacheConstant.USER_SESSION_TIME);
            logger.info(&quot;the token:{}, save object:{}&quot;, tokenInfo.getToken(),
                    this.cacheManager.getObject(CacheEnum.TOKEN, tokenInfo.getToken()));
            returnResult.setEntity(account);
            returnResult.setSuccess(true);
        } else {
            returnResult.getErrors().add(new MError(MErrorCode.e9001));
            returnResult.setMessage(MErrorCode.e9001.desc());
        }
        httpResponse.setHeader(CacheConstant.HEADER_TOKEN, tokenInfo.getToken());
    } else {
        logger.error(&quot;User {} ,Password {} Unauthorized!&quot;, username, password);
        returnResult.getErrors().add(new MError(MErrorCode.e9000));
        returnResult.setMessage(MErrorCode.e9000.desc());
    }
    return returnResult;
}
</code></pre></li>
</ol>
<h2 id="åŸºäºç”¨æˆ·-è§’è‰²-æƒé™è®¾è®¡"><a href="#åŸºäºç”¨æˆ·-è§’è‰²-æƒé™è®¾è®¡" class="headerlink" title="åŸºäºç”¨æˆ·-è§’è‰²-æƒé™è®¾è®¡"></a>åŸºäºç”¨æˆ·-è§’è‰²-æƒé™è®¾è®¡</h2><pre><code>Account

accountName//è´¦å·å
accountPwd//å¯†ç 
status//çŠ¶æ€
accountType//è´¦å·ç±»å‹
entityID//å®ä½“id
lastLoginTime//æœ€åä¸€æ¬¡ç™»å½•æ—¶é—´
loginTimes//ç™»å½•æ¬¡æ•°
roleIds//è§’è‰²åˆ—è¡¨
//ä¸€ä¸ªè´¦å·å¯ä»¥å…³è”è§’è‰²ï¼Œè§’è‰²å‘ˆæ ‘çŠ¶ç»“æ„ï¼Œå¯å¤šé€‰

Function

name//åŠŸèƒ½ç‚¹åç§°
parentId//çˆ¶çº§
memo//æè¿°
action//èµ„æºurl
order//æ’åº
icon//å›¾æ ‡
permissionCode//å”¯ä¸€æƒé™æ ‡è¯†
permissionName//æƒé™åç§°

Role

name//è§’è‰²åç§°
parentId//çˆ¶çº§
memo//æè¿°
functionIds//åŠŸèƒ½ç‚¹
order//æ’åº
//è§’è‰²ä¹Ÿæ˜¯å‘ˆæ ‘çŠ¶èœå•çš„ï¼Œè§’è‰²é‡Œé¢æœ‰æƒé™é…ç½®ï¼Œæ‰€æœ‰çš„åŠŸèƒ½ç‚¹ä»¥æ ‘çŠ¶ç»“æ„å±•ç¤ºï¼Œé€šè¿‡è§’è‰²å»å…³è”åŠŸèƒ½ç‚¹
</code></pre><h2 id="é€’å½’èœå•å’Œè§’è‰²"><a href="#é€’å½’èœå•å’Œè§’è‰²" class="headerlink" title="é€’å½’èœå•å’Œè§’è‰²"></a>é€’å½’èœå•å’Œè§’è‰²</h2><pre><code>// è·å–æ ‡å‡†JSONæ•°æ®
public static List&lt;Map&lt;String, Object&gt;&gt; getStandardJSON() {
    // æ ¹æ®ä¸åŒæ¡†æ¶è·å–å¯¹åº”çš„Listæ•°æ®
    List&lt;Map&lt;String, Object&gt;&gt; queryList = query.find();
    List&lt;Map&lt;String, Object&gt;&gt; parentList = Lists.newArrayList();
    for (Map&lt;String, Object&gt; map : queryList) {
        if (map.get(&quot;pId&quot;).equals(&quot;0&quot;)) {
            parentList.add(map);
        }
    }    
    recursionChildren(parentList, queryList);
    return parentList;
}

// é€’å½’è·å–å­èŠ‚ç‚¹æ•°æ®
public static void recursionChildren (List&lt;Map&lt;String, Object&gt;&gt; parentList, 
List&lt;Map&lt;String, Object&gt;&gt; allList) {
    for (Map&lt;String, Object&gt; parentMap : parentList) {
        List&lt;Map&lt;String, Object&gt;&gt; childrenList = Lists.newArrayList();
        for (Map&lt;String, Object&gt; allMap : allList) {
            if (allMap.get(&quot;pId&quot;).equals(parentMap.get(&quot;id&quot;))) {
                childrenList.add(allMap);
            }
        }
        if (!ParamValidUtils.isEmpty(childrenList)) {
            parentMap.put(&quot;children&quot;, childrenList);
            recursionChildren(childrenList, allList);
        }
    }
}
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/26/SpringBootç³»åˆ—/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Airthink">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Airthink">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/26/SpringBootç³»åˆ—/" itemprop="url">SpringBootç³»åˆ—</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2020-05-26T21:34:15+08:00">
                2020-05-26
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Spring-Bootç®€ä»‹"><a href="#Spring-Bootç®€ä»‹" class="headerlink" title="Spring Bootç®€ä»‹"></a>Spring Bootç®€ä»‹</h2><ol>
<li>Spring bootæ˜¯Springå®¶æ—ä¸­çš„ä¸€ä¸ªå…¨æ–°çš„æ¡†æ¶ï¼Œå®ƒç”¨æ¥ç®€åŒ–Springåº”ç”¨ç¨‹åºçš„åˆ›å»ºå’Œå¼€å‘è¿‡ç¨‹ï¼Œä¹Ÿå¯ä»¥è¯´Spring bootèƒ½ç®€åŒ–æˆ‘ä»¬ä¹‹å‰é‡‡ç”¨SpringMVC+Spring+Mybatisæ¡†æ¶è¿›è¡Œå¼€å‘çš„è¿‡ç¨‹ã€‚</li>
<li>åœ¨ä»¥å¾€æˆ‘ä»¬é‡‡ç”¨SpringMVC+Spring+Mybatisæ¡†æ¶è¿›è¡Œå¼€å‘çš„æ—¶å€™ï¼Œæ­å»ºå’Œæ•´åˆä¸‰å¤§æ¡†æ¶ï¼Œæˆ‘ä»¬éœ€è¦åšå¾ˆå¥½å·¥ä½œï¼Œæ¯”å¦‚é…ç½®web.xmlï¼Œé…ç½®Springï¼Œé…ç½®Mybatis,å¹¶å°†å®ƒä»¬æ•´åˆåœ¨ä¸€èµ·ç­‰ï¼Œè€ŒSpring bootæ¡†æ¶å¯¹æ­¤å¼€å‘è¿‡ç¨‹è¿›è¡Œäº†é©å‘½æ€§çš„é¢ è¦†ï¼ŒæŠ›å¼ƒäº†ç¹ççš„xmlé…ç½®è¿‡ç¨‹ï¼Œé‡‡ç”¨å¤§é‡çš„é»˜è®¤é…ç½®ç®€åŒ–æˆ‘ä»¬çš„å¼€å‘è¿‡ç¨‹ã€‚</li>
<li>æ‰€ä»¥é‡‡ç”¨Spring bootå¯ä»¥éå¸¸å®¹æ˜“å’Œå¿«é€Ÿçš„åˆ›å»ºåŸºäºSpringæ¡†æ¶çš„åº”ç”¨ç¨‹åºï¼Œå®ƒè®©ç¼–ç å˜ç®€å•äº†ï¼Œé…ç½®å˜ç®€å•äº†ï¼Œéƒ¨ç½²å˜ç®€å•äº†ï¼Œç›‘æ§ä¹Ÿå˜ç®€å•äº†ã€‚</li>
<li>æ­£å› ä¸ºSpring bootå®ƒåŒ–ç¹ä¸ºç®€ï¼Œè®©å¼€å‘å˜å¾—æå…¶ç®€å•å’Œå¿«æ·ï¼Œæ‰€ä»¥åœ¨ä¸šç•Œå¤‡å—å…³æ³¨ã€‚Spring bootåœ¨å›½å†…çš„å…³æ³¨è¶‹åŠ¿ä¹Ÿæ—¥æ¸è¶…è¿‡Springã€‚</li>
</ol>
<ol>
<li>èƒ½å¤Ÿå¿«é€Ÿåˆ›å»ºåŸºäºSpringçš„åº”ç”¨ç¨‹åºã€‚ï¼ˆç®€åŒ–é…ç½®ï¼‰</li>
<li>èƒ½å¤Ÿç›´æ¥ä½¿ç”¨javaçš„mainæ–¹æ³•å¯åŠ¨å†…åµŒçš„Tomcatï¼ŒJettyæœåŠ¡å™¨è¿è¡ŒSpring bootç¨‹åºï¼Œä¸éœ€è¦éƒ¨ç½²waråŒ…æ–‡ä»¶ã€‚</li>
<li>æä¾›çº¦å®šçš„starter POMæ¥ç®€åŒ–æ¥ç®€åŒ–Mavené…ç½®ï¼Œè®©Mavené…ç½®å˜å¾—ç®€å•ã€‚</li>
<li>æ ¹æ®é¡¹ç›®çš„mavenä¾èµ–é…ç½®ï¼ŒSpring bootè‡ªåŠ¨é…ç½®Spring,SpringMVCç­‰å…¶å®ƒå¼€æºæ¡†æ¶ã€‚<br>.æä¾›ç¨‹åºçš„å¥åº·æ£€æŸ¥ç­‰åŠŸèƒ½ã€‚ï¼ˆæ£€æŸ¥å†…éƒ¨çš„è¿è¡ŒçŠ¶æ€ç­‰ï¼‰<br>åŸºæœ¬å¯ä»¥å®Œå…¨ä¸ä½¿ç”¨xmlé…ç½®æ–‡ä»¶ï¼Œé‡‡ç”¨æ³¨è§£é…ç½®ã€‚ï¼ˆæˆ–è€…é»˜è®¤çº¦å®šçš„é…ç½®ï¼Œä»£ç ä¸­å·²ç»å®ç°ï¼‰</li>
</ol>
<h2 id="å¾®æœåŠ¡"><a href="#å¾®æœåŠ¡" class="headerlink" title="å¾®æœåŠ¡"></a>å¾®æœåŠ¡</h2><p>å¾®æœåŠ¡ï¼šæ¶æ„é£æ ¼</p>
<p>ä¸€ä¸ªåº”ç”¨åº”è¯¥æ˜¯ä¸€ç»„å°å‹æœåŠ¡ï¼›å¯ä»¥é€šè¿‡HTTPçš„æ–¹å¼è¿›è¡Œäº’é€šï¼›</p>
<p>æ¯ä¸€ä¸ªåŠŸèƒ½å…ƒç´ æœ€ç»ˆéƒ½æ˜¯ä¸€ä¸ªå¯ç‹¬ç«‹æ›¿æ¢å’Œç‹¬ç«‹å‡çº§çš„è½¯ä»¶å•å…ƒï¼›</p>
<h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><h3 id="ç¯å¢ƒçº¦æŸ"><a href="#ç¯å¢ƒçº¦æŸ" class="headerlink" title="ç¯å¢ƒçº¦æŸ"></a>ç¯å¢ƒçº¦æŸ</h3><p>-jdk1.8</p>
<p>-maven 3.x</p>
<p>-springboot1.5.9RELEASE</p>
<h3 id="MAVENè®¾ç½®"><a href="#MAVENè®¾ç½®" class="headerlink" title="MAVENè®¾ç½®"></a>MAVENè®¾ç½®</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>jdk-1.8<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdk</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">jdk</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.compilerVersion</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.compilerVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Spring-Boot-HelloWorld"><a href="#Spring-Boot-HelloWorld" class="headerlink" title="Spring Boot HelloWorld"></a>Spring Boot HelloWorld</h3><p>æµè§ˆå™¨å‘é€helloè¯·æ±‚ï¼ŒæœåŠ¡å™¨æ¥å—è¯·æ±‚å¹¶å¤„ç†ï¼Œå“åº”HelloWorldå­—ç¬¦ä¸²ï¼›</p>
<h4 id="åˆ›å»ºä¸€ä¸ªmavenå·¥ç¨‹ï¼ˆjarï¼‰"><a href="#åˆ›å»ºä¸€ä¸ªmavenå·¥ç¨‹ï¼ˆjarï¼‰" class="headerlink" title="åˆ›å»ºä¸€ä¸ªmavenå·¥ç¨‹ï¼ˆjarï¼‰"></a>åˆ›å»ºä¸€ä¸ªmavenå·¥ç¨‹ï¼ˆjarï¼‰</h4><h4 id="å¯¼å…¥springBoot-ä¾èµ–"><a href="#å¯¼å…¥springBoot-ä¾èµ–" class="headerlink" title="å¯¼å…¥springBoot ä¾èµ–"></a>å¯¼å…¥springBoot ä¾èµ–</h4><pre><code>&lt;parent&gt;
&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
&lt;version&gt;1.5.9.RELEASE&lt;/version&gt;
&lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
&lt;/parent&gt;
&lt;dependencies&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
    &lt;scope&gt;test&lt;/scope&gt;
    &lt;exclusions&gt;
    &lt;exclusion&gt;
    &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt;
    &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt;
    &lt;/exclusion&gt;
    &lt;/exclusions&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre><h4 id="ç¼–å†™ä¸»ç¨‹åºï¼Œå¯åŠ¨Spring-Bootåº”ç”¨"><a href="#ç¼–å†™ä¸»ç¨‹åºï¼Œå¯åŠ¨Spring-Bootåº”ç”¨" class="headerlink" title="ç¼–å†™ä¸»ç¨‹åºï¼Œå¯åŠ¨Spring Bootåº”ç”¨"></a>ç¼–å†™ä¸»ç¨‹åºï¼Œå¯åŠ¨Spring Bootåº”ç”¨</h4><pre><code>/**
 * @Date2020/5/23 12:53
 * SpringBootApplicationæ¥æ ‡æ³¨ä¸€ä¸ªä¸»ç¨‹åº
 **/
@SpringBootApplication
public class HelloWorldMainApplication {
    public static void main(String[] args) {
        //springåº”ç”¨å¯åŠ¨èµ·æ¥
        SpringApplication.run(HelloWorldMainApplication.class,args);
    }
}
</code></pre><h4 id="ç¼–å†™ç›¸å…³çš„Controllerã€Service"><a href="#ç¼–å†™ç›¸å…³çš„Controllerã€Service" class="headerlink" title="ç¼–å†™ç›¸å…³çš„Controllerã€Service"></a>ç¼–å†™ç›¸å…³çš„Controllerã€Service</h4><h4 id="è¿è¡Œä¸»ç¨‹åºæµ‹è¯•"><a href="#è¿è¡Œä¸»ç¨‹åºæµ‹è¯•" class="headerlink" title="è¿è¡Œä¸»ç¨‹åºæµ‹è¯•"></a>è¿è¡Œä¸»ç¨‹åºæµ‹è¯•</h4><h4 id="ç®€åŒ–éƒ¨ç½²"><a href="#ç®€åŒ–éƒ¨ç½²" class="headerlink" title="ç®€åŒ–éƒ¨ç½²"></a>ç®€åŒ–éƒ¨ç½²</h4><pre><code>&lt;!--å¯ä»¥å°†åº”ç”¨æ‰“åŒ…æˆä¸€ä¸ªå¯æ‰§è¡Œçš„jarå®--&gt;
&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;
</code></pre><h5 id="å°†è¿™ä¸ªåº”ç”¨æ‰“æˆjaråŒ…ï¼Œç›´æ¥ç”¨java-jarçš„å‘½ä»¤è¿›è¡Œæ‰§è¡Œï¼›"><a href="#å°†è¿™ä¸ªåº”ç”¨æ‰“æˆjaråŒ…ï¼Œç›´æ¥ç”¨java-jarçš„å‘½ä»¤è¿›è¡Œæ‰§è¡Œï¼›" class="headerlink" title="å°†è¿™ä¸ªåº”ç”¨æ‰“æˆjaråŒ…ï¼Œç›´æ¥ç”¨java -jarçš„å‘½ä»¤è¿›è¡Œæ‰§è¡Œï¼›"></a>å°†è¿™ä¸ªåº”ç”¨æ‰“æˆjaråŒ…ï¼Œç›´æ¥ç”¨java -jarçš„å‘½ä»¤è¿›è¡Œæ‰§è¡Œï¼›</h5><h5 id="ç»ˆæ­¢è¿è¡Œ"><a href="#ç»ˆæ­¢è¿è¡Œ" class="headerlink" title="ç»ˆæ­¢è¿è¡Œ"></a>ç»ˆæ­¢è¿è¡Œ</h5><pre><code>netstat -aon|findstr &quot;8080&quot;
taskkill /f /pid 8976  ç»ˆæ­¢jarå‘½ä»¤è¿è¡Œçš„ç¨‹åº
</code></pre><h3 id="Hello-Worldæ¢ç©¶"><a href="#Hello-Worldæ¢ç©¶" class="headerlink" title="Hello Worldæ¢ç©¶"></a>Hello Worldæ¢ç©¶</h3><h4 id="pomæ–‡ä»¶"><a href="#pomæ–‡ä»¶" class="headerlink" title="pomæ–‡ä»¶"></a>pomæ–‡ä»¶</h4><h5 id="çˆ¶æ–‡ä»¶"><a href="#çˆ¶æ–‡ä»¶" class="headerlink" title="çˆ¶æ–‡ä»¶"></a>çˆ¶æ–‡ä»¶</h5><pre><code>&lt;parent&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
    &lt;version&gt;1.5.9.RELEASE&lt;/version&gt;
    &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
&lt;/parent&gt;
</code></pre><p>Spring Bootçš„ç‰ˆæœ¬ä»²è£ä¸­å¿ƒ</p>
<p>ä»¥åæˆ‘ä»¬å¯¼å…¥ä¾èµ–é»˜è®¤æ˜¯ä¸éœ€è¦å†™ç‰ˆæœ¬å·çš„ï¼ˆæ²¡æœ‰åœ¨dependenciesé‡Œé¢ç®¡ç†çš„ä¾èµ–è‡ªç„¶éœ€è¦å£°æ˜ç‰ˆæœ¬å·ï¼‰</p>
<h5 id="å¯¼å…¥çš„ä¾èµ–"><a href="#å¯¼å…¥çš„ä¾èµ–" class="headerlink" title="å¯¼å…¥çš„ä¾èµ–"></a>å¯¼å…¥çš„ä¾èµ–</h5><pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre><p>spring-boot-starter-webï¼š</p>
<h6 id="spring-boot-starterï¼šspring-bootåœºæ™¯å¯åŠ¨å™¨ï¼›å¸®æˆ‘ä»¬å¯¼å…¥äº†webæ¨¡å—æ­£å¸¸è¿è¡Œæ‰€ä¾èµ–çš„ç»„ä»¶"><a href="#spring-boot-starterï¼šspring-bootåœºæ™¯å¯åŠ¨å™¨ï¼›å¸®æˆ‘ä»¬å¯¼å…¥äº†webæ¨¡å—æ­£å¸¸è¿è¡Œæ‰€ä¾èµ–çš„ç»„ä»¶" class="headerlink" title="spring-boot-starterï¼šspring-bootåœºæ™¯å¯åŠ¨å™¨ï¼›å¸®æˆ‘ä»¬å¯¼å…¥äº†webæ¨¡å—æ­£å¸¸è¿è¡Œæ‰€ä¾èµ–çš„ç»„ä»¶"></a>spring-boot-starterï¼šspring-bootåœºæ™¯å¯åŠ¨å™¨ï¼›å¸®æˆ‘ä»¬å¯¼å…¥äº†webæ¨¡å—æ­£å¸¸è¿è¡Œæ‰€ä¾èµ–çš„ç»„ä»¶</h6><p>Spring Bootå°†æ‰€æœ‰åŠŸèƒ½åœºæ™¯éƒ½æŠ½å–å‡ºæ¥ï¼Œåšæˆä¸€ä¸ªä¸ªstarters(å¯åŠ¨å™¨)ï¼Œåªéœ€è¦åœ¨é¡¹ç›®é‡Œå¼•å…¥è¿™äº›starterç›¸å…³åœºæ™¯çš„æ‰€æœ‰ä¾èµ–éƒ½ä¼šå¯¼å…¥è¿›æ¥ã€‚è¦ç”¨ä»€ä¹ˆåŠŸèƒ½å°±å¯¼å…¥ä»€ä¹ˆåœºæ™¯çš„å¯åŠ¨å™¨</p>
<h5 id="ä¸»ç¨‹åºç±»"><a href="#ä¸»ç¨‹åºç±»" class="headerlink" title="ä¸»ç¨‹åºç±»"></a>ä¸»ç¨‹åºç±»</h5><pre><code>/**
 * @Date2020/5/23 12:53
 * SpringBootApplicationæ¥æ ‡æ³¨ä¸€ä¸ªä¸»ç¨‹åº,è¯´æ˜è¿™æ˜¯ä¸€ä¸ªSpring Bootåº”ç”¨
 **/
@SpringBootApplication
public class HelloWorldMainApplication {

    private static Logger log= LoggerFactory.getLogger(HelloWorldMainApplication.class);

    public static void main(String[] args) {
        log.info(&quot;HelloWorldMainApplication is success!&quot;);
        //springåº”ç”¨å¯åŠ¨èµ·æ¥
        SpringApplication.run(HelloWorldMainApplication.class,args);
    }
}
</code></pre><p>@SpringBootApplication Spring Bootåº”ç”¨æ ‡æ³¨åœ¨æŸä¸ªç±»ä¸Šè¯´æ˜è¿™ä¸ªç±»æ˜¯SpringBootçš„ä¸»é…ç½®ç±»ï¼ŒSpringBootå°±åº”è¯¥è¿è¡Œè¿™ä¸ªç±»çš„mainæ–¹æ³•æ¥å¯åŠ¨SpringBootåº”ç”¨ã€‚</p>
<pre><code>@Target({ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Inherited
@SpringBootConfiguration
@EnableAutoConfiguration
@ComponentScan(
    excludeFilters = {@Filter(
    type = FilterType.CUSTOM,
    classes = {TypeExcludeFilter.class}
    ), @Filter(
        type = FilterType.CUSTOM,
        classes = {AutoConfigurationExcludeFilter.class}
    )}
)
</code></pre><p>@SpringBootConfigurationï¼šSpringBootçš„é…ç½®ç±»ï¼›</p>
<p>â€‹    æ ‡æ³¨åœ¨æŸä¸ªç±»ä¸Šï¼Œæ ‡è¯†è¿™æ˜¯ä¸€ä¸ªSpringBootçš„é…ç½®ç±»ï¼›</p>
<p>â€‹    @Configuration:é…ç½®ç±»ä¸Šæ¥æ ‡æ³¨è¿™ä¸ªæ³¨è§£ï¼š</p>
<p>â€‹        é…ç½®ç±»â€”é…ç½®æ–‡ä»¶ï¼›é…ç½®ç±»ä¹Ÿæ˜¯å®¹å™¨ä¸­çš„ä¸€ä¸ªç»„ä»¶ï¼›@Componet</p>
<p>@EnableAutoConfigurationï¼šå¼€å¯è‡ªåŠ¨é…ç½®åŠŸèƒ½</p>
<p>â€‹    ä»¥å‰éœ€è¦é…ç½®çš„ä¸œè¥¿ï¼ŒSpringBootå¸®æˆ‘ä»¬è‡ªåŠ¨é…ç½®ï¼›@EnableAutoConfigurationå‘Šè¯‰SpringBootå¼€å¯è‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼›è¿™æ ·è‡ªåŠ¨é…ç½®æ‰èƒ½ç”Ÿæ•ˆã€‚</p>
<pre><code>@AutoConfigurationPackage
@Import({EnableAutoConfigurationImportSelector.class})
</code></pre><p>@AutoConfigurationPackageï¼šè‡ªåŠ¨é…ç½®åŒ…</p>
<p>@Import({Registrar.class})</p>
<p>â€‹Springçš„åº•å±‚æ³¨è§£@Importï¼Œç»™å®¹å™¨ä¸­å¯¼å…¥ä¸€ä¸ªç»„ä»¶ï¼›å¯¼å…¥çš„ç»„ä»¶ç”±Registrar.class</p>
<p>å°†ä¸»é…ç½®ç±»ï¼ˆ@SpringBootApplicationæ ‡æ³¨çš„ç±»ï¼‰çš„æ‰€åœ¨åŒ…åŠä¸‹é¢æ‰€æœ‰å­åŒ…é‡Œé¢çš„æ‰€æœ‰ç»„ä»¶æ‰«æåˆ°</p>
<p>Springå®¹å™¨ï¼›</p>
<p>â€‹@Import({EnableAutoConfigurationImportSelector.class})</p>
<p>â€‹ç»™å®¹å™¨ä¸­å¯¼å…¥ç»„ä»¶</p>
<p>â€‹EnableAutoConfigurationImportSelectorï¼šå¯¼å…¥é‚£äº›ç»„ä»¶çš„é€‰æ‹©å™¨ï¼›</p>
<p>â€‹å°†æ‰€æœ‰éœ€è¦å¯¼å…¥çš„ç»„ä»¶ä»¥å…¨ç±»åçš„æ–¹å¼è¿”å›ï¼›</p>
<p>â€‹ä¼šç»™å®¹å™¨ä¸­å¯¼å…¥éå¸¸å¤šçš„è‡ªåŠ¨é…ç½®ç±»ï¼ˆxxxAutoConfigurationï¼‰;å°±æ˜¯ç»™å®¹å™¨ä¸­å¯¼å…¥è¿™ä¸ªåœºæ™¯éœ€è¦çš„æ‰€</p>
<p>æœ‰ç»„ä»¶ï¼Œå¹¶é…ç½®å¥½è¿™äº›ç»„ä»¶ï¼›å…å»äº†æˆ‘ä»¬æ‰‹åŠ¨ç¼–å†™é…ç½®æ³¨å…¥åŠŸèƒ½ç»„ä»¶çš„å·¥ä½œã€‚</p>
<pre><code>SpringFactoriesLoader.loadFactoryNames(
  getSpringFactoriesLoaderFactoryClass(), getBeanClassLoader());
</code></pre><p><img src="/2020/05/26/SpringBootç³»åˆ—/æ‰¹æ³¨ 2020-05-23 145433.jpg" alt=""></p>
<p>Spring Bootåœ¨å¯åŠ¨çš„æ—¶å€™ä»ç±»è·¯å¾„ä¸‹çš„â€META-INF/spring.factoriesâ€ä¸­è·å–EnableAutoConfigurationæŒ‡å®šçš„å€¼ï¼Œå°†è¿™äº›å€¼ä½œä¸ºè‡ªåŠ¨é…ç½®ç±»å¯¼å…¥åˆ°å®¹å™¨ä¸­ï¼Œè‡ªåŠ¨é…ç½®ç±»å°±ç”Ÿæ•ˆï¼Œå¸®æˆ‘ä»¬è¿›è¡Œè‡ªåŠ¨é…ç½®å·¥ä½œã€‚</p>
<p>J2EEçš„æ•´ä½“æ•´åˆè§£å†³æ–¹æ¡ˆå’Œè‡ªåŠ¨é…ç½®éƒ½åœ¨m2\repository\org\springframework\boot\spring-boot-autoconfigure\1.5.9.RELEASE\spring-boot-autoconfigure-1.5.9.RELEASE.jar</p>
<h3 id="ä½¿ç”¨Spring-Initializerå¿«é€Ÿåˆ›å»ºSpring-Booté¡¹ç›®"><a href="#ä½¿ç”¨Spring-Initializerå¿«é€Ÿåˆ›å»ºSpring-Booté¡¹ç›®" class="headerlink" title="ä½¿ç”¨Spring Initializerå¿«é€Ÿåˆ›å»ºSpring Booté¡¹ç›®"></a>ä½¿ç”¨Spring Initializerå¿«é€Ÿåˆ›å»ºSpring Booté¡¹ç›®</h3><p>IDEéƒ½æ”¯æŒä½¿ç”¨Springçš„é¡¹ç›®åˆ›å»ºå‘å¯¼å¿«é€Ÿåˆ›å»ºä¸€ä¸ªSpring Booté¡¹ç›®ï¼›</p>
<p>é€‰æ‹©æˆ‘ä»¬éœ€è¦çš„æ¨¡å—ï¼Œå‘å¯¼ä¼šè”ç½‘è¿›è¡Œé¡¹ç›®çš„åˆ›å»ºï¼›</p>
<p>é»˜è®¤ç”Ÿæˆçš„Spring Booté¡¹ç›®</p>
<ol>
<li><p>ä¸»ç¨‹åºå·²ç»ç”Ÿæˆå¥½äº†ï¼Œåªéœ€è¦å®ç°æˆ‘ä»¬è‡ªå·±çš„é€»è¾‘</p>
</li>
<li><p>resourcesæ–‡ä»¶å¤¹çš„ç›®å½•ç»“æ„</p>
<p>static:ä¿å­˜æ‰€æœ‰çš„js  css images</p>
<p>templates:ä¿å­˜æ‰€æœ‰çš„é¡µé¢æ¨¡æ¿ï¼›ï¼ˆSpring Booté»˜è®¤jaråŒ…ä½¿ç”¨åµŒå…¥å¼çš„Tomcat,é»˜è®¤ä¸æ”¯æŒJSPé¡µé¢ï¼‰ï¼›å¯ä»¥ä½¿ç”¨æ¨¡æ¿å¼•æ“ï¼ˆfreemarkerã€thymeleafï¼‰;</p>
<p>application.properties:Spring Boot çš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ä¿®æ”¹ä¸€äº›é»˜è®¤è®¾ç½®ï¼›</p>
</li>
</ol>
<h2 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h2><h3 id="SpringBootä½¿ç”¨ä¸€ä¸ªå…¨å±€çš„é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶åæ˜¯å›ºå®šçš„ï¼›"><a href="#SpringBootä½¿ç”¨ä¸€ä¸ªå…¨å±€çš„é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶åæ˜¯å›ºå®šçš„ï¼›" class="headerlink" title="SpringBootä½¿ç”¨ä¸€ä¸ªå…¨å±€çš„é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶åæ˜¯å›ºå®šçš„ï¼›"></a>SpringBootä½¿ç”¨ä¸€ä¸ªå…¨å±€çš„é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶åæ˜¯å›ºå®šçš„ï¼›</h3><p>application.properties</p>
<p>application.yml</p>
<p>é…ç½®æ–‡ä»¶çš„ä½œç”¨ï¼šä¿®æ”¹SpringBootè‡ªåŠ¨é…ç½®çš„é»˜è®¤å€¼</p>
<p>SpringBootåœ¨åº•å±‚éƒ½ç»™æˆ‘ä»¬è‡ªåŠ¨é…ç½®å¥½ï¼›</p>
<p>YAMLæ˜¯ä¸€ä¸ªæ ‡è®°è¯­è¨€ï¼šä»¥å‰çš„é…ç½®å¤§éƒ½ä½¿ç”¨xxx.xmlæ–‡ä»¶ï¼Œè€Œyamlä»¥æ•°æ®ä¸ºä¸­å¿ƒï¼Œæ¯”json,xmlæ›´é€‚åˆä½œé…ç½®æ–‡ä»¶</p>
<h3 id="YAMLè¯­æ³•"><a href="#YAMLè¯­æ³•" class="headerlink" title="YAMLè¯­æ³•"></a>YAMLè¯­æ³•</h3><h4 id="k-v-æ ‡è¯†ä¸€å¯¹é”®å€¼å¯¹ï¼ˆç©ºæ ¼å¿…é¡»æœ‰ï¼‰"><a href="#k-v-æ ‡è¯†ä¸€å¯¹é”®å€¼å¯¹ï¼ˆç©ºæ ¼å¿…é¡»æœ‰ï¼‰" class="headerlink" title="k: v :æ ‡è¯†ä¸€å¯¹é”®å€¼å¯¹ï¼ˆç©ºæ ¼å¿…é¡»æœ‰ï¼‰"></a>k: v :æ ‡è¯†ä¸€å¯¹é”®å€¼å¯¹ï¼ˆç©ºæ ¼å¿…é¡»æœ‰ï¼‰</h4><p>ä»¥ç©ºæ ¼çš„ç¼©è¿›æ¥æ§åˆ¶å±‚çº§å…³ç³»ï¼Œåªè¦å·¦å¯¹é½çš„ä¸€åˆ—æ•°æ®ï¼Œéƒ½æ˜¯ä¸€ä¸ªå±‚çº§çš„ï¼Œå±æ€§å’Œå€¼ä¹Ÿæ˜¯å¤§å°å†™æ•æ„Ÿï¼›</p>
<h4 id="å€¼çš„å†™æ³•"><a href="#å€¼çš„å†™æ³•" class="headerlink" title="å€¼çš„å†™æ³•"></a>å€¼çš„å†™æ³•</h4><p>å­—é¢é‡ï¼šæ™®é€šçš„å€¼ï¼ˆæ•°å­—ã€å­—ç¬¦ä¸²ã€å¸ƒå°”ï¼‰</p>
<p>â€‹    å­—é¢é‡ç›´æ¥æ¥å†™ï¼Œå­—ç¬¦ä¸²é»˜è®¤ä¸ç”¨åŠ ä¸Šå•å¼•å·æˆ–è€…åŒå¼•å·</p>
<p>â€‹    â€œâ€:åŒå¼•å·ï¼Œä¸ä¼šè½¬ä¹‰å­—ç¬¦ä¸²é‡Œé¢çš„ç‰¹æ®Šå­—ç¬¦ï¼Œç‰¹æ®Šå­—ç¬¦ä¼šä½œä¸ºæœ¬èº«æƒ³è¡¨ç¤ºçš„æ„æ€</p>
<p>â€‹        name: â€œzhangsan \n lisiâ€ è¾“å‡ºzhangsan æ¢è¡Œ lisi</p>
<p>â€‹    â€˜â€™:å•å¼•å·ï¼Œä¼šè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œè¾“å‡ºzhangsan \n lisi</p>
<p>å¯¹è±¡ã€mapï¼ˆå±æ€§å’Œå€¼ï¼‰ï¼ˆé”®å€¼å¯¹ï¼‰</p>
<p>â€‹k:v :å¯¹è±¡è¿˜æ˜¯k:vçš„å½¢å¼</p>
<pre><code>friends:
lastName: zhangsan
    age: 18
</code></pre><p>è¡Œå†…å†™æ³•</p>
<pre><code>friends{lastName:zhangsan,age:18}
</code></pre><p>æ•°ç»„ï¼ˆlistã€setï¼‰</p>
<pre><code>pets:
  - cat
  - dog
 - pig
</code></pre><p>è¡Œå†…å†™æ³•</p>
<pre><code>pets:{cat,dog,pig}
</code></pre><h3 id="é…ç½®æ–‡ä»¶çš„æ³¨å…¥å’Œæ ¡éªŒ"><a href="#é…ç½®æ–‡ä»¶çš„æ³¨å…¥å’Œæ ¡éªŒ" class="headerlink" title="é…ç½®æ–‡ä»¶çš„æ³¨å…¥å’Œæ ¡éªŒ"></a>é…ç½®æ–‡ä»¶çš„æ³¨å…¥å’Œæ ¡éªŒ</h3><h4 id="properitiesé…ç½®æ–‡ä»¶åœ¨ideaä¸­é»˜è®¤utf-8å¯èƒ½ä¼šä¹±ç "><a href="#properitiesé…ç½®æ–‡ä»¶åœ¨ideaä¸­é»˜è®¤utf-8å¯èƒ½ä¼šä¹±ç " class="headerlink" title="properitiesé…ç½®æ–‡ä»¶åœ¨ideaä¸­é»˜è®¤utf-8å¯èƒ½ä¼šä¹±ç "></a>properitiesé…ç½®æ–‡ä»¶åœ¨ideaä¸­é»˜è®¤utf-8å¯èƒ½ä¼šä¹±ç </h4><pre><code>person:
  name: zhangsan
  age: 18
  boss: false
  birth: 2020/12/12
  map: {k1: v1,k2: 12}
  objectList:
    - lisi
    - wangwu
  dog:
    name: mumu
    age: 2
</code></pre><p>javaBean</p>
<pre><code>/**
 * @ClassNamePerson
 * @Description å°†é…ç½®æ–‡ä»¶ä¸­çš„æ¯ä¸€ä¸ªå±æ€§çš„å€¼æ˜ å°„åˆ°è¿™ä¸ªç»„ä»¶ä¸­
 * @Author
 * @Date2020/5/23 16:08
 * @ConfigurationPropertieså‘Šè¯‰SpringBootå°†æœ¬ç±»ä¸­çš„æ‰€æœ‰å±æ€§å’Œé…ç½®æ–‡ä»¶ä¸­ç›¸å…³çš„é…ç½®è¿›è¡Œç»‘å®š
 * prefix = &quot;person&quot;:é…ç½®æ–‡ä»¶ä¸­å“ªä¸ªä¸‹é¢çš„æ‰€æœ‰å±æ€§è¿›è¡Œä¸€ä¸€æ˜ å°„
 * åªæœ‰è¿™ä¸ªç»„ä»¶æ˜¯å®¹å™¨ä¸­çš„ç»„ä»¶ï¼Œæ‰èƒ½ç”¨å®¹å™¨æä¾›çš„@ConfigurationPropertiesåŠŸèƒ½,éœ€è¦åŠ ä¸Š@Component
 * @ConfigurationProperties(prefix = &quot;person&quot;)é»˜è®¤ä»å…¨å±€é…ç½®æ–‡ä»¶ä¸­è·å–å€¼
 **/
@Component
@ConfigurationProperties(prefix = &quot;person&quot;)
public class Person {
    private String name;
    private Integer age;
    private boolean boss;
    private Date birth;
    private Map&lt;String,Object&gt; map;
    private List&lt;Object&gt; objectList;
    private Dog dog;
</code></pre><p>æˆ‘ä»¬å¯ä»¥å¯¼å…¥é…ç½®æ–‡ä»¶å¤„ç†å™¨ï¼Œä»¥åç¼–å†™é…ç½®å°±æœ‰æç¤ºäº†</p>
<pre><code>&lt;!--å¯¼å…¥é…ç½®æ–‡ä»¶å¤„ç†å™¨ï¼Œé…ç½®æ–‡ä»¶è¿›è¡Œç»‘å®šå°±ä¼šæœ‰æç¤º--&gt;
 &lt;dependency&gt;
     &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
     &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;
     &lt;optional&gt;true&lt;/optional&gt;
 &lt;/dependency&gt;
</code></pre><table>
<thead>
<tr>
<th></th>
<th>@ConfigurationProperties</th>
<th>@Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>åŠŸèƒ½</td>
<td>æ‰¹é‡æ³¨å…¥æ–‡ä»¶çš„å±æ€§</td>
<td>ä¸€ä¸ªä¸ªæŒ‡å®š</td>
</tr>
<tr>
<td>æ¾æ•£ç»‘å®š</td>
<td>æ”¯æŒï¼ˆlastName,last-nameï¼‰</td>
<td>ä¸æ”¯æŒ</td>
</tr>
<tr>
<td>SpEL</td>
<td>ä¸æ”¯æŒ</td>
<td>æ”¯æŒ</td>
</tr>
<tr>
<td>JSR303æ•°æ®æ ¡éªŒ</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
</tr>
<tr>
<td>å¤æ‚ç±»å‹å°è£…</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
</tr>
</tbody>
</table>
<p>é…ç½®æ–‡ä»¶ymlè¿˜æ˜¯propertieséƒ½å¯è·å–åˆ°å€¼</p>
<p>å¦‚æœåªéœ€è¦è·å–ç®€å•å±æ€§å€¼å¯ç”¨@Value</p>
<h4 id="PropertySource-amp-ImportResource"><a href="#PropertySource-amp-ImportResource" class="headerlink" title="@PropertySource&amp;ImportResource"></a>@PropertySource&amp;ImportResource</h4><p>@PropertySource:åŠ è½½æŒ‡å®šçš„é…ç½®æ–‡ä»¶ï¼Œéœ€è¦æŒ‡å®šé…ç½®æ–‡ä»¶çš„è·¯å¾„</p>
<pre><code>/**
 * @Description å°†é…ç½®æ–‡ä»¶ä¸­çš„æ¯ä¸€ä¸ªå±æ€§çš„å€¼æ˜ å°„åˆ°è¿™ä¸ªç»„ä»¶ä¸­
 * @ConfigurationPropertieså‘Šè¯‰SpringBootå°†æœ¬ç±»ä¸­çš„æ‰€æœ‰å±æ€§å’Œé…ç½®æ–‡ä»¶ä¸­ç›¸å…³çš„é…ç½®è¿›è¡Œç»‘å®š
 * prefix = &quot;person&quot;:é…ç½®æ–‡ä»¶ä¸­å“ªä¸ªä¸‹é¢çš„æ‰€æœ‰å±æ€§è¿›è¡Œä¸€ä¸€æ˜ å°„
 * åªæœ‰è¿™ä¸ªç»„ä»¶æ˜¯å®¹å™¨ä¸­çš„ç»„ä»¶ï¼Œæ‰èƒ½ç”¨å®¹å™¨æä¾›çš„@ConfigurationPropertiesåŠŸèƒ½,éœ€è¦åŠ ä¸Š@Component
 **/
@PropertySource(value = {&quot;classpath:person.properties&quot;})
@Component
@ConfigurationProperties(prefix = &quot;person&quot;)
public class Person {
    private String name;
    private Integer age;
    private boolean boss;
    private Date birth;
    private Map&lt;String,Object&gt; map;
    private List&lt;Object&gt; objectList;
    private Dog dog;
</code></pre><p>@ImportResource:å¯¼å…¥Springçš„é…ç½®æ–‡ä»¶ï¼Œè®©é…ç½®æ–‡ä»¶é‡Œé¢çš„å†…å®¹ç”Ÿæ•ˆï¼›</p>
<p>Spring Booté‡Œé¢æ²¡æœ‰Springçš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬è‡ªå·±ç¼–å†™çš„é…ç½®æ–‡ä»¶ï¼Œä¹Ÿä¸èƒ½è‡ªåŠ¨è¯†åˆ«ï¼Œæƒ³è®©Springçš„é…ç½®æ–‡ä»¶ç”Ÿæ•ˆï¼ŒåŠ è½½è¿›æ¥ï¼›@ImportResourceéœ€è¦æ ‡æ³¨åœ¨ä¸€ä¸ªé…ç½®ç±»ä¸Š</p>
<pre><code>@ImportResource(locations = {&quot;classpath:beans.xml&quot;})
</code></pre><p>å¯¼å…¥Springçš„é…ç½®æ–‡ä»¶ï¼Œè®©å…¶ç”Ÿæ•ˆ</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;
&lt;bean id=&quot;helloService&quot; class=&quot;com.think.hello.service.HelloService&quot;&gt;&lt;/bean&gt;
&lt;/beans&gt;
</code></pre><p>SpringBootæ¨èç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶çš„æ–¹å¼ï¼Œæ¨èä½¿ç”¨å…¨æ³¨è§£çš„æ–¹å¼ï¼›</p>
<p>1ã€é…ç½®ç±»===Springé…ç½®æ–‡ä»¶</p>
<p>2ã€@Beanç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶</p>
<pre><code>@Configuration
public class myAppConfig {
    //å°†æ–¹æ³•çš„è¿”å›å€¼æ·»åŠ åˆ°å®¹å™¨ï¼Œå®¹å™¨ä¸­è¿™ä¸ªç»„ä»¶é»˜è®¤çš„idå°±æ˜¯æ–¹æ³•å
    @Bean
    public HelloService helloService(){
        return new HelloService();
    }
}
</code></pre><h3 id="é…ç½®æ–‡ä»¶å ä½ç¬¦"><a href="#é…ç½®æ–‡ä»¶å ä½ç¬¦" class="headerlink" title="é…ç½®æ–‡ä»¶å ä½ç¬¦"></a>é…ç½®æ–‡ä»¶å ä½ç¬¦</h3><p>å ä½ç¬¦åæœŸä¹‹å‰é…ç½®çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰å¯ç”¨ï¼šæŒ‡å®šé»˜è®¤å€¼</p>
<pre><code>person:
  name: zhangsan${random.uuid}
  boss: false
  age: ${random.int}
  birth: 2020/12/12
  map: {k1: v1,k2: 12}
  objectList:
    - lisi
    - wangwu
    - zhangsan
  dog:
    name: ${person.hello:hello}mumu
    age: 2
</code></pre><h3 id="Profile"><a href="#Profile" class="headerlink" title="Profile"></a>Profile</h3><h4 id="å¤šprofileæ–‡ä»¶"><a href="#å¤šprofileæ–‡ä»¶" class="headerlink" title="å¤šprofileæ–‡ä»¶"></a>å¤šprofileæ–‡ä»¶</h4><p>æˆ‘ä»¬åœ¨ä¸»é…ç½®æ–‡ä»¶ç¼–å†™çš„æ—¶å€™ï¼Œæ–‡ä»¶åå¯ç”¨applicaton-{profile}.properties/yml</p>
<p>é»˜è®¤ä½¿ç”¨application.propertiesçš„é…ç½®</p>
<h4 id="ymlæ”¯æŒå¤šæ–‡æ¡£å—çš„æ–¹å¼"><a href="#ymlæ”¯æŒå¤šæ–‡æ¡£å—çš„æ–¹å¼" class="headerlink" title="ymlæ”¯æŒå¤šæ–‡æ¡£å—çš„æ–¹å¼"></a>ymlæ”¯æŒå¤šæ–‡æ¡£å—çš„æ–¹å¼</h4><pre><code>server:
  port: 8080
spring:
  profiles:
    active: prod
---
server:
  port: 8081
spring:
  profiles: dev
---
server:
  port: 8082
spring:
  profiles: prod
</code></pre><h4 id="æ¿€æ´»æŒ‡å®šprofile"><a href="#æ¿€æ´»æŒ‡å®šprofile" class="headerlink" title="æ¿€æ´»æŒ‡å®šprofile"></a>æ¿€æ´»æŒ‡å®šprofile</h4><h5 id="åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šspring-profiles-active-dev"><a href="#åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šspring-profiles-active-dev" class="headerlink" title="åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šspring.profiles.active=dev"></a>åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šspring.profiles.active=dev</h5><h5 id="å‘½ä»¤è¡Œçš„æ–¹å¼"><a href="#å‘½ä»¤è¡Œçš„æ–¹å¼" class="headerlink" title="å‘½ä»¤è¡Œçš„æ–¹å¼"></a>å‘½ä»¤è¡Œçš„æ–¹å¼</h5><p>â€‹    åœ¨å¯åŠ¨é…ç½®é‡Œ â€“spring.profiles.active=devæˆ–java -jar xxx.jar â€“spring.profiles.active=dev</p>
<h5 id="è™šæ‹Ÿæœºå‚æ•°"><a href="#è™šæ‹Ÿæœºå‚æ•°" class="headerlink" title="è™šæ‹Ÿæœºå‚æ•°"></a>è™šæ‹Ÿæœºå‚æ•°</h5><p>â€‹    -Dspring.profiles.active=dev</p>
<h3 id="é…ç½®æ–‡ä»¶çš„åŠ è½½é»˜è®¤çš„ä¼˜å…ˆçº§ç”±é«˜åˆ°ä½"><a href="#é…ç½®æ–‡ä»¶çš„åŠ è½½é»˜è®¤çš„ä¼˜å…ˆçº§ç”±é«˜åˆ°ä½" class="headerlink" title="é…ç½®æ–‡ä»¶çš„åŠ è½½é»˜è®¤çš„ä¼˜å…ˆçº§ç”±é«˜åˆ°ä½"></a>é…ç½®æ–‡ä»¶çš„åŠ è½½é»˜è®¤çš„ä¼˜å…ˆçº§ç”±é«˜åˆ°ä½</h3><p>é«˜ä¼˜å…ˆçº§çš„é…ç½®ä¼šè¦†ç›–ä½ä¼˜å…ˆçº§çš„é…ç½®ç”Ÿæ•ˆï¼›</p>
<p>SpringBootä¼šä»è¿™å››ä¸ªä½ç½®å…¨éƒ¨åŠ è½½ä¸»é…ç½®æ–‡ä»¶ï¼›äº’è¡¥é…ç½®ï¼›</p>
<p>-file:./conifg/</p>
<p>-file:./</p>
<p>-classpath:/config/</p>
<p>-classpath:/</p>
<p>æˆ‘ä»¬è¿˜å¯ç”¨é€šè¿‡spring.config.locationæ¥æ”¹å˜é»˜è®¤çš„é…ç½®æ–‡ä»¶ä½ç½®</p>
<p>é¡¹ç›®æ‰“åŒ…åå¯ç”¨å‘½ä»¤è¡Œå‚æ•°çš„å½¢å¼ï¼Œå¯åŠ¨é¡¹ç›®çš„æ—¶å€™æ¥æŒ‡å®šé…ç½®æ–‡ä»¶çš„æ–°ä½ç½®ï¼ŒæŒ‡å®šé…ç½®æ–‡ä»¶ä¼šå’Œé»˜è®¤åŠ è½½çš„è¿™äº›é…ç½®æ–‡ä»¶å…±åŒèµ·ä½œç”¨å½¢æˆé…ç½®</p>
<p> -jar xxx.jar â€“server.port=8080</p>
<h3 id="è‡ªåŠ¨é…ç½®åŸç†"><a href="#è‡ªåŠ¨é…ç½®åŸç†" class="headerlink" title="è‡ªåŠ¨é…ç½®åŸç†"></a>è‡ªåŠ¨é…ç½®åŸç†</h3><p>é…ç½®æ–‡ä»¶èƒ½é…ç½®çš„å±æ€§å‚ç…§</p>
<p><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/appendix-application-properties.html#common-application-properties" target="_blank" rel="noopener">https://docs.spring.io/spring-boot/docs/current/reference/html/appendix-application-properties.html#common-application-properties</a></p>
<pre><code>@SpringBootApplication
@SpringBootApplicationæ˜¯ä¸€ä¸ªå¤åˆæ³¨è§£æˆ–æ´¾ç”Ÿæ³¨è§£ï¼Œåœ¨@SpringBootApplicationä¸­æœ‰ä¸€ä¸ªæ³¨è§£@EnableAutoConfigurationï¼Œè¯¥æ³¨è§£æ˜¯å¼€å¯è‡ªåŠ¨é…ç½®
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Inherited
@SpringBootConfiguration
@EnableAutoConfiguration
@ComponentScan(excludeFilters = { @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),
        @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) })
public @interface SpringBootApplication {
</code></pre><p>@EnableAutoConfigurationä¹Ÿæ˜¯ä¸€ä¸ªæ´¾ç”Ÿæ³¨è§£ï¼Œå…¶ä¸­çš„å…³é”®åŠŸèƒ½æ˜¯ç”±@Importæä¾›ï¼Œå…¶å¯¼å…¥çš„AutoConfigurationImportSelectorçš„selectImports()æ–¹æ³•é€šè¿‡SpringFactoriesLoader.loadFactoryNames()æ‰«ææ‰€æœ‰å…·æœ‰META-INF/spring.factoriesçš„jaråŒ…ã€‚ spring-boot-autoconfigure-x.x.x.x.jaré‡Œå°±æœ‰ä¸€ä¸ªspring.factoriesæ–‡ä»¶ã€‚spring.factoriesæ–‡ä»¶ç”±ä¸€ç»„ä¸€ç»„çš„key=valueçš„å½¢å¼ï¼Œå…¶ä¸­ä¸€ä¸ªkeyæ˜¯EnableAutoConfigurationç±»çš„å…¨ç±»åï¼Œè€Œå®ƒçš„valueæ˜¯ä¸€ä¸ªxxxxAutoConfigurationçš„ç±»åçš„åˆ—è¡¨ï¼Œ è¿™äº›ç±»åä»¥é€—å·åˆ†éš”ã€‚<br>spring-boot-autoconfigure-x.x.x.x.jar -&gt; META-INF/spring.factories -&gt; org.springframework.boot.autoconfigure.xxx.xxxAutoConfiguration ç±»åˆ—è¡¨å°†ä¼šè¢«å®ä¾‹åŒ–åˆ°Springå®¹å™¨ã€‚<br>SpringBooté¡¹ç›®å¯åŠ¨æ—¶ï¼Œ@SpringBootApplicationç”¨åœ¨å¯åŠ¨ç±»SpringApplication.run()çš„å†…éƒ¨å°±ä¼šç½®é¡¶selectImports()æ–¹æ³•ï¼Œæ‰¾åˆ°æ‰€æœ‰JavaConfigè‡ªåŠ¨é…ç½®ç±»çš„å…¨é™å®šåå¯¹åº”çš„class,ç„¶åå°†æ‰€æœ‰è‡ªåŠ¨é…ç½®ç±»åŠ è½½åˆ°Springå®¹å™¨ä¸­ã€‚</p>
<h3 id="ä»¥redisè‡ªåŠ¨é…ç½®ï¼Œè§£æSpringè‡ªåŠ¨é…ç½®åŸç†"><a href="#ä»¥redisè‡ªåŠ¨é…ç½®ï¼Œè§£æSpringè‡ªåŠ¨é…ç½®åŸç†" class="headerlink" title="ä»¥redisè‡ªåŠ¨é…ç½®ï¼Œè§£æSpringè‡ªåŠ¨é…ç½®åŸç†"></a>ä»¥redisè‡ªåŠ¨é…ç½®ï¼Œè§£æSpringè‡ªåŠ¨é…ç½®åŸç†</h3><h4 id="å°†redis-starterä¾èµ–åŠ å…¥"><a href="#å°†redis-starterä¾èµ–åŠ å…¥" class="headerlink" title="å°†redis starterä¾èµ–åŠ å…¥"></a>å°†redis starterä¾èµ–åŠ å…¥</h4><pre><code>&lt;!--redis jar--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre><p>org.springframework.boot.autoconfigure.data.redis.RedisAutoConfigurationä¼šè¢«å®ä¾‹åŒ–åˆ°å®¹å™¨ã€‚è¯¥ç±»ä¸ºä»€ä¹ˆä¼šè¢«å®ä¾‹åŒ–ï¼Ÿ å› ä¸ºå®ƒåœ¨META-INF/spring.factoriesçš„Auto Configureåˆ—è¡¨ã€‚<br>org.springframework.boot.autoconfigure.data.redis.RedisAutoConfigurationè¢«å®ä¾‹åŒ–ï¼Œç„¶è€Œredisä¹Ÿä¼šè¢«å®ä¾‹åŒ–å³åˆ›å»ºRedisTemplateåœ¨Springå®¹å™¨ã€‚</p>
<p>ç„¶è€Œå®ä¾‹åŒ–rediså¯¹è±¡æ˜¯æœ‰æ¡ä»¶çš„å³@ConditionalOnClass({RedisOperations.class})ï¼Œæ„æ€ï¼šå½“ç»™å®šçš„ç±»ååœ¨ç±»è·¯å¾„ä¸Šå­˜åœ¨ï¼Œåˆ™å®ä¾‹åŒ–å½“å‰Beanã€‚</p>
<p>ä¹Ÿå°±æ˜¯æƒ³Springåˆ›å»ºrediså®ä¾‹å¯¹è±¡ï¼Œå¿…é¡»éœ€è¦å°†redis starteråŒ…ï¼šspring-boot-starter-data-redisä¾èµ–å¼•å…¥ã€‚æœ‰äº†redis starterä¾èµ–springbootè‡ªåŠ¨é…ç½®å°±ä¼šæ£€æµ‹åˆ°classpathè·¯å¾„ä¸‹æœ‰ç›¸å…³çš„ç±»ï¼Œç„¶åå°±å¯ä»¥å®ä¾‹åŒ–å¯¹åº”çš„ç±»äº†ï¼Œè¿™å°±æ˜¯è‡ªåŠ¨é…ç½®çš„åŸç†ã€‚</p>
<p><em>çŸ¥è¯†ç‚¹ï¼šç±»ä¸Šæœ‰è¯¥æ³¨è§£@Configurationï¼Œç±»è¢«å®ä¾‹åŒ– æ—¶@beanä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œç”Ÿæˆå¯¹åº”çš„beanå®ä¾‹ï¼Œæ”¾å…¥Springå®¹å™¨ã€‚</em></p>
<pre><code>org.springframework.boot.autoconfigure.data.redis.RedisAutoConfigurationä¼šå¯¼å…¥JedisConnectionConfiguration.class
@Import({LettuceConnectionConfiguration.class, JedisConnectionConfiguration.class})

JedisConnectionConfiguration.classæœ‰æ³¨è§£ï¼š@ConditionalOnClass({GenericObjectPool.class, JedisConnection.class, Jedis.class}) 
</code></pre><h4 id="springæ˜¯æ€æ ·è¯»å–redisé…ç½®å‚æ•°ï¼Ÿ"><a href="#springæ˜¯æ€æ ·è¯»å–redisé…ç½®å‚æ•°ï¼Ÿ" class="headerlink" title="springæ˜¯æ€æ ·è¯»å–redisé…ç½®å‚æ•°ï¼Ÿ"></a>springæ˜¯æ€æ ·è¯»å–redisé…ç½®å‚æ•°ï¼Ÿ</h4><p>å…³é”®æ˜¯org.springframework.boot.autoconfigure.data.redis.RedisAutoConfigurationçš„æ³¨è§£ï¼š@EnableConfigurationProperties({RedisProperties.class})</p>
<p><em>çŸ¥è¯†ç‚¹ï¼š@EnableConfigurationPropertiesä¼šå°†é…ç½®æ–‡ä»¶çš„key-valueæ˜ å°„æˆJavaå¯¹è±¡ã€‚<br>redisé…ç½®ç±»ï¼Œå¦‚æœæ²¡redisé…ç½®ï¼Œä½¿ç”¨æœ¬åœ°çš„redisè¿™éœ€è¦æœ¬åœ°å®‰è£…redisæœåŠ¡ï¼Œå¦‚æœæœ‰redisé…ç½®å°±è®¾ç½®redis hostã€portç­‰å±æ€§</em></p>
<p>appliccation.yml redisé…ç½®ã€‚å¿…é¡»ä»¥spring.rediså¼€å¤´</p>
<h2 id="spring-boot-starter"><a href="#spring-boot-starter" class="headerlink" title="spring-boot-starter"></a>spring-boot-starter</h2><p>SpringBoot å¯ä»¥çœç•¥ä¼—å¤šçš„ç¹çé…ç½®ï¼Œå®ƒçš„ä¼—å¤šstarterå¯ä»¥è¯´åŠŸä¸å¯æ²¡ã€‚ ä¾‹å¦‚é›†æˆredis,åªéœ€è¦pom.xmlä¸­å¼•å…¥spring-boot-starter-data-redis,é…ç½®æ–‡ä»¶application.ymlä¸­åŠ å…¥spring.redis.databaseç­‰å‡ ä¸ªå…³é”®é…ç½®é¡¹å³å¯ï¼Œå¸¸ç”¨çš„starterè¿˜æœ‰spring-boot-starter-webã€spring-boot-starter-testç­‰ï¼Œç›¸æ¯”ä¼ ç»Ÿçš„xmlé…ç½®å¤§å¤§å‡å°‘äº†é›†æˆçš„å·¥ä½œé‡ã€‚</p>
<h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>åˆ©ç”¨starterå®ç°è‡ªåŠ¨åŒ–é…ç½®åªéœ€è¦ä¸¤ä¸ªæ¡ä»¶â€“mavenä¾èµ–ã€é…ç½®æ–‡ä»¶ã€‚å¼•å…¥mavenå®è´¨å°±æ˜¯å¯¼å…¥jaråŒ…ï¼Œspring-bootå¯åŠ¨çš„æ—¶å€™ä¼šæ‰¾åˆ°starter jaråŒ…ä¸­çš„resources/META-INF/spring.factoriesæ–‡ä»¶ï¼Œæ ¹æ®spring.factoriesæ–‡ä»¶ä¸­çš„é…ç½®ï¼Œæ‰¾åˆ°éœ€è¦è‡ªåŠ¨é…ç½®çš„ç±»ã€‚</p>
<table>
<thead>
<tr>
<th>æ³¨è§£</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>@Configuration</td>
<td>è¡¨æ˜æ˜¯ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œè¢«æ³¨è§£çš„ç±»å°†æˆä¸ºä¸€ä¸ªbeané…ç½®ç±»</td>
</tr>
<tr>
<td>@ConditionalOnClass</td>
<td>å½“classpathä¸‹å‘ç°è¯¥ç±»çš„æƒ…å†µä¸‹è¿›è¡Œè‡ªåŠ¨é…ç½®</td>
</tr>
<tr>
<td>@ConditionalOnBean</td>
<td>å½“classpathä¸‹å‘ç°è¯¥ç±»çš„æƒ…å†µä¸‹è¿›è¡Œè‡ªåŠ¨é…ç½®</td>
</tr>
<tr>
<td>@EnableConfigurationProperties</td>
<td>ä½¿@ConfigurationPropertiesæ³¨è§£ç”Ÿæ•ˆ</td>
</tr>
<tr>
<td>@AutoConfigureAfter</td>
<td>å®Œæˆè‡ªåŠ¨é…ç½®åå®ä¾‹åŒ–è¿™ä¸ªbean</td>
</tr>
</tbody>
</table>
<h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><p>pom.xml</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.1.4.RELEASE&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;com.air&lt;/groupId&gt;
    &lt;artifactId&gt;starter-demo&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;starter-demo&lt;/name&gt;
    &lt;description&gt;spring-boot-starter demo&lt;/description&gt;

    &lt;properties&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;!-- Source --&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-source-plugin&lt;/artifactId&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;phase&gt;package&lt;/phase&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;jar-no-fork&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;
</code></pre><p>spring-boot-configuration-processor çš„ä½œç”¨æ˜¯ç¼–è¯‘æ—¶ç”Ÿæˆ spring-configuration-metadata.json ï¼Œåœ¨IDEä¸­ç¼–è¾‘é…ç½®æ–‡ä»¶æ—¶ï¼Œä¼šå‡ºç°æç¤ºã€‚ æ‰“åŒ…é€‰æ‹©jar-no-forkï¼Œå› ä¸ºè¿™é‡Œä¸éœ€è¦mainå‡½æ•°ã€‚</p>
<h3 id="EnableDemoConfiguration"><a href="#EnableDemoConfiguration" class="headerlink" title="EnableDemoConfiguration"></a>EnableDemoConfiguration</h3><pre><code>@Target({ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Inherited
public @interface EnableDemoConfiguration {
}
</code></pre><h3 id="DemoProperties"><a href="#DemoProperties" class="headerlink" title="DemoProperties"></a>DemoProperties</h3><pre><code>@Data
@ConfigurationProperties(prefix = &quot;demo&quot;)
public class DemoProperties {
    private String name;
    private Integer age;
}
</code></pre><p>nameå’Œageå¯¹åº”application.propertiesé‡Œé¢çš„demo.nameå’Œdemo.age</p>
<h3 id="DemoAutoConfiguration"><a href="#DemoAutoConfiguration" class="headerlink" title="DemoAutoConfiguration"></a>DemoAutoConfiguration</h3><pre><code>@Configuration
@ConditionalOnBean(annotation = EnableDemoConfiguration.class)
@EnableConfigurationProperties(DemoProperties.class)
public class DemoAutoConfiguration {

    @Bean
    @ConditionalOnMissingBean
    DemoService demoService (){
        return new DemoService();
    }

}
</code></pre><p>è¿™é‡Œè®¾ç½®è‡ªåŠ¨é…ç½®çš„ç›¸å…³æ¡ä»¶ï¼Œå’Œç›¸å…³æ“ä½œï¼Œç”±äºè¿™é‡Œåªæƒ³å†™ä¸€ä¸ªæœ€ç®€å•çš„demoï¼Œæ‰€ä»¥è¿™é‡Œåªéœ€è¦ç®€å•æ³¨å…¥ä¸€ä¸ªbeanï¼Œæ²¡æœ‰å¤æ‚é€»è¾‘ï¼Œå®é™…å¼€å‘ä¸­ï¼Œè¿™ä¸ªç±»æ˜¯æœ€å…³é”®çš„ã€‚</p>
<h3 id="DemoService"><a href="#DemoService" class="headerlink" title="DemoService"></a>DemoService</h3><pre><code>public class DemoService {

    @Autowired
    private DemoProperties demoProperties;

    public void print() {
        System.out.println(demoProperties.getName());
        System.out.println(demoProperties.getAge());
    }
}
</code></pre><p>è¿™é‡Œä¸éœ€è¦@Serviceï¼Œå› ä¸ºå·²ç»é€šè¿‡DemoAutoConfigurationæ³¨å…¥springå®¹å™¨äº†ã€‚</p>
<h3 id="spring-factories"><a href="#spring-factories" class="headerlink" title="spring.factories"></a>spring.factories</h3><p>åœ¨resources/META-INF/ä¸‹åˆ›å»ºspring.factoriesæ–‡ä»¶:<br>org.springframework.boot.autoconfigure.EnableAutoConfiguration=\<br>com.air.starterdemo.config.DemoAutoConfiguration<br>å‘Šè¯‰spring-bootï¼Œå¯åŠ¨æ—¶éœ€è¦æ‰«æçš„ç±»ã€‚</p>
<h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>pom.xml æœ¬åœ°mvn installä¹‹åï¼Œåœ¨æ–°çš„spring-booté¡¹ç›®é‡Œé¢å¼•å…¥<br>    <dependency><br>        <groupid>com.air</groupid><br>        <artifactid>starter-demo</artifactid><br>        <version>0.0.1-SNAPSHOT</version><br>    </dependency></p>
<h3 id="é…ç½®æ–‡ä»¶-1"><a href="#é…ç½®æ–‡ä»¶-1" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><pre><code>demo.name = ooo
demo.age = 11
</code></pre><p>å¦‚æœä½¿ç”¨çš„æ˜¯IDEAï¼Œåœ¨ç¼–è¾‘æ—¶ä¼šå‡ºç°æç¤ºã€‚</p>
<h3 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><pre><code>@SpringBootApplication
@EnableDemoConfiguration
public class Demo1Application {

    @Autowired
    private DemoService demoService;

    public static void main(String[] args) {
        SpringApplication.run(Demo1Application.class, args);
    }

    @PostConstruct
    public void test() {
        demoService.print();
    }
}
</code></pre><p>å¯åŠ¨mainå‡½æ•°ï¼Œæ§åˆ¶å°ä¼šæ‰“å°å‡ºé…ç½®æ–‡ä»¶ä¸­çš„nameå’Œageï¼Œä¸€ä¸ªç®€å•çš„spring-boot-starterå°±å†™å¥½äº†</p>
<h3 id="spring-factories-1"><a href="#spring-factories-1" class="headerlink" title="spring.factories"></a>spring.factories</h3><pre><code># Initializers
org.springframework.context.ApplicationContextInitializer=\
org.springframework.boot.autoconfigure.SharedMetadataReaderFactoryContextInitializer,\
org.springframework.boot.autoconfigure.logging.ConditionEvaluationReportLoggingListener

# Application Listeners
org.springframework.context.ApplicationListener=\
org.springframework.boot.autoconfigure.BackgroundPreinitializer

# Auto Configuration Import Listeners
org.springframework.boot.autoconfigure.AutoConfigurationImportListener=\
org.springframework.boot.autoconfigure.condition.ConditionEvaluationReportAutoConfigurationImportListener

# Auto Configuration Import Filters
org.springframework.boot.autoconfigure.AutoConfigurationImportFilter=\
org.springframework.boot.autoconfigure.condition.OnBeanCondition,\
org.springframework.boot.autoconfigure.condition.OnClassCondition,\
org.springframework.boot.autoconfigure.condition.OnWebApplicationCondition

# Auto Configure
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\
org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\
org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\
org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration,\
org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration,\
org.springframework.boot.autoconfigure.cassandra.CassandraAutoConfiguration,\
org.springframework.boot.autoconfigure.context.ConfigurationPropertiesAutoConfiguration,\
org.springframework.boot.autoconfigure.context.LifecycleAutoConfiguration,\
org.springframework.boot.autoconfigure.context.MessageSourceAutoConfiguration,\
org.springframework.boot.autoconfigure.context.PropertyPlaceholderAutoConfiguration,\
org.springframework.boot.autoconfigure.couchbase.CouchbaseAutoConfiguration,\
org.springframework.boot.autoconfigure.dao.PersistenceExceptionTranslationAutoConfiguration,\
org.springframework.boot.autoconfigure.data.cassandra.CassandraDataAutoConfiguration,\
org.springframework.boot.autoconfigure.data.cassandra.CassandraReactiveDataAutoConfiguration,\
org.springframework.boot.autoconfigure.data.cassandra.CassandraReactiveRepositoriesAutoConfiguration,\
org.springframework.boot.autoconfigure.data.cassandra.CassandraRepositoriesAutoConfiguration,\
org.springframework.boot.autoconfigure.data.couchbase.CouchbaseDataAutoConfiguration,\
org.springframework.boot.autoconfigure.data.couchbase.CouchbaseReactiveDataAutoConfiguration,\
org.springframework.boot.autoconfigure.data.couchbase.CouchbaseReactiveRepositoriesAutoConfiguration,\
org.springframework.boot.autoconfigure.data.couchbase.CouchbaseRepositoriesAutoConfiguration,\
org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchDataAutoConfiguration,\
org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchRepositoriesAutoConfiguration,\
org.springframework.boot.autoconfigure.data.elasticsearch.ReactiveElasticsearchRepositoriesAutoConfiguration,\
org.springframework.boot.autoconfigure.data.elasticsearch.ReactiveElasticsearchRestClientAutoConfiguration,\
org.springframework.boot.autoconfigure.data.jdbc.JdbcRepositoriesAutoConfiguration,\
org.springframework.boot.autoconfigure.data.jpa.JpaRepositoriesAutoConfiguration,\
org.springframework.boot.autoconfigure.data.ldap.LdapRepositoriesAutoConfiguration,\
org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration,\
org.springframework.boot.autoconfigure.data.mongo.MongoReactiveDataAutoConfiguration,\
org.springframework.boot.autoconfigure.data.mongo.MongoReactiveRepositoriesAutoConfiguration,\
org.springframework.boot.autoconfigure.data.mongo.MongoRepositoriesAutoConfiguration,\
org.springframework.boot.autoconfigure.data.neo4j.Neo4jDataAutoConfiguration,\
org.springframework.boot.autoconfigure.data.neo4j.Neo4jRepositoriesAutoConfiguration,\
org.springframework.boot.autoconfigure.data.solr.SolrRepositoriesAutoConfiguration,\
org.springframework.boot.autoconfigure.data.r2dbc.R2dbcDataAutoConfiguration,\
org.springframework.boot.autoconfigure.data.r2dbc.R2dbcRepositoriesAutoConfiguration,\
org.springframework.boot.autoconfigure.data.r2dbc.R2dbcTransactionManagerAutoConfiguration,\
org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration,\
org.springframework.boot.autoconfigure.data.redis.RedisReactiveAutoConfiguration,\
org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration,\
org.springframework.boot.autoconfigure.data.rest.RepositoryRestMvcAutoConfiguration,\
org.springframework.boot.autoconfigure.data.web.SpringDataWebAutoConfiguration,\
org.springframework.boot.autoconfigure.elasticsearch.ElasticsearchRestClientAutoConfiguration,\
org.springframework.boot.autoconfigure.flyway.FlywayAutoConfiguration,\
org.springframework.boot.autoconfigure.freemarker.FreeMarkerAutoConfiguration,\
org.springframework.boot.autoconfigure.groovy.template.GroovyTemplateAutoConfiguration,\
org.springframework.boot.autoconfigure.gson.GsonAutoConfiguration,\
org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration,\
org.springframework.boot.autoconfigure.hateoas.HypermediaAutoConfiguration,\
org.springframework.boot.autoconfigure.hazelcast.HazelcastAutoConfiguration,\
org.springframework.boot.autoconfigure.hazelcast.HazelcastJpaDependencyAutoConfiguration,\
org.springframework.boot.autoconfigure.http.HttpMessageConvertersAutoConfiguration,\
org.springframework.boot.autoconfigure.http.codec.CodecsAutoConfiguration,\
org.springframework.boot.autoconfigure.influx.InfluxDbAutoConfiguration,\
org.springframework.boot.autoconfigure.info.ProjectInfoAutoConfiguration,\
org.springframework.boot.autoconfigure.integration.IntegrationAutoConfiguration,\
org.springframework.boot.autoconfigure.jackson.JacksonAutoConfiguration,\
org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration,\
org.springframework.boot.autoconfigure.jdbc.JdbcTemplateAutoConfiguration,\
org.springframework.boot.autoconfigure.jdbc.JndiDataSourceAutoConfiguration,\
org.springframework.boot.autoconfigure.jdbc.XADataSourceAutoConfiguration,\
org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration,\
org.springframework.boot.autoconfigure.jms.JmsAutoConfiguration,\
org.springframework.boot.autoconfigure.jmx.JmxAutoConfiguration,\
org.springframework.boot.autoconfigure.jms.JndiConnectionFactoryAutoConfiguration,\
org.springframework.boot.autoconfigure.jms.activemq.ActiveMQAutoConfiguration,\
org.springframework.boot.autoconfigure.jms.artemis.ArtemisAutoConfiguration,\
org.springframework.boot.autoconfigure.jersey.JerseyAutoConfiguration,\
org.springframework.boot.autoconfigure.jooq.JooqAutoConfiguration,\
org.springframework.boot.autoconfigure.jsonb.JsonbAutoConfiguration,\
org.springframework.boot.autoconfigure.kafka.KafkaAutoConfiguration,\
org.springframework.boot.autoconfigure.availability.ApplicationAvailabilityAutoConfiguration,\
org.springframework.boot.autoconfigure.ldap.embedded.EmbeddedLdapAutoConfiguration,\
org.springframework.boot.autoconfigure.ldap.LdapAutoConfiguration,\
org.springframework.boot.autoconfigure.liquibase.LiquibaseAutoConfiguration,\
org.springframework.boot.autoconfigure.mail.MailSenderAutoConfiguration,\
org.springframework.boot.autoconfigure.mail.MailSenderValidatorAutoConfiguration,\
org.springframework.boot.autoconfigure.mongo.embedded.EmbeddedMongoAutoConfiguration,\
org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration,\
org.springframework.boot.autoconfigure.mongo.MongoReactiveAutoConfiguration,\
org.springframework.boot.autoconfigure.mustache.MustacheAutoConfiguration,\
org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration,\
org.springframework.boot.autoconfigure.quartz.QuartzAutoConfiguration,\
org.springframework.boot.autoconfigure.r2dbc.R2dbcAutoConfiguration,\
org.springframework.boot.autoconfigure.rsocket.RSocketMessagingAutoConfiguration,\
org.springframework.boot.autoconfigure.rsocket.RSocketRequesterAutoConfiguration,\
org.springframework.boot.autoconfigure.rsocket.RSocketServerAutoConfiguration,\
org.springframework.boot.autoconfigure.rsocket.RSocketStrategiesAutoConfiguration,\
org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration,\
org.springframework.boot.autoconfigure.security.servlet.UserDetailsServiceAutoConfiguration,\
org.springframework.boot.autoconfigure.security.servlet.SecurityFilterAutoConfiguration,\
org.springframework.boot.autoconfigure.security.reactive.ReactiveSecurityAutoConfiguration,\
org.springframework.boot.autoconfigure.security.reactive.ReactiveUserDetailsServiceAutoConfiguration,\
org.springframework.boot.autoconfigure.security.rsocket.RSocketSecurityAutoConfiguration,\
org.springframework.boot.autoconfigure.security.saml2.Saml2RelyingPartyAutoConfiguration,\
org.springframework.boot.autoconfigure.sendgrid.SendGridAutoConfiguration,\
org.springframework.boot.autoconfigure.session.SessionAutoConfiguration,\
org.springframework.boot.autoconfigure.security.oauth2.client.servlet.OAuth2ClientAutoConfiguration,\
org.springframework.boot.autoconfigure.security.oauth2.client.reactive.ReactiveOAuth2ClientAutoConfiguration,\
org.springframework.boot.autoconfigure.security.oauth2.resource.servlet.OAuth2ResourceServerAutoConfiguration,\
org.springframework.boot.autoconfigure.security.oauth2.resource.reactive.ReactiveOAuth2ResourceServerAutoConfiguration,\
org.springframework.boot.autoconfigure.solr.SolrAutoConfiguration,\
org.springframework.boot.autoconfigure.task.TaskExecutionAutoConfiguration,\
org.springframework.boot.autoconfigure.task.TaskSchedulingAutoConfiguration,\
org.springframework.boot.autoconfigure.thymeleaf.ThymeleafAutoConfiguration,\
org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration,\
org.springframework.boot.autoconfigure.transaction.jta.JtaAutoConfiguration,\
org.springframework.boot.autoconfigure.validation.ValidationAutoConfiguration,\
org.springframework.boot.autoconfigure.web.client.RestTemplateAutoConfiguration,\
org.springframework.boot.autoconfigure.web.embedded.EmbeddedWebServerFactoryCustomizerAutoConfiguration,\
org.springframework.boot.autoconfigure.web.reactive.HttpHandlerAutoConfiguration,\
org.springframework.boot.autoconfigure.web.reactive.ReactiveWebServerFactoryAutoConfiguration,\
org.springframework.boot.autoconfigure.web.reactive.WebFluxAutoConfiguration,\
org.springframework.boot.autoconfigure.web.reactive.error.ErrorWebFluxAutoConfiguration,\
org.springframework.boot.autoconfigure.web.reactive.function.client.ClientHttpConnectorAutoConfiguration,\
org.springframework.boot.autoconfigure.web.reactive.function.client.WebClientAutoConfiguration,\
org.springframework.boot.autoconfigure.web.servlet.DispatcherServletAutoConfiguration,\
org.springframework.boot.autoconfigure.web.servlet.ServletWebServerFactoryAutoConfiguration,\
org.springframework.boot.autoconfigure.web.servlet.error.ErrorMvcAutoConfiguration,\
org.springframework.boot.autoconfigure.web.servlet.HttpEncodingAutoConfiguration,\
org.springframework.boot.autoconfigure.web.servlet.MultipartAutoConfiguration,\
org.springframework.boot.autoconfigure.web.servlet.WebMvcAutoConfiguration,\
org.springframework.boot.autoconfigure.websocket.reactive.WebSocketReactiveAutoConfiguration,\
org.springframework.boot.autoconfigure.websocket.servlet.WebSocketServletAutoConfiguration,\
org.springframework.boot.autoconfigure.websocket.servlet.WebSocketMessagingAutoConfiguration,\
org.springframework.boot.autoconfigure.webservices.WebServicesAutoConfiguration,\
org.springframework.boot.autoconfigure.webservices.client.WebServiceTemplateAutoConfiguration

# Failure analyzers
org.springframework.boot.diagnostics.FailureAnalyzer=\
org.springframework.boot.autoconfigure.diagnostics.analyzer.NoSuchBeanDefinitionFailureAnalyzer,\
org.springframework.boot.autoconfigure.flyway.FlywayMigrationScriptMissingFailureAnalyzer,\
org.springframework.boot.autoconfigure.jdbc.DataSourceBeanCreationFailureAnalyzer,\
org.springframework.boot.autoconfigure.jdbc.HikariDriverConfigurationFailureAnalyzer,\
org.springframework.boot.autoconfigure.r2dbc.ConnectionFactoryBeanCreationFailureAnalyzer,\
org.springframework.boot.autoconfigure.session.NonUniqueSessionRepositoryFailureAnalyzer

# Template availability providers
org.springframework.boot.autoconfigure.template.TemplateAvailabilityProvider=\
org.springframework.boot.autoconfigure.freemarker.FreeMarkerTemplateAvailabilityProvider,\
org.springframework.boot.autoconfigure.mustache.MustacheTemplateAvailabilityProvider,\
org.springframework.boot.autoconfigure.groovy.template.GroovyTemplateAvailabilityProvider,\
org.springframework.boot.autoconfigure.thymeleaf.ThymeleafTemplateAvailabilityProvider,\
org.springframework.boot.autoconfigure.web.servlet.JspTemplateAvailabilityProvider
</code></pre><p>æ¯ä¸€ä¸ªautoconfigureç±»éƒ½æ˜¯å®¹å™¨ä¸­çš„ä¸€ä¸ªç»„ä»¶ï¼Œéƒ½åŠ å…¥åˆ°å®¹å™¨ä¸­ï¼Œç”¨ä»–ä»¬æ¥åšè‡ªåŠ¨é…ç½®</p>
<p>æ¯ä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»è¿›è¡Œè‡ªåŠ¨é…ç½®åŠŸèƒ½;</p>
<p>ä»¥HttpEncodingAutoConfigurationä¸ºä¾‹è§£é‡Šè‡ªåŠ¨é…ç½®åŸç†</p>
<pre><code>@Configuration(//è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»
proxyBeanMethods = false
)
@EnableConfigurationProperties({ServerProperties.class})//å¯ç”¨configurationPropertiesåŠŸèƒ½ï¼Œå°†é…ç½®æ–‡ä»¶ä¸­å¯¹åº”çš„å€¼å’ŒxxxPropertiesç»‘å®šèµ·æ¥
@ConditionalOnWebApplication(//Springåº•å±‚@Conditionalæ³¨è§£ï¼Œæ ¹æ®ä¸åŒæ¡ä»¶ï¼Œå¦‚æœæ»¡è¶³æŒ‡å®šæ¡ä»¶ï¼Œæ•´ä¸ªé…ç½®é‡Œé‡Œé¢çš„é…ç½®å°±ä¼šç”Ÿæ•ˆï¼Œåˆ¤æ–­å½“å‰åº”ç”¨æ˜¯å¦æ˜¯webåº”ç”¨ï¼Œæ˜¯å°±ç”Ÿæ•ˆä¸æ˜¯å°±ä¸ç”Ÿæ•ˆ
    type = Type.SERVLET
)
@ConditionalOnClass({CharacterEncodingFilter.class})//åˆ¤æ–­å½“å‰é¡¹ç›®æœ‰æ²¡æœ‰è¿™ä¸ªç±»
CharacterEncodingFilterï¼šSpringMVCä¸­è¿›è¡Œä¹±ç è§£å†³çš„è¿‡æ»¤å™¨
@ConditionalOnProperty(//åˆ¤æ–­é…ç½®æ–‡ä»¶ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªé…ç½®server.servlet.encoding.enabledå¦‚æœä¸å­˜åœ¨åˆ¤æ–­ä¹Ÿæ˜¯æˆç«‹çš„ï¼Œå³ä½¿æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶ä¸­ä¸é…ç½®server.servlet.encoding.enabled=true,ä¹Ÿæ˜¯é»˜è®¤ç”Ÿæ•ˆçš„  
    prefix = &quot;server.servlet.encoding&quot;,//ä»é…ç½®æ–‡ä»¶ä¸­è·å–æŒ‡å®šçš„å€¼å’Œbeançš„å±æ€§è¿›è¡Œç»‘å®š
    value = {&quot;enabled&quot;},
    matchIfMissing = true
)
public class HttpEncodingAutoConfiguration {
</code></pre><p>æ ¹æ®å½“å‰ä¸åŒçš„æ¡ä»¶åˆ¤æ–­ï¼Œå†³å®šè¿™ä¸ªé…ç½®ç±»æ˜¯å¦ç”Ÿæ•ˆ</p>
<p><em>å¦‚æœç”Ÿæ•ˆï¼Œè¿™ä¸ªé…ç½®ç±»å°±ä¼šç»™å®¹å™¨ä¸­æ·»åŠ å„ç§ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶çš„å±æ€§æ˜¯ä»å¯¹åº”çš„propertiesç±»ä¸­è·å–çš„ï¼Œè¿™äº›ç±»é‡Œé¢çš„æ¯ä¸€ä¸ªåˆæ˜¯å’Œé…ç½®æ–‡ä»¶ç»‘å®šçš„</em></p>
<pre><code>@Bean//ç»™å®¹å™¨ä¸­æ·»åŠ ä¸€ä¸ªç»„ä»¶,è¿™ä¸ªç»„ä»¶çš„æŸäº›å€¼éœ€è¦ä»propertiesä¸­è·å–
@ConditionalOnMissingBean
public CharacterEncodingFilter characterEncodingFilter() {
    CharacterEncodingFilter filter = new OrderedCharacterEncodingFilter();
    filter.setEncoding(this.properties.getCharset().name());
    filter.setForceRequestEncoding(this.properties.shouldForce(org.springframework.boot.web.servlet.server.Encoding.Type.REQUEST));
    filter.setForceResponseEncoding(this.properties.shouldForce(org.springframework.boot.web.servlet.server.Encoding.Type.RESPONSE));
    return filter;
}
</code></pre><p>æ‰€æœ‰åœ¨é…ç½®æ–‡ä»¶ä¸­èƒ½é…ç½®çš„å±æ€§éƒ½æ˜¯xxxPropertiesç±»ä¸­å°è£…ç€ï¼Œé…ç½®æ–‡ä»¶èƒ½é…ç½®ä»€ä¹ˆå°±å¯ä»¥å‚ç…§æŸä¸ªåŠŸèƒ½å¯¹åº”çš„è¿™ä¸ªå±æ€§ç±»</p>
<p>æ€»ç»“ 1ã€SpringBootå¯åŠ¨ä¼šåŠ è½½å¤§é‡çš„è‡ªåŠ¨é…ç½®ç±»ï¼›</p>
<p>â€‹    2ã€æˆ‘ä»¬çœ‹éœ€è¦çš„åŠŸèƒ½æœ‰æ²¡æœ‰SpringBooté»˜è®¤å†™å¥½çš„è‡ªåŠ¨é…ç½®ç±»</p>
<p>â€‹    3ã€æˆ‘ä»¬å†æ¥çœ‹è¿™ä¸ªè‡ªåŠ¨é…ç½®ç±»ä¸­é…ç½®äº†å“ªäº›ç»„ä»¶ï¼Œåªè¦æˆ‘ä»¬è¦ç”¨çš„ç»„ä»¶æœ‰ï¼Œå°±ä¸éœ€è¦å†æ¥é…ç½®äº†ï¼Œ</p>
<p>â€‹    4ã€ç»™å®¹å™¨ä¸­è‡ªåŠ¨é…ç½®ç±»æ·»åŠ ç»„ä»¶çš„æ—¶å€™ï¼Œä¼šä»propertiesç±»ä¸­è·å–æŸäº›å±æ€§ï¼Œæˆ‘ä»¬å°±å¯ä»¥å†é…ç½®æ–‡ä»¶æ€»æŒ‡å®šè¿™äº›å±æ€§çš„å€¼ã€‚</p>
<p>xxxAutoConfiguration:è‡ªåŠ¨é…ç½®ç±»</p>
<p>ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶</p>
<p>xxxPropertiesï¼šå°è£…é…ç½®æ–‡ä»¶ä¸­ç›¸å…³å±æ€§</p>
<p>è‡ªåŠ¨é…ç½®ç±»å“ªä¸ªç”Ÿæ•ˆäº†</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡debug=trueæ¥è®©æ§åˆ¶å°æ‰“å°è‡ªåŠ¨é…ç½®æŠ¥å‘Šï¼Œè¿™æ ·å°±å¯ä»¥å¾ˆæ–¹ä¾¿çŸ¥é“å“ªäº›è‡ªåŠ¨é…ç½®ç”Ÿæ•ˆäº†</p>
<pre><code>============================
CONDITIONS EVALUATION REPORT
============================


Positive matches:ï¼ˆè‡ªåŠ¨é…ç½®ç±»å¯ç”¨çš„ï¼‰
-----------------

AopAutoConfiguration matched:
- @ConditionalOnProperty (spring.aop.auto=true) matched (OnPropertyCondition)

AopAutoConfiguration.ClassProxyingConfiguration matched:
- @ConditionalOnMissingClass did not find unwanted class &apos;org.aspectj.weaver.Advice&apos; (OnClassCondition)
- @ConditionalOnProperty (spring.aop.proxy-target-class=true) matched (OnPropertyCondition)

DispatcherServletAutoConfiguration matched:
- @ConditionalOnClass found required class &apos;org.springframework.web.servlet.DispatcherServlet&apos; (OnClassCondition)
- found &apos;session&apos; scope (OnWebApplicationCondition)

DispatcherServletAutoConfiguration.DispatcherServletConfiguration matched:
- @ConditionalOnClass found required class &apos;javax.servlet.ServletRegistration&apos; (OnClassCondition)
- Default DispatcherServlet did not find dispatcher servlet beans (DispatcherServletAutoConfiguration.DefaultDispatcherServletCondition)


Negative matches:ï¼ˆæ²¡æœ‰å¯ç”¨çš„ï¼Œæ²¡åŒ¹é…æˆåŠŸçš„ï¼‰
-----------------

ActiveMQAutoConfiguration:
Did not match:
- @ConditionalOnClass did not find required class &apos;javax.jms.ConnectionFactory&apos; (OnClassCondition)

AopAutoConfiguration.AspectJAutoProxyingConfiguration:
Did not match:
- @ConditionalOnClass did not find required class &apos;org.aspectj.weaver.Advice&apos; (OnClassCondition)

ArtemisAutoConfiguration:
Did not match:
- @ConditionalOnClass did not find required class &apos;javax.jms.ConnectionFactory&apos; (OnClassCondition)
</code></pre><h2 id="SpringBootä¸æ—¥å¿—"><a href="#SpringBootä¸æ—¥å¿—" class="headerlink" title="SpringBootä¸æ—¥å¿—"></a>SpringBootä¸æ—¥å¿—</h2><h3 id="æ—¥å¿—é—¨é¢SLF4Jæ—¥å¿—å®ç°Logback"><a href="#æ—¥å¿—é—¨é¢SLF4Jæ—¥å¿—å®ç°Logback" class="headerlink" title="æ—¥å¿—é—¨é¢SLF4Jæ—¥å¿—å®ç°Logback;"></a>æ—¥å¿—é—¨é¢SLF4Jæ—¥å¿—å®ç°Logback;</h3><p>SpringBoot:åº•å±‚æ˜¯Springæ¡†æ¶ï¼ŒSpringæ¡†æ¶é»˜è®¤ç”¨JCL;</p>
<p>SpringBooté€‰ç”¨SLF4J(æ—¥å¿—çš„æŠ½è±¡å±‚)å’Œlogback;</p>
<p>ä»¥åå¼€å‘çš„æ—¶å€™ï¼Œæ—¥å¿—è®°å½•æ–¹æ³•çš„è°ƒç”¨ï¼Œä¸åº”è¯¥æ¥ç›´æ¥è°ƒç”¨æ—¥å¿—çš„å®ç°ç±»ï¼Œè€Œæ˜¯è°ƒç”¨æ—¥å¿—æŠ½è±¡æ›¾é‡Œé¢çš„æ–¹æ³•ã€‚</p>
<p>åº”è¯¥ç»™ç³»ç»Ÿå¯¼å…¥slf4jçš„jarå’Œlogbackçš„å®ç°jar</p>
<pre><code>import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class HelloWorld {
  public static void main(String[] args) {
    Logger logger = LoggerFactory.getLogger(HelloWorld.class);
    logger.info(&quot;Hello World&quot;);
  }
}
</code></pre><p><img src="/2020/05/26/SpringBootç³»åˆ—/æ‰¹æ³¨ 2020-05-24 123704.png" alt=""></p>
<p>æ¯ä¸€ä¸ªæ—¥å¿—çš„å®ç°æ¡†æ¶éƒ½æœ‰è‡ªå·±çš„é…ç½®æ–‡ä»¶ã€‚ä½¿ç”¨slf4jåï¼Œ<em>é…ç½®æ–‡ä»¶è¿˜æ˜¯åšæˆæ—¥å¿—å®ç°æ¡†æ¶è‡ªå·±æœ¬èº«çš„é…ç½®æ–‡ä»¶</em>ï¼›</p>
<h3 id="é—ç•™é—®é¢˜"><a href="#é—ç•™é—®é¢˜" class="headerlink" title="é—ç•™é—®é¢˜"></a>é—ç•™é—®é¢˜</h3><p>ä¸åŒç³»ç»Ÿæœ‰ä¸åŒçš„æ—¥å¿—æ¡†æ¶ï¼Œéœ€è¦åšåˆ°ç»Ÿä¸€æ—¥å¿—è®°å½•ï¼Œå³ä½¿åˆ«çš„æ¡†æ¶å’Œæˆ‘ä¸€èµ·ä½¿ç”¨slf4jè¿›è¡Œè¾“å‡º</p>
<p><img src="/2020/05/26/SpringBootç³»åˆ—/legacy.png" alt=""></p>
<p>å¦‚ä½•è®©ç³»ç»Ÿä¸­æ‰€æœ‰æ—¥å¿—éƒ½ç»Ÿä¸€åˆ°slf4j</p>
<p>å°†ç³»ç»Ÿä¸­å…¶ä»–æ—¥å¿—æ¡†æ¶æ’é™¤ï¼Œç”¨ä¸­é—´åŒ…æ›¿æ¢åŸæœ‰çš„æ—¥å¿—æ¡†æ¶ï¼Œå†å¯¼å…¥slf4då…¶ä»–çš„å®ç°</p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;
    &lt;version&gt;2.3.0.RELEASE&lt;/version&gt;
    &lt;scope&gt;compile&lt;/scope&gt;
&lt;/dependency&gt;
</code></pre><p>SpringBoot ä½¿ç”¨å®ƒæ¥åšæ—¥å¿—</p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt;
    &lt;version&gt;2.3.0.RELEASE&lt;/version&gt;
    &lt;scope&gt;compile&lt;/scope&gt;
&lt;/dependency&gt;

&lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;
      &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;
      &lt;scope&gt;compile&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;
      &lt;artifactId&gt;log4j-to-slf4j&lt;/artifactId&gt;
      &lt;scope&gt;compile&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
      &lt;artifactId&gt;jul-to-slf4j&lt;/artifactId&gt;
      &lt;scope&gt;compile&lt;/scope&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre><p><img src="/2020/05/26/SpringBootç³»åˆ—/æ‰¹æ³¨ 2020-05-24 125540.png" alt=""></p>
<p>æ€»ç»“ï¼š1ã€SpringBootåº•å±‚ä¹Ÿæ˜¯ä½¿ç”¨slf4j+logbackçš„æ–¹å¼è¿›è¡Œæ—¥å¿—è®°å½•</p>
<p>â€‹    2ã€SpringBootä¹ŸæŠŠå…¶ä»–çš„æ—¥å¿—éƒ½æ›¿æ¢æˆäº†slf4j</p>
<p>â€‹    3ã€ä¸­é—´æ›¿æ¢åŒ…</p>
<p>â€‹    4ã€å¦‚æœè¦å¼•å…¥å…¶ä»–æ¡†æ¶ï¼Œä¸€å®šè¦æŠŠè¿™ä¸ªæ¡†æ¶çš„é»˜è®¤æ—¥å¿—ç§»é™¤æ‰</p>
<p>â€‹    Springæ¡†æ¶ç”¨çš„commons-logging;</p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.apache.activemq&lt;/groupId&gt;
    &lt;artifactId&gt;activemq-console&lt;/artifactId&gt;
    &lt;version&gt;${activemq.version}&lt;/version&gt;
        &lt;exclusions&gt;
            &lt;exclusion&gt;
            &lt;groupId&gt;commons-logging&lt;/groupId&gt;
            &lt;artifactId&gt;commons-logging&lt;/artifactId&gt;
            &lt;/exclusion&gt;
        &lt;/exclusions&gt;
&lt;/dependency&gt;
</code></pre><p><em>SpringBootèƒ½è‡ªåŠ¨é€‚é…æ‰€æœ‰çš„æ—¥å¿—ï¼Œè€Œä¸”åº•å±‚ä½¿ç”¨slf4j+logbackçš„æ–¹å¼è®°å½•æ—¥å¿—ï¼Œå¼•å…¥å…¶ä»–æ¡†æ¶çš„æ—¶å€™ï¼Œåªéœ€è¦æŠŠè¿™ä¸ªæ¡†æ¶ä¾èµ–çš„æ—¥å¿—æ¡†æ¶æ’é™¤æ‰ã€‚</em></p>
<pre><code>private static Logger logger = LoggerFactory.getLogger(HelloApplication.class);
public static void main(String[] args) {
    SpringApplication.run(HelloApplication.class, args);
    //æ—¥å¿—çº§åˆ«ç”±ä½åˆ°é«˜
    //å¯ä»¥è°ƒæ•´è¾“å‡ºçš„æ—¥å¿—çº§åˆ«
    logger.trace(&quot;trace&quot;);
    logger.debug(&quot;debug&quot;);
    logger.info(&quot;HelloApplication is Success&quot;);
    logger.warn(&quot;warn&quot;);
    logger.error(&quot;error&quot;);
}

logging.pattern.console=%d{yyyy-MM-dd} [%thread] %-5level %logger{50} - %msg%n

%dè¡¨ç¤ºæ—¥æœŸæ—¶é—´
%threadè¡¨ç¤ºçº¿ç¨‹å
%-5level:çº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦çš„å®½åº¦
%logger{50}è¡¨ç¤ºloggeråå­—æœ€é•¿50ä¸ªå­—ç¬¦ï¼Œå¦åˆ™æŒ‰ç…§å¥ç‚¹åˆ†å‰²
%msg:æ—¥å¿—æ¶ˆæ¯
%næ¢è¡Œç¬¦
</code></pre><p>SpringBootä¿®æ”¹é»˜è®¤æ—¥å¿—é…ç½®</p>
<pre><code>logging.level.com.think=trace
#å½“å‰é¡¹ç›®ä¸‹ç”Ÿæˆspringboot.logæ—¥å¿—ï¼Œå¯ä»¥æŒ‡å®šå®Œæ•´çš„è·¯å¾„D:/springboot.log
#logging.file.name=springboot.log
#åœ¨å½“å‰ç£ç›˜çš„æ ¹è·¯å¾„ä¸‹åˆ›å»ºspringæ–‡ä»¶å¤¹å’Œé‡Œé¢çš„logæ–‡ä»¶å¤¹ï¼›ä½¿ç”¨spring.logåšä¸ºé»˜è®¤æ–‡ä»¶
logging.file.path=/spring/log
#åœ¨æ§åˆ¶å°è¾“å‡ºçš„æ—¥å¿—çš„æ ¼å¼
logging.pattern.console=%d{yyyy-MM-dd} [%thread] %-5level %logger{50} - %msg%n
#æŒ‡å®šæ–‡ä»¶ä¸­æ—¥å¿—çš„è¾“å‡ºæ ¼å¼
logging.pattern.file=%d{yyyy-MM-dd} [%thread] %-5level %logger{50} - %msg%n

&lt;!-- æ—¥å¿—è®°å½•å™¨ï¼Œæ—¥æœŸæ»šåŠ¨è®°å½• --&gt;
&lt;appender name=&quot;FILE_ERROR&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;

&lt;!-- æ­£åœ¨è®°å½•çš„æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„åŠæ–‡ä»¶å --&gt;
&lt;file&gt;${LOG_PATH}/log_error.log&lt;/file&gt;

&lt;!-- æ—¥å¿—è®°å½•å™¨çš„æ»šåŠ¨ç­–ç•¥ï¼ŒæŒ‰æ—¥æœŸï¼ŒæŒ‰å¤§å°è®°å½• --&gt;
&lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;

&lt;!-- å½’æ¡£çš„æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ï¼Œ%d{yyyy-MM-dd}æŒ‡å®šæ—¥æœŸæ ¼å¼ï¼Œ%iæŒ‡å®šç´¢å¼• --&gt;
&lt;fileNamePattern&gt;${LOG_PATH}/error/log-error-%d{yyyy-MM-dd}.%i.log&lt;/fileNamePattern&gt;

&lt;!-- é™¤æŒ‰æ—¥å¿—è®°å½•ä¹‹å¤–ï¼Œè¿˜é…ç½®äº†æ—¥å¿—æ–‡ä»¶ä¸èƒ½è¶…è¿‡2Mï¼Œè‹¥è¶…è¿‡2Mï¼Œæ—¥å¿—æ–‡ä»¶ä¼šä»¥ç´¢å¼•0å¼€å§‹ï¼Œ
å‘½åæ—¥å¿—æ–‡ä»¶ï¼Œä¾‹å¦‚log-error-2013-12-21.0.log --&gt;
&lt;timeBasedFileNamingAndTriggeringPolicy class=&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;&gt;
&lt;maxFileSize&gt;10MB&lt;/maxFileSize&gt;
&lt;/timeBasedFileNamingAndTriggeringPolicy&gt;
&lt;/rollingPolicy&gt;

&lt;!-- è¿½åŠ æ–¹å¼è®°å½•æ—¥å¿— --&gt;
&lt;append&gt;true&lt;/append&gt;

&lt;!-- æ—¥å¿—æ–‡ä»¶çš„æ ¼å¼ --&gt;
&lt;encoder class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt;
&lt;pattern&gt;${FILE_LOG_PATTERN}&lt;/pattern&gt;
&lt;charset&gt;utf-8&lt;/charset&gt;
&lt;/encoder&gt;

&lt;!-- æ­¤æ—¥å¿—æ–‡ä»¶åªè®°å½•errorçº§åˆ«çš„ --&gt;
&lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt;
&lt;level&gt;error&lt;/level&gt;
&lt;onMatch&gt;ACCEPT&lt;/onMatch&gt;
&lt;onMismatch&gt;DENY&lt;/onMismatch&gt;
&lt;/filter&gt;
&lt;/appender&gt;
</code></pre><p>å¯ä»¥æŒ‰ç…§slfjçš„æ—¥å¿—é€‚é…å›¾ï¼Œè¿›è¡Œç›¸å…³çš„åˆ‡æ¢</p>
<p>ideaä¾èµ–åˆ†æ-pom.xml-å³é”®-Diagrams-Show Dependencies</p>
<h2 id="SpringBootä¸Webå¼€å‘"><a href="#SpringBootä¸Webå¼€å‘" class="headerlink" title="SpringBootä¸Webå¼€å‘"></a>SpringBootä¸Webå¼€å‘</h2><h3 id="ä½¿ç”¨SpringBoot"><a href="#ä½¿ç”¨SpringBoot" class="headerlink" title="ä½¿ç”¨SpringBoot"></a>ä½¿ç”¨SpringBoot</h3><h4 id="åˆ›å»ºSpringBootåº”ç”¨ï¼Œé€‰ä¸­æˆ‘ä»¬éœ€è¦çš„æ¨¡å—ï¼›"><a href="#åˆ›å»ºSpringBootåº”ç”¨ï¼Œé€‰ä¸­æˆ‘ä»¬éœ€è¦çš„æ¨¡å—ï¼›" class="headerlink" title="åˆ›å»ºSpringBootåº”ç”¨ï¼Œé€‰ä¸­æˆ‘ä»¬éœ€è¦çš„æ¨¡å—ï¼›"></a>åˆ›å»ºSpringBootåº”ç”¨ï¼Œé€‰ä¸­æˆ‘ä»¬éœ€è¦çš„æ¨¡å—ï¼›</h4><h4 id="SpringBootå·²ç»é»˜è®¤å°†è¿™äº›åœºæ™¯é…ç½®å¥½äº†ï¼Œåªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šå°‘é‡é…ç½®å°±å¯ä»¥è¿è¡Œèµ·æ¥ï¼›"><a href="#SpringBootå·²ç»é»˜è®¤å°†è¿™äº›åœºæ™¯é…ç½®å¥½äº†ï¼Œåªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šå°‘é‡é…ç½®å°±å¯ä»¥è¿è¡Œèµ·æ¥ï¼›" class="headerlink" title="SpringBootå·²ç»é»˜è®¤å°†è¿™äº›åœºæ™¯é…ç½®å¥½äº†ï¼Œåªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šå°‘é‡é…ç½®å°±å¯ä»¥è¿è¡Œèµ·æ¥ï¼›"></a>SpringBootå·²ç»é»˜è®¤å°†è¿™äº›åœºæ™¯é…ç½®å¥½äº†ï¼Œåªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šå°‘é‡é…ç½®å°±å¯ä»¥è¿è¡Œèµ·æ¥ï¼›</h4><h4 id="è‡ªå·±ç¼–å†™ä¸šåŠ¡é€»è¾‘ä»£ç ï¼›"><a href="#è‡ªå·±ç¼–å†™ä¸šåŠ¡é€»è¾‘ä»£ç ï¼›" class="headerlink" title="è‡ªå·±ç¼–å†™ä¸šåŠ¡é€»è¾‘ä»£ç ï¼›"></a>è‡ªå·±ç¼–å†™ä¸šåŠ¡é€»è¾‘ä»£ç ï¼›</h4><h4 id="è‡ªåŠ¨é…ç½®åŸç†-1"><a href="#è‡ªåŠ¨é…ç½®åŸç†-1" class="headerlink" title="è‡ªåŠ¨é…ç½®åŸç†"></a>è‡ªåŠ¨é…ç½®åŸç†</h4><p>è¿™ä¸ªåœºæ™¯SpringBootå¸®æˆ‘ä»¬é…ç½®äº†ä»€ä¹ˆï¼Œèƒ½ä¸èƒ½ä¿®æ”¹ï¼Œèƒ½ä¿®æ”¹å“ªäº›é…ç½®ï¼Œèƒ½ä¸èƒ½æ‰©å±•</p>
<p>xxxAutoConfiguration:å¸®æˆ‘ä»¬ç»™å®¹å™¨ä¸­è‡ªåŠ¨é…ç½®ç»„ä»¶</p>
<p>xxxPropertiesï¼šé…ç½®ç±»æ¥å°è£…é…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹</p>
<h4 id="SpringBootå¯¹é™æ€èµ„æºçš„æ˜ å°„è§„åˆ™"><a href="#SpringBootå¯¹é™æ€èµ„æºçš„æ˜ å°„è§„åˆ™" class="headerlink" title="SpringBootå¯¹é™æ€èµ„æºçš„æ˜ å°„è§„åˆ™"></a>SpringBootå¯¹é™æ€èµ„æºçš„æ˜ å°„è§„åˆ™</h4><p>ResourcePropertieså¯ä»¥è®¾ç½®é™æ€èµ„æºæœ‰å…³çš„å‚æ•°ï¼Œç¼“å­˜æ—¶é—´ç­‰</p>
<pre><code>@ConfigurationProperties(prefix = &quot;spring.resources&quot;, ignoreUnknownFields = false)
public class ResourceProperties {

    private static final String[] CLASSPATH_RESOURCE_LOCATIONS = { &quot;classpath:/META-INF/resources/&quot;,
            &quot;classpath:/resources/&quot;, &quot;classpath:/static/&quot;, &quot;classpath:/public/&quot; };

    /**
     * Locations of static resources. Defaults to classpath:[/META-INF/resources/,
     * /resources/, /static/, /public/].

@Override
public void addResourceHandlers(ResourceHandlerRegistry registry) {
    if (!this.resourceProperties.isAddMappings()) {
        logger.debug(&quot;Default resource handling disabled&quot;);
        return;
    }
    Duration cachePeriod = this.resourceProperties.getCache().getPeriod();
    CacheControl cacheControl = this.resourceProperties.getCache().getCachecontrol().toHttpCacheControl();
    if (!registry.hasMappingForPattern(&quot;/webjars/**&quot;)) {
        customizeResourceHandlerRegistration(registry.addResourceHandler(&quot;/webjars/**&quot;)
        .addResourceLocations(&quot;classpath:/META-INF/resources/webjars/&quot;)
        .setCachePeriod(getSeconds(cachePeriod)).setCacheControl(cacheControl));
    }
    String staticPathPattern = this.mvcProperties.getStaticPathPattern();
    if (!registry.hasMappingForPattern(staticPathPattern)) {
    customizeResourceHandlerRegistration(registry.addResourceHandler(staticPathPattern)
    .addResourceLocations(getResourceLocations(this.resourceProperties.getStaticLocations()))
    .setCachePeriod(getSeconds(cachePeriod)).setCacheControl(cacheControl));
    }
}
</code></pre><p>æ‰€æœ‰/webjars/**éƒ½å»classpath:/META-INF/resources/webjars/æ‰¾èµ„æº</p>
<p>webjars:ä»¥jaråŒ…çš„æ–¹å¼å¼•å…¥é™æ€èµ„æºï¼›</p>
<p><a href="https://www.webjars.org/" target="_blank" rel="noopener">https://www.webjars.org/</a></p>
<p><img src="/2020/05/26/SpringBootç³»åˆ—/æ‰¹æ³¨ 2020-05-24 160548.png" alt=""></p>
<p><a href="http://localhost:8080/webjars/jquery/3.5.1/jquery.js" target="_blank" rel="noopener">http://localhost:8080/webjars/jquery/3.5.1/jquery.js</a></p>
<pre><code>&lt;!--å¼•å…¥jquery-webjar--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.webjars&lt;/groupId&gt;
    &lt;artifactId&gt;jquery&lt;/artifactId&gt;
    &lt;version&gt;3.5.1&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><p>/**è®¿é—®å½“å‰é¡¹ç›®çš„ä»»ä½•èµ„æºï¼ˆé™æ€èµ„æºæ–‡ä»¶å¤¹ï¼‰</p>
<pre><code>&quot;/&quot;ï¼šå½“å‰é¡¹ç›®çš„æ ¹è·¯å¾„
&quot;classpath:/META-INF/resources/&quot;,
&quot;classpath:/resources/&quot;, 
&quot;classpath:/static/&quot;, 
&quot;classpath:/public/
</code></pre><h4 id="ä»¥ä»€ä¹ˆæ ·çš„è·¯å¾„è®¿é—®é™æ€èµ„æº"><a href="#ä»¥ä»€ä¹ˆæ ·çš„è·¯å¾„è®¿é—®é™æ€èµ„æº" class="headerlink" title="ä»¥ä»€ä¹ˆæ ·çš„è·¯å¾„è®¿é—®é™æ€èµ„æº"></a>ä»¥ä»€ä¹ˆæ ·çš„è·¯å¾„è®¿é—®é™æ€èµ„æº</h4><p>spring.mvc.static-path-pattern=/static/**<br>Spring Boot 2.3è¦åœ¨é…ç½®æ–‡ä»¶é…ç½®é™æ€èµ„æºè®¿é—®è·¯å¾„</p>
<p>æ¬¢è¿é¡µï¼Œé™æ€èµ„æºæ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰çš„index.htmlé¡µé¢ï¼›è¢«â€/**â€œæ˜ å°„</p>
<p>æ‰€æœ‰çš„**/favicon.icoéƒ½æ˜¯åœ¨é™æ€èµ„æºæ–‡ä»¶ä¸‹æ‰¾</p>
<h4 id="æ¨¡æ¿å¼•æ“"><a href="#æ¨¡æ¿å¼•æ“" class="headerlink" title="æ¨¡æ¿å¼•æ“"></a>æ¨¡æ¿å¼•æ“</h4><p>Thymeleaf</p>
<p>è¯­æ³•æ›´ç®€å•ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§</p>
<h4 id="å¼•å…¥Thymeleaf"><a href="#å¼•å…¥Thymeleaf" class="headerlink" title="å¼•å…¥Thymeleaf"></a>å¼•å…¥Thymeleaf</h4><pre><code>&lt;!--æ¨¡æ¿å¼•æ“--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;
&lt;/dependency&gt;

@ConfigurationProperties(prefix = &quot;spring.thymeleaf&quot;)
public class ThymeleafProperties {

    private static final Charset DEFAULT_ENCODING = StandardCharsets.UTF_8;
    //åªè¦æˆ‘ä»¬æŠŠhtmlé¡µé¢æ”¾åœ¨classpath:/templates/ï¼Œthymeleafå°±èƒ½è‡ªåŠ¨æ¸²æŸ“
    public static final String DEFAULT_PREFIX = &quot;classpath:/templates/&quot;;

    public static final String DEFAULT_SUFFIX = &quot;.html&quot;;

    /**
     * Whether to check that the template exists before rendering it.
     */
    private boolean checkTemplate = true;

å¯¼å…¥thymeleafçš„åç§°ç©ºé—´
&lt;html xmlns:th=&quot;http://www.thymeleaf.org&quot;&gt;
</code></pre><h4 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h4><p>å‚è€ƒthymeleafæ‰‹å†Œ</p>
<h3 id="SpringMVCè‡ªåŠ¨é…ç½®"><a href="#SpringMVCè‡ªåŠ¨é…ç½®" class="headerlink" title="SpringMVCè‡ªåŠ¨é…ç½®"></a>SpringMVCè‡ªåŠ¨é…ç½®</h3><h4 id="Spring-Bootè‡ªåŠ¨é…ç½®å¥½äº†SpringMVC"><a href="#Spring-Bootè‡ªåŠ¨é…ç½®å¥½äº†SpringMVC" class="headerlink" title="Spring Bootè‡ªåŠ¨é…ç½®å¥½äº†SpringMVC"></a>Spring Bootè‡ªåŠ¨é…ç½®å¥½äº†SpringMVC</h4><p>ä»¥ä¸‹æ˜¯SpringBootå¯¹SpringMVCçš„é»˜è®¤</p>
<p>The auto-configuration adds the following features on top of Springâ€™s defaults:</p>
<ul>
<li><p>Inclusion of <code>ContentNegotiatingViewResolver</code> and <code>BeanNameViewResolver</code> beans.</p>
<ul>
<li>è‡ªåŠ¨é…ç½®äº†ViewResolverï¼ˆè§†å›¾è§£æå™¨ï¼šæ ¹æ®æ–¹æ³•çš„è¿”å›å€¼å¾—åˆ°è§†å›¾å¯¹è±¡ï¼ˆViewï¼‰è§†å›¾å¯¹è±¡å†³å®šå¦‚ä½•æ¸²æŸ“ï¼Œæ˜¯è½¬å‘è¿˜æ˜¯é‡å®šå‘ï¼‰</li>
<li>ContentNegotiatingViewResolverç¬¦åˆæ‰€æœ‰çš„è§†å›¾è§£æå™¨çš„</li>
<li>å¦‚ä½•å®šåˆ¶ï¼šæˆ‘ä»¬å¯ä»¥ç»™å®¹å™¨ä¸­æ·»åŠ ä¸€ä¸ªè§†å›¾è§£æå™¨@Beanï¼›è‡ªåŠ¨å°†å…¶ç»„åˆè¿›æ¥</li>
<li>å¦‚ä½•éªŒè¯æ˜¯å¦æ·»åŠ è¿›æ¥äº†-æœç´¢DispatcherServlet-doDispatch-åœ¨è¿™æ‰“æ–­ç‚¹ï¼Œç”¨debugæ–¹å¼è¿è¡Œ</li>
<li>éšä¾¿è¯·æ±‚ä¸€ä¸ªé¡µé¢å¯ä»¥çœ‹åˆ°DispatcherServletçš„viewResolversé‡Œé¢å·²ç»åŒ…å«äº†æˆ‘ä»¬è‡ªå®šä¹‰çš„è§†å›¾è§£æå™¨</li>
</ul>
</li>
<li><p>Support for serving static resources, including support for WebJars (covered <a href="https://docs.spring.io/spring-boot/docs/2.3.0.RELEASE/reference/htmlsingle/#boot-features-spring-mvc-static-content" target="_blank" rel="noopener">later in this document</a>)).é™æ€èµ„æºæ–‡ä»¶å¤¹è·¯å¾„ï¼Œwebjars</p>
</li>
<li><p>Automatic registration of <code>Converter</code>, <code>GenericConverter</code>, and <code>Formatter</code> beans.</p>
<ul>
<li>Converter:è½¬æ¢å™¨ ç±»å‹è½¬æ¢ä½¿ç”¨</li>
<li>Formatter:æ ¼å¼åŒ–å™¨æ—¥æœŸçš„è½¬æ¢</li>
</ul>
</li>
<li><p>Support for <code>HttpMessageConverters</code> (covered <a href="https://docs.spring.io/spring-boot/docs/2.3.0.RELEASE/reference/htmlsingle/#boot-features-spring-mvc-message-converters" target="_blank" rel="noopener">later in this document</a>).</p>
<ul>
<li>HttpMessageConverters:SpringMVCç”¨æ¥è½¬æ¢Httpè¯·æ±‚å’Œå“åº”çš„ï¼›Userâ€“Json</li>
</ul>
</li>
<li><p>Automatic registration of <code>MessageCodesResolver</code> (covered <a href="https://docs.spring.io/spring-boot/docs/2.3.0.RELEASE/reference/htmlsingle/#boot-features-spring-message-codes" target="_blank" rel="noopener">later in this document</a>).</p>
<ul>
<li>å®šä¹‰é”™è¯¯ä»£ç ç”Ÿæˆè§„åˆ™çš„</li>
</ul>
</li>
<li><p>Static <code>index.html</code> support.(é™æ€é¦–é¡µè®¿é—®)</p>
</li>
<li><p>Custom <code>Favicon</code> support (covered <a href="https://docs.spring.io/spring-boot/docs/2.3.0.RELEASE/reference/htmlsingle/#boot-features-spring-mvc-favicon" target="_blank" rel="noopener">later in this document</a>).ï¼ˆfavicon.icoï¼‰</p>
</li>
<li><p>Automatic use of a <code>ConfigurableWebBindingInitializer</code> bean (covered <a href="https://docs.spring.io/spring-boot/docs/2.3.0.RELEASE/reference/htmlsingle/#boot-features-spring-mvc-web-binding-initializer" target="_blank" rel="noopener">later in this document</a>).</p>
<ul>
<li><p>æˆ‘ä»¬å¯ä»¥é…ç½®ä¸€ä¸ªConfigurableWebBindingInitializeræ¥æ›¿æ¢é»˜è®¤çš„</p>
<p> åˆå§‹åŒ–WebDataBinder;<br>è¯·æ±‚æ•°æ®===JavaBean</p>
</li>
</ul>
</li>
</ul>
<p>If you want to keep those Spring Boot MVC customizations and make more <a href="https://docs.spring.io/spring/docs/5.2.6.RELEASE/spring-framework-reference/web.html#mvc" target="_blank" rel="noopener">MVC customizations</a> (interceptors, formatters, view controllers, and other features), you can add your own <code>@Configuration</code> class of type <code>WebMvcConfigurer</code> but <strong>without</strong> <code>@EnableWebMvc</code>.</p>
<h4 id="ä½¿ç”¨WebMvcConfigurerAdapteræ‰©å±•SpringMVCçš„åŠŸèƒ½"><a href="#ä½¿ç”¨WebMvcConfigurerAdapteræ‰©å±•SpringMVCçš„åŠŸèƒ½" class="headerlink" title="ä½¿ç”¨WebMvcConfigurerAdapteræ‰©å±•SpringMVCçš„åŠŸèƒ½"></a>ä½¿ç”¨WebMvcConfigurerAdapteræ‰©å±•SpringMVCçš„åŠŸèƒ½</h4><p>ç¼–å†™ä¸€ä¸ªé…ç½®ç±»ï¼ˆ@Configurationï¼‰,æ˜¯WebMvcConfigurerAdapterç±»å‹ï¼›ä¸èƒ½æ ‡æ³¨@EnableWebMvcã€‚</p>
<p>æ—¢ä¿ç•™äº†æ‰€æœ‰çš„è‡ªåŠ¨é…ç½®ï¼Œä¹Ÿèƒ½ç”¨æˆ‘ä»¬æ‰©å±•çš„é…ç½®</p>
<pre><code>//ä½œç”¨ï¼šè¯·æ±‚meçš„æ—¶å€™ä¼šåˆ°successé¡µé¢
@Configuration
public class MyConfig extends WebMvcConfigurerAdapter{

    @Override
    public void addViewControllers(ViewControllerRegistry registry) {
        registry.addViewController(&quot;/me&quot;).setViewName(&quot;success&quot;);
    }
}
</code></pre><p>åŸç†ï¼š</p>
<ol>
<li><p>WebMvcAutoConfiguration æ˜¯SpringMVCçš„è‡ªåŠ¨é…ç½®ç±»</p>
</li>
<li><p>åœ¨åšå…¶ä»–è‡ªåŠ¨é…ç½®æ—¶ä¼šå¯¼å…¥@Import(EnableWebMvcConfiguration.class)</p>
<pre><code>@Configuration(proxyBeanMethods = false)
public static class EnableWebMvcConfiguration extends DelegatingWebMvcConfiguration implements ResourceLoaderAware {

private final WebMvcConfigurerComposite configurers = new WebMvcConfigurerComposite();

//ä»å®¹å™¨ä¸­è·å–æ‰€æœ‰WebMvcConfigurerçš„é…ç½®
@Autowired(required = false)
public void setConfigurers(List&lt;WebMvcConfigurer&gt; configurers) {
    if (!CollectionUtils.isEmpty(configurers)) {
    this.configurers.addWebMvcConfigurers(configurers);
        //ä¸€ä¸ªå‚è€ƒå®ç°ï¼Œå°†æ‰€æœ‰çš„WebMvcConfigurerç›¸å…³é…ç½®éƒ½æ¥ä¸€èµ·è°ƒç”¨
        @Override
        public void addViewControllers(ViewControllerRegistry registry) {
            for (WebMvcConfigurer delegate : this.delegates) {
                delegate.addViewControllers(registry);
            }
        }
    }
}
</code></pre></li>
<li><p>å®¹å™¨ä¸­æ‰€æœ‰çš„WebMvcConfigureréƒ½ä¼šä¸€èµ·èµ·ä½œç”¨ï¼ŒåŒ…æ‹¬è‡ªå·±å†™çš„é…ç½®ç±»</p>
</li>
</ol>
<h4 id="å…¨é¢æ¥ç®¡SpringMVC"><a href="#å…¨é¢æ¥ç®¡SpringMVC" class="headerlink" title="å…¨é¢æ¥ç®¡SpringMVC"></a>å…¨é¢æ¥ç®¡SpringMVC</h4><p>SpringBootå¯¹SpringMVCçš„è‡ªåŠ¨é…ç½®ä¸éœ€è¦ï¼Œæ‰€æœ‰éƒ½æ˜¯æˆ‘ä»¬è‡ªå·±é…ï¼Œåªéœ€è¦åœ¨é…ç½®ç±»ä¸­æ·»åŠ @EnableWebMvc</p>
<pre><code>åŸç†ï¼š

@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.TYPE)
@Documented
@Import(DelegatingWebMvcConfiguration.class)
public @interface EnableWebMvc {//è¿™ä¸ªæ³¨è§£ä¸Šå¯¼å…¥äº†DelegatingWebMvcConfiguration
}

@Configuration(proxyBeanMethods = false)
public class DelegatingWebMvcConfiguration extends WebMvcConfigurationSupport {//DelegatingWebMvcConfiguration.classåˆç»§æ‰¿äº†WebMvcConfigurationSupport

@Configuration(proxyBeanMethods = false)
@ConditionalOnWebApplication(type = Type.SERVLET)
@ConditionalOnClass({ Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class })
//å®¹å™¨ç§æ²¡æœ‰ï¼ˆWebMvcConfigurationSupportï¼‰è¿™ä¸ªç»„ä»¶çš„æ—¶å€™ï¼Œè¿™ä¸ªè‡ªåŠ¨é…ç½®ç±»æ‰ç”Ÿæ•ˆ
@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)
@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10)
@AutoConfigureAfter({ DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class,
        ValidationAutoConfiguration.class })
public class WebMvcAutoConfiguration {

@EnableWebMvcå°†WebMvcConfigurationSupportç»„ä»¶å¯¼å…¥è¿›æ¥ï¼›
å¯¼å…¥çš„WebMvcConfigurationSupportåªæ˜¯SpringMVCæœ€åŸºæœ¬çš„åŠŸèƒ½ï¼›
</code></pre><h4 id="å¦‚ä½•ä¿®æ”¹SpringBootçš„é»˜è®¤é…ç½®"><a href="#å¦‚ä½•ä¿®æ”¹SpringBootçš„é»˜è®¤é…ç½®" class="headerlink" title="å¦‚ä½•ä¿®æ”¹SpringBootçš„é»˜è®¤é…ç½®"></a>å¦‚ä½•ä¿®æ”¹SpringBootçš„é»˜è®¤é…ç½®</h4><ol>
<li>SpringBootåœ¨è‡ªåŠ¨é…ç½®å¾ˆå¤šç»„ä»¶çš„æ—¶å€™ï¼Œå…ˆçœ‹å®¹å™¨ä¸­æœ‰æ²¡æœ‰ç”¨æˆ·è‡ªå·±é…ç½®çš„ï¼ˆ@Bean,@Componentï¼‰å¦‚æœæœ‰å°±ç”¨ç”¨æˆ·é…ç½®çš„ï¼Œå¦‚æœæ²¡æœ‰æ‰è‡ªåŠ¨é…ç½®ï¼›å¦‚æœæœ‰äº›ç»„ä»¶å¯ä»¥æœ‰å¤šä¸ªï¼Œä»–æ˜¯å°†ç”¨æˆ·é…ç½®çš„å’Œè‡ªå·±é»˜è®¤çš„ç»„åˆèµ·æ¥</li>
<li>åœ¨SpringBootç§ä¼šæœ‰éå¸¸å¤šçš„xxxConfigurerå¸®åŠ©æˆ‘ä»¬è¿›è¡Œæ‰©å±•é…ç½®</li>
</ol>
<h4 id="ç™»é™†é¡µé¢"><a href="#ç™»é™†é¡µé¢" class="headerlink" title="ç™»é™†é¡µé¢"></a>ç™»é™†é¡µé¢</h4><pre><code> //æ‰€æœ‰çš„WebMvcConfigurerAdapterç»„ä»¶éƒ½ä¼šä¸€èµ·èµ·ä½œç”¨
@Bean//å°†ç»„ä»¶æ³¨å†Œåˆ°å®¹å™¨ä¸­
public WebMvcConfigurerAdapter webMvcConfigurerAdapter(){
    WebMvcConfigurerAdapter adapter = new WebMvcConfigurerAdapter() {
        @Override
        public void addViewControllers(ViewControllerRegistry registry) {
            registry.addViewController(&quot;/&quot;).setViewName(&quot;login&quot;);
            registry.addViewController(&quot;/login.html&quot;).setViewName(&quot;login&quot;);
        }
    };
    return adapter;
}
</code></pre><h4 id="å›½é™…åŒ–"><a href="#å›½é™…åŒ–" class="headerlink" title="å›½é™…åŒ–"></a>å›½é™…åŒ–</h4><ol>
<li>ç¼–å†™å›½é™…åŒ–æ–‡ä»¶ï¼ŒæŠ½å–é¡µé¢éœ€è¦æ˜¾ç¤ºçš„å›½é™…åŒ–æ¶ˆæ¯</li>
</ol>
<p><img src="/2020/05/26/SpringBootç³»åˆ—/æ‰¹æ³¨ 2020-05-30 103915.png" alt=""></p>
<ol start="2">
<li><p>SpringBootè‡ªåŠ¨é…ç½®å¥½äº†ç®¡ç†å›½é™…åŒ–èµ„æºæ–‡ä»¶çš„ç»„ä»¶</p>
<p> @Configuration(proxyBeanMethods = false)<br>@ConditionalOnMissingBean(name = AbstractApplicationContext.MESSAGE_SOURCE_BEAN_NAME, search = SearchStrategy.CURRENT)<br>@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE)<br>@Conditional(ResourceBundleCondition.class)<br>@EnableConfigurationProperties<br>public class MessageSourceAutoConfiguration {</p>
<p> private static final Resource[] NO_RESOURCES = {};</p>
<p> @Bean<br> @ConfigurationProperties(prefix = â€œspring.messagesâ€)<br> public MessageSourceProperties messageSourceProperties() {</p>
<pre><code>return new MessageSourceProperties();
</code></pre><p> }</p>
<p> @Bean<br> public MessageSource messageSource(MessageSourceProperties properties) {</p>
<pre><code>ResourceBundleMessageSource messageSource = new ResourceBundleMessageSource();
if (StringUtils.hasText(properties.getBasename())) {
    //è®¾ç½®å›½é™…åŒ–èµ„æºæ–‡ä»¶çš„åŸºç¡€å
    messageSource.setBasenames(StringUtils
            .commaDelimitedListToStringArray(StringUtils.trimAllWhitespace(properties.getBasename())));
}
if (properties.getEncoding() != null) {
    messageSource.setDefaultEncoding(properties.getEncoding().name());
}
messageSource.setFallbackToSystemLocale(properties.isFallbackToSystemLocale());
Duration cacheDuration = properties.getCacheDuration();
if (cacheDuration != null) {
    messageSource.setCacheMillis(cacheDuration.toMillis());
}
messageSource.setAlwaysUseMessageFormat(properties.isAlwaysUseMessageFormat());
messageSource.setUseCodeAsDefaultMessage(properties.isUseCodeAsDefaultMessage());
return messageSource;
</code></pre><p> }</p>
</li>
<li><p>å»é¡µé¢è·å–å›½é™…åŒ–çš„å€¼</p>
</li>
</ol>
<p>idea  file-setting-FileEncodings-fileEncodeingå°†propertiesç¼–ç æ”¹æˆUTF-8ï¼Œè®©ä»–è‡ªåŠ¨è½¬æˆasciiç ï¼ˆåªå¯¹å½“å‰é¡¹ç›®ç”Ÿæ•ˆï¼‰<br>è¦æ”¹é»˜è®¤çš„åœ¨file-Other Setting-DefaultSettingæ¥ä¿®æ”¹å…¨å±€é»˜è®¤è®¾ç½®</p>
<p><img src="/2020/05/26/SpringBootç³»åˆ—/æ‰¹æ³¨ 2020-05-30 114127.png" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/23/mongo/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Airthink">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Airthink">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/23/mongo/" itemprop="url">mongo</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2020-05-23T08:51:04+08:00">
                2020-05-23
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/mongo/" itemprop="url" rel="index">
                    <span itemprop="name">mongo</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ä»€ä¹ˆæ˜¯MongoDB"><a href="#ä»€ä¹ˆæ˜¯MongoDB" class="headerlink" title="ä»€ä¹ˆæ˜¯MongoDB ?"></a>ä»€ä¹ˆæ˜¯MongoDB ?</h1><p>MongoDB æ˜¯ç”±C++è¯­è¨€ç¼–å†™çš„ï¼Œæ˜¯ä¸€ä¸ªåŸºäºåˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨çš„å¼€æºæ•°æ®åº“ç³»ç»Ÿã€‚<br>åœ¨é«˜è´Ÿè½½çš„æƒ…å†µä¸‹ï¼Œæ·»åŠ æ›´å¤šçš„èŠ‚ç‚¹ï¼Œå¯ä»¥ä¿è¯æœåŠ¡å™¨æ€§èƒ½ã€‚<br>MongoDB æ—¨åœ¨ä¸ºWEBåº”ç”¨æä¾›å¯æ‰©å±•çš„é«˜æ€§èƒ½æ•°æ®å­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚<br>MongoDB å°†æ•°æ®å­˜å‚¨ä¸ºä¸€ä¸ªæ–‡æ¡£ï¼Œæ•°æ®ç»“æ„ç”±é”®å€¼(key=&gt;value)å¯¹ç»„æˆã€‚MongoDB æ–‡æ¡£ç±»ä¼¼äº JSON å¯¹è±¡ã€‚å­—æ®µå€¼å¯ä»¥åŒ…å«å…¶ä»–æ–‡æ¡£ï¼Œæ•°ç»„åŠæ–‡æ¡£æ•°ç»„ã€‚</p>
<p>NoSQLï¼ŒæŒ‡çš„æ˜¯éå…³ç³»å‹çš„æ•°æ®åº“ã€‚NoSQLæœ‰æ—¶ä¹Ÿç§°ä½œNot Only SQLçš„ç¼©å†™ï¼Œæ˜¯å¯¹ä¸åŒäºä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“çš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„ç»Ÿç§°ã€‚<br>NoSQLç”¨äºè¶…å¤§è§„æ¨¡æ•°æ®çš„å­˜å‚¨ã€‚ï¼ˆä¾‹å¦‚è°·æ­Œæˆ–Facebookæ¯å¤©ä¸ºä»–ä»¬çš„ç”¨æˆ·æ”¶é›†ä¸‡äº¿æ¯”ç‰¹çš„æ•°æ®ï¼‰ã€‚è¿™äº›ç±»å‹çš„æ•°æ®å­˜å‚¨ä¸éœ€è¦å›ºå®šçš„æ¨¡å¼ï¼Œæ— éœ€å¤šä½™æ“ä½œå°±å¯ä»¥æ¨ªå‘æ‰©å±•ã€‚</p>
<h1 id="ä¸»è¦ç‰¹ç‚¹"><a href="#ä¸»è¦ç‰¹ç‚¹" class="headerlink" title="ä¸»è¦ç‰¹ç‚¹"></a>ä¸»è¦ç‰¹ç‚¹</h1><ul>
<li><p>MongoDB æ˜¯ä¸€ä¸ªé¢å‘æ–‡æ¡£å­˜å‚¨çš„æ•°æ®åº“ï¼Œæ“ä½œèµ·æ¥æ¯”è¾ƒç®€å•å’Œå®¹æ˜“ã€‚</p>
</li>
<li><p>ä½ å¯ä»¥åœ¨MongoDBè®°å½•ä¸­è®¾ç½®ä»»ä½•å±æ€§çš„ç´¢å¼• (å¦‚ï¼šFirstName=â€Sameerâ€,Address=â€8 Gandhi Roadâ€)æ¥å®ç°æ›´å¿«çš„æ’åºã€‚</p>
</li>
<li><p>ä½ å¯ä»¥é€šè¿‡æœ¬åœ°æˆ–è€…ç½‘ç»œåˆ›å»ºæ•°æ®é•œåƒï¼Œè¿™ä½¿å¾—MongoDBæœ‰æ›´å¼ºçš„æ‰©å±•æ€§ã€‚</p>
</li>
<li><p>å¦‚æœè´Ÿè½½çš„å¢åŠ ï¼ˆéœ€è¦æ›´å¤šçš„å­˜å‚¨ç©ºé—´å’Œæ›´å¼ºçš„å¤„ç†èƒ½åŠ›ï¼‰ ï¼Œå®ƒå¯ä»¥åˆ†å¸ƒåœ¨è®¡ç®—æœºç½‘ç»œä¸­çš„å…¶ä»–èŠ‚ç‚¹ä¸Šè¿™å°±æ˜¯æ‰€è°“çš„åˆ†ç‰‡ã€‚</p>
</li>
<li><p>Mongoæ”¯æŒä¸°å¯Œçš„æŸ¥è¯¢è¡¨è¾¾å¼ã€‚æŸ¥è¯¢æŒ‡ä»¤ä½¿ç”¨JSONå½¢å¼çš„æ ‡è®°ï¼Œå¯è½»æ˜“æŸ¥è¯¢æ–‡æ¡£ä¸­å†…åµŒçš„å¯¹è±¡åŠæ•°ç»„ã€‚</p>
</li>
<li><p>MongoDb ä½¿ç”¨update()å‘½ä»¤å¯ä»¥å®ç°æ›¿æ¢å®Œæˆçš„æ–‡æ¡£ï¼ˆæ•°æ®ï¼‰æˆ–è€…ä¸€äº›æŒ‡å®šçš„æ•°æ®å­—æ®µ ã€‚</p>
</li>
<li><p>Mongodbä¸­çš„Map/reduceä¸»è¦æ˜¯ç”¨æ¥å¯¹æ•°æ®è¿›è¡Œæ‰¹é‡å¤„ç†å’Œèšåˆæ“ä½œã€‚</p>
</li>
<li><p>Mapå’ŒReduceã€‚Mapå‡½æ•°è°ƒç”¨emit(key,value)éå†é›†åˆä¸­æ‰€æœ‰çš„è®°å½•ï¼Œå°†keyä¸valueä¼ ç»™Reduceå‡½æ•°è¿›è¡Œå¤„ç†ã€‚</p>
</li>
<li><p>Mapå‡½æ•°å’ŒReduceå‡½æ•°æ˜¯ä½¿ç”¨Javascriptç¼–å†™çš„ï¼Œå¹¶å¯ä»¥é€šè¿‡db.runCommandæˆ–mapreduceå‘½ä»¤æ¥æ‰§è¡ŒMapReduceæ“ä½œã€‚</p>
</li>
<li><p>GridFSæ˜¯MongoDBä¸­çš„ä¸€ä¸ªå†…ç½®åŠŸèƒ½ï¼Œå¯ä»¥ç”¨äºå­˜æ”¾å¤§é‡å°æ–‡ä»¶ã€‚</p>
</li>
<li><p>MongoDBå…è®¸åœ¨æœåŠ¡ç«¯æ‰§è¡Œè„šæœ¬ï¼Œå¯ä»¥ç”¨Javascriptç¼–å†™æŸä¸ªå‡½æ•°ï¼Œç›´æ¥åœ¨æœåŠ¡ç«¯æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥æŠŠå‡½æ•°çš„å®šä¹‰å­˜å‚¨åœ¨æœåŠ¡ç«¯ï¼Œä¸‹æ¬¡ç›´æ¥è°ƒç”¨å³å¯ã€‚</p>
</li>
<li><p>MongoDBæ”¯æŒå„ç§ç¼–ç¨‹è¯­è¨€:RUBYï¼ŒPYTHONï¼ŒJAVAï¼ŒC++ï¼ŒPHPï¼ŒC#ç­‰å¤šç§è¯­è¨€ã€‚</p>
</li>
<li><p>MongoDBå®‰è£…ç®€å•ã€‚</p>
<h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1></li>
</ul>
<ol>
<li><p>ä¸‹è½½mongodb-linux-x86_64-3.6.3.tar.gz</p>
</li>
<li><p>è§£å‹tar -zxvf mongodb-linux-x86_64-3.0.6.tgz</p>
</li>
<li><p>åœ¨ä¸binåŒçº§çš„ç›®å½•ä¸‹å»ºç«‹dataæ–‡ä»¶å¤¹</p>
</li>
<li><p>mongo.configæ–‡ä»¶å†…å®¹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">port=27017</span><br><span class="line">logpath=/airthink/mongodb-linux-x86_64-3.6.3/mongod.log</span><br><span class="line">pidfilepath=/airthink/mongodb-linux-x86_64-3.6.3/mongod.pid</span><br><span class="line">logappend=true</span><br><span class="line">fork=true</span><br><span class="line">maxConns=3000</span><br><span class="line">dbpath=/airthink/mongodb-linux-x86_64-3.6.3/data</span><br><span class="line">auth=true</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¯åŠ¨./mongodb-linux-x86_64-3.6.3/bin/mongo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var schema = db.system.version.findOne(&#123;_id:&quot;authSchema&quot;&#125;);//é©±åŠ¨ç‰ˆæœ¬5--SCRAM-SHA-1éœ€è¦ä¿®æ”¹æˆï¼š3--Mongodb-CR</span><br><span class="line">schema. currentVersion = 3;</span><br><span class="line">db.system.version.save(schema);</span><br><span class="line"></span><br><span class="line">db.createUser(&#123;user:&quot;admin&quot;,pwd:&quot;mypass&quot;,roles:[&quot;readWriteAnyDatabase&quot;, &quot;userAdminAnyDatabase&quot;, &quot;dbAdminAnyDatabase&quot;]&#125;);</span><br><span class="line"></span><br><span class="line">windowsä¸‹çš„å¯åŠ¨å‘½ä»¤åˆ°binç›®å½•ä¸‹  start mongod</span><br></pre></td></tr></table></figure>
<h1 id="MongoDBç”¨æˆ·è§’è‰²é…ç½®"><a href="#MongoDBç”¨æˆ·è§’è‰²é…ç½®" class="headerlink" title="MongoDBç”¨æˆ·è§’è‰²é…ç½®"></a>MongoDBç”¨æˆ·è§’è‰²é…ç½®</h1></li>
</ol>
<h2 id="åŸºæœ¬çŸ¥è¯†ä»‹ç»"><a href="#åŸºæœ¬çŸ¥è¯†ä»‹ç»" class="headerlink" title="åŸºæœ¬çŸ¥è¯†ä»‹ç»"></a>åŸºæœ¬çŸ¥è¯†ä»‹ç»</h2><p>MongoDBåŸºæœ¬çš„è§’è‰²</p>
<ol>
<li>æ•°æ®åº“ç”¨æˆ·è§’è‰²ï¼šreadã€readWrite;</li>
<li>æ•°æ®åº“ç®¡ç†è§’è‰²ï¼šdbAdminã€dbOwnerã€userAdminï¼›</li>
<li>é›†ç¾¤ç®¡ç†è§’è‰²ï¼šclusterAdminã€clusterManagerã€clusterMonitorã€hostManagerï¼›</li>
<li>å¤‡ä»½æ¢å¤è§’è‰²ï¼šbackupã€restoreï¼›</li>
<li>æ‰€æœ‰æ•°æ®åº“è§’è‰²ï¼šreadAnyDatabaseã€readWriteAnyDatabaseã€userAdminAnyDatabaseã€dbAdminAnyDatabase</li>
<li>è¶…çº§ç”¨æˆ·è§’è‰²ï¼šroot (è¿™é‡Œè¿˜æœ‰å‡ ä¸ªè§’è‰²é—´æ¥æˆ–ç›´æ¥æä¾›äº†ç³»ç»Ÿè¶…çº§ç”¨æˆ·çš„è®¿é—®ï¼ˆdbOwner ã€userAdminã€userAdminAnyDatabase,å…¶ä¸­MongoDBé»˜è®¤æ˜¯æ²¡æœ‰å¼€å¯ç”¨æˆ·è®¤è¯çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ¸¸å®¢ä¹Ÿæ‹¥æœ‰è¶…çº§ç®¡ç†å‘˜çš„æƒé™ã€‚userAdminAnyDatabaseï¼šæœ‰åˆ†é…è§’è‰²å’Œç”¨æˆ·çš„æƒé™ï¼Œä½†æ²¡æœ‰æŸ¥å†™çš„æƒé™)</li>
</ol>
<h2 id="è¿æ¥åˆ°MongoDBæœåŠ¡å™¨"><a href="#è¿æ¥åˆ°MongoDBæœåŠ¡å™¨" class="headerlink" title="è¿æ¥åˆ°MongoDBæœåŠ¡å™¨"></a>è¿æ¥åˆ°MongoDBæœåŠ¡å™¨</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">å»ºåº“æ“ä½œå¼€å§‹</span><br><span class="line"></span><br><span class="line">./mongodb-linux-x86_64-3.6.3/bin/mongo   è¿›å…¥mongo shell</span><br><span class="line"></span><br><span class="line">use admin(ä½¿ç”¨)</span><br><span class="line"></span><br><span class="line">db.createUser(&#123;user:&quot;root&quot;,pwd:&quot;password&quot;,roles:[&quot;root&quot;]&#125;)//åˆ›å»ºrootç”¨æˆ·</span><br><span class="line"></span><br><span class="line">db.createUser(&#123;user:&quot;admin&quot;,pwd:&quot;admin&quot;,roles:[&#123;role:&quot;userAdminAnyDatabase&quot;,db:&quot;admin&quot;&#125;]&#125;)ï¼ˆåˆ›å»ºadminç”¨æˆ·ï¼‰</span><br><span class="line"></span><br><span class="line">db.auth(&apos;admin&apos;, &apos;admin&apos;);ï¼ˆæˆæƒï¼‰</span><br><span class="line"></span><br><span class="line">ä¿®æ”¹mongod.confæ–‡ä»¶</span><br><span class="line"></span><br><span class="line">security:</span><br><span class="line">authorization: enabled//å¯ç”¨æˆæƒ</span><br><span class="line"></span><br><span class="line">é‡å¯MongoDBæœåŠ¡å™¨</span><br><span class="line"></span><br><span class="line">service mongod restart</span><br><span class="line"></span><br><span class="line">åˆ›å»ºæ•°æ®åº“è¯»å†™æƒé™ç”¨æˆ·</span><br><span class="line"></span><br><span class="line">use admin</span><br><span class="line">db.auth(&quot;admin&quot;,&quot;password&quot;);</span><br><span class="line">use ballmatch</span><br><span class="line">db.createUser(&#123;</span><br><span class="line">    user: &quot;baidu&quot;,</span><br><span class="line">    pwd: &quot;password&quot;,</span><br><span class="line">    roles: [&#123;role: &quot;readWrite&quot;,db: &quot;baidu&quot;&#125;]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="Javaç¨‹åºè¿æ¥MongoDB"><a href="#Javaç¨‹åºè¿æ¥MongoDB" class="headerlink" title="Javaç¨‹åºè¿æ¥MongoDB"></a>Javaç¨‹åºè¿æ¥MongoDB</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">MongoCredential credential = MongoCredential.createCredential(&quot;username&quot;, &quot;dbName&quot;, &quot;password&quot;.toCharArray());</span><br><span class="line">ServerAddress serverAddress = new ServerAddress(&quot;192.168.10.242&quot;, 27017);</span><br><span class="line">MongoClient mongoClient = new MongoClient(serverAddress, Arrays.asList(credential));</span><br><span class="line">DB db = mongoClient.getDB(&quot;dbName&quot;);</span><br><span class="line">returndb;</span><br><span class="line"></span><br><span class="line">//æ–¹å¼äºŒ</span><br><span class="line">String sURI = String.format(&quot;mongodb://%s:%s@%s:%d/%s&quot;, &quot;username&quot;, &quot;password&quot;, &quot;192.168.10.242&quot;, 27017, &quot;dbName&quot;); </span><br><span class="line">MongoClientURI uri = new MongoClientURI(sURI); </span><br><span class="line">MongoClient mongoClient = new MongoClient(uri); </span><br><span class="line">DB db = mongoClient.getDB(&quot;dbName&quot;);</span><br></pre></td></tr></table></figure>
<h2 id="å‘½ä»¤ä»‹ç»"><a href="#å‘½ä»¤ä»‹ç»" class="headerlink" title="å‘½ä»¤ä»‹ç»"></a>å‘½ä»¤ä»‹ç»</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ä¿®æ”¹ç”¨æˆ·å¯†ç </span><br><span class="line">db.updateUser( &quot;admin&quot;,&#123;pwd:&quot;password&quot;&#125;);</span><br><span class="line"></span><br><span class="line">å¯†ç è®¤è¯</span><br><span class="line">db.auth(&quot;admin&quot;,&quot;password&quot;);</span><br><span class="line"></span><br><span class="line">MongoDBè¿æ¥ä¿¡æ¯æŸ¥è¯¢</span><br><span class="line">db.serverStatus().connections;</span><br><span class="line"></span><br><span class="line">å…³é—­MongoDBæœåŠ¡</span><br><span class="line">use admin;</span><br><span class="line">db.shutdownServer();</span><br><span class="line"></span><br><span class="line">åˆ é™¤ç”¨æˆ·</span><br><span class="line">åˆ é™¤ç”¨æˆ·(éœ€è¦rootæƒé™ï¼Œä¼šå°†æ‰€æœ‰æ•°æ®åº“ä¸­çš„footballç”¨æˆ·åˆ é™¤)</span><br><span class="line">db.system.users.remove(&#123;user:&quot;baidu&quot;&#125;);</span><br><span class="line"></span><br><span class="line">åˆ é™¤ç”¨æˆ·(æƒé™è¦æ±‚æ²¡æœ‰é‚£ä¹ˆé«˜ï¼Œåªåˆ é™¤æœ¬æ•°æ®ä¸­çš„footballç”¨æˆ·)</span><br><span class="line">db.dropUser(&quot;baidu&quot;);</span><br></pre></td></tr></table></figure>
<h1 id="mongoTemplateä½¿ç”¨ç¤ºä¾‹"><a href="#mongoTemplateä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="mongoTemplateä½¿ç”¨ç¤ºä¾‹"></a>mongoTemplateä½¿ç”¨ç¤ºä¾‹</h1><h2 id="å¯¹åŒ¹é…åˆ°çš„æ•°æ®è¿›è¡Œæ›´æ–°-inc"><a href="#å¯¹åŒ¹é…åˆ°çš„æ•°æ®è¿›è¡Œæ›´æ–°-inc" class="headerlink" title="å¯¹åŒ¹é…åˆ°çš„æ•°æ®è¿›è¡Œæ›´æ–°(inc)"></a>å¯¹åŒ¹é…åˆ°çš„æ•°æ®è¿›è¡Œæ›´æ–°(inc)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Query query = new Query();</span><br><span class="line">query.addCriteria(Criteria.where(&quot;accountName&quot;).is(username));</span><br><span class="line">if (null != password)&#123;</span><br><span class="line">        query.addCriteria(Criteria.where(&quot;accountPwd&quot;).is(password));</span><br><span class="line">&#125;</span><br><span class="line">Account account = this.mongoTemplate.findOne(query, Account.class);</span><br><span class="line">if (account != null) &#123;</span><br><span class="line">    Update update = new Update();</span><br><span class="line">    update.inc(&quot;loginTimes&quot;, 1);</span><br><span class="line">    this.mongoTemplate.updateFirst(query, update, Account.class);//æŸ¥æ‰¾å¹¶æ›´æ–°</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mongoTemplate.updateFirst(Query.query(Criteria.where(&quot;_id&quot;).is(favor.getTypeId())),new Update().inc(&quot;favorTimes&quot;, 1), News.class);</span><br><span class="line"></span><br><span class="line">mongoTemplate.updateFirst(Query.query(Criteria.where(&quot;_id&quot;).is(favor.getTypeId())),new Update().inc(&quot;favorTimes&quot;, -1), News.class);</span><br></pre></td></tr></table></figure>
<h2 id="æŸ¥è¯¢ä¸€æ¡è®°å½•å’Œä¿å­˜ï¼ˆfindOne-saveï¼‰"><a href="#æŸ¥è¯¢ä¸€æ¡è®°å½•å’Œä¿å­˜ï¼ˆfindOne-saveï¼‰" class="headerlink" title="æŸ¥è¯¢ä¸€æ¡è®°å½•å’Œä¿å­˜ï¼ˆfindOne/saveï¼‰"></a>æŸ¥è¯¢ä¸€æ¡è®°å½•å’Œä¿å­˜ï¼ˆfindOne/saveï¼‰</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Account account = mongoTemplate.findOne(Query.query(Criteria.where(&quot;accountName&quot;).is(accountName)),Account.class);</span><br><span class="line"></span><br><span class="line">account.setAccountPwd(passwd);</span><br><span class="line"></span><br><span class="line">mongoTemplate.save(account);</span><br></pre></td></tr></table></figure>
<h2 id="å¤šæ¡ä»¶åŒ¹é…ï¼ˆå¹¶çš„å…³ç³»ï¼‰"><a href="#å¤šæ¡ä»¶åŒ¹é…ï¼ˆå¹¶çš„å…³ç³»ï¼‰" class="headerlink" title="å¤šæ¡ä»¶åŒ¹é…ï¼ˆå¹¶çš„å…³ç³»ï¼‰"></a>å¤šæ¡ä»¶åŒ¹é…ï¼ˆå¹¶çš„å…³ç³»ï¼‰</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Criteria criteria = new Criteria();</span><br><span class="line">criteria.andOperator(Criteria.where(&quot;phone&quot;).is(phone), Criteria.where(&quot;status&quot;).is(0));</span><br><span class="line">List&lt;VerifyCode&gt; codes = mongoTemplate.find(Query.query(criteria), VerifyCode.class);</span><br><span class="line"></span><br><span class="line">Criteria criteria = new Criteria();</span><br><span class="line">criteria.andOperator(Criteria.where(&quot;entityID&quot;).is(entityID), Criteria.where(&quot;accountType&quot;).is(accountType), Criteria.where(&quot;weUnionId&quot;).ne(&quot;&quot;).ne(null));</span><br><span class="line">Account Account = mongoTemplate.findOne(Query.query(criteria), Account.class);</span><br><span class="line"></span><br><span class="line">Boolean isFavor = mongoTemplate.exists(Query.query(Criteria.where(&quot;typeId&quot;).is(favor.getTypeId()).and(&quot;type&quot;).is(favor.getType()).and(&quot;userId&quot;).is(favor.getUserId())), Favor.class);</span><br></pre></td></tr></table></figure>
<h2 id="å¤šæ¡ä»¶åŒ¹é…ï¼ˆæˆ–çš„å…³ç³»ï¼‰"><a href="#å¤šæ¡ä»¶åŒ¹é…ï¼ˆæˆ–çš„å…³ç³»ï¼‰" class="headerlink" title="å¤šæ¡ä»¶åŒ¹é…ï¼ˆæˆ–çš„å…³ç³»ï¼‰"></a>å¤šæ¡ä»¶åŒ¹é…ï¼ˆæˆ–çš„å…³ç³»ï¼‰</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Criteria criteria = new Criteria();</span><br><span class="line">criteria.orOperator(Criteria.where(&quot;status&quot;).is(1), Criteria.where(&quot;status&quot;).is(0));</span><br><span class="line">List&lt;VerifyCode&gt; codes = mongoTemplate.find(Query.query(criteria), VerifyCode.class);</span><br></pre></td></tr></table></figure>
<h2 id="æ ¹æ®idæŸ¥æ‰¾å¹¶åˆ é™¤"><a href="#æ ¹æ®idæŸ¥æ‰¾å¹¶åˆ é™¤" class="headerlink" title="æ ¹æ®idæŸ¥æ‰¾å¹¶åˆ é™¤"></a>æ ¹æ®idæŸ¥æ‰¾å¹¶åˆ é™¤</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Account account = mongoTemplate.findById(id, Account.class); </span><br><span class="line">mongoTemplate.remove(account);</span><br></pre></td></tr></table></figure>
<h2 id="è®¡æ•°"><a href="#è®¡æ•°" class="headerlink" title="è®¡æ•°"></a>è®¡æ•°</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">long count = mongoTemplate.count(Query.query(Criteria.where(&quot;accountName&quot;).is(accountName)), Account.class);</span><br></pre></td></tr></table></figure>
<h2 id="æ¨¡ç³ŠåŒ¹é…å¹¶æ’åº"><a href="#æ¨¡ç³ŠåŒ¹é…å¹¶æ’åº" class="headerlink" title="æ¨¡ç³ŠåŒ¹é…å¹¶æ’åº"></a>æ¨¡ç³ŠåŒ¹é…å¹¶æ’åº</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Criteria criteria = new Criteria();</span><br><span class="line">criteria.andOperator(Criteria.where(&quot;province&quot;).regex(province));//æ­£åˆ™</span><br><span class="line">mongoTemplate.find(Query.query(criteria).with(new Sort(Direction.ASC, &quot;order&quot;)), Bbatch.class);</span><br></pre></td></tr></table></figure>
<h2 id="distinctæŸ¥è¯¢"><a href="#distinctæŸ¥è¯¢" class="headerlink" title="distinctæŸ¥è¯¢"></a>distinctæŸ¥è¯¢</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> DBObject dbObject = new BasicDBObject(&quot;schoolId&quot;, bschool.get_id());</span><br><span class="line">List&lt;String&gt; provinces = mongoTemplate.getCollection(</span><br><span class="line">mongoTemplate.getCollectionName(BschoolScoreline.class)) .distinct(&quot;province&quot;, dbObject);</span><br><span class="line">bschool.setProvinces(provinces);</span><br></pre></td></tr></table></figure>
<h2 id="æŸ¥æ‰¾å¹¶æ‰€æœ‰æ’åº"><a href="#æŸ¥æ‰¾å¹¶æ‰€æœ‰æ’åº" class="headerlink" title="æŸ¥æ‰¾å¹¶æ‰€æœ‰æ’åº"></a>æŸ¥æ‰¾å¹¶æ‰€æœ‰æ’åº</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongoTemplate.find(new Query().with(new Sort(Direction.ASC, &quot;order&quot;,&quot;createTime&quot;)), Bschool.class);</span><br></pre></td></tr></table></figure>
<h2 id="inæŸ¥è¯¢"><a href="#inæŸ¥è¯¢" class="headerlink" title="inæŸ¥è¯¢"></a>inæŸ¥è¯¢</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;MpropValue&gt; mpropValueList = mongoTemplate.find(Query.query(Criteria.where(&quot;propId&quot;).in(mprop1.get_id())), MpropValue.class);</span><br></pre></td></tr></table></figure>
<h2 id="è®¾ç½®å”¯ä¸€å­—æ®µ"><a href="#è®¾ç½®å”¯ä¸€å­—æ®µ" class="headerlink" title="è®¾ç½®å”¯ä¸€å­—æ®µ"></a>è®¾ç½®å”¯ä¸€å­—æ®µ</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//used æ˜¯1 å°†å…¶ä»–æ‰€æœ‰æ˜¯1çš„æ›´æ–°ä¸º0</span><br><span class="line">    if(address.getUsed()==1)&#123;</span><br><span class="line">    Query q = new Query(Criteria.where(&quot;userId&quot;).is(user.get_id()));//æŸ¥è¯¢</span><br><span class="line">    Update u = new Update().set(&quot;used&quot;,0);</span><br><span class="line">    BulkOperations ops = mongoTemplate.bulkOps(BulkOperations.BulkMode.UNORDERED, &quot;address&quot;);</span><br><span class="line">    ops.updateMulti(q,u);//å…¨éƒ¨æ›´æ–°</span><br><span class="line">    ops.execute();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ’å…¥å¤šæ¡æ•°æ®"><a href="#æ’å…¥å¤šæ¡æ•°æ®" class="headerlink" title="æ’å…¥å¤šæ¡æ•°æ®"></a>æ’å…¥å¤šæ¡æ•°æ®</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public ReturnStatus upsert(List&lt;BspecialLink&gt; specialLinks) &#123;</span><br><span class="line">    ReturnStatus status;</span><br><span class="line">    mongoTemplate.insertAll(specialLinks);</span><br><span class="line">    status = new ReturnStatus(true);</span><br><span class="line">    return status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="è·å–æ•°æ®åº“æ‰€æœ‰é›†åˆåç§°"><a href="#è·å–æ•°æ®åº“æ‰€æœ‰é›†åˆåç§°" class="headerlink" title="è·å–æ•°æ®åº“æ‰€æœ‰é›†åˆåç§°"></a>è·å–æ•°æ®åº“æ‰€æœ‰é›†åˆåç§°</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;String&gt; sets = mongoTemplage.getDb().getCollectionNames();</span><br></pre></td></tr></table></figure>
<h2 id="æŸ¥è¯¢å½“å¤©æ•°æ®"><a href="#æŸ¥è¯¢å½“å¤©æ•°æ®" class="headerlink" title="æŸ¥è¯¢å½“å¤©æ•°æ®"></a>æŸ¥è¯¢å½“å¤©æ•°æ®</h2><pre><code>private static Date getStartTime() {
    Calendar todayStart = Calendar.getInstance();
    todayStart.set(Calendar.HOUR_OF_DAY, 0);
    todayStart.set(Calendar.MINUTE, 0);
    todayStart.set(Calendar.SECOND, 0);
    todayStart.set(Calendar.MILLISECOND, 0);
    return todayStart.getTime();
}

private static Date getEndTime() {
    Calendar todayEnd = Calendar.getInstance();
    todayEnd.set(Calendar.HOUR_OF_DAY, 23);
    todayEnd.set(Calendar.MINUTE, 59);
    todayEnd.set(Calendar.SECOND, 59);
    todayEnd.set(Calendar.MILLISECOND, 999);
    return todayEnd.getTime();
}

Criteria criteria = new Criteria();
criteria.andOperator(
        Criteria.where(&quot;type&quot;).is(type),
        Criteria.where(&quot;typeId&quot;).is(typeId),
        Criteria.where(&quot;userId&quot;).is(user.get_id()),
        Criteria.where(&quot;createTime&quot;).gte(getStartTime())
                .lte(getEndTime()));
return mongoTemplate.exists(Query.query(criteria), Zan.class);
</code></pre><h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><ol>
<li><p>åˆ é™¤å­—æ®µ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.yourcollection.update(&#123;&#125;,&#123;$unset:&#123;&quot;éœ€è¦åˆ é™¤çš„å­—æ®µ&quot;:&quot;&quot;&#125;&#125;,false,true)</span><br></pre></td></tr></table></figure>
</li>
<li><p>å°†åŒ¹é…åˆ°çš„å€¼å…¨éƒ¨æ›´æ–°</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.getCollection(&quot;bschool&quot;).update(&#123;&quot;state&quot;:0&#125;,&#123;$set:&#123;&quot;state&quot;:&quot;1&quot;&#125;&#125;,&#123;&apos;multi&apos;:true&#125;)</span><br></pre></td></tr></table></figure>
<p>db.getCollection(â€œpdfChapterItemâ€).update({}, {$rename : {â€œremarkâ€ : â€œabbrâ€}}, false, true)//æ›´æ–°æ‰€æœ‰å­—æ®µå</p>
</li>
<li><p>å»ºç«‹ç´¢å¼•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.bschoolScorelineDetail.ensureIndex(&#123;&quot;schoolId&quot;:1,&quot;type&quot;:1,&quot;batch&quot;:1,&quot;province&quot;:1&#125;,&#123;&quot;name&quot;ï¼š&quot;schoolScorelineDetail&quot;&#125;)</span><br></pre></td></tr></table></figure>
<p>mongoä¸­å»ºç«‹ç´¢å¼•ç”¨ensureIndex({â€œå­—æ®µ1â€:1,â€å­—æ®µ2â€:â€-1â€},{â€œnameâ€:â€ç´¢å¼•åâ€}) 1å’Œ-1ä»£è¡¨æ­£åºå’Œå€’åº</p>
</li>
<li><p>mongoæ•°æ®åº“å¤‡ä»½æ“ä½œ(åœ¨mongoçš„å®‰è£…ç›®å½•çš„binä¸‹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ä¸å¸¦éªŒè¯çš„æ•°æ®åº“å¤‡ä»½ï¼š</span><br><span class="line"></span><br><span class="line">mongodump -d mrmf -o /tools/test   mrmfæ•°æ®åº“å   /tools/testè¦å¤‡ä»½åˆ°çš„åœ°æ–¹</span><br><span class="line"></span><br><span class="line">ä¸å¸¦éªŒè¯çš„æ•°æ®åº“æ¢å¤</span><br><span class="line"></span><br><span class="line">mongorestore --db mrmf /tools/test/mrmf   mrmfæ•°æ®åº“å   /tools/testè¦æ¢å¤çš„æ•°æ®</span><br><span class="line"></span><br><span class="line">å¸¦éªŒè¯çš„æ•°æ®åº“å¤‡ä»½ï¼š</span><br><span class="line"></span><br><span class="line">mongodump -d mrmf -u admin -p &quot;ie8*kskIkd123&quot; --authenticationDatabase=admin -o /tools/test  </span><br><span class="line"></span><br><span class="line">å¸¦éªŒè¯çš„æ•°æ®åº“æ¢å¤ï¼š</span><br><span class="line"></span><br><span class="line">mongorestore --db mrmf -u admin -p &quot;ie8*kskIkd123&quot; --authenticationDatabase=admin /tools/test/red</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¼€å¯æ…¢æ—¥å¿—</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">åœ¨å®¢æˆ·ç«¯è°ƒç”¨db.setProfilingLevel(çº§åˆ«) å‘½ä»¤æ¥å®æ—¶é…ç½®ã€‚å¯ä»¥é€šè¿‡db.getProfilingLevel()å‘½ä»¤æ¥è·å–å½“å‰çš„Profileçº§åˆ«ã€‚</span><br><span class="line"></span><br><span class="line">&gt; db.setProfilingLevel(2); </span><br><span class="line">&gt; &#123;&quot;was&quot; : 0 , &quot;ok&quot; : 1&#125; </span><br><span class="line">&gt; db.getProfilingLevel()</span><br><span class="line">ä¸Šé¢æ–œä½“çš„çº§åˆ«å¯ä»¥å–0ï¼Œ1ï¼Œ2 ä¸‰ä¸ªå€¼ï¼Œä»–ä»¬è¡¨ç¤ºçš„æ„ä¹‰å¦‚ä¸‹ï¼š</span><br><span class="line">0 â€“ ä¸å¼€å¯</span><br><span class="line">1 â€“ è®°å½•æ…¢å‘½ä»¤ (é»˜è®¤ä¸º&gt;100ms)</span><br><span class="line">2 â€“ è®°å½•æ‰€æœ‰å‘½ä»¤</span><br><span class="line">Profile è®°å½•åœ¨çº§åˆ«1æ—¶ä¼šè®°å½•æ…¢å‘½ä»¤ï¼Œé‚£ä¹ˆè¿™ä¸ªæ…¢çš„å®šä¹‰æ˜¯ä»€ä¹ˆ?ä¸Šé¢æˆ‘ä»¬è¯´åˆ°å…¶é»˜è®¤ä¸º100msï¼Œå½“ç„¶æœ‰é»˜è®¤å°±æœ‰è®¾ç½®ï¼Œå…¶è®¾ç½®æ–¹æ³•å’Œçº§åˆ«ä¸€æ ·æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯é€šè¿‡æ·»åŠ â€“slowmså¯åŠ¨å‚æ•°é…ç½®ã€‚ç¬¬äºŒç§æ˜¯è°ƒç”¨db.setProfilingLevelæ—¶åŠ ä¸Šç¬¬äºŒä¸ªå‚æ•°ï¼š</span><br><span class="line">db.setProfilingLevel( level , slowms ) </span><br><span class="line">db.setProfilingLevel( 1 , 10 );</span><br><span class="line">Mongo Profile è®°å½•æ˜¯ç›´æ¥å­˜åœ¨ç³»ç»Ÿdbé‡Œçš„ï¼Œè®°å½•ä½ç½® system.profile ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åªè¦æŸ¥è¯¢è¿™ä¸ªCollectionçš„è®°å½•å°±å¯ä»¥è·å–åˆ°æˆ‘ä»¬çš„ Profile è®°å½•äº†ã€‚</span><br><span class="line"></span><br><span class="line">Profile ä¿¡æ¯å†…å®¹è¯¦è§£ï¼š</span><br><span class="line"></span><br><span class="line">ts-è¯¥å‘½ä»¤åœ¨ä½•æ—¶æ‰§è¡Œ.</span><br><span class="line"></span><br><span class="line">millis Time-è¯¥å‘½ä»¤æ‰§è¡Œè€—æ—¶ï¼Œä»¥æ¯«ç§’è®°.</span><br><span class="line"></span><br><span class="line">info-æœ¬å‘½ä»¤çš„è¯¦ç»†ä¿¡æ¯.</span><br><span class="line"></span><br><span class="line">query-è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªqueryæŸ¥è¯¢æ“ä½œ.</span><br><span class="line"></span><br><span class="line">ntoreturn-æœ¬æ¬¡æŸ¥è¯¢å®¢æˆ·ç«¯è¦æ±‚è¿”å›çš„è®°å½•æ•°.æ¯”å¦‚, findOne()å‘½ä»¤æ‰§è¡Œæ—¶ ntoreturn ä¸º 1.æœ‰limit(n) æ¡ä»¶æ—¶ntoreturnä¸ºn.</span><br><span class="line"></span><br><span class="line">query-å…·ä½“çš„æŸ¥è¯¢æ¡ä»¶(å¦‚x&gt;3).</span><br><span class="line"></span><br><span class="line">nscanned-æœ¬æ¬¡æŸ¥è¯¢æ‰«æçš„è®°å½•æ•°.</span><br><span class="line"></span><br><span class="line">reslen-è¿”å›ç»“æœé›†çš„å¤§å°.</span><br><span class="line"></span><br><span class="line">nreturned-æœ¬æ¬¡æŸ¥è¯¢å®é™…è¿”å›çš„ç»“æœé›†.</span><br><span class="line"></span><br><span class="line">update-è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªupdateæ›´æ–°æ“ä½œ.</span><br><span class="line"></span><br><span class="line">upsert-è¡¨æ˜updateçš„upsertå‚æ•°ä¸ºtrue.æ­¤å‚æ•°çš„åŠŸèƒ½æ˜¯å¦‚æœupdateçš„è®°å½•ä¸å­˜åœ¨ï¼Œåˆ™ç”¨updateçš„æ¡ä»¶insertä¸€æ¡è®°å½•.</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>ã€€ã€€moved-è¡¨æ˜æœ¬æ¬¡updateæ˜¯å¦ç§»åŠ¨äº†ç¡¬ç›˜ä¸Šçš„æ•°æ®ï¼Œå¦‚æœæ–°è®°å½•æ¯”åŸè®°å½•çŸ­ï¼Œé€šå¸¸ä¸ä¼šç§»åŠ¨å½“å‰è®°å½•ï¼Œå¦‚æœæ–°è®°å½•æ¯”åŸè®°å½•é•¿ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šç§»åŠ¨è®°å½•åˆ°å…¶å®ƒä½ç½®ï¼Œè¿™æ—¶å€™ä¼šå¯¼è‡´ç›¸å…³ç´¢å¼•çš„æ›´æ–°.ç£ç›˜æ“ä½œæ›´å¤šï¼ŒåŠ ä¸Šç´¢å¼•æ›´æ–°ï¼Œä¼šä½¿å¾—è¿™æ ·çš„æ“ä½œæ¯”è¾ƒæ…¢.</p>
<p>ã€€ã€€insert-è¿™æ˜¯ä¸€ä¸ªinsertæ’å…¥æ“ä½œ.</p>
<p>ã€€ã€€getmore-è¿™æ˜¯ä¸€ä¸ªgetmore æ“ä½œï¼Œgetmoreé€šå¸¸å‘ç”Ÿåœ¨ç»“æœé›†æ¯”è¾ƒå¤§çš„æŸ¥è¯¢æ—¶ï¼Œç¬¬ä¸€ä¸ªqueryè¿”å›äº†éƒ¨åˆ†ç»“æœï¼Œåç»­çš„ç»“æœæ˜¯é€šè¿‡getmoreæ¥è·å–çš„ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">#ä¸‹é¢æ˜¯ä¸€ä¸ªè¶…è¿‡200msçš„æŸ¥è¯¢è¯­å¥</span><br><span class="line">&#123; </span><br><span class="line">&quot;op&quot; : &quot;query&quot;,                     #æ“ä½œç±»å‹ï¼Œæœ‰insertã€queryã€updateã€removeã€getmoreã€command  </span><br><span class="line">&quot;ns&quot; : &quot;F10data3.f10_2_8_3_jgcc&quot;, </span><br><span class="line">&quot;query&quot; : &#123;                         #å…·ä½“çš„æŸ¥è¯¢è¯­å¥ åŒ…æ‹¬è¿‡æ»¤æ¡ä»¶ï¼Œlimitè¡Œæ•°  æ’åºå­—æ®µ</span><br><span class="line">    filter&quot; : &#123;</span><br><span class="line">        &quot;jzrq&quot; : &#123;</span><br><span class="line">            &quot;$gte&quot; : ISODate(&quot;2017-03-31T16:00:00.000+0000&quot;), </span><br><span class="line">            &quot;$lte&quot; : ISODate(&quot;2017-06-30T15:59:59.000+0000&quot;)</span><br><span class="line">        &#125;, </span><br><span class="line">        &quot;jglxfldm&quot; : 10.0</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;ntoreturn&quot; : 200.0,    </span><br><span class="line">    &quot;sort&quot; : &#123;                      #å¦‚æœæœ‰æ’åº  åˆ™æ˜¾ç¤ºæ’åºçš„å­—æ®µ è¿™é‡Œæ˜¯ RsId</span><br><span class="line">        &quot;RsId&quot; : 1.0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, </span><br><span class="line">&quot;keysExamined&quot; : 0.0,               #ç´¢å¼•æ‰«ææ•°é‡ è¿™é‡Œæ˜¯å…¨è¡¨æ‰«æï¼Œæ²¡æœ‰ç”¨ç´¢å¼• æ‰€ä»¥æ˜¯ 0</span><br><span class="line">&quot;docsExamined&quot; : 69608.0,           #æµè§ˆçš„æ–‡æ¡£æ•° è¿™é‡Œæ˜¯å…¨è¡¨æ‰«æ æ‰€ä»¥æ˜¯æ•´ä¸ªcollectionä¸­çš„å…¨éƒ¨æ–‡æ¡£æ•°</span><br><span class="line">&quot;numYield&quot; : 546.0,                 #è¯¥æ“ä½œä¸ºäº†ä½¿å…¶ä»–æ“ä½œå®Œæˆè€Œæ”¾å¼ƒçš„æ¬¡æ•°ã€‚é€šå¸¸æ¥è¯´ï¼Œå½“ä»–ä»¬éœ€è¦è®¿é—®</span><br><span class="line">                                    è¿˜æ²¡æœ‰å®Œå…¨è¯»å…¥å†…å­˜ä¸­çš„æ•°æ®æ—¶ï¼Œæ“ä½œå°†æ”¾å¼ƒã€‚è¿™ä½¿å¾—åœ¨MongoDBä¸ºäº†</span><br><span class="line">                                    æ”¾å¼ƒæ“ä½œè¿›è¡Œæ•°æ®è¯»å–çš„åŒæ—¶ï¼Œè¿˜æœ‰æ•°æ®åœ¨å†…å­˜ä¸­çš„å…¶ä»–æ“ä½œå¯ä»¥å®Œæˆã€‚</span><br><span class="line">&quot;locks&quot; : &#123;                         #é”ä¿¡æ¯ï¼ŒRï¼šå…¨å±€è¯»é”ï¼›Wï¼šå…¨å±€å†™é”ï¼›rï¼šç‰¹å®šæ•°æ®åº“çš„è¯»é”ï¼›wï¼šç‰¹å®šæ•°æ®åº“çš„å†™é”</span><br><span class="line">    &quot;Global&quot; : &#123;</span><br><span class="line">        &quot;acquireCount&quot; : &#123;</span><br><span class="line">            &quot;r&quot; : NumberLong(1094)  #è¯¥æ“ä½œè·å–ä¸€ä¸ªå…¨å±€çº§é”èŠ±è´¹çš„æ—¶é—´ã€‚</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;Database&quot; : &#123;</span><br><span class="line">        &quot;acquireCount&quot; : &#123;</span><br><span class="line">            &quot;r&quot; : NumberLong(547)  </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;Collection&quot; : &#123;</span><br><span class="line">        &quot;acquireCount&quot; : &#123;</span><br><span class="line">            &quot;r&quot; : NumberLong(547)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, </span><br><span class="line">&quot;nreturned&quot; : 200.0,                #è¿”å›çš„æ–‡æ¡£æ•°é‡</span><br><span class="line">&quot;responseLength&quot; : 57695.0,         #è¿”å›å­—èŠ‚é•¿åº¦ï¼Œå¦‚æœè¿™ä¸ªæ•°å­—å¾ˆå¤§ï¼Œè€ƒè™‘å€¼è¿”å›æ‰€éœ€å­—æ®µ</span><br><span class="line">&quot;millis&quot; : 264.0,                   #æ¶ˆè€—çš„æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span><br><span class="line">&quot;planSummary&quot; : &quot;COLLSCAN, COLLSCAN&quot;, #æ‰§è¡Œæ¦‚è§ˆ ä»è¿™é‡Œçœ‹æ¥ æ˜¯å…¨è¡¨æ‰«æ </span><br><span class="line">&quot;execStats&quot; : &#123;                       #è¯¦ç»†çš„æ‰§è¡Œè®¡åˆ’ è¿™é‡Œå…ˆç•¥è¿‡ åç»­å¯ä»¥ç”¨ explainæ¥å…·ä½“åˆ†æ</span><br><span class="line">&#125;, </span><br><span class="line">&quot;ts&quot; : ISODate(&quot;2017-08-24T02:32:49.768+0000&quot;),  #å‘½ä»¤æ‰§è¡Œçš„æ—¶é—´</span><br><span class="line">&quot;client&quot; : &quot;10.3.131.96&quot;,                        #è®¿é—®çš„ipæˆ–è€…ä¸»æœº</span><br><span class="line">&quot;allUsers&quot; : [</span><br><span class="line">], </span><br><span class="line">&quot;user&quot; : &quot;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>MongoDB æŸ¥è¯¢ä¼˜åŒ–</p>
<ol>
<li>ã€€å¦‚æœå‘ç° millis å€¼æ¯”è¾ƒå¤§ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½œä¼˜åŒ–ã€‚</li>
<li>ã€€å¦‚æœdocsExaminedæ•°å¾ˆå¤§ï¼Œæˆ–è€…æ¥è¿‘è®°å½•æ€»æ•°ï¼ˆæ–‡æ¡£æ•°ï¼‰ï¼Œé‚£ä¹ˆå¯èƒ½æ²¡æœ‰ç”¨åˆ°ç´¢å¼•æŸ¥è¯¢ï¼Œè€Œæ˜¯å…¨è¡¨æ‰«æã€‚</li>
<li>ã€€å¦‚æœkeysExaminedæ•°ä¸º0ï¼Œä¹Ÿå¯èƒ½æ˜¯æ²¡ç”¨ç´¢å¼•ã€‚</li>
<li>ã€€ç»“åˆ planSummary ä¸­çš„æ˜¾ç¤ºï¼Œä¸Šä¾‹ä¸­æ˜¯ â€œCOLLSCAN, COLLSCANâ€ ç¡®è®¤æ˜¯å…¨è¡¨æ‰«æ</li>
<li>ã€€å¦‚æœ keysExamined å€¼é«˜äº nreturned çš„å€¼ï¼Œè¯´æ˜æ•°æ®åº“ä¸ºäº†æ‰¾åˆ°ç›®æ ‡æ–‡æ¡£æ‰«æäº†å¾ˆå¤šæ–‡æ¡£ã€‚è¿™æ—¶å¯ä»¥è€ƒè™‘åˆ›å»ºç´¢å¼•æ¥æé«˜æ•ˆç‡ã€‚</li>
<li>ã€€ç´¢å¼•çš„é”®å€¼é€‰æ‹©å¯ä»¥æ ¹æ® query ä¸­çš„è¾“å‡ºå‚è€ƒï¼Œä¸Šä¾‹ä¸­ filter:åŒ…å«äº† jzrqå’Œjglxfldm å¹¶ä¸”æŒ‰ç…§RsIdæ’åºï¼Œæ‰€ä»¥ æˆ‘ä»¬çš„ç´¢å¼•ç´¢å¼•å¯ä»¥è¿™ä¹ˆå»º: db.f10_2_8_3_jgcc.ensureindex({jzrq:1,jglxfldm:1,RsId:1})</li>
</ol>
<h1 id="èšåˆæ“ä½œ"><a href="#èšåˆæ“ä½œ" class="headerlink" title="èšåˆæ“ä½œ"></a>èšåˆæ“ä½œ</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ä¸€</span><br><span class="line">Criteria criteria = new Criteria();</span><br><span class="line">criteria.andOperator(Criteria.where(&quot;userId&quot;).is(uid), Criteria.where(&quot;type&quot;).is(2));//æŸ¥è¯¢æ¡ä»¶</span><br><span class="line">Aggregation aggregation = Aggregation.newAggregation(Aggregation.match(criteria),Aggregation.group(&quot;content&quot;).count().as(&quot;count&quot;),Aggregation.sort(Sort.Direction.ASC,&quot;count&quot;));</span><br><span class="line">AggregationResults&lt;SearchKeyWords&gt; ar = mongoTemplate.aggregate(aggregation,</span><br><span class="line">Searched.class, SearchKeyWords.class);//Searchedä¸ºè¦æŸ¥è¯¢çš„ç±»ï¼ŒSearchKeyWordsä¸ºæŸ¥è¯¢ç»“æœçš„voå¯¹è±¡</span><br><span class="line">List&lt;SearchKeyWords&gt; list = ar.getMappedResults();</span><br><span class="line"></span><br><span class="line">public class SearchKeyWords &#123;</span><br><span class="line"></span><br><span class="line">    public String _id;//_id: &quot;ä¸­å&quot;  é‡å¤çš„å­—æ®µ</span><br><span class="line">    public int count;//count: 57   é‡å¤æ¬¡æ•°</span><br><span class="line">    public int getCount() &#123;</span><br><span class="line">        return count;</span><br><span class="line">    &#125;</span><br><span class="line">    public void setCount(int count) &#123;</span><br><span class="line">        this.count = count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/23/mongo/aggregation.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹äºŒ</span><br><span class="line">//åˆ†ç»„groupã€æ’åºsortç»Ÿè®¡æ¯ä¸ªåˆ†ç±»ä¸‹å•†å“ä¸ªæ•°</span><br><span class="line">Criteria criteria = new Criteria();</span><br><span class="line">Aggregation aggregation = Aggregation.newAggregation(Aggregation.match(criteria),</span><br><span class="line">        Aggregation.group(&quot;categoryId&quot;).count().as(&quot;count&quot;),Aggregation.sort(Sort.Direction.ASC,&quot;count&quot;));</span><br><span class="line"></span><br><span class="line">AggregationResults&lt;BasicDBObject&gt; ar = mongoTemplate.aggregate(aggregation,</span><br><span class="line">        Goods.class, BasicDBObject.class);</span><br><span class="line">for (BasicDBObject basicDBObject : ar) &#123;</span><br><span class="line">    logger.info(JsonUtils.toJson(basicDBObject));</span><br><span class="line">&#125;</span><br><span class="line">//è¾“å‡ºç»“æœ</span><br><span class="line">2019-05-06 11:13:11 [com.badou.service.basic.goods.GoodsService]-[INFO] &#123;&quot;_id&quot;:&quot;6430379335205566832&quot;,&quot;count&quot;:1&#125;//åˆ†ç±»idå’Œå½“å‰åˆ†ç±»ä¸‹å•†å“ä¸ªæ•°</span><br><span class="line">2019-05-06 11:13:11 [com.badou.service.basic.goods.GoodsService]-[INFO] &#123;&quot;_id&quot;:&quot;8732390723817262538&quot;,&quot;count&quot;:2&#125;</span><br><span class="line">2019-05-06 11:13:11 [com.badou.service.basic.goods.GoodsService]-[INFO] &#123;&quot;_id&quot;:&quot;4479460853249390323&quot;,&quot;count&quot;:2&#125;</span><br><span class="line">2019-05-06 11:13:11 [com.badou.service.basic.goods.GoodsService]-[INFO] &#123;&quot;_id&quot;:&quot;6571438787886532072&quot;,&quot;count&quot;:16&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ä¸‰</span><br><span class="line">//ä¸¤ä¸ªé›†åˆå…³è”æŸ¥è¯¢ Aggregation.lookup</span><br><span class="line">//è‹¥ Aé›†åˆå…³è”Bé›†åˆ</span><br><span class="line">//å‚æ•°ï¼š from Bé›†åˆå</span><br><span class="line">//localField Aé›†åˆå­˜å¤–é”®çš„å­—æ®µ</span><br><span class="line">//foreignField Bé›†åˆä¸Aé›†åˆå…³è”çš„å­—æ®µ</span><br><span class="line">//as é‡æ–°ç»„åˆæˆCé›†åˆåç§°</span><br><span class="line">è¯­æ³•</span><br><span class="line">db.collection.aggregate([&#123;</span><br><span class="line">   $lookup:</span><br><span class="line">     &#123;</span><br><span class="line">       from: &lt;collection to join&gt;,</span><br><span class="line">       localField: &lt;field from the input documents&gt;,</span><br><span class="line">       foreignField: &lt;field from the documents of the &quot;from&quot; collection&gt;,</span><br><span class="line">       as: &lt;output array field&gt;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;])</span><br><span class="line"></span><br><span class="line">Criteria criteria = new Criteria();</span><br><span class="line">criteria.andOperator(Criteria.where(&quot;_id&quot;).is(&quot;6118446118773213048&quot;));</span><br><span class="line">Aggregation aggregation = Aggregation.newAggregation(</span><br><span class="line">        Aggregation.match(criteria),</span><br><span class="line">        Aggregation.lookup(&quot;goodsCategory&quot;, &quot;categoryId&quot;, &quot;_id&quot;, &quot;goodsCategory&quot;),</span><br><span class="line">        Aggregation.unwind(&quot;goodsCategory&quot;),</span><br><span class="line">        Aggregation.project(&quot;title&quot;,&quot;price&quot;).and(&quot;goodsCategory.name&quot;).as(&quot;categoryName&quot;).and(&quot;goodsCategory.order&quot;).as(&quot;categoryOrder&quot;)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">AggregationResults&lt;BasicDBObject&gt; ar = mongoTemplate.aggregate(</span><br><span class="line">        aggregation, Goods.class, BasicDBObject.class);</span><br><span class="line">for (BasicDBObject basicDBObject : ar) &#123;</span><br><span class="line">    logger.info(JsonUtils.toJson(basicDBObject));</span><br><span class="line">&#125;</span><br><span class="line">//è¾“å‡ºç»“æœ</span><br><span class="line">2019-05-06 21:17:26 [com.badou.service.basic.goods.GoodsService]-[INFO] &#123;&quot;_id&quot;:&quot;6118446118773213048&quot;,&quot;title&quot;:&quot;å°å­¦ç”Ÿå¿…å¤‡å›½å­¦å¸¸è¯†&amp;å°å­¦ç”Ÿå¿…è¯»å›½å­¦ç»å…¸&quot;,&quot;price&quot;:&quot;10.0&quot;,&quot;categoryName&quot;:&quot;å°å­¦ç”Ÿ&quot;,&quot;categoryOrder&quot;:&quot;1&quot;&#125;</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹å››(æœªæ›¾éªŒè¯)</span><br><span class="line">//å…¨æ–‡æœç´¢æŸ¥è¯¢</span><br><span class="line">//è®¾ç½®ç´¢å¼•ï¼šdb.logInfo.ensureIndex(msg:&quot;text&quot;)</span><br><span class="line">Query query = TextQuery.query(new TextCriteria().matching(&quot;coffee&quot;).matching(&quot;-cake&quot;));</span><br><span class="line">//-cakeè¡¨ç¤ºä¸åŒ¹é…ä¸åŒ…å«cakeä¸notMatchingç±»ä¼¼</span><br><span class="line">//Query query = TextQuery.searching((new TextCriteria().matching(&quot;coffee&quot;).notMatching(&quot;-cake&quot;))</span><br><span class="line">List&lt;LogInfoCol&gt; lfs = mongoTemplate.find(query,LogInfoCol.class);</span><br><span class="line">if(lfs!=null)&#123;</span><br><span class="line">    for(LogInfoCol logInfoCol:lfs)&#123;</span><br><span class="line">        logger.info(JSON.toString(logInfoCol));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹äº”(æœªæ›¾éªŒè¯)</span><br><span class="line">//å¾—åˆ°èŒƒå›´å†…æ•°æ®ï¼šä»¥Circleæ„é€ å‡½æ•°ï¼Œç¬¬ä¸€ç¬¬äºŒä¸ªå‚æ•°ä¸ºåæ ‡ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºè·ç¦»åŠå¾„æŸ¥æ‰¾ç¬¦åˆæ¡ä»¶çš„</span><br><span class="line">Circle circle = new Circle(4.2341111,63.00001,0.01);</span><br><span class="line">List&lt;PositionCol&gt; positionCols = mongoTemplate.find(new Query(Criteria.where(&quot;location&quot;).within(circle)),PositionCol.class);</span><br><span class="line">if(positionCols!=null)&#123;</span><br><span class="line">    for(PositionCol positionCol:positionCols)&#123;</span><br><span class="line">        logger.info(JSON.toJSONString(positionCol))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹å…­(æœªæ›¾éªŒè¯)</span><br><span class="line">//æŸ¥æ‰¾åæ ‡å‘¨å›´10KMå†…çš„æ‰€æœ‰å•†åº—</span><br><span class="line">Point location = new Point(116.425253,39.925338);</span><br><span class="line">NearQuery query = NearQuery.near(location).maxDistance(new Distance(10,Metrice.KILOMETERS));</span><br><span class="line">GeoResults&lt;PositionCol&gt; positions = mongoTemplate.geoNear(query,PositionCol.class);</span><br><span class="line">if(positionCols!=null)&#123;</span><br><span class="line">    for(GeoResults&lt;PositionCol&gt;geoResult :positions)&#123;</span><br><span class="line">        logger.info(geoResult.getContent().getBuissName()+&quot;-&quot;+geoResult.getDistance().getValue());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">ç¤ºä¾‹ä¸ƒ</span><br><span class="line">mongoæ”¯æŒçš„æŸ¥è¯¢å‚æ•°å®ä¾‹</span><br><span class="line">fpi.getParams().put(&quot;state|integer&quot;, &quot;1&quot;);           ç›¸å½“äºis       ä¸€å¯¹ä¸€</span><br><span class="line">fpi.getParams().put(&quot;ne:state|integer&quot;, &quot;1&quot;);           ç›¸å½“äºnot is       ä¸€å¯¹ä¸€</span><br><span class="line">fpi.getParams().put(&quot;all:keywords&quot;, keyword);        keywordsä¸ºlist å¤šå¯¹ä¸€</span><br><span class="line">fpi.getParams().put(&quot;in:_id|array&quot;, &quot;0,1&quot;);          åŒ…å«    ä¸€å¯¹å¤š</span><br><span class="line">fpi.getParams().put(&quot;nin:_id|array&quot;, &quot;0,1&quot;);         æ’é™¤id  ä¸€å¯¹å¤š</span><br><span class="line">fpi.getParams().put(&quot;gte:serialNum&quot;, start);        </span><br><span class="line">fpi.getParams().put(&quot;lte:serialNum&quot;, end); </span><br><span class="line">//æ—¥æœŸæŸ¥è¯¢</span><br><span class="line">Date currentDate = DateUtil.currentDate();</span><br><span class="line">String d = DateUtil.format(currentDate,&quot;yyyy-MM-dd HH:mm:ss&quot;);</span><br><span class="line">fpi.getParams().put(&quot;gte:endDate|datetime&quot;, d);  å¤§äºå½“å‰æ—¥æœŸçš„ç¿»é¡µæŸ¥è¯¢</span><br><span class="line"></span><br><span class="line">èšåˆæŸ¥è¯¢</span><br><span class="line">1ã€Criteria idcardCriteria = new Criteria();</span><br><span class="line">                idcardCriteria.orOperator(Criteria.where(&quot;idcard&quot;).regex(studentIdcard.toLowerCase()),</span><br><span class="line">                        Criteria.where(&quot;idcard&quot;).regex(studentIdcard.toUpperCase()));</span><br><span class="line">                criteria.andOperator(idcardCriteria);</span><br><span class="line"></span><br><span class="line">Mongodb: Sort operation used more than the maximum 33554432 bytes of RAM</span><br><span class="line">mongoä¸­æ‰€æœ‰æ’åºå­—æ®µåŠ ä¸Šç´¢å¼•æ¯”è¾ƒå¥½</span><br><span class="line"></span><br><span class="line">Criteria criteria = new Criteria();</span><br><span class="line">criteria.andOperator(Criteria.where(&quot;shakyId&quot;).in(gshakyIds), Criteria.where(&quot;userId&quot;).in(userIds));//ç­›é€‰æ¡ä»¶ï¼ˆé™å®šæ•°æ®èŒƒå›´ï¼‰</span><br><span class="line">Aggregation aggregation = Aggregation.newAggregation(Aggregation.match(criteria),</span><br><span class="line">        Aggregation.group(&quot;userId&quot;, &quot;shakyId&quot;).count().as(&quot;count&quot;),Aggregation.sort(Sort.Direction.ASC, &quot;count&quot;));//åˆ†ç»„  å•ä¸ªå­—æ®µåˆ†ç»„ï¼Œç›´æ¥å–count;ä¸¤ä¸ªå­—æ®µkey ç¡®å®šå”¯ä¸€ä¸€æ¡è®°å½•,åç»­éœ€è¦æ‰‹åŠ¨ç»Ÿè®¡</span><br></pre></td></tr></table></figure>
<p>AggregationResults ar = mongoTemplate.aggregate(aggregation,<br>Ugclock.class, BasicDBObject.class);</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">for (BasicDBObject basicDBObject : ar) &#123;</span><br><span class="line">    String id = basicDBObject.getString(&quot;shakyId&quot;);</span><br><span class="line">    int count = 1;</span><br><span class="line">    if (shakyCount.containsKey(id)) &#123;</span><br><span class="line">        count = shakyCount.get(id);</span><br><span class="line">        count++;</span><br><span class="line">        shakyCount.put(id, count);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        shakyCount.put(id, count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">2ã€ä»¥idä¸ºgroup byè®¡ç®—numçš„æ€»å€¼sumï¼ˆï¼‰</span><br><span class="line">Aggregation agg = Aggregation.newAggregation(</span><br><span class="line">                Aggregation.group(new String[] &#123;&quot;_id&quot;&#125;).sum(&quot;num&quot;).as(&quot;num&quot;)</span><br><span class="line">                );</span><br><span class="line">3ã€ä»¥idä¸ºgroup byæ‰¾å‡ºnumçš„æœ€å¤§å€¼max()                </span><br><span class="line">Aggregation agg = Aggregation.newAggregation(</span><br><span class="line">                Aggregation.group(new String[] &#123;&quot;_id&quot;&#125;).max(&quot;num&quot;).as(&quot;num&quot;)</span><br><span class="line">                );                </span><br><span class="line">Aggregation agg = Aggregation.newAggregation(</span><br><span class="line">                Aggregation.group(new String[] &#123;&quot;_id&quot;&#125;).min(&quot;num&quot;).as(&quot;num&quot;)</span><br><span class="line">                );</span><br><span class="line">4ã€ä»¥idä¸ºgroup byè®¡ç®—numçš„å¹³å‡å€¼avg(ï¼‰</span><br><span class="line">Aggregation agg = Aggregation.newAggregation(</span><br><span class="line">                Aggregation.group(new String[] &#123;&quot;_id&quot;&#125;).avg(&quot;num&quot;).as(&quot;num&quot;)</span><br><span class="line">                );</span><br></pre></td></tr></table></figure>
<h1 id="ç¿»é¡µ"><a href="#ç¿»é¡µ" class="headerlink" title="ç¿»é¡µ"></a>ç¿»é¡µ</h1><p>é¡¹ç›®å½“ä¸­æ¨¡æ‹Ÿæ’å…¥äº†120Wæ¡æ•°æ®ï¼Œåœ¨åŒä¸€ä¸ªæ–‡æ¡£å½“ä¸­å•çº¯æŸ¥è¯¢æ•°æ®çš„é€Ÿåº¦è¿˜ä¸é”™ï¼Œä¸»è¦æ˜¯å¯¹æŸ¥è¯¢çš„æ–‡æ¡£å­—æ®µæ·»åŠ äº†ç´¢å¼•ï¼Œä½†æ˜¯å¯¹æŸ¥è¯¢ç»“æœçš„å‰å°åˆ†é¡µç¡®æœ‰é—®é¢˜ã€‚å…·ä½“æ¥è¯´æ˜¯ä¸è®¾ç½®ä»»ä½•æŸ¥è¯¢æ¡ä»¶çš„æ—¶å€™ï¼Œä¼šæŸ¥è¯¢å‡ºæ¥å°†è¿‘120Wæ¡æ»¡è¶³æ¡ä»¶çš„ç»“æœï¼Œä½¿ç”¨mongodbçš„limit()å’Œskip() æ¥å–å‡ºæ¥ ç¬¬ä¸€é¡µå‰20æ¡æ•°æ®ï¼Œè¿™æ ·åœ¨åå°çš„javaç¨‹åºå½“ä¸­åªæ˜¯è¿™20æ¡æ•°æ®å ç”¨å†…å­˜ã€‚<br>ä»£ç å…·ä½“å½¢å¼ç±»ä¼¼äºç”¨mongodbå®¢æˆ·ç«¯æ‰§è¡Œdb.feedbackInfo.find(criteria).skip(0).limit(20) è·å¾—ç¬¬ä¸€é¡µ0-20æ¡æ•°æ®db.feedbackInfo.find(criteria).skip(20).limit(20) è·å¾—ç¬¬äºŒé¡µ20-40æ¡æ•°æ®â€¦â€¦db.feedbackInfo.find(criteria).skip(N).limit(20) è·å¾—ç¬¬äºŒé¡µN-N+20æ¡æ•°æ®ä½†é—®é¢˜åœ¨äºéšç€ä¸æ–­ç¿»é¡µï¼Œskipçš„å€¼Nä¼šè¶Šæ¥è¶Šå¤§ï¼Œå‰å°çš„ååº”è¶Šæ¥è¶Šæ…¢ã€‚å¾ˆç›´æ¥çš„ä¸€ä¸ªè¡¨ç°å°±æ˜¯åœ¨å‰å°ä»ç¬¬ä¸€é¡µç›´æ¥è·³è½¬è¿›å…¥æœ€åä¸€é¡µæ ¹æœ¬ååº”ä¸è¿‡æ¥ã€‚å¯¹äºè¿™ä¸ªå®é™…é—®é¢˜ï¼ŒåŸå› å°±æ˜¯æœ¬ä¹¦è¿™é‡Œæ‰€è¨€çš„skipç•¥è¿‡å¤§é‡ç»“æœä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Œå†æ ¹æºåœ°è¯´æ˜¯mongodbè¿˜ä¸å¤Ÿå®Œå–„ï¼Œç´¢å¼•æœ¬èº«è¿˜æ¯”è¾ƒç®€å•ã€‚å…·ä½“çš„è¿™ä¸ªåˆ†é¡µæ•ˆç‡çš„é—®é¢˜ï¼Œæœ‰ä¸¤ç§æ€è·¯ï¼šç¬¬ä¸€ï¼Œç­‰mongodbå‡çº§ï¼Œä¼˜åŒ–è¿™ä¸ªskipçš„æ‰§è¡Œæ•ˆç‡ã€‚ç¬¬äºŒï¼Œä¸ç”¨skip()è€Œå®ç°åˆ†é¡µæ•ˆæœã€‚è¿™ä¸ªæ€è·¯çš„åŸºç¡€å°±æ˜¯mongodbæœ¬èº«å¯¹äºwhereæŸ¥è¯¢å’Œlimit()çš„æ•ˆç‡è¿˜æ¯”è¾ƒä¸é”™ï¼Œä¹Ÿå°±æ˜¯æœ¬æ¥åˆ†é¡µçš„é‚£ä¸ªæŸ¥è¯¢ç”¨whereå’Œlimité€Ÿåº¦è¿˜å¯ä»¥çš„å‰æï¼ˆä¸€èˆ¬å°±æ˜¯éœ€è¦å»ºç«‹å¿…è¦çš„ç´¢å¼•ï¼‰ã€‚å‡å¦‚è¿™ä¸ªå‰æä¸æˆç«‹ï¼Œé‚£æ²¡æ³•è®¨è®ºã€‚æœ¬ä¹¦æ¥ä¸‹æ¥å…·ä½“è®¨è®ºäº†ä¸ä½¿ç”¨skipå¯¹ç»“æœåˆ†é¡µçš„å®ç°ä¾‹å­ï¼Œè¿™ä¸ªæœ¬è´¨æ˜¯å¯¹ä¿¡æ¯ç³»ç»Ÿå¢åŠ ä¸€ä¸ªæŸ¥è¯¢ä¸­é—´é‡â€”â€”ä¸Šæ¬¡æŸ¥è¯¢çš„ä¸šåŠ¡æ•°å€¼ï¼Œåœ¨é€»è¾‘ä¸Šæ‰¿æ‹…èµ·è·Ÿskipç›¸å¯¹ç­‰ä»·çš„åŠŸèƒ½ã€‚æ¯”å¦‚è¯´æ˜¯ç¬¬ä¸€é¡µæŸ¥è¯¢æ˜¯æŒ‰ç…§ä¸€ä¸ªæ—¥æœŸdateå€¼æŸ¥è¯¢ï¼Œç¬¬ä¸€æ¬¡ç”¨db.foo.find().sort({â€œdateâ€,-1}).limit(20)è€Œç‚¹å‡»ä¸‹ä¸€é¡µçš„æ—¶å€™ï¼Œäº‹å…ˆå°†ä¸Šæ¬¡æŸ¥è¯¢çš„dateçš„è¾¹ç•Œå€¼ç»™ä¼ é€’è¿‡å»ï¼Œç¬¬äºŒé¡µæŸ¥è¯¢çš„æ—¶å€™å°±ä½¿ç”¨æ–°çš„findæ¡ä»¶æŸ¥è¯¢db.foo.find({â€œdateâ€:{â€œ$gtâ€:latest.date}}); è€Œåå†å¯¹æŸ¥è¯¢ç»“æœæ’åºå³å¯è¿™ç§ç»•è¿‡skipçš„æ–¹å¼è¯„ä»·ï¼šç¬¬ä¸€ï¼Œå¾ˆéš¾æ¯”è¾ƒæ–¹ä¾¿åœ°è§£å†³æ‰€æœ‰çš„åˆ†é¡µé—®é¢˜ï¼Œç®€å•æ¥è¯´ å¯¹äºä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼çš„æŸ¥è¯¢ï¼Œæ ¹æœ¬æ— æ³•é€šè¿‡è®°å½•è¾¹ç•Œæ¡ä»¶æ¥å®ç°ã€‚ç¬¬äºŒï¼Œä¸å¾—ä¸å¤šä¼ é€’ä¸Šæ¬¡æŸ¥è¯¢çš„é‚£ä¸ªè¾¹ç•Œæ¡ä»¶ï¼Œå¢åŠ äº†å·¥ä½œé‡ï¼Œä¸å¤Ÿä¼˜é›…ã€‚ç¬¬ä¸‰ï¼Œåªèƒ½å¤Ÿè§£å†³ä¸€é¡µä¸€é¡µå¾€ä¸‹ç¿»é¡µçš„é—®é¢˜ï¼Œå¦‚æœæˆ‘è¦ä»ç¬¬1é¡µç›´æ¥è·³åˆ°100é¡µï¼Œå°±æŸæ‰‹æ— ç­–</p>
<h2 id="ç¿»é¡µçš„å®ç°ä¸€"><a href="#ç¿»é¡µçš„å®ç°ä¸€" class="headerlink" title="ç¿»é¡µçš„å®ç°ä¸€"></a>ç¿»é¡µçš„å®ç°ä¸€</h2><h3 id="skipå®ç°è·³é¡µï¼ˆæ¯”è¾ƒç®€å•ï¼Œæ•°æ®é‡å¤§äº†ä¸è¡Œï¼‰"><a href="#skipå®ç°è·³é¡µï¼ˆæ¯”è¾ƒç®€å•ï¼Œæ•°æ®é‡å¤§äº†ä¸è¡Œï¼‰" class="headerlink" title="skipå®ç°è·³é¡µï¼ˆæ¯”è¾ƒç®€å•ï¼Œæ•°æ®é‡å¤§äº†ä¸è¡Œï¼‰"></a>skipå®ç°è·³é¡µï¼ˆæ¯”è¾ƒç®€å•ï¼Œæ•°æ®é‡å¤§äº†ä¸è¡Œï¼‰</h3><pre><code> /**
 *db.getCollection(&apos;user&apos;).find({})æ˜¯æŒ‡æŸ¥è¯¢å…¨éƒ¨ã€‚
 *sort()è®¾ç½®æ’åºï¼Œæœ¬ç¤ºä¾‹æ˜¯æŒ‡ä»¥_idä½œä¸ºæ¡ä»¶ï¼Œæ­£åºæ’åºã€‚è‹¥å°†æ•°å­—1æ”¹ä¸º-1ï¼Œåˆ™ä¸ºå€’åºã€‚
 *skip()è®¾ç½®è·³é¡µï¼Œæœ¬ç¤ºä¾‹æ˜¯æŒ‡è·³è¿‡å‰10æ¡ï¼Œä»ç¬¬11æ¡å¼€å§‹æ˜¾ç¤ºã€‚
 *limit()è®¾ç½®æ¯é¡µçš„æ˜¾ç¤ºæ•°é‡ï¼Œæœ¬ä¾‹æ˜¯æŒ‡æ¯é¡µé™åˆ¶æ˜¾ç¤º10æ¡ã€‚
 */
db.getCollection(&apos;user&apos;).find({}).sort({&quot;ID&quot;:1}).skip(10).limit(10)
</code></pre><h3 id="éskipå®ç°è·³é¡µ"><a href="#éskipå®ç°è·³é¡µ" class="headerlink" title="éskipå®ç°è·³é¡µ"></a>éskipå®ç°è·³é¡µ</h3><pre><code>åŸç†ï¼šä»¥è‡ªå¢_idä½œä¸ºä¸»æ¡ä»¶ï¼Œè·å–å‰ä¸€é¡µçš„æœ€åä¸€æ¡è®°å½•ï¼ŒæŸ¥è¯¢ä¹‹åçš„æŒ‡å®šæ¡è®°å½•

//æ ¹æ®_idï¼ŒæŸ¥è¯¢å‰10æ¡
var a = db. getCollection(&apos;user&apos;).find({}).sort(&quot;_id&quot;,1).limit(10)
//å®šä¹‰å˜é‡last
var last  = null
//å¾ªç¯éå†
while(a.hasNext()){
    last=a.next;//å¾ªç¯åˆ°æœ€åï¼Œlastæ¥æ”¶çš„æ˜¯æœ€åä¸€æ¡çš„ä¿¡æ¯
}
//æ ¸å¿ƒæ˜¯&quot;_id&quot;:{&quot;$gt&quot;:last._id}ï¼Œå³æŸ¥è¯¢å¤§äºæœ€åä¸€æ¡çš„_idçš„å10æ¡ä¿¡æ¯
db.getCollection(&apos;slt&apos;).find({&quot;_id&quot;:{&quot;$gt&quot;:last._id}}).sort({_id:1}).limit(10)
</code></pre><h2 id="ç¿»é¡µçš„å®ç°äºŒï¼ˆéskipå®ç°è·³é¡µï¼Œä»¥è‡ªå¢-idä½œä¸ºä¸»æ¡ä»¶ï¼‰"><a href="#ç¿»é¡µçš„å®ç°äºŒï¼ˆéskipå®ç°è·³é¡µï¼Œä»¥è‡ªå¢-idä½œä¸ºä¸»æ¡ä»¶ï¼‰" class="headerlink" title="ç¿»é¡µçš„å®ç°äºŒï¼ˆéskipå®ç°è·³é¡µï¼Œä»¥è‡ªå¢_idä½œä¸ºä¸»æ¡ä»¶ï¼‰"></a>ç¿»é¡µçš„å®ç°äºŒï¼ˆéskipå®ç°è·³é¡µï¼Œä»¥è‡ªå¢_idä½œä¸ºä¸»æ¡ä»¶ï¼‰</h2><pre><code>private List&lt;JSONObject&gt; findOrderList(Map&lt;String,Object&gt; paramOptions,int page,int size,String sidx,String sord) throws Exception {
            //è¿æ¥æ•°æ®åº“
    MongoCollection&lt;Document&gt; mongoCollection = getMdbCollection();
    //è¿›è¡Œç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼Œæ¡ä»¶ä¸­æ²¡æœ‰skip
    MongoCursor&lt;Document&gt; iterable = mongoCollection.find().limit(size).sort(new BasicDBObject(&quot;_id&quot;, 1)).iterator(); 
    //å®šä¹‰orderItemsï¼Œç”¨ä»¥æ¥æ”¶æŸ¥è¯¢çš„ä¿¡æ¯
    List&lt;JSONObject&gt; orderItems = new ArrayList&lt;JSONObject&gt;();

    //å¦‚æœåªæœ‰ä¸€é¡µæˆ–ç¬¬ä¸€é¡µï¼Œåˆ™èµ°æ­¤æ¡ä»¶ï¼Œå¦ï¼Œåˆ™èµ°else
        if(page == 1){     
ã€€ã€€ã€€ã€€  //éå†        
            while (iterable.hasNext()) {
              Document next = iterable.next();
              JSONObject a =JSONObject.parseObject(next.toJson());
              orderItems.add(a);
            }
ã€€ã€€ã€€ã€€ã€€}else{ 
ã€€ã€€ã€€ã€€ã€€ã€€MongoCursor&lt;Document&gt; iterable2 = mongoCollection.find().limit(size*(page-1)).sort(new BasicDBObject(&quot;_id&quot;, 1)).iterator(); 
         //å®šä¹‰å˜é‡lastï¼Œç”¨ä»¥å­˜å‚¨æ¯é¡µçš„æœ€åä¸€æ¡è®°å½• 
ã€€ã€€ã€€ã€€ã€€Document last = null; 
ã€€ã€€ã€€ã€€ã€€while (iterable2.hasNext()) { 
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€last = iterable2.next(); 
ã€€ã€€ã€€ã€€ã€€} 
         //å®šä¹‰conditionï¼Œç”¨ä»¥æ·»åŠ ã€$gt:æ¯é¡µæœ€åä¸€æ¡è®°å½•çš„_idå€¼ã€‘ï¼Œä½œä¸ºæŸ¥è¯¢æ¡ä»¶ 
ã€€ã€€ã€€ã€€ã€€ã€€Map&lt;String, Object&gt; condition = new HashMap&lt;&gt;(); 
ã€€ã€€ã€€ã€€ã€€ã€€if (null != last.get(&quot;_id&quot;)) { 
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€condition.put(&quot;$gt&quot;,last.get(&quot;_id&quot;)); 
 ã€€ã€€ã€€ã€€ã€€ } 
ã€€ã€€ã€€ã€€ã€€ MongoCursor&lt;Document&gt; iterable3 = mongoCollection.find(condition).limit(size).sort(new BasicDBObject(&quot;_id&quot;, 1)).iterator(); 
ã€€ã€€ã€€ã€€ã€€ã€€//éå† 
ã€€ã€€ã€€ã€€ã€€ã€€while (iterable.hasNext()) { 
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€Document next = iterable.next(); 
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€JSONObject a =JSONObject.parseObject(next.toJson()); 
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€orderItems.add(a);
ã€€ã€€ã€€ã€€ã€€ã€€} 
ã€€ã€€ã€€ã€€ã€€ã€€return orderItems; 
}
 æ³¨ï¼šä¸Šé¢æ˜¯æŒ‰_idæ­£åºæ’åˆ—çš„ï¼Œå¦‚æœæƒ³è¦æŒ‰ç…§å€’åºæ’åˆ—ï¼Œåˆ™éœ€è¦å°†condition.put(&quot;$gt&quot;,last.get(&quot;_id&quot;))æ”¹ä¸ºcondition.put(&quot;$lt&quot;,last.get(&quot;_id&quot;))ï¼Œå°†sort(new BasicDBObject(&quot;_id&quot;, 1)æ”¹ä¸ºsort(new BasicDBObject(&quot;_id&quot;, -1)ã€‚
</code></pre><h1 id="mongoé«˜çº§"><a href="#mongoé«˜çº§" class="headerlink" title="mongoé«˜çº§"></a>mongoé«˜çº§</h1><h2 id="æœ¬åœ°æ­å»ºå‰¯æœ¬é›†"><a href="#æœ¬åœ°æ­å»ºå‰¯æœ¬é›†" class="headerlink" title="æœ¬åœ°æ­å»ºå‰¯æœ¬é›†"></a>æœ¬åœ°æ­å»ºå‰¯æœ¬é›†</h2><h3 id="mongoçš„ç‰ˆæœ¬"><a href="#mongoçš„ç‰ˆæœ¬" class="headerlink" title="mongoçš„ç‰ˆæœ¬"></a>mongoçš„ç‰ˆæœ¬</h3><p> version 3.6.5</p>
<h3 id="å‰¯æœ¬é›†æ–‡ä»¶å¤¹å‡†å¤‡"><a href="#å‰¯æœ¬é›†æ–‡ä»¶å¤¹å‡†å¤‡" class="headerlink" title="å‰¯æœ¬é›†æ–‡ä»¶å¤¹å‡†å¤‡"></a>å‰¯æœ¬é›†æ–‡ä»¶å¤¹å‡†å¤‡</h3><pre><code>mongodb3.6 åŒç›®å½•ä¸‹å»ºç«‹æ–‡ä»¶å¤¹ï¼Œå­˜æ”¾æ•°æ®
data/mongo/27017,data/mongo/27018,data/mongo/27019
åŒç›®å½•ä¸‹å»ºç«‹æ–‡ä»¶å¤¹å­˜æ”¾æ—¥å¿—æ•°æ®
data/mongo/27017log,data/mongo/27018log,data/mongo/27019log
</code></pre><h3 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><pre><code>mongod --port 27017 --dbpath /data/mongo/27017 --logpath /data/mongo/27017log/27017.log --replSet rs-local-test --logappend
mongod --port 27018 --dbpath /data/mongo/27018 --logpath /data/mongo/27018log/27018.log --replSet rs-local-test --logappend
mongod --port 27019 --dbpath /data/mongo/27019 --logpath /data/mongo/27019log/27019.log --replSet rs-local-test --logappend
</code></pre><p>ä¸‰ä¸ªæœåŠ¡å™¨å¯åŠ¨å®Œæ¯•ä¹‹åï¼Œä¸è¦å…³é—­ã€‚å¦å¼€ä¸€ä¸ªcmdçª—å£ï¼Œè¿æ¥åˆ°27017ç«¯å£çš„æœåŠ¡å™¨ï¼ˆè¿æ¥å…¶ä»–ç«¯å£ä¹Ÿå¯ä»¥ï¼‰ï¼Œæ¯æ¬¡å¯åŠ¨ï¼Œä¸»æœåŠ¡å™¨å¯èƒ½ä¼šä¸ä¸€æ ·ï¼Œå¦‚æœè¿æ¥çš„æ˜¯ä¸»æœåŠ¡å™¨ï¼Œå‰ç¼€ä¼šå˜æˆå¦‚ä¸‹PRIMARYï¼Œå¦‚æœæ˜¯ä»æœåŠ¡å™¨ï¼Œå‰ç¼€ä¼šå˜æˆSECONDARY</p>
<h3 id="åˆ›å»ºé…ç½®æ–‡ä»¶"><a href="#åˆ›å»ºé…ç½®æ–‡ä»¶" class="headerlink" title="åˆ›å»ºé…ç½®æ–‡ä»¶"></a>åˆ›å»ºé…ç½®æ–‡ä»¶</h3><p>åˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­åˆ—å‡ºæ¯ä¸€ä¸ªæˆå‘˜ï¼ŒçŸ¥é“å½¼æ­¤çš„å­˜åœ¨(ç¬¬äºŒæ¬¡å¯åŠ¨å°±ä¸éœ€è¦å†é…ç½®)</p>
<pre><code>use test
witched to db test
     rs.initiate({
      &quot;_id&quot;:&quot;rs-local-test01&quot;,
      &quot;members&quot;:[
     {&quot;_id&quot;:0,&quot;host&quot;:&quot;127.0.0.1:27017&quot;},
      {&quot;_id&quot;:1,&quot;host&quot;:&quot;127.0.0.1:27018&quot;},
      {&quot;_id&quot;:2,&quot;host&quot;:&quot;127.0.0.1:27019&quot;}
    ]
})

{
&quot;ok&quot; : 1,
&quot;operationTime&quot; : Timestamp(1596076771, 1),
&quot;$clusterTime&quot; : {
    &quot;clusterTime&quot; : Timestamp(1596076771, 1),
        &quot;signature&quot; : {
            &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;
            &quot;keyId&quot; : NumberLong(0)
        }
    }
}
</code></pre><p>æŸ¥çœ‹çŠ¶æ€ä¿¡æ¯</p>
<pre><code>rs-local-test:OTHER&gt; rs.status()
{
&quot;set&quot; : &quot;rs-local-test&quot;,
&quot;date&quot; : ISODate(&quot;2020-07-30T02:40:29.243Z&quot;),
&quot;myState&quot; : 1,
&quot;term&quot; : NumberLong(1),
&quot;heartbeatIntervalMillis&quot; : NumberLong(2000),
&quot;optimes&quot; : {
&quot;lastCommittedOpTime&quot; : {
&quot;ts&quot; : Timestamp(1596076823, 1),
&quot;t&quot; : NumberLong(1)
},
&quot;readConcernMajorityOpTime&quot; : {
&quot;ts&quot; : Timestamp(1596076823, 1),
&quot;t&quot; : NumberLong(1)
},
&quot;appliedOpTime&quot; : {
&quot;ts&quot; : Timestamp(1596076823, 1),
&quot;t&quot; : NumberLong(1)
},
&quot;durableOpTime&quot; : {
&quot;ts&quot; : Timestamp(1596076823, 1),
&quot;t&quot; : NumberLong(1)
}
},
&quot;members&quot; : [
{
&quot;_id&quot; : 0,
&quot;name&quot; : &quot;127.0.0.1:27017&quot;,
&quot;health&quot; : 1,
&quot;state&quot; : 1,
&quot;stateStr&quot; : &quot;PRIMARY&quot;,
&quot;uptime&quot; : 286,
&quot;optime&quot; : {
&quot;ts&quot; : Timestamp(1596076823, 1),
&quot;t&quot; : NumberLong(1)
},
&quot;optimeDate&quot; : ISODate(&quot;2020-07-30T02:40:23Z&quot;),
&quot;infoMessage&quot; : &quot;could not find member to sync fr
&quot;electionTime&quot; : Timestamp(1596076782, 1),
&quot;electionDate&quot; : ISODate(&quot;2020-07-30T02:39:42Z&quot;),
&quot;configVersion&quot; : 1,
&quot;self&quot; : true
},
{
&quot;_id&quot; : 1,
&quot;name&quot; : &quot;127.0.0.1:27018&quot;,
&quot;health&quot; : 1,
&quot;state&quot; : 2,
&quot;stateStr&quot; : &quot;SECONDARY&quot;,
&quot;uptime&quot; : 57,
&quot;optime&quot; : {
&quot;ts&quot; : Timestamp(1596076823, 1),
&quot;t&quot; : NumberLong(1)
},
&quot;optimeDurable&quot; : {
&quot;ts&quot; : Timestamp(1596076823, 1),
&quot;t&quot; : NumberLong(1)
},
&quot;optimeDate&quot; : ISODate(&quot;2020-07-30T02:40:23Z&quot;),
&quot;optimeDurableDate&quot; : ISODate(&quot;2020-07-30T02:40:2
&quot;lastHeartbeat&quot; : ISODate(&quot;2020-07-30T02:40:28.47
&quot;lastHeartbeatRecv&quot; : ISODate(&quot;2020-07-30T02:40:2
),
&quot;pingMs&quot; : NumberLong(0),
&quot;syncingTo&quot; : &quot;127.0.0.1:27017&quot;,
&quot;configVersion&quot; : 1
},
{
&quot;_id&quot; : 2,
&quot;name&quot; : &quot;127.0.0.1:27019&quot;,
&quot;health&quot; : 1,
&quot;state&quot; : 2,
&quot;stateStr&quot; : &quot;SECONDARY&quot;,
&quot;uptime&quot; : 57,
&quot;optime&quot; : {
&quot;ts&quot; : Timestamp(1596076823, 1),
&quot;t&quot; : NumberLong(1)
},
&quot;optimeDurable&quot; : {
&quot;ts&quot; : Timestamp(1596076823, 1),
&quot;t&quot; : NumberLong(1)
},
&quot;optimeDate&quot; : ISODate(&quot;2020-07-30T02:40:23Z&quot;),
&quot;optimeDurableDate&quot; : ISODate(&quot;2020-07-30T02:40:2
&quot;lastHeartbeat&quot; : ISODate(&quot;2020-07-30T02:40:28.47
&quot;lastHeartbeatRecv&quot; : ISODate(&quot;2020-07-30T02:40:2
),
&quot;pingMs&quot; : NumberLong(0),
&quot;syncingTo&quot; : &quot;127.0.0.1:27018&quot;,
&quot;configVersion&quot; : 1
}
],
&quot;ok&quot; : 1,
&quot;operationTime&quot; : Timestamp(1596076823, 1),
&quot;$clusterTime&quot; : {
&quot;clusterTime&quot; : Timestamp(1596076823, 1),
&quot;signature&quot; : {
&quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;
&quot;keyId&quot; : NumberLong(0)
}
}
}
</code></pre><p>å¦‚æœæ˜¯ç¬¬äºŒæ¬¡å¯åŠ¨ï¼Œå¯ä»¥ç›´æ¥æŸ¥çœ‹çŠ¶æ€ä¿¡æ¯ï¼Œä¸éœ€è¦åœ¨è®¾ç½®é…ç½®æ–‡ä»¶ã€‚<br>æŸ¥çœ‹çŠ¶æ€ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°ä¸»æœåŠ¡å™¨å’Œå¤‡ä»½æœåŠ¡å™¨ï¼š</p>
<pre><code>rs-local-test:SECONDARY&gt;use test
switched to db test
rs-local-test:SECONDARY&gt; db.isMaster()
{
&quot;hosts&quot; : [
&quot;127.0.0.1:27017&quot;,
&quot;127.0.0.1:27018&quot;,
&quot;127.0.0.1:27019&quot;
],
&quot;setName&quot; : &quot;rs-local-test&quot;,
&quot;setVersion&quot; : 1,
&quot;ismaster&quot; : false,
&quot;secondary&quot; : true,
&quot;primary&quot; : &quot;127.0.0.1:27019&quot;,
&quot;me&quot; : &quot;127.0.0.1:27017&quot;,
&quot;lastWrite&quot; : {
&quot;opTime&quot; : {
&quot;ts&quot; : Timestamp(1596079583, 1),
&quot;t&quot; : NumberLong(5)
},
&quot;lastWriteDate&quot; : ISODate(&quot;2020-07-30T03:26:23Z&quot;),
&quot;majorityOpTime&quot; : {
&quot;ts&quot; : Timestamp(1596079583, 1),
&quot;t&quot; : NumberLong(5)
},
&quot;majorityWriteDate&quot; : ISODate(&quot;2020-07-30T03:26:23Z&quot;)
},
&quot;maxBsonObjectSize&quot; : 16777216,
&quot;maxMessageSizeBytes&quot; : 48000000,
&quot;maxWriteBatchSize&quot; : 100000,
&quot;localTime&quot; : ISODate(&quot;2020-07-30T03:26:25.289Z&quot;),
&quot;logicalSessionTimeoutMinutes&quot; : 30,
&quot;minWireVersion&quot; : 0,
&quot;maxWireVersion&quot; : 6,
&quot;readOnly&quot; : false,
&quot;ok&quot; : 1,
&quot;operationTime&quot; : Timestamp(1596079583, 1),
&quot;$clusterTime&quot; : {
&quot;clusterTime&quot; : Timestamp(1596079583, 1),
&quot;signature&quot; : {
&quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;),
&quot;keyId&quot; : NumberLong(0)
}
}
}
</code></pre><h3 id="è¯»å†™æµ‹è¯•"><a href="#è¯»å†™æµ‹è¯•" class="headerlink" title="è¯»å†™æµ‹è¯•"></a>è¯»å†™æµ‹è¯•</h3><p>è¿æ¥ä¸»æœåŠ¡å™¨åï¼Œå¯ä»¥å†™å…¥æ•°æ®ï¼š<br>é‡æ–°å¯åŠ¨ä¸€ä¸ªcmd,è¿æ¥ä¸€ä¸ªå¤‡ä»½æœåŠ¡å™¨ï¼ŒæŸ¥çœ‹æ˜¯å¦æ•°æ®è¢«å¤åˆ¶ï¼š<br>å¤‡ä»½èŠ‚ç‚¹å¯èƒ½ä¼šè½åäºä¸»èŠ‚ç‚¹ï¼Œå¯èƒ½æ²¡æœ‰æœ€æ–°å†™å…¥æ•°æ®ï¼Œæ‰€ä»¥å¤‡ä»½èŠ‚ç‚¹é»˜è®¤æƒ…å†µä¸‹ä¼šæ‹’ç»è¯»å–è¯·æ±‚ï¼Œè¿™æ˜¯ä¸ºäº†ä¿æŠ¤åº”ç”¨ç¨‹åºï¼Œä»¥å…æ„å¤–è¿æ¥åˆ°å¤‡ä»½èŠ‚ç‚¹ï¼Œè¯»å–åˆ°è¿‡æœŸæ•°æ®ï¼š</p>
<pre><code>rs-local-test:SECONDARY&gt; db.foo.find()
Error: error: {
        &quot;operationTime&quot; : Timestamp(1596079503, 1),
        &quot;ok&quot; : 0,
        &quot;errmsg&quot; : &quot;not master and slaveOk=false&quot;,
        &quot;code&quot; : 13435,
        &quot;codeName&quot; : &quot;NotMasterNoSlaveOk&quot;,
        &quot;$clusterTime&quot; : {
                &quot;clusterTime&quot; : Timestamp(1596079503, 1),
                &quot;signature&quot; : {
                        &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;),
                        &quot;keyId&quot; : NumberLong(0)
                }
        }
}

ä»å¤‡ä»½èŠ‚ç‚¹è¯»å–æ•°æ®ï¼Œéœ€è¦è®¾ç½®æ ‡è¯†ï¼š
db.getMongo().setSlaveOk();
</code></pre><h3 id="èŠ‚ç‚¹å˜æ›´"><a href="#èŠ‚ç‚¹å˜æ›´" class="headerlink" title="èŠ‚ç‚¹å˜æ›´"></a>èŠ‚ç‚¹å˜æ›´</h3><p>åœ¨ä¸»èŠ‚ç‚¹æ’å…¥æ•°æ®åï¼Œå¦‚æœæœ‰å¤‡ä»½èŠ‚ç‚¹æœåŠ¡å™¨æ²¡æœ‰å¯åŠ¨ï¼Œå½“åœ¨è¯¥å¤‡ä»½å¯åŠ¨åï¼Œä¹Ÿå¯ä»¥æŸ¥è¯¢åˆ°å†™å…¥çš„æ•°æ®ï¼š<br>ä¸èƒ½å¯¹å¤‡ä»½èŠ‚ç‚¹æ‰§è¡Œå†™å…¥æ“ä½œï¼Œå¤‡ä»½èŠ‚ç‚¹åªèƒ½é€šè¿‡å¤åˆ¶åŠŸèƒ½å†™å…¥æ•°æ®ï¼Œä¸æ¥å—å®¢æˆ·ç«¯çš„å†™å…¥è¯·æ±‚ï¼š<br>rs-local-test:SECONDARY&gt;</p>
<p>å¯ä»¥éšæ—¶æ·»åŠ æˆ–åˆ é™¤æˆå‘˜,å…ˆæŒ‰ä¹‹å‰çš„æ–¹æ³•åˆ›å»ºä¸€ä¸ªå¤‡ç”¨æœåŠ¡å™¨ï¼Œå†æ·»åŠ è¿›å»ï¼š<br>rs.add(â€˜127.0.0.1â€™:4444)<br>rsæ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå…¶ä¸­åŒ…å«ä¸å¤åˆ¶ç›¸å…³çš„è¾…åŠ©å‡½æ•°ã€‚<br>åˆ é™¤æˆå‘˜ï¼š<br>rs.remove(â€˜127.0.0.1â€™:4444)</p>
<p>æ·»åŠ æˆ–åˆ é™¤å®Œå¯é€šè¿‡ db.isMaster()æŸ¥çœ‹ä¿®æ”¹ç»“æœ<br>ä¹Ÿå¯rs.config();</p>
<pre><code>rs-local-test:SECONDARY&gt; rs.config()
{
        &quot;_id&quot; : &quot;rs-local-test&quot;,
        &quot;version&quot; : 1,
        &quot;protocolVersion&quot; : NumberLong(1),
        &quot;members&quot; : [
                {
                        &quot;_id&quot; : 0,
                        &quot;host&quot; : &quot;127.0.0.1:27017&quot;,
                        &quot;arbiterOnly&quot; : false,
                        &quot;buildIndexes&quot; : true,
                        &quot;hidden&quot; : false,
                        &quot;priority&quot; : 1,
                        &quot;tags&quot; : {

                        },
                        &quot;slaveDelay&quot; : NumberLong(0),
                        &quot;votes&quot; : 1
                },
                {
                        &quot;_id&quot; : 1,
                        &quot;host&quot; : &quot;127.0.0.1:27018&quot;,
                        &quot;arbiterOnly&quot; : false,
                        &quot;buildIndexes&quot; : true,
                        &quot;hidden&quot; : false,
                        &quot;priority&quot; : 1,
                        &quot;tags&quot; : {

                        },
                        &quot;slaveDelay&quot; : NumberLong(0),
                        &quot;votes&quot; : 1
                },
                {
                        &quot;_id&quot; : 2,
                        &quot;host&quot; : &quot;127.0.0.1:27019&quot;,
                        &quot;arbiterOnly&quot; : false,
                        &quot;buildIndexes&quot; : true,
                        &quot;hidden&quot; : false,
                        &quot;priority&quot; : 1,
                        &quot;tags&quot; : {

                        },
                        &quot;slaveDelay&quot; : NumberLong(0),
                        &quot;votes&quot; : 1
                }
        ],
        &quot;settings&quot; : {
                &quot;chainingAllowed&quot; : true,
                &quot;heartbeatIntervalMillis&quot; : 2000,
                &quot;heartbeatTimeoutSecs&quot; : 10,
                &quot;electionTimeoutMillis&quot; : 10000,
                &quot;catchUpTimeoutMillis&quot; : -1,
                &quot;catchUpTakeoverDelayMillis&quot; : 30000,
                &quot;getLastErrorModes&quot; : {

                },
                &quot;getLastErrorDefaults&quot; : {
                        &quot;w&quot; : 1,
                        &quot;wtimeout&quot; : 0
                },
                &quot;replicaSetId&quot; : ObjectId(&quot;5f2232e3b3ef9f7db4cb682d&quot;)
        }
}
</code></pre><p>ä»¥ä¸Šå‚è€ƒè‡ª <a href="https://www.cnblogs.com/a-horse-mosaic/p/9284297.html" target="_blank" rel="noopener">https://www.cnblogs.com/a-horse-mosaic/p/9284297.html</a></p>
<h2 id="é—®é¢˜æ±‡æ€»"><a href="#é—®é¢˜æ±‡æ€»" class="headerlink" title="é—®é¢˜æ±‡æ€»"></a>é—®é¢˜æ±‡æ€»</h2><h3 id="å¦‚ä½•å¼€å¯è¯»å†™åˆ†ç¦»"><a href="#å¦‚ä½•å¼€å¯è¯»å†™åˆ†ç¦»" class="headerlink" title="å¦‚ä½•å¼€å¯è¯»å†™åˆ†ç¦»"></a>å¦‚ä½•å¼€å¯è¯»å†™åˆ†ç¦»</h3><p>é»˜è®¤æƒ…å†µä¸‹é©±åŠ¨æ˜¯ä»Replica Set é›†ç¾¤ä¸­çš„ Primary ä¸Šè¿›è¡Œè¯»å†™çš„ï¼Œåº”ç”¨å¯ä»¥åœ¨è¯»å¤šå†™å°‘çš„åœºæ™¯ä¸‹å¼€å¯è¯»å†™åˆ†ç¦»ï¼Œæé«˜æ•ˆç‡ã€‚</p>
<p>è¯»å–åå¥½(Read Preference)å‚æ•°</p>
<p>primary  ä¸»èŠ‚ç‚¹ï¼Œé»˜è®¤æ¨¡å¼ï¼Œè¯»æ“ä½œåªåœ¨ä¸»èŠ‚ç‚¹ï¼Œå¦‚æœä¸»èŠ‚ç‚¹ä¸å¯ç”¨ï¼ŒæŠ¥é”™æˆ–è€…æŠ›å¼‚å¸¸ã€‚</p>
<p>primaryPreferred é¦–é€‰ä¸»èŠ‚ç‚¹ï¼Œå¦‚æœä¸»èŠ‚ç‚¹ä¸å¯ç”¨ï¼Œå¦‚æ•…éšœè½¬ç§»ï¼Œè¯»æ“ä½œåœ¨ä»èŠ‚ç‚¹ã€‚</p>
<p>secondary ä»èŠ‚ç‚¹ï¼Œè¯»æ“ä½œåªåœ¨ä»èŠ‚ç‚¹ï¼Œå¦‚æœä»èŠ‚ç‚¹ä¸å¯ç”¨ï¼ŒæŠ¥é”™æˆ–è€…æŠ›å¼‚å¸¸ã€‚</p>
<p>secondaryPreferred é¦–é€‰ä»èŠ‚ç‚¹ï¼Œå¤§å¤šæƒ…å†µä¸‹è¯»æ“ä½œåœ¨ä»èŠ‚ç‚¹ï¼Œç‰¹æ®Šæƒ…å†µï¼ˆå¦‚å•ä¸»èŠ‚ç‚¹æ¶æ„ï¼‰è¯»æ“ä½œåœ¨ä¸»èŠ‚ç‚¹ã€‚</p>
<p>nearest æœ€é‚»è¿‘èŠ‚ç‚¹ï¼Œè¯»æ“ä½œåœ¨æœ€é‚»è¿‘çš„æˆå‘˜ï¼Œå¯èƒ½æ˜¯ä¸»èŠ‚ç‚¹æˆ–è€…ä»èŠ‚ç‚¹</p>
<h3 id="åœ¨Mongodbä¸­æœ€å¤šèƒ½åˆ›å»ºå¤šå°‘é›†åˆï¼Ÿ"><a href="#åœ¨Mongodbä¸­æœ€å¤šèƒ½åˆ›å»ºå¤šå°‘é›†åˆï¼Ÿ" class="headerlink" title="åœ¨Mongodbä¸­æœ€å¤šèƒ½åˆ›å»ºå¤šå°‘é›†åˆï¼Ÿ"></a>åœ¨Mongodbä¸­æœ€å¤šèƒ½åˆ›å»ºå¤šå°‘é›†åˆï¼Ÿ</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒMongoDB çš„æ¯ä¸ªæ•°æ®åº“çš„å‘½åç©ºé—´ä¿å­˜åœ¨ä¸€ä¸ª 16MB çš„ .ns æ–‡ä»¶ä¸­ï¼Œå¹³å‡æ¯ä¸ªå‘½åå ç”¨çº¦ 628 å­—èŠ‚ï¼Œä¹Ÿå³æ•´ä¸ªæ•°æ®åº“çš„å‘½åç©ºé—´çš„ä¸Šé™çº¦ä¸º 24000ã€‚<br>æ¯ä¸€ä¸ªé›†åˆã€ç´¢å¼•éƒ½å°†å ç”¨ä¸€ä¸ªå‘½åç©ºé—´ã€‚æ‰€ä»¥ï¼Œå¦‚æœæ¯ä¸ªé›†åˆæœ‰ä¸€ä¸ªç´¢å¼•ï¼ˆæ¯”å¦‚é»˜è®¤çš„ _id ç´¢å¼•ï¼‰ï¼Œé‚£ä¹ˆæœ€å¤šå¯ä»¥åˆ›å»º 12000 ä¸ªé›†åˆã€‚å¦‚æœç´¢å¼•æ•°æ›´å¤šï¼Œåˆ™å¯åˆ›å»ºçš„é›†åˆæ•°å°±æ›´å°‘äº†ã€‚åŒæ—¶ï¼Œå¦‚æœé›†åˆæ•°å¤ªå¤šï¼Œä¸€äº›æ“ä½œä¹Ÿä¼šå˜æ…¢ã€‚ç”šè‡³ä½¿å¾—MongoDBé›†ç¾¤æ— æ³•æœåŠ¡çš„æƒ…å†µå‘ç”Ÿï¼</p>
<h3 id="MongoDBæœ‰ä¼ ç»Ÿæ•°æ®åº“çš„äº‹åŠ¡å’Œäº‹åŠ¡å›æ»šä¹ˆï¼Ÿ"><a href="#MongoDBæœ‰ä¼ ç»Ÿæ•°æ®åº“çš„äº‹åŠ¡å’Œäº‹åŠ¡å›æ»šä¹ˆï¼Ÿ" class="headerlink" title="MongoDBæœ‰ä¼ ç»Ÿæ•°æ®åº“çš„äº‹åŠ¡å’Œäº‹åŠ¡å›æ»šä¹ˆï¼Ÿ"></a>MongoDBæœ‰ä¼ ç»Ÿæ•°æ®åº“çš„äº‹åŠ¡å’Œäº‹åŠ¡å›æ»šä¹ˆï¼Ÿ</h3><p>æ²¡æœ‰ï¼Œè¯·ä¸è¦æŠŠå®ƒå½“æˆå…³ç³»å‹æ•°æ®åº“æ¥ä½¿ç”¨ï¼Œå¯¹äºMongoDBé›†ç¾¤æ¥è¯´ï¼Œé»˜è®¤æƒ…å†µä¸‹æ•°æ®ä¹Ÿä¸æ˜¯å¼ºä¸€è‡´æ€§çš„ï¼Œè€Œæ˜¯æœ€ç»ˆä¸€è‡´æ€§ã€‚å¦‚æœå¯¹æ•°æ®ä¸€è‡´æ€§æ¯”è¾ƒæ•æ„Ÿå»ºè®®æ›´æ”¹WriteConcernçº§åˆ«ï¼Œä½†åæœæ˜¯é™ä½äº†æ€§èƒ½ï¼Œè¯·é…Œæƒ…è€ƒè™‘ã€‚</p>
<h3 id="MongoDBæœ‰å‘½åè§„èŒƒä¹ˆï¼Ÿ"><a href="#MongoDBæœ‰å‘½åè§„èŒƒä¹ˆï¼Ÿ" class="headerlink" title="MongoDBæœ‰å‘½åè§„èŒƒä¹ˆï¼Ÿ"></a>MongoDBæœ‰å‘½åè§„èŒƒä¹ˆï¼Ÿ</h3><ul>
<li>ä¸èƒ½æ˜¯ç©ºå­—ç¬¦ä¸²</li>
<li>ä¸èƒ½å«æœ‰.ã€â€™â€™ã€*ã€/ã€\ã€&lt;ã€&gt;ã€:ã€?ã€$ã€\0ã€‚å»ºè®®åªä½¿ç”¨ASCIIç ä¸­å­—æ¯å’Œæ•°å­—</li>
<li>æ•°æ®åº“ååŒºåˆ†å¤§å°å†™</li>
<li>æ•°æ®åº“åé•¿åº¦æœ€å¤šä¸º64å­—èŠ‚</li>
<li>é›†åˆåä¸èƒ½åŒ…å«\0å­—ç¬¦ï¼Œè¿™ä¸ªå­—ç¬¦è¡¨ç¤ºé›†åˆåçš„ç»“æŸ</li>
<li>é›†åˆåä¸èƒ½æ˜¯ç©ºå­—ç¬¦ä¸²â€â€</li>
<li>é›†åˆåä¸èƒ½ä½¿ç”¨ç³»ç»Ÿé›†åˆçš„ä¿ç•™å‰ç¼€â€system.â€</li>
<li>é›†ååä¸­ä¸å»ºè®®åŒ…å«å­—ç¬¦â€™$â€™ï¼Œè™½ç„¶å¾ˆå¤šé©±åŠ¨ç¨‹åºå¯ä»¥æ”¯æŒåŒ…å«æ­¤å­—ç¬¦çš„é›†åˆå</li>
</ul>
<h3 id="MongoDBæœ‰ç³»ç»Ÿä¿ç•™åº“åä¹ˆï¼Ÿ"><a href="#MongoDBæœ‰ç³»ç»Ÿä¿ç•™åº“åä¹ˆï¼Ÿ" class="headerlink" title="MongoDBæœ‰ç³»ç»Ÿä¿ç•™åº“åä¹ˆï¼Ÿ"></a>MongoDBæœ‰ç³»ç»Ÿä¿ç•™åº“åä¹ˆï¼Ÿ</h3><ul>
<li>admin</li>
<li>local</li>
<li>config</li>
</ul>
<h3 id="MongoDBæœ‰è¿æ¥æ± ä¹ˆï¼Ÿ"><a href="#MongoDBæœ‰è¿æ¥æ± ä¹ˆï¼Ÿ" class="headerlink" title="MongoDBæœ‰è¿æ¥æ± ä¹ˆï¼Ÿ"></a>MongoDBæœ‰è¿æ¥æ± ä¹ˆï¼Ÿ</h3><p>MongoDBé©±åŠ¨ä¸­å…¶å®å·²ç»æ˜¯ä¸€ä¸ªç°æˆçš„è¿æ¥æ± äº†ï¼Œè€Œä¸”çº¿ç¨‹å®‰å…¨ã€‚è¿™ä¸ªå†…ç½®çš„è¿æ¥æ± é»˜è®¤åˆå§‹äº†100ä¸ªè¿æ¥ï¼Œæ¯ä¸€ä¸ªæ“ä½œï¼ˆå¢åˆ æ”¹æŸ¥ç­‰ï¼‰éƒ½ä¼šè·å–ä¸€ä¸ªè¿æ¥ï¼Œæ‰§è¡Œæ“ä½œåé‡Šæ”¾è¿æ¥ã€‚<br>ã€é¢˜å¤–è¯ã€‘è¯·åŠ¡å¿…è®°å¾—å…³é—­èµ„æºï¼Œå¹¶ä¸”è®¾ç½®åˆç†çš„æ± å­è¿æ¥æ•°å’Œè¶…æ—¶æ—¶é—´ã€‚</p>
<h3 id="å†…ç½®è¿æ¥æ± æœ‰å¤šä¸ªé‡è¦å‚æ•°ï¼Œåˆ†åˆ«æ˜¯"><a href="#å†…ç½®è¿æ¥æ± æœ‰å¤šä¸ªé‡è¦å‚æ•°ï¼Œåˆ†åˆ«æ˜¯" class="headerlink" title="å†…ç½®è¿æ¥æ± æœ‰å¤šä¸ªé‡è¦å‚æ•°ï¼Œåˆ†åˆ«æ˜¯"></a>å†…ç½®è¿æ¥æ± æœ‰å¤šä¸ªé‡è¦å‚æ•°ï¼Œåˆ†åˆ«æ˜¯</h3><ul>
<li>connectionsPerHostï¼šæ¯ä¸ªä¸»æœºç­”åº”çš„è¿æ¥æ•°ï¼ˆæ¯ä¸ªä¸»æœºçš„è¿æ¥æ± å¤§å°ï¼‰ï¼Œå½“è¿æ¥æ± è¢«ç”¨å…‰æ—¶ï¼Œä¼šè¢«é˜»å¡ä½ï¼Œé»˜è®¤å€¼ä¸º100</li>
<li>threadsAllowedToBlockForConnectionMultiplierï¼šçº¿ç¨‹é˜Ÿåˆ—æ•°ï¼Œå®ƒå’Œä¸Šé¢connectionsPerHostå€¼ç›¸ä¹˜çš„ç»“æœå°±æ˜¯çº¿ç¨‹é˜Ÿåˆ—æœ€å¤§å€¼ã€‚å¦‚æœè¿æ¥çº¿ç¨‹æ’æ»¡äº†é˜Ÿåˆ—å°±ä¼šæŠ›å‡ºâ€œOut of semaphores to get dbâ€é”™è¯¯ï¼Œé»˜è®¤å€¼ä¸º5ï¼Œåˆ™æœ€å¤šæœ‰500ä¸ªçº¿ç¨‹å¯ä»¥ç­‰å¾…è·å–è¿æ¥</li>
<li>maxWaitTime: è¢«é˜»å¡çº¿ç¨‹ä»è¿æ¥æ± è·å–è¿æ¥çš„æœ€é•¿ç­‰å¾…æ—¶é—´(ms)ã€‚é»˜è®¤å€¼ä¸º120,000</li>
<li>connectTimeoutï¼šåœ¨å»ºç«‹ï¼ˆæ‰“å¼€ï¼‰å¥—æ¥å­—è¿æ¥æ—¶çš„è¶…æ—¶æ—¶é—´ï¼ˆmsï¼‰ã€‚é»˜è®¤å€¼ä¸º10,000</li>
<li>socketTimeoutï¼šå¥—æ¥å­—è¶…æ—¶æ—¶é—´ï¼ˆmsï¼‰ã€‚é»˜è®¤å€¼ä¸º0ï¼Œæ— é™åˆ¶ï¼ˆinfiniteï¼‰</li>
<li>autoConnectRetryï¼šè¿™ä¸ªæ§åˆ¶æ˜¯å¦åœ¨è¿æ¥æ—¶ï¼Œä¼šè‡ªåŠ¨é‡è¯•ï¼Œ2.13é©±åŠ¨å·²ç»ã€åºŸå¼ƒã€‘ï¼Œè¯·ä½¿ç”¨connectTimeoutä»£æ›¿å®ƒ</li>
</ul>
<p>è¿æ¥æ± çš„MaximumPoolSizeè¦æœ‰ä¸ªåˆç†å€¼ï¼Œå¦åˆ™è¿™ä¸ªå€¼æ•°æ®é‡çš„è¿æ¥éƒ½è¢«å ç”¨ï¼Œåé¢å†æœ‰æ–°çš„è¿æ¥åˆ›å»ºæ—¶å°±è¦ç­‰å¾…äº†ï¼Œè€Œä¸èƒ½è¶…å‡ºæ± ä¸Šé™æ–°å»ºè¿æ¥ã€‚é™¤æ­¤ä¹‹å¤–è¿˜è¦è®¾ç½®åˆç†çš„è¿æ¥ç­‰å¾…ï¼Œè¿æ¥è¶…æ—¶æ—¶é—´ï¼Œä»¥é˜²æ­¢ä¸€ä¸ªè¿æ¥å ç”¨æ—¶é—´è¿‡é•¿ï¼Œå½±å“å…¶å®ƒè¿æ¥è¯·æ±‚ã€‚</p>
<h3 id="connectTimeout-å’Œ-socketTimeout-çš„åŒºåˆ«"><a href="#connectTimeout-å’Œ-socketTimeout-çš„åŒºåˆ«" class="headerlink" title="connectTimeout å’Œ socketTimeout çš„åŒºåˆ«"></a>connectTimeout å’Œ socketTimeout çš„åŒºåˆ«</h3><p>ä¸€æ¬¡å®Œæ•´çš„è¯·æ±‚åŒ…æ‹¬ä¸‰ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li>å»ºç«‹è¿æ¥</li>
<li>æ•°æ®ä¼ è¾“</li>
<li>æ–­å¼€è¿æ¥</li>
</ul>
<p>å¦‚æœä¸æœåŠ¡å™¨(è¿™é‡ŒæŒ‡æ•°æ®åº“)è¯·æ±‚å»ºç«‹è¿æ¥çš„æ—¶é—´è¶…è¿‡ConnectTimeoutï¼Œå°±ä¼šæŠ› ConnectionTimeOutExceptionï¼Œå³æœåŠ¡å™¨è¿æ¥è¶…æ—¶ï¼Œæ²¡æœ‰åœ¨è§„å®šçš„æ—¶é—´å†…å»ºç«‹è¿æ¥ã€‚<br>å¦‚æœä¸æœåŠ¡å™¨è¿æ¥æˆåŠŸï¼Œå°±å¼€å§‹æ•°æ®ä¼ è¾“äº†ã€‚<br>å¦‚æœæœåŠ¡å™¨å¤„ç†æ•°æ®ç”¨æ—¶è¿‡é•¿ï¼Œè¶…è¿‡äº†SocketTimeOutï¼Œå°±ä¼šæŠ›å‡ºSocketTimeOutExceptinï¼Œå³æœåŠ¡å™¨å“åº”è¶…æ—¶ï¼ŒæœåŠ¡å™¨æ²¡æœ‰åœ¨è§„å®šçš„æ—¶é—´å†…è¿”å›ç»™å®¢æˆ·ç«¯æ•°æ®ã€‚</p>
<p>æ‰€ä»¥è¿™è¯¥æ­»çš„è¶…æ—¶è¯¥æ€ä¹ˆé…ï¼Ÿ<br>è¿™é‡Œæœ‰ä¸€ä»½å›½å¤–å†™çš„å…³äºè¶…æ—¶çš„å»ºè®®ï¼š<br><a href="http://blog.mongolab.com/2013/10/do-you-want-a-timeout/" target="_blank" rel="noopener">http://blog.mongolab.com/2013/10/do-you-want-a-timeout/</a><br>ä¸Šæ–‡ç»™å‡ºçš„é€šå¸¸æƒ…å†µä¸‹ï¼šconnectTimeout=5000ï¼ŒsocketTimeout=0</p>
<h3 id="å…³äºWriteConcern"><a href="#å…³äºWriteConcern" class="headerlink" title="å…³äºWriteConcern"></a>å…³äºWriteConcern</h3><p>MongoDBæä¾›äº†ä¸€ä¸ªé…ç½®å‚æ•°ï¼šwrite concern æ¥è®©ç”¨æˆ·è‡ªå·±è¡¡é‡æ€§èƒ½å’Œå†™å®‰å…¨ã€‚åˆ†å¸ƒå¼æ•°æ®åº“ä¸­è¿™æ ·çš„å‚æ•°æ¯”è¾ƒå¸¸è§ï¼Œè®°å¾—Cassandraä¸­ä¹Ÿæœ‰ä¸€ä¸ªç±»ä¼¼å‚æ•°ï¼Œä¸è¿‡é‚£ä¸ªå¥½åƒæ˜¯è¦å†™å…¥å‡ ä¸ªèŠ‚ç‚¹è¿”å›æˆåŠŸã€‚å…¶å®é“ç†éƒ½ä¸€æ ·åˆ†å¸ƒå¼çš„é›†ç¾¤ç¯å¢ƒè€ƒè™‘åˆ°æ€§èƒ½å› ç´ ä¸èƒ½ç¡®ä¿æ¯ä¸ªæˆå‘˜éƒ½å†™å…¥ååœ¨è¿”å›æˆåŠŸï¼Œæ‰€ä»¥åªèƒ½äº¤ç»™ç”¨æˆ·æ ¹æ®å®é™…åœºæ™¯è¡¡é‡ã€‚</p>
<ul>
<li>Unacknowledged</li>
<li>è¿™ä¸ªçº§åˆ«ä¹Ÿå±äºæ¯”è¾ƒä½çš„çº§åˆ«ï¼Œä»¥å‰è¿™ä¸ªçº§åˆ«æ˜¯é©±åŠ¨é…ç½®çš„é»˜è®¤çº§åˆ«ï¼Œä¸è¿‡åæ¥è°ƒæ•´æˆAcknowledgedçº§åˆ«ã€‚åœ¨è¿™ä¸ªçº§åˆ«ä¸‹ï¼Œè¿™ä¸ªé©±åŠ¨ä¼šæ ¹æ®å½“å‰ç³»ç»Ÿçš„ç½‘ç»œé…ç½®è¿›è¡Œç½‘ç»œé—®é¢˜çš„æ£€æµ‹ï¼Œä¸ç­‰å¾…Mongdçš„è¿”å›ã€‚ä»£ç æµ‹è¯•ï¼šæœ¬åœ°ç½‘ç»œé—®é¢˜æ˜¯å¦æœ‰å¼‚å¸¸ï¼Ÿæœ¬åœ°ç½‘ç»œæ— é—®é¢˜æ˜¯è¿œç¨‹serveré—®é¢˜æ˜¯å¦å¼‚å¸¸ï¼Ÿ</li>
<li>Acknowledged</li>
<li>è¿™ä¸ªçº§åˆ«ç®—æ˜¯ä¸­ç­‰çº§åˆ«çš„é…ç½®ï¼Œè¿™ä¸ªçº§åˆ«èƒ½å¤Ÿæ‹¿åˆ°mongodçš„è¿”å›ä¿¡æ¯ï¼šdupkey Errorï¼Œä»¥åŠä¸€äº›å…¶ä»–çš„é—®é¢˜ã€‚ç°åœ¨è¿™ä¸ªçº§åˆ«æ˜¯é©±åŠ¨çš„é»˜è®¤çº§åˆ«ï¼Œä¼°è®¡æ˜¯10genå…¬å¸å‘ç°å¥½å¤šäººè¯„ä»·Mongodbä¸é è°±åæ”¹çš„ã€‚ä¸€èˆ¬ç³»ç»Ÿè¿™ä¸ªçº§åˆ«ä¹Ÿå°±å¤Ÿç”¨äº†ã€‚ç”±äºé»˜è®¤çº§åˆ«æ˜¯Acknowledgedï¼Œå†…éƒ¨ç”¨getLastErroræ–¹æ³•æ£€æŸ¥æ˜¯å¦å†™å…¥æˆåŠŸçš„æ—¶å€™æ˜¯ä¹Ÿä¸ç”¨è®¾ç½®ä»»ä½•å‚æ•°ï¼Œå¯¹ä¸Replsetæ¥è¯´å¯ä»¥åœ¨é…ç½®ä¸­è¿›è¡ŒgetLastErrorDefaultsçš„é…ç½®ï¼Œå¦‚æœæ²¡æœ‰çš„è¯é»˜è®¤åˆ™æ˜¯Masteræ”¶åˆ°å°±okã€‚</li>
<li>Journaled</li>
<li>ç­‰åˆ°æ“ä½œè®°å½•åˆ°Journal Logä¸­æ‰è¿”å›æ“ä½œç»“æœï¼Œä¹Ÿå°±æ˜¯ä¸‹ä¸€æ¬¡JournaledLogæäº¤ã€‚è¿™ç§æƒ…å†µå¯ä»¥å®¹å¿æœåŠ¡å™¨çªç„¶å®•æœºï¼Œæ–­ç”µç­‰æ„å¤–çš„æ¢å¤ã€‚å‡ºå»ä¸Šè¾¹çš„é…ç½®è¿˜è¦åœ¨å¯åŠ¨mongodçš„æ—¶å€™åŠ ä¸Šjournaling å‚æ•°ç¡®ä¿å¯ä»¥ä½¿ç”¨ã€‚commitlogæäº¤é—´éš”æ—¶é—´æ˜¯å¯ä»¥é…ç½®çš„ï¼Œå•ç£ç›˜è®¾å¤‡ï¼ˆphysical volume, RAID device, or LVM volumeï¼‰æ¯100msæäº¤ä¸€æ¬¡ï¼Œå’Œæ•°æ®æ–‡ä»¶åˆ·å‡ºç›¸åŒé¢‘ç‡ï¼Œæ—¥å¿—å’Œæ•°æ®åˆ†å¼€ç£ç›˜è®¾å¤‡çš„30msæäº¤ä¸€æ¬¡ã€‚åœ¨æ’å…¥æ•°æ®æ˜¯å¦‚æœä½¿ç”¨{j:true}åˆ™ä¼šç¼©çŸ­åˆ°å·²é…ç½®çš„é»˜è®¤è®¾ç½®1/3çš„æ—¶é—´ã€‚</li>
<li>Replica Acknowledged</li>
<li>åœ¨å‰¯æœ¬é›†ä¸­å¦‚æœwè®¾ç½®ä¸º2çš„è¯åˆ™è‡³å°‘å·²ç»å¸å…¥åˆ°ä¸€ä¸ªsecondaryä¸­ï¼Œæˆ‘çŒœæµ‹å†™å…¥secondaryè¿™ä¸ªçº§åˆ«æ˜¯Acknowledgedçº§åˆ«ï¼Œmajorityæ˜¯å¤šä¸ªsecondaryå·²ç»å†™å…¥ã€‚å¦‚æœæ‰‹è´±è®¾ç½®wå‚æ•°å¤§äºreplsetä¸­éœ€è¦å¤åˆ¶çš„secondarysçš„è¯ï¼Œæ“ä½œå°±ä¸€ç›´ç­‰å¾…ç›´åˆ°è¾¾åˆ°å·²å†™å…¥æ•°æ®çš„æœåŠ¡å™¨æ•°é‡ç¬¦åˆè¦æ±‚ï¼Œä¹Ÿå¯ä»¥è®¾ç½®timeoutå€¼æ¥æŒ‡æ˜æœ€é•¿ç­‰å¾…æ—¶é—´ã€‚{ getLastError: 1, w: 2, wtimeout:5000 }</li>
</ul>
<h3 id="MongoDBçš„é”æœºåˆ¶"><a href="#MongoDBçš„é”æœºåˆ¶" class="headerlink" title="MongoDBçš„é”æœºåˆ¶"></a>MongoDBçš„é”æœºåˆ¶</h3><p>MongoDBçš„é”æœºåˆ¶å’Œä¸€èˆ¬å…³ç³»æ•°æ®åº“å¦‚ MySQLï¼ˆInnoDBï¼‰, Oracle æœ‰å¾ˆå¤§çš„å·®å¼‚ï¼ŒInnoDB å’Œ Oracle èƒ½æä¾›è¡Œçº§ç²’åº¦é”ï¼Œè€Œ MongoDB v2 åªèƒ½æä¾›åº“çº§ç²’åº¦é”ï¼Œè¿™æ„å‘³ç€å½“ MongoDB ä¸€ä¸ªå†™é”å¤„äºå ç”¨çŠ¶æ€æ—¶ï¼Œå…¶å®ƒçš„è¯»å†™æ“ä½œéƒ½å¾—å¹²ç­‰ã€‚</p>
<p>åˆçœ‹èµ·æ¥åº“çº§é”åœ¨å¤§å¹¶å‘ç¯å¢ƒä¸‹æœ‰ä¸¥é‡çš„é—®é¢˜ï¼Œä½†æ˜¯ MongoDB ä¾ç„¶èƒ½å¤Ÿä¿æŒå¤§å¹¶å‘é‡å’Œé«˜æ€§èƒ½ï¼Œè¿™æ˜¯å› ä¸º MongoDB çš„é”ç²’åº¦è™½ç„¶å¾ˆç²—æ”¾ï¼Œä½†æ˜¯åœ¨é”å¤„ç†æœºåˆ¶å’Œå…³ç³»æ•°æ®åº“é”æœ‰å¾ˆå¤§å·®å¼‚ï¼Œä¸»è¦è¡¨ç°åœ¨</p>
<ul>
<li>MongoDB æ²¡æœ‰å®Œæ•´äº‹åŠ¡æ”¯æŒï¼Œæ“ä½œåŸå­æ€§åªåˆ°å•ä¸ª document çº§åˆ«ï¼Œæ‰€ä»¥é€šå¸¸æ“ä½œç²’åº¦æ¯”è¾ƒå°ï¼›</li>
<li>MongoDB é”å®é™…å ç”¨æ—¶é—´æ˜¯å†…å­˜æ•°æ®è®¡ç®—å’Œå˜æ›´æ—¶é—´ï¼Œé€šå¸¸å¾ˆå¿«ï¼›</li>
<li>MongoDB é”æœ‰ä¸€ç§ä¸´æ—¶æ”¾å¼ƒæœºåˆ¶ï¼Œå½“å‡ºç°éœ€è¦ç­‰å¾…æ…¢é€Ÿ IO è¯»å†™æ•°æ®æ—¶ï¼Œå¯ä»¥å…ˆä¸´æ—¶æ”¾å¼ƒï¼Œç­‰ IO å®Œæˆä¹‹åå†é‡æ–°è·å–é”ã€‚</li>
</ul>
<p>é€šå¸¸ä¸å‡ºé—®é¢˜ä¸ç­‰äºæ²¡æœ‰é—®é¢˜ï¼Œå¦‚æœæ•°æ®æ“ä½œä¸å½“ï¼Œä¾ç„¶ä¼šå¯¼è‡´é•¿æ—¶é—´å ç”¨å†™é”ï¼Œæ¯”å¦‚ä¸‹é¢æåˆ°çš„å‰å°å»ºç´¢å¼•æ“ä½œï¼Œå½“å‡ºç°è¿™ç§æƒ…å†µçš„æ—¶å€™ï¼Œæ•´ä¸ªæ•°æ®åº“å°±å¤„äºå®Œå…¨é˜»å¡çŠ¶æ€ï¼Œæ— æ³•è¿›è¡Œä»»ä½•è¯»å†™æ“ä½œï¼Œæƒ…å†µååˆ†ä¸¥é‡ã€‚</p>
<p>è§£å†³é—®é¢˜çš„æ–¹æ³•ï¼Œå°½é‡é¿å…é•¿æ—¶é—´å ç”¨å†™é”æ“ä½œï¼Œå¦‚æœæœ‰ä¸€äº›é›†åˆæ“ä½œå®åœ¨éš¾ä»¥é¿å…ï¼Œå¯ä»¥è€ƒè™‘æŠŠè¿™ä¸ªé›†åˆæ”¾åˆ°ä¸€ä¸ªå•ç‹¬çš„ MongoDB åº“é‡Œï¼Œå› ä¸º MongoDB ä¸åŒåº“é”æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œåˆ†ç¦»é›†åˆå¯ä»¥é¿å…æŸä¸€ä¸ªé›†åˆæ“ä½œå¼•å‘å…¨å±€é˜»å¡é—®é¢˜ã€‚</p>
<h3 id="å»ºç´¢å¼•å¯¼è‡´æ•°æ®åº“é˜»å¡"><a href="#å»ºç´¢å¼•å¯¼è‡´æ•°æ®åº“é˜»å¡" class="headerlink" title="å»ºç´¢å¼•å¯¼è‡´æ•°æ®åº“é˜»å¡"></a>å»ºç´¢å¼•å¯¼è‡´æ•°æ®åº“é˜»å¡</h3><p>ä¸Šé¢æåˆ°äº† MongoDB åº“çº§é”çš„é—®é¢˜ï¼Œå»ºç´¢å¼•å°±æ˜¯ä¸€ä¸ªå®¹æ˜“å¼•èµ·é•¿æ—¶é—´å†™é”çš„é—®é¢˜ï¼ŒMongoDB åœ¨å‰å°å»ºç´¢å¼•æ—¶éœ€è¦å ç”¨ä¸€ä¸ªå†™é”ï¼ˆè€Œä¸”ä¸ä¼šä¸´æ—¶æ”¾å¼ƒï¼‰ï¼Œå¦‚æœé›†åˆçš„æ•°æ®é‡å¾ˆå¤§ï¼Œå»ºç´¢å¼•é€šå¸¸è¦èŠ±æ¯”è¾ƒé•¿æ—¶é—´ï¼Œç‰¹åˆ«å®¹æ˜“å¼•èµ·é—®é¢˜ã€‚</p>
<p>è§£å†³çš„æ–¹æ³•å¾ˆç®€å•ï¼ŒMongoDB æä¾›äº†ä¸¤ç§å»ºç´¢å¼•çš„è®¿é—®ï¼Œä¸€ç§æ˜¯ background æ–¹å¼ï¼Œä¸éœ€è¦é•¿æ—¶é—´å ç”¨å†™é”ï¼Œå¦ä¸€ç§æ˜¯é background æ–¹å¼ï¼Œéœ€è¦é•¿æ—¶é—´å ç”¨é”ã€‚ä½¿ç”¨ background æ–¹å¼å°±å¯ä»¥è§£å†³é—®é¢˜ã€‚<br>ä¾‹å¦‚ï¼Œä¸ºè¶…å¤§è¡¨ posts å»ºç«‹ç´¢å¼•</p>
<pre><code>//åƒä¸‡ä¸ç”¨ä½¿ç”¨
db.posts.ensureIndex({user_id: 1})
//è€Œåº”è¯¥ä½¿ç”¨
db.posts.ensureIndex({user_id: 1}, {background: 1})
</code></pre><p><a href="http://www.111com.net/database/165981.htm" target="_blank" rel="noopener">http://www.111com.net/database/165981.htm</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/04/ffmpegçš„ä½¿ç”¨/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Airthink">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Airthink">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/04/ffmpegçš„ä½¿ç”¨/" itemprop="url">ffmpegçš„ä½¿ç”¨</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2020-04-04T08:22:08+08:00">
                2020-04-04
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="è§†é¢‘æ ¼å¼å°ç§‘æ™®"><a href="#è§†é¢‘æ ¼å¼å°ç§‘æ™®" class="headerlink" title="è§†é¢‘æ ¼å¼å°ç§‘æ™®"></a>è§†é¢‘æ ¼å¼å°ç§‘æ™®</h2><p>åœ¨å¼€å§‹ä¸‹é¢çš„æ•™ç¨‹ä¹‹å‰æœ‰å¿…è¦å…ˆç®€å•ç§‘æ™®ä¸€ä¸‹è§†é¢‘æ ¼å¼çš„çŸ¥è¯†ã€‚</p>
<p>è§†é¢‘æ ¼å¼æ˜¯ä¸€ç§éå¸¸ä¸ä¸“ä¸šçš„å«æ³•ï¼Œäº‹å®ä¸Šï¼Œè§†é¢‘æœ‰ç¼–ç æ ¼å¼å’Œå®¹å™¨æ ¼å¼ä¸¤ç§ã€‚ç¼–ç æ ¼å¼ä¹‹äºå®¹å™¨æ ¼å¼å°±åƒç‰›å¥¶ä¹‹äºæ¯å­ä¸€æ ·ã€‚ å¸¸è§çš„è§†é¢‘æ–‡ä»¶æœ‰mp4(mpeg4 part 14)ï¼Œmkvï¼Œflvç­‰ï¼Œè¿™äº›æ˜¯è§†é¢‘çš„å®¹å™¨æ ¼å¼/å°è£…æ ¼å¼(Container format)ã€‚å®ƒä»¬åŒ…å«è§†é¢‘æµå’ŒéŸ³é¢‘æµï¼Œmkvæ”¯æŒå¤šæ¡éŸ³è½¨å’Œå­—å¹•ï¼Œå› æ­¤æ˜¯ç›®å‰æœ€å—æ¬¢è¿çš„å®¹å™¨æ ¼å¼ã€‚æ¯”å¦‚åœ¨æ’­æ”¾mkvè§†é¢‘çš„æ—¶å€™ï¼Œå¯ä»¥é€‰æ‹©ä¸åŒè¯­è¨€çš„éŸ³è½¨/å­—å¹•ã€‚ è‡³äºè§†é¢‘ç¼–ç æ ¼å¼(Encoding format)ï¼Œåˆ™æ˜¯è¿™äº›å®¹å™¨æ‰€åŒ…å«çš„è§†é¢‘æµ/éŸ³é¢‘æµæ‰€é‡‡ç”¨çš„å‹ç¼©æ–¹å¼ï¼Œæ¯”å¦‚æœ€å¸¸ç”¨çš„h.264/aacï¼Œmpeg4/mpeg3ç­‰ã€‚</p>
<h3 id="å®‰è£…ffmpeg"><a href="#å®‰è£…ffmpeg" class="headerlink" title="å®‰è£…ffmpeg"></a>å®‰è£…ffmpeg</h3><p>åœ¨mac osä¸Šå®‰è£…ffmpegï¼š</p>
<p>brew install ffmpeg â€“with-fdk-aac â€“with-libass â€“with-sdl2<br>ä¸é»˜è®¤å®‰è£…ç›¸æ¯”ï¼Œè¿™é‡Œå¢åŠ äº†å¯¹fdk-aacéŸ³é¢‘åº“å’Œasså­—å¹•åº“çš„æ”¯æŒï¼ŒåŒæ—¶å®‰è£…äº†ffplayæ’­æ”¾å™¨ã€‚</p>
<p>åœ¨linuxä¸Šå®‰è£…ffmpegæœ€ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨å®˜æ–¹æä¾›çš„é™æ€ç¼–è¯‘å®‰è£…åŒ…ï¼Œè§£å‹åå³å¯ä½¿ç”¨ã€‚</p>
<p>ffmpegå‘½ä»¤é€šç”¨æ ¼å¼<br>å…ˆæ¥è®¤è¯†ä¸€ä¸‹ffmpegå‘½ä»¤è¡Œå·¥å…·çš„æ ¼å¼ï¼š</p>
<p><code>ffmpeg -global_options -input_1_options -i input_1 -input_2_options -i input_2 -output_1_options output_1</code> â€¦<br>ä¸ç®¡ä½ çœ‹åˆ°çš„ffmpegå‘½ä»¤å¤šä¹ˆå¤æ‚ï¼Œä¸‡å˜ä¸ç¦»å…¶å®—ï¼Œéƒ½å¯ä»¥æŒ‰ç…§è¿™ä¸ªæ ¼å¼æ‹†åˆ†æˆå‡ ä¸ªå•ç‹¬çš„éƒ¨åˆ†ï¼Œå„ä¸ªé€‰é¡¹çš„å«ä¹‰å¯ä»¥æŸ¥é˜…ffmpegçš„documentationã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š <em> è¾“å…¥è¾“å‡º </em> è‡³å°‘æœ‰ä¸€ä¸ªè¾“å…¥å’Œè¾“å‡º <em> å¯ä»¥åŒæ—¶æœ‰å¤šä¸ªè¾“å…¥å’Œè¾“å‡º </em> è¾“å…¥ã€è¾“å‡ºä¸ä¸€å®šæ˜¯æ–‡ä»¶ï¼Œå¯ä»¥æ˜¯rtmpæµçš„åœ°å€ã€æ‘„åƒå¤´å¯¹åº”çš„è®¾å¤‡æ–‡ä»¶ç­‰ <em> é¡ºåºå¾ˆé‡è¦ </em> æ‰€æœ‰çš„è¾“å…¥å®Œäº†ç„¶åæ˜¯è¾“å‡º * æŸä¸ªé€‰é¡¹åªå¯¹å®ƒåé¢çš„è¾“å…¥æˆ–è¾“å‡ºèµ·ä½œç”¨</p>
<h3 id="1ã€æŸ¥çœ‹è§†é¢‘çš„ä¿¡æ¯"><a href="#1ã€æŸ¥çœ‹è§†é¢‘çš„ä¿¡æ¯" class="headerlink" title="1ã€æŸ¥çœ‹è§†é¢‘çš„ä¿¡æ¯"></a>1ã€æŸ¥çœ‹è§†é¢‘çš„ä¿¡æ¯</h3><p><code>ffmpeg -hide_banner -i input.mkv  æˆ–è€…  ffprobe -hide_banner input.mkv</code></p>
<p>é€šè¿‡ffmpegå¯ä»¥æŸ¥çœ‹ä¸€ä¸ªè§†é¢‘æ–‡ä»¶çš„ä»¥ä¸‹åŸºæœ¬ä¿¡æ¯ï¼š</p>
<p>è§†é¢‘/éŸ³é¢‘çš„ç¼–ç æ ¼å¼<br>åˆ†è¾¨ç‡(1080p or 1080i, Progressive Interlaced)<br>æ—¶é•¿(duration)/ç ç‡(bitrate)/å¸§ç‡(fps,frames per second)<br>éŸ³è½¨(Audio)/å­—å¹•(Subtitle)</p>
<h3 id="2ã€è½¬ç -transcode"><a href="#2ã€è½¬ç -transcode" class="headerlink" title="2ã€è½¬ç (transcode)"></a>2ã€è½¬ç (transcode)</h3><p>è½¬ç æ˜¯æŒ‡å¯¹æµ(è§†é¢‘ã€éŸ³é¢‘å’Œå­—å¹•)è¿›è¡Œè§£ç ç„¶åå†ç¼–ç ï¼Œè¿™ä¸ªè¿‡ç¨‹éå¸¸è€—CPUã€‚è¾“å‡ºçš„ç¼–ç æ ¼å¼é€šè¿‡-codecæŒ‡å®šï¼Œå¦‚æœä¸æŒ‡å®šï¼Œffmpegå¹¶ä¸ä¼šç›´æ¥copyï¼Œè€Œæ˜¯é‡‡ç”¨æ ¹æ®å®¹å™¨æ ¼å¼é‡‡ç”¨ç›¸åº”çš„é»˜è®¤ç¼–ç æ ¼å¼è¿›è¡Œé‡æ–°ç¼–ç ã€‚</p>
<p>ä¸ºäº†ç®€å•èµ·è§ï¼ŒæŠŠè½¬æ¢å®¹å™¨æ ¼å¼ä¹Ÿå½’ä¸ºè½¬ç ï¼Œffmpegä¼šé€šè¿‡è¾“å‡ºæ–‡ä»¶çš„åç¼€åˆ¤æ–­è¾“å‡ºçš„å®¹å™¨æ ¼å¼ï¼Œå› æ­¤ä¸éœ€è¦æŒ‡å®š(-f)ã€‚</p>
<p>è§†é¢‘<br>å°†mkvè½¬æ¢æˆmp4</p>
<p>æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦å°†mkvè½¬æ¢æˆmp4ï¼š</p>
<p>å¾ˆå¤šè§†é¢‘ç½‘ç«™ä¸æ”¯æŒä¸Šä¼ mkvæ ¼å¼<br>å¤§éƒ¨åˆ†è§†é¢‘å‰ªè¾‘è½¯ä»¶ï¼Œæ¯”å¦‚premiereç­‰ä¸æ”¯æŒå¯¼å…¥mkvæ ¼å¼çš„è§†é¢‘<br>ä¸‹é¢çš„å‘½ä»¤å°†mkvçš„è§†é¢‘å’ŒéŸ³é¢‘æµé‡æ–°å°è£…æˆmp4æ–‡ä»¶ï¼Œä¸è¿›è¡Œé‡æ–°ç¼–ç (æ— æŸ)</p>
<p><code>ffmpeg -i input.mkv -codec copy output.mp4</code><br>åˆ¶ä½œmkv</p>
<p>mkvæ ¼å¼èƒ½å¤Ÿå°è£…å¤šä¸ªéŸ³é¢‘ã€å­—å¹•è½¨ï¼Œæ˜¯ç›®å‰æœ€ä¸ºæµè¡Œçš„è§†é¢‘åˆ†å‘æ ¼å¼ï¼Œé€šå¸¸ä½¿ç”¨mkvtoolnixå·¥å…·æ¥ç¼–è¾‘åˆ¶ä½œmkvè§†é¢‘ï¼Œé€šè¿‡ffmpegä¹Ÿèƒ½å®Œæˆä¸€äº›ç®€å•çš„ä»»åŠ¡ã€‚</p>
<p>å°†mpeg4/mp3ç¼–ç çš„è§†é¢‘é‡æ–°ç¼–ç ä¸ºh.264/aacï¼Œå¹¶å’Œå­—å¹•ä¸€èµ·å°è£…æˆmkvæ–‡ä»¶ï¼š</p>
<p><code>ffmpeg -i input.avi -i input.srt -map 0:0 -map 0:1 -map 1:0 -c:v libx264 -c:a aac -c:s srt output.mkv</code><br>è¿™é‡Œä½¿ç”¨ffmpegè‡ªå¸¦çš„aacéŸ³é¢‘ç¼–ç å™¨ï¼Œè€Œä¸æ˜¯fdkaacã€‚</p>
<p>éŸ³é¢‘<br>ffmpegä¸ä»…èƒ½å¤„ç†è§†é¢‘ï¼ŒéŸ³é¢‘æ–‡ä»¶ä¹Ÿä¸åœ¨è¯ä¸‹ï¼Œå› æ­¤ï¼ŒåŒæ ·å¯ä»¥ç”¨ffmpegè½¬æ¢éŸ³é¢‘æ ¼å¼ã€‚</p>
<p>å°†flacæ— æŸçš„éŸ³ä¹è½¬æ¢æˆé«˜è´¨é‡(High Qualityï¼Œå³320Kb)çš„mp3æ ¼å¼ï¼š</p>
<p><code>ffmpeg -i &quot;Michael Jackson - Billie Jean.flac&quot; -ab 320k &quot;Michael Jackson - Billie Jean.mp3&quot;</code></p>
<h3 id="3ã€æˆªå–-cut"><a href="#3ã€æˆªå–-cut" class="headerlink" title="3ã€æˆªå–(cut)"></a>3ã€æˆªå–(cut)</h3><p>ä»è§†é¢‘ä¸­æˆªå–å‡ºç²¾å½©ç‰‡æ®µæ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„åŠŸèƒ½ã€‚</p>
<p>ä»ç¬¬2åˆ†é’Ÿå¼€å§‹ï¼Œæˆªå–30ç§’ã€‚æ‰€æœ‰æµéƒ½ç›´æ¥æ‹·è´ã€‚</p>
<p><code>ffmpeg -ss 00:02:00.0 -i input.mkv -t 30 -c copy output.mkv</code><br>-ssè®¾ç½®å¼€å§‹æ—¶é—´ç‚¹ï¼Œæ ¼å¼æ˜¯HH:MM:SS.xxxæˆ–sec.msecã€‚å½“ä½œä¸ºè¾“å…¥é€‰é¡¹æ—¶ï¼Œå¯ä»¥å¿«é€Ÿseekåˆ°æŒ‡å®šæ—¶é—´ç‚¹ï¼› -tä½œä¸ºè¾“å‡ºé€‰é¡¹ï¼Œè®¾ç½®æ—¶é•¿ã€‚</p>
<p>æˆªå–æœ€å¤§çš„é—®é¢˜æ˜¯éš¾ä»¥åšåˆ°ç²¾ç¡®æ§åˆ¶æ—¶é—´ç‚¹ï¼Œå¤§éƒ¨åˆ†çš„è§†é¢‘å‰ªè¾‘è½¯ä»¶éƒ½å­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼š</p>
<p>è§†é¢‘å¼€å¤´å¡é¡¿/ä¸æµç•…ï¼Œç”»é¢ä¸å£°éŸ³ä¸åŒæ­¥<br>æ—¶é—´è¯¯å·®ç”šè‡³èƒ½è¾¾åˆ°ç§’çº§ï¼Œæ¯”å¦‚æˆªå–10ç§’çš„ç‰‡æ®µï¼Œå¯èƒ½ä¼šå¾—åˆ°12ç§’çš„è¾“å‡º<br>åŸå› æ˜¯ffmpegä¼šseekåˆ°æŒ‡å®šæ—¶é—´ç‚¹å‰çš„ä¸€ä¸ªå…³é”®å¸§ï¼Œå¦‚æœæ˜¯copyè§†é¢‘æµï¼Œseekç‚¹å’Œèµ·ç‚¹ä¹‹é—´çš„é¢å¤–éƒ¨åˆ†å°†ä¼šè¢«ä¿ç•™ï¼Œå› æ­¤å°±äº§ç”Ÿäº†è¯¯å·®ã€‚è§£å†³åŠæ³•æ˜¯å°†-ssä½œä¸ºè¾“å‡ºé€‰é¡¹æˆ–è¿›è¡Œé‡æ–°ç¼–ç ï¼š</p>
<p><code>ffmpeg -i input.mkv -ss 00:02:00.0 -t 30 -c copy output.mkv</code><br>-ssä½œä¸ºè¾“å‡ºé€‰é¡¹æ—¶ï¼Œè§£ç åˆ°æŒ‡å®šçš„æ—¶é—´ç‚¹ï¼Œç„¶åå¼€å§‹è¾“å‡ºï¼Œç›¸å½“äºè¦æ‰«æå‰é¢çš„æ‰€æœ‰å¸§ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼èƒ½è·å¾—æ›´ç²¾ç¡®çš„è¾“å‡ºã€‚</p>
<p>å¦‚æœè¿˜æ˜¯å‡ºç°ä¸Šè¿°é—®é¢˜ï¼Œä½¿ç”¨ä¸‹é¢çš„ç»ˆæè§£å†³æ–¹æ¡ˆ(ä½¿ç”¨ä¸¤æ¬¡seek)ï¼š</p>
<p><code>ffmpeg -ss 00:01:30.0 -i input.mkv -ss 00:00:30.0 -t 30 output.mkv</code></p>
<h3 id="4ã€æˆªå›¾-screenshot"><a href="#4ã€æˆªå›¾-screenshot" class="headerlink" title="4ã€æˆªå›¾(screenshot)"></a>4ã€æˆªå›¾(screenshot)</h3><p>æˆªå›¾å°±æ˜¯å°†æŸä¸ªè§†é¢‘å¸§ä¿å­˜ä¸ºå›¾ç‰‡ï¼Œä¾‹å¦‚ï¼š</p>
<p>åœ¨æŒ‡å®šæ—¶é—´ç‚¹æˆªå›¾</p>
<p><code>ffmpeg -ss 00:30:14.435 -i input.mkv -vframes 1 out.png</code></p>
<ul>
<li>-ssä½œä¸ºè¾“å…¥é€‰é¡¹ï¼Œå¯ä»¥å¿«é€Ÿå®šä½åˆ°æŒ‡å®šæ—¶é—´ç‚¹ï¼›å¦‚æœä½œä¸ºè¾“å‡ºé€‰é¡¹ï¼Œéœ€è¦è¯»å–æŒ‡å®šæ—¶é—´ç‚¹å‰é¢æ‰€æœ‰çš„å¸§ï¼Œä½†å¯ä»¥è·å¾—æ›´ç²¾ç¡®çš„ä½ç½®ã€‚ * -vframesè®¾ç½®è¾“å‡ºçš„å¸§æ•°ã€‚</li>
</ul>
<p>ç»“åˆfpsè§†é¢‘æ»¤é•œï¼Œå¯ä»¥ä»è§†é¢‘ä¸­æˆªå–å¤šå¼ å›¾ç‰‡ã€‚ä¾‹å¦‚ï¼š</p>
<p>æ¯1åˆ†é’Ÿæˆªä¸€å¼ å›¾ï¼Œåœ¨æˆªå›¾æ–‡ä»¶åä¸­æ·»åŠ å½“å‰çš„æ—¶é—´</p>
<p><code>ffmpeg -i input.mkv -vf fps=1/60 -strftime 1 out_%Y%m%d%H%M%S.jpg</code></p>
<h3 id="5ã€å‹ç¼©-compress"><a href="#5ã€å‹ç¼©-compress" class="headerlink" title="5ã€å‹ç¼©(compress)"></a>5ã€å‹ç¼©(compress)</h3><p>ä¸€å¼ è“å…‰åŸç›˜æ¥è¿‘50Gï¼Œè€Œ720pçš„ç”µå½±å¯èƒ½åªæœ‰2Gï¼Œè¿™æ˜¯é€šè¿‡å‹ç¼©å®ç°çš„ã€‚åœ¨ä¿è¯ç”»è´¨çš„å‰æä¸‹ä½¿ç”¨æ›´å°çš„æ–‡ä»¶å­˜å‚¨ï¼Œä¸€ç›´æ˜¯å‹ç¼©çš„ç›®æ ‡ã€‚ç„¶è€Œå‹ç¼©å¹¶éé‚£ä¹ˆç®€å•ï¼Œæ¯”å¦‚åŒæ ·æ˜¯720pçš„ç”µå½±ï¼Œæœ‰çš„åªæœ‰2ä¸ªGï¼Œæœ‰çš„å´æœ‰5ä¸ªGï¼Œç„¶è€Œä»è§†è§‰ä¸Šå‡ ä¹çœ‹ä¸å‡ºåŒºåˆ«æ¥ã€‚ è¿™é‡Œåªä»‹ç»å‹ç¼©çš„ä¸€ä¸ªç®€å•ç”¨é€”ï¼šresizeã€‚</p>
<p>å°†1080pè½¬æˆ720pï¼Œå®½åº¦è‡ªé€‚åº”</p>
<p><code>ffmpeg -i input.mkv -c copy -c:v libx264 -vf scale=-2:720 output.mkv</code><br>-vfæ˜¯-filter:vçš„ç®€å†™ï¼Œ-filteræŒ‡å®šæ»¤é•œï¼Œ:væ˜¯æµé€‰æ‹©å™¨ï¼Œè¡¨ç¤ºå¯¹è§†é¢‘æµåº”ç”¨æ»¤é•œã€‚scaleæ»¤é•œåé¢çš„å‚æ•°æ˜¯w:hï¼Œwå’Œhå¯ä»¥åŒ…å«ä¸€äº›å˜é‡ï¼Œæ¯”å¦‚åŸå§‹çš„å®½é«˜åˆ†åˆ«ä¸ºiwå’Œihã€‚å½“å…¶ä¸­ä¸€ä¸ªæ˜¯è´Ÿæ•°æ—¶ï¼Œå‡è®¾ä¸º-nï¼Œffmpegè‡ªåŠ¨ä½¿ç”¨å¦ä¸€ä¸ªå€¼æŒ‰ç…§åŸå§‹çš„å®½é«˜æ¯”(aspect ratio)è®¡ç®—å‡ºè¯¥å€¼ï¼Œå¹¶ä¸”ä¿è¯è®¡ç®—å‡ºæ¥çš„å€¼èƒ½è¢«næ•´é™¤ã€‚</p>
<p>å› ä¸ºscaleæ»¤é•œæ˜¯é’ˆå¯¹æœªç¼–ç çš„åŸå§‹æ•°æ®ï¼Œæ‰€ä»¥è§†é¢‘æµä¸èƒ½ç”¨copyï¼Œéœ€è¦è¿›è¡Œé‡æ–°ç¼–ç ã€‚-c copy -c:v libx264è¡¨ç¤ºè§†é¢‘æµä½¿ç”¨h.264é‡æ–°ç¼–ç ï¼Œå…¶ä»–æµç›´æ¥copyï¼Œé¡ºåºä¸èƒ½é¢ å€’ã€‚</p>
<h3 id="6ã€å­—å¹•-subtitle"><a href="#6ã€å­—å¹•-subtitle" class="headerlink" title="6ã€å­—å¹•(subtitle)"></a>6ã€å­—å¹•(subtitle)</h3><p>å¯¹äºè§†é¢‘å‘å¸ƒè€…ï¼Œç»™è§†é¢‘æ·»åŠ å­—å¹•å¾ˆæœ‰å¿…è¦ã€‚å¦‚æœæ˜¯mkvï¼Œå¯ä»¥é‡‡ç”¨åˆ¶ä½œmkvçš„æ–¹æ³•å°†å­—å¹•æ–‡ä»¶å°è£…åˆ°mkvæ–‡ä»¶é‡Œã€‚å¦‚æœæ˜¯mp4è§†é¢‘ï¼Œåˆ™éœ€è¦è¿›è¡Œçƒ§å½•(draw)ï¼Œå³å¯¹è§†é¢‘é‡æ–°ç¼–ç çš„è¿‡ç¨‹ä¸­å°†å­—å¹•èå…¥è§†é¢‘æµã€‚</p>
<p><code>ffmpeg -i input.mkv -vf subtitles=input.srt output.mp4</code><br>è¯¥è¿‡ç¨‹æ˜¯é€šè¿‡subtitlesæ»¤é•œå®Œæˆçš„ï¼Œå®‰è£…ffmpegçš„æ—¶å€™éœ€è¦å¯ç”¨libassåº“ã€‚subtitlesçš„å‚æ•°æ˜¯å­—å¹•æ–‡ä»¶ï¼Œå¦‚æœæ˜¯mkvæ–‡ä»¶åˆ™è¡¨ç¤ºä½¿ç”¨mkvçš„é»˜è®¤å­—å¹•æµã€‚</p>
<p>å¦‚æœæ˜¯assæ ¼å¼çš„å­—å¹•æ–‡ä»¶ï¼Œåˆ™ä½¿ç”¨assæ»¤é•œï¼š</p>
<p><code>ffmpeg -i input.mkv -vf ass=input.ass output.mp4</code><br>æ®æˆ‘æ‰€çŸ¥ï¼Œé€šå¸¸asså­—å¹•å…·æœ‰æ›´ä¸°å¯Œçš„æ ·å¼ã€‚</p>
<p>å¦ä¸€ç§å¸¸è§çš„æ–¹æ³•æ˜¯ä½¿ç”¨-c:s mov_textå°†å­—å¹•æµå°è£…è¿›mp4é‡Œï¼Œå®ƒä¸éœ€è¦é‡æ–°ç¼–ç ï¼Œä½†æ˜¯ç›®å‰å¤§éƒ¨åˆ†æ’­æ”¾å™¨å¯¹mp4çš„è½¯å­—å¹•æ”¯æŒä¸å¥½ã€‚</p>
<h3 id="7ã€æå–-extract"><a href="#7ã€æå–-extract" class="headerlink" title="7ã€æå–(extract)"></a>7ã€æå–(extract)</h3><p>æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦ä»ç”µå½±ä¸­æå–æ’æ›²æˆ–ä»è§†é¢‘ä¸­æå–èƒŒæ™¯éŸ³ä¹ï¼Œé€šè¿‡ffmpegå¯ä»¥å¾ˆå®¹æ˜“ä»è§†é¢‘æ–‡ä»¶ä¸­æå–éŸ³é¢‘ï¼š</p>
<p><code>ffmpeg -i cut.mp4 -vn output.mp3</code><br>-vnè¡¨ç¤ºä¸è¾“å‡ºè§†é¢‘æµã€‚</p>
<p>è¾“å‡ºçš„mp3é»˜è®¤çš„ç ç‡æ˜¯128kbï¼Œå¯ä»¥ä½¿ç”¨abæ§åˆ¶ã€‚ç»“åˆæˆªå–ä¸­çš„-sså’Œ-tè¿˜å¯ä»¥åªæå–ä¸€ä¸ªéƒ¨åˆ†çš„éŸ³é¢‘ã€‚</p>
<p>ä»mkvæ–‡ä»¶ä¸­æå–å­—å¹•ä¹Ÿæ˜¯åŒæ ·çš„æ–¹æ³•ã€‚</p>
<h3 id="8ã€æ°´å°-watermark"><a href="#8ã€æ°´å°-watermark" class="headerlink" title="8ã€æ°´å°(watermark)"></a>8ã€æ°´å°(watermark)</h3><p>ç»™è§†é¢‘æ·»åŠ æ°´å°æ˜¯é€šè¿‡overlayæ»¤é•œå®ç°çš„ï¼Œoverlayæ»¤é•œçš„ä½œç”¨æ˜¯å°†ä¸€ä¸ªè§†é¢‘è¦†ç›–å¦ä¸€ä¸ªè§†é¢‘ä¸Šé¢ï¼Œå®ƒæœ‰ä¸¤ä¸ªè¾“å…¥ï¼Œå‰ä¸€ä¸ªæ˜¯ä¸‹å±‚(main)ï¼Œåä¸€ä¸ªæ˜¯ä¸Šå±‚(overlaid)ã€‚ overlayçš„å‚æ•°x:yæ˜¯ä¸Šå±‚å·¦ä¸Šè§’çš„åæ ‡ï¼Œ0:0è¡¨ç¤ºä½äºä¸‹å±‚çš„å·¦ä¸Šè§’ã€‚å®ƒå¯ä»¥åŒ…å«ä»¥ä¸‹å‚æ•°ï¼š</p>
<p>W(w):ä¸‹(ä¸Š)å±‚çš„å®½<br>H(h):ä¸‹(ä¸Š)å±‚çš„é«˜<br>å°†æ°´å°/logoæ·»åŠ åˆ°è§†é¢‘çš„å³ä¸Šè§’ï¼Œå¹¶ä¸”å’Œè¾¹ç¼˜ä¿æŒ5åƒç´ çš„è·ç¦»ï¼š</p>
<p><code>ffmpeg -i input.mkv -i input.png -filter_complex &quot;overlay=W-w-5:5&quot; -c copy -c:v libx264 output.mkv</code><br>input.pngæ˜¯å¸¦é€æ˜èƒŒæ™¯çš„logoï¼Œä½œä¸ºä¸Šå±‚ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè§†é¢‘éœ€è¦é‡æ–°ç¼–ç ï¼Œå…¶ä»–æµ(éŸ³é¢‘ã€å­—å¹•)åˆ™ç›´æ¥copyï¼Œé¡ºåºä¸èƒ½é¢ å€’ã€‚</p>
<h3 id="9ã€æ··æµ-Muxing"><a href="#9ã€æ··æµ-Muxing" class="headerlink" title="9ã€æ··æµ(Muxing)"></a>9ã€æ··æµ(Muxing)</h3><p>å¦‚æœæˆ‘ä»¬æ‹æ‘„äº†ä¸€æ®µè§†é¢‘ï¼Œæƒ³ç»™å®ƒæ·»åŠ èƒŒæ™¯éŸ³ä¹ï¼Œæœ€å¥½è¿˜æ˜¯å€ŸåŠ©è§†é¢‘ç¼–è¾‘è½¯ä»¶ï¼Œå®ƒèƒ½å¯¹éŸ³ä¹çš„å¼€å¤´å’Œç»“å°¾åˆ†åˆ«è¿›è¡Œå¢å¼ºå’Œå‡å¼±çš„å¤„ç†ï¼Œå¦‚æœä¸åœ¨æ„è¿™äº›ç»†èŠ‚ï¼Œå®Œå…¨å¯ä»¥ç”¨ffmpegæ¥ä»£æ›¿ã€‚</p>
<p>æ›¿æ¢éŸ³é¢‘<br><code>ffmpeg -i input.mkv -i input.mp3 -map 0:v -map 1:a -c copy -shortest output.mp4</code><br>-mapçš„ä½œç”¨æ˜¯æ‰‹åŠ¨é€‰æ‹©è¾“å‡ºçš„æµï¼š</p>
<p>-map 0:v â€“ ä»è¾“å…¥0(ç¬¬1ä¸ªè¾“å…¥ï¼Œå³input.mkv) é€‰æ‹©è§†é¢‘æµ<br>-map 1:a â€“ ä»è¾“å…¥1(ç¬¬2ä¸ªè¾“å…¥ï¼Œå³input.mp3) é€‰æ‹©éŸ³é¢‘æµ<br>ç¬¬1ä¸ªmapå¯¹åº”è¾“å‡ºçš„ç¬¬1ä¸ªæµï¼Œç¬¬2ä¸ªmapå¯¹åº”è¾“å‡ºçš„ç¬¬2ä¸ªæµï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>
<p>åˆå¹¶éŸ³é¢‘<br>å¦ä¸€ä¸ªå¸¸è§çš„å½¢å¼æ˜¯å°†ä¸¤ä¸ªéŸ³é¢‘åˆå¹¶æˆä¸€ä¸ªï¼Œéœ€è¦ä½¿ç”¨amergeæ»¤é•œï¼š</p>
<p><code>ffmpeg -i input.mkv -i output.aac -filter_complex &quot;[0:a][1:a]amerge=inputs=2[a]&quot; -map 0:v -map &quot;[a]&quot; -c:v copy -c:a aac -ac 2 -shortest output.mp4</code></p>
<h3 id="10ã€åˆ¶ä½œgif"><a href="#10ã€åˆ¶ä½œgif" class="headerlink" title="10ã€åˆ¶ä½œgif"></a>10ã€åˆ¶ä½œgif</h3><p>ç»“åˆå‰é¢è®²åˆ°çš„æˆªå–å’Œå‹ç¼©ï¼Œå°†è¾“å‡ºæ–‡ä»¶çš„åç¼€æ”¹ä¸ºgifå°±å¯ä»¥å¾—åˆ°åŠ¨æ€å›¾</p>
<p><code>ffmpeg -ss 30 -t 5 -i input.mp4 -r 10 -vf scale=-1:144 -y output.gif</code><br>-ræŒ‡å®šå¸§ç‡ï¼ŒåŸå§‹çš„å¸§ç‡æ˜¯25ï¼Œé™ä½å¸§ç‡èƒ½å‡å°gifå›¾ç‰‡çš„å¤§å°ã€‚</p>
<p>ä½†æ˜¯è¿™ç§æ–¹å¼çš„æ•ˆæœå¾ˆå·®ï¼Œæœ‰ä¸€ç§ç²—ç³™çš„å¸ƒæ–™çš„æ„Ÿè§‰ã€‚ åŸå› åœ¨äºgifé™åˆ¶åªèƒ½åŒ…å«256ç§é¢œè‰²ï¼Œè€ŒåŸå§‹è§†é¢‘å¯èƒ½åŒ…å«æ•°ä»¥ç™¾ä¸‡çš„é¢œè‰²ï¼Œffmpegé»˜è®¤ä¼šä½¿ç”¨ä¸€ç§é€šç”¨çš„è°ƒè‰²æ¿(palettep)ï¼Œå› æ­¤å¯¼è‡´é¢œè‰²å¤±çœŸã€‚2015å¹´ï¼Œffmpegé€šè¿‡å¼•å…¥palettegenå’Œpaletteuseä¸¤ä¸ªæ»¤é•œæ¥æ”¹è¿›è¿™ä¸ªé—®é¢˜ï¼Œå®ƒé€šè¿‡æ‰«ææ•´ä¸ªè§†é¢‘ï¼Œè¾“å‡ºä¸€ä¸ªæœ€ä½³çš„è°ƒè‰²æ¿ï¼Œç„¶åå†è½¬æ¢æˆgifçš„è¿‡ç¨‹ä¸­åº”ç”¨è¿™ä¸ªè°ƒè‰²æ¿ä»è€Œé¿å…é¢œè‰²å¤±çœŸã€‚</p>
<p>ä¸‹é¢çš„å‘½ä»¤ä»input.mp4çš„ç¬¬30ç§’å¼€å§‹æˆªå–5ç§’ï¼Œç”Ÿæˆé«˜144åƒç´ çš„gifåŠ¨æ€å›¾ï¼š</p>
<p><code>palette=&quot;/tmp/palette.png&quot;</code><br><code>filters=&quot;fps=10,scale=-1:144:flags=lanczos&quot;</code></p>
<p><code>ffmpeg -ss 30 -t 5 -i input.mp4 -vf &quot;$filters,palettegen&quot; -y $palette</code><br><code>ffmpeg -ss 30 -t 5 -i input.mp4 -i $palette -filter_complex &quot;$filters [x]; [x][1:v] paletteuse&quot; -y output.gif</code></p>
<p>ä¸å‰ä¸€ä¸ªè¾“å‡ºç›¸æ¯”ï¼Œè´¨é‡æå‡äº†å¾ˆå¤šã€‚</p>
<p>å¦ä¸€ä¸ªæœ‰å¾…ç ”ç©¶çš„éš¾é¢˜æ˜¯å¦‚ä½•æ§åˆ¶è¾“å‡ºgifçš„å¤§å°ã€‚åœ¨ä¸å½±å“ç”»è´¨çš„å‰æä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›ä½“ç§¯è¶Šå°è¶Šå¥½ã€‚æ¯”å¦‚ç½‘ä¸Šæœ‰çš„gifå›¾å¾ˆæ¸…æ™°ï¼Œå´ä¸è¶…è¿‡1Mã€‚è€Œä¸€æ®µ500Kçš„è§†é¢‘æ–‡ä»¶ï¼Œä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•è½¬æˆgifåè¾“å‡ºçš„gifå´æœ‰1.6Mã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="Airthink">
          <p class="site-author-name" itemprop="name">Airthink</p>
           
              <p class="site-description motion-element" itemprop="description">The Pursuit of Happyness</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">56</span>
                <span class="site-state-item-name">æ—¥å¿—</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">20</span>
                <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">24</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/ikangbow" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2018 - 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-snowflake-o"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Airthink</span>
</div>



        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

</body>
</html>
