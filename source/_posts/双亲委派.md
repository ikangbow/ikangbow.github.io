---
title: 双亲委派
date: 2021-10-23 09:22:13
tags: 面基
category: 面基
---

## java中类加载器

JDK自带有三个类加载器：BootStrapClassLoader，ExtClassLoader，AppClassLoaser

BootStrapClassLoader是ExtClassLoader的父类加载器，默认加载%JAVA_HOME%/lib下的jar包和class文件。

ExtClassLoader是AppClassLoader的父类加载器，负责加载%JAVA_HOME%/jre/lib/ext目录下的一些扩展jar。

AppClassLoader是自定义类加载器的父类，负责加载classpath下的类文件，是系统类加载器，线程上下文加载器继承ClassLoader实现自定义类加载器。

## 双亲委派机制

当某个类加载器需要加载.class文件时，它首先会把这个任务委托给他的上级类加载器，递归这个操作，如果上级的类加载器没有加载，自己才会去加载这个类。即向上委派，实际上就是查找缓存，看是否加载了该类，有则返回，没有继续向上；向下查找，查找加载的路径，有则加载，没有继续向下查找。

作用：主要为了安全性，避免用户自己编写的类动态替换java的一些核心类。同时也避免了类的重复加载，因为JVM中区分不同的类，不仅仅是根据类名，相同的class文件被不同的classLoader加载就是不同的两个类。

## 是什么

Java虚拟机对class文件采用的是按需加载的方式，也就是说当需要使用该类时才会将它的class文件加载到内存生成class对象，加载某个类class文件时，java虚拟机采用的是双亲委派机制，即把请求交由父类处理。

## 工作原理

如果一个类加载器收到了类加载请求，它并不会自己先加载，而是把这个请求委托给父类的加载器去执行

如果父类加载器还存在其他父类加载器，则进一步向上委托，依次递归，请求最终将到达顶层的引导类加载器

如果父类加载器可以完成类加载的任务，就成功返回，倘若父类加载器无法完成加载任务，子类加载器材会尝试自己去加载，这就是双亲委派机制

父类加载器一层一层往下分配任务，如果子类加载器能加载，则加载此类，如果一直向下查找也无法加载此类，则抛出异常。

## 作用

避免类的重复加载。

保护程序安全，防止核心API被随意篡改。
