<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2">






<meta name="description" content="The Pursuit of Happyness">
<meta property="og:type" content="website">
<meta property="og:title" content="Airthink">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Airthink">
<meta property="og:description" content="The Pursuit of Happyness">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Airthink">
<meta name="twitter:description" content="The Pursuit of Happyness">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/">





  <title>Airthink</title>
  














</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Airthink</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/10/18/面试题（查漏补缺）/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Airthink">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Airthink">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/10/18/面试题（查漏补缺）/" itemprop="url">面试题（查漏补缺）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-10-18T21:18:22+08:00">
                2021-10-18
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/面基/" itemprop="url" rel="index">
                    <span itemprop="name">面基</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="List和Set的区别"><a href="#List和Set的区别" class="headerlink" title="List和Set的区别"></a>List和Set的区别</h2><p>List:有序集合，可重复，按对象的插入顺序保存。允许多个Null元素对象，可以使用iterator取出所有元素，在逐一遍历，还可以使用get(index)获取指定下标的元素。</p>
<p>Set：无序，不可重复。最多只允许有一个Null元素对象，取元素时只能用iterator接口取得所有元素，在逐一遍历。</p>
<h2 id="ArrayList和LinkedList区别"><a href="#ArrayList和LinkedList区别" class="headerlink" title="ArrayList和LinkedList区别"></a>ArrayList和LinkedList区别</h2><p>ArrayList：基于动态数组实现，连续内存存储，适合下标访问（随机访问）。有扩容机制，因为数组长度固定，超出长度存数据时需要新建数组，然后将老数组拷贝到新的数组，如果不是尾部插入，还会涉及元素的移动。使用尾插法并指定初始容量可以极大提升性能。</p>
<p>LinkedList：基于链表实现，可以存储在分散的内存中，适合做数据的插入及删除操作，不适合查询。需要逐一遍历，遍历LinkedList必须使用iterator不能使用for循环，因为每次for循环体内通过get（i）取得某一元素时都需要对List重新遍历，性能消耗大。<br>另外不要用indexOf等返回元素索引，并利用其进行遍历，使用indexOf对list进行遍历，当结果未空时会遍历整个列表。</p>
<h2 id="和equals比较"><a href="#和equals比较" class="headerlink" title="==和equals比较"></a>==和equals比较</h2><p>==比较的是栈中的值，基本数据类型是变量值，引用类型是堆中内存对象的地址。<br>equals：object中默认也是采用==比较，但通常会重写。</p>
<h2 id="接口和抽象类的区别"><a href="#接口和抽象类的区别" class="headerlink" title="接口和抽象类的区别"></a>接口和抽象类的区别</h2><p>一个类只能继承一个抽象类，但可以实现多个接口。继承抽象类用关键字extends，实现接口用implements。</p>
<p>抽象类中的成员变量可以是各种类型的，而接口中的成员变量默认是public static final类型，必须赋初始值，不能被修改。</p>
<p>抽象类可以存在普通成员函数，接口只有定义，在JDK8之前方法被指定为public abstract，JDK8之后允许添加非抽象的方法，但是必须用default关键字修饰；定义了default的方法可以不被实现子类所实现，但可以被实现子类的对象调用。</p>
<p>接口的设计目的是对类的行为进行约束，也就是提供一种机制，可以强制要求不同类具有相同的行为，它只约束了行为的有无，但不对如何实现行为进行限制。</p>
<p>而抽象类的设计目的，是为了代码复用，当不同的类具有某些相同的行为，且其中一部分行为的实现方式一致（A的非真子集，记为B），可以让这些类都派生与一个抽象类。这个抽象类中实现了B，避免让所有的子类来实现B，这样就达到了代码复用的目的。而A-B的部分，留给各个子类自己实现。正是因为A-B在这里没有实现，所有抽象类不允许实例化。</p>
<p>抽象类是对类本质的抽象，表达的是is a的关系。抽象类包含并实现子类的通用特性，将子类存在差异化的特性进行抽象，交由子类去实现。</p>
<p>接口的核心是定义行为，，即实现类可以做什么，至于实现类主体是谁，如何实现，接口并不关心。</p>
<h2 id="重载和重写的区别"><a href="#重载和重写的区别" class="headerlink" title="重载和重写的区别"></a>重载和重写的区别</h2><p>重载：发生在同一个类中，方法名必须相同，参数类型不同，个数不同，顺序不同，方法返回值和访问修饰符可以不同。</p>
<p>重写：发生在父子类中，方法名，参数列表必须相同，返回值范围小于等于父类，抛出的异常范围小于等于父类，访问修饰符的范围大于等于父类，如果父类方法访问修饰符为private则子类就不能重写该方法。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/10/18/HashMap相关/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Airthink">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Airthink">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/10/18/HashMap相关/" itemprop="url">HashMap相关</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-10-18T21:16:00+08:00">
                2021-10-18
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/面基/" itemprop="url" rel="index">
                    <span itemprop="name">面基</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="HashMap底层数据结构详解"><a href="#HashMap底层数据结构详解" class="headerlink" title="HashMap底层数据结构详解"></a>HashMap底层数据结构详解</h2><p>JDK1.7及之前：数组+链表</p>
<p>JDK1.8:数组+链表+红黑树</p>
<p>HashMap添加元素时，会根据哈希值和数组长度来计算该元素put的位置。put元素会判断当前位置是否已经有元素，这样在多线程环境下，会发生数据覆盖，导致数据丢失。通常为了使元素分布均匀会使用取模运算，计算出index后，就会将改元素添加进去，但是会出现两个key的哈希值相同，这时候会产生哈希冲突，当哈希冲突时会产生链表的数据结构，冲突的元素会在该索引出以链表的形式保存。</p>
<p>但是当链表的长度过长时，其固有弊端就显示出来了，即查询效率低。</p>
<p>此时就引入了第三种数据结构，红黑树，红黑树是一刻接近于平衡的二叉树，远远比链表的查询料率高。但是如果链表的长度不到一定阈值，直接使用红黑树也不行，因为红黑树的自身维护代价也比较高，每插入一个元素都可能打破红黑树的平衡，这时候就需要对红黑树再平衡（左旋，右旋，重新着色）。</p>
<p>HashMap中数组的初始长度是16，默认的加载因子是0.75</p>
<p>数组一单达到容量的阈值就需要对数组进行扩容。扩容就意味着要进行数组的移动，数组一旦移动，每移动一次就要重新计算索引，这个过程牵扯大量元素的迁移，会大大影响效率。如果直接使用与运算，这个效率远远高于取模运算。</p>
<p>为什么链表长度大于等于8时转成了红黑树</p>
<p>遵循概率论里的泊松分布。链表中元素个数为8的概率已经非常小，红黑树平均查找长度是log（n），当长度为8时，平均查找长度为3，如果继续使用链表，平均查找长度为8、2=4，这时候才有转为树的必要。</p>
<h2 id="HashMap的遍历方式"><a href="#HashMap的遍历方式" class="headerlink" title="HashMap的遍历方式"></a>HashMap的遍历方式</h2><p>迭代器遍历（iterator）</p>
<p>For Each方式遍历</p>
<p>Lambda表达式遍历</p>
<p>Streams Api遍历</p>
<p>迭代器entrySet</p>
<pre><code>@Test
public void test001(){
    Map&lt;String, Integer&gt; map = new HashMap&lt;&gt;();
    map.put(&quot;1&quot;,1);
    map.put(&quot;2&quot;,2);
    Iterator&lt;Map.Entry&lt;String,Integer&gt;&gt; iterator = map.entrySet().iterator();
    while (iterator.hasNext()){
        Map.Entry&lt;String,Integer&gt; entry = iterator.next();
        System.out.println(&quot;key:&quot;+entry.getKey()+&quot;,value:&quot;+entry.getValue());
    }
}
</code></pre><p>迭代器keySet</p>
<pre><code>@Test
public void test002(){
    Map&lt;String, Integer&gt; map = new HashMap&lt;&gt;();
    map.put(&quot;11&quot;,1);
    map.put(&quot;22&quot;,2);
    Iterator&lt;String&gt; iterator = map.keySet().iterator();
    while (iterator.hasNext()){
        String key = iterator.next();
        System.out.println(&quot;key:&quot;+key+&quot;,value:&quot;+map.get(key));
    }
}
</code></pre><p>ForEach EntrySet</p>
<pre><code>@Test
public void test003(){
    Map&lt;String, Integer&gt; map = new HashMap&lt;&gt;();
    map.put(&quot;111&quot;,1);
    map.put(&quot;222&quot;,2);
    for (Map.Entry&lt;String,Integer&gt; entry:map.entrySet()
         ) {
        System.out.println(&quot;key:&quot;+entry.getKey()+&quot;,value:&quot;+entry.getValue());
    }
}
</code></pre><p>ForEach keySet</p>
<pre><code>@Test
public void test004(){
    Map&lt;String,Integer&gt; map = new HashMap&lt;&gt;();
    map.put(&quot;1111&quot;,1);
    map.put(&quot;2222&quot;,2);
    for (String str:
         map.keySet()) {
        System.out.println(&quot;key:&quot;+str+&quot;,value:&quot;+map.get(str));
    }
}
</code></pre><p>Lambda表达式</p>
<pre><code>@Test
public void test005(){
    Map&lt;String,Integer&gt; map = new HashMap&lt;&gt;();
    map.put(&quot;11111&quot;,1);
    map.put(&quot;22222&quot;,2);
    map.forEach((key,value)-&gt;{
        System.out.println(&quot;key:&quot;+key+&quot;,value:&quot;+value);
    });
}
</code></pre><p>Streams API单线程</p>
<pre><code> @Test
public void test006(){
    Map&lt;String,Integer&gt; map = new HashMap&lt;&gt;();
    map.put(&quot;111111&quot;,1);
    map.put(&quot;222222&quot;,2);
    map.entrySet().stream().forEach((entry)-&gt;{
        System.out.println(&quot;key:&quot;+entry.getKey()+&quot;,value:&quot;+entry.getValue());
    });
}
</code></pre><p>Streams API多线程</p>
<pre><code>@Test
public void test007(){
    Map&lt;String,Integer&gt; map = new HashMap&lt;&gt;();
    map.put(&quot;1111111&quot;,1);
    map.put(&quot;2222222&quot;,2);
    map.entrySet().parallelStream().forEach((entry)-&gt;{
        System.out.println(&quot;key:&quot;+entry.getKey()+&quot;,value:&quot;+entry.getValue());
    });
}
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/05/22/TBQUANT/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Airthink">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Airthink">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/22/TBQUANT/" itemprop="url">TBQUANT</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-22T10:55:31+08:00">
                2021-05-22
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/投资/" itemprop="url" rel="index">
                    <span itemprop="name">投资</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h2><pre><code>PlotString(&quot;BarStatus&quot;,Text(BarStatus));
</code></pre><h2 id="定义参数"><a href="#定义参数" class="headerlink" title="定义参数"></a>定义参数</h2><p>整个公式中只能出现一个 Params 宣告，并且要放到公式的开始部分，在变量定义之前</p>
<pre><code>Params
 Bool bTest(False); //定义布尔型参数 bTest，默认值为 False;
 Numberic Length(10); //定义数值型参数 Length，默认值为 10；
 NumericSeries Price(0); //定义数值型序列参数 Price，默认值为 0；
 NumericRef output(0); //定义数值型引用参数 output，默认值为 0；
 String strTmp(&quot;Hello&quot;); //定义字符串参数 strTmp,默认值为 Hello
</code></pre><h2 id="定义变量"><a href="#定义变量" class="headerlink" title="定义变量"></a>定义变量</h2><p>整个公式中只能出现一个 Vars 声明，并且要放到公式的开始部分，在参数定义之后，正文之前。</p>
<pre><code>Vars
NumericSeries MyVal1(0); //定义数值型序列变量 MyVal1，默认值为 0；
Numeric MyVal2(0); //定义数值型变量 MyVal2，默认值为 0；
Bool MyVal3(False); //定义布尔型变量 MyVal3，默认值为 False;
String MyVal4(&quot;Test&quot;); //定义字符串变量 MyVal4，默认值为 Test。
</code></pre><h2 id="用户函数编写示例"><a href="#用户函数编写示例" class="headerlink" title="用户函数编写示例"></a>用户函数编写示例</h2><pre><code>Average 函数脚本如下：
Params
NumericSeries Price(1);
Numeric Length(10);
Vars
Numeric AvgValue; 
Begin
AvgValue = Summation(Price, Length) / Length;
Return AvgValue;
End
</code></pre><p>上面的例子，返回值只有一个，即最后求得的平均值，在函数中直接使用 Return 语句返回就可以<br>了。</p>
<pre><code>Params
NumericSeries Price(1);
Numeric Length(10);
NumericRef HighestBar; //设置引用型的变量
Vars
Numeric MyVal;TradeBlazer 公式开发指南 TradeBlazer 用户函数
- 69 -
Numeric MyBar;
Numeric i; 
Begin
MyVal = Price;
MyBar = 0;
For i = 1 to Length – 1
{
If ( Price[i] &gt; MyVal)
{
MyVal = Price[i];
MyBar = i; //记录最大值 Bar 与当前 Bar 的偏移量
}
}
HighestBar = MyBar; //通过将偏移量赋值给引用型变量，它可将该值传递回去
Return MyVal;
End

函数参数声明类型 可传入的变量类型
Numeric== Numeric，NumericRef，NumericSeries
NumericRe==f Numeric，NumericRef
NumericSeries== Numeric，NumericRef，NumericSeries
Bool== Bool，BoolRef，BoolSeriesTradeBlazer
BoolRef== Bool，BoolRef
BoolSeries== Bool，BoolRef，BoolSeries
String== String，StringRef，StringSeries
StringRef== String，StringRef
StringSeries== String，StringRef，StringSeries 
</code></pre><h2 id="输出-1"><a href="#输出-1" class="headerlink" title="输出"></a>输出</h2><pre><code>PlotNumeric-----在当前 Bar 输出一个数值；
语法：PlotNumeric(String Name,Numeric Number,Numeric Locator=0,Integer Color=-1,Integer 
BarsBack=0)
 Name 输出值的名称的字符串，可以为中、英文、数字或者其它字符；
 Number 输出的数值；
 Locator 输出值的定位点，默认时输出单点，否则输出连接两个值线段，用法请看例 2；
 Color 输出值的显示颜色，默认表示使用属性设置框中的颜色；
 BarsBack 从当前 Bar 向前回溯的 Bar 数，默认值为当前 Bar。
例 1：PlotNumeric (&quot;RSI&quot;,RSIValue);
输出 RSI 的值。
例 2：PlotNumeric (&quot;OpenToClose&quot;,Open,Close);
输出开盘价与收盘价的连线。（需要在公式属性的输出线形选择柱状图）
例 3：PlotNumeric (&quot;AvgValue&quot;,average(close,5),0,Blue);
输出一条蓝色的以收盘价计算的五日平均线。
注意：当后面的参数都使用默认值的情况下，可省略不写，如例 1。但如果后面还有其它参数要指明，
而只是中间某一个或者多个参数需要默认值的话，则中间参数不可省略，需将默认值一一填写，如例


PlotBool-----在当前 Bar 输出一个布尔值。
语法：PlotBool(String Name,Bool bPlot,Numeric Locator=0,Integer Color=-1,Integer BarsBack=0)
Name 输出值的名称，不区分大小写；
bPlot 输出的布尔值；
Locator 输出值的定位点；
Color 输出值的显示颜色，默认表示使用属性设置框中的颜色
BarsBack 从当前 Bar 向前回溯的 Bar 数，默认值为当前 Bar 

示例 ：PlotBool (&quot;con&quot;,con,High); 
在 Bar 的最高价位置输出条件 con 的布尔值。
PlotString-----在当前 Bar 输出一个字符串。
语法：PlotString(String Name,String str,Numeric Locator=0,Integer Color=-1,Integer BarsBack=0)
Name 输出值的名称，不区分大小写；
str 输出的字符串；
Locator 输出值的定位点；
Color 输出值的显示颜色，默认表示使用属性设置框中的颜色；
BarsBack 从当前 Bar 向前回溯的 Bar 数，默认值为当前 Bar。
示例 ：
PlotString (&quot;Bear Market&quot;,&quot;Bear Bear&quot;,High,Blue); 
在 Bar 的最高价位置输出一个蓝色的字符串 Bear Bear
</code></pre><h2 id="公式正文"><a href="#公式正文" class="headerlink" title="公式正文"></a>公式正文</h2><p>参数与变量的声明之后，在公式的正文部分，对所声明的变量进行赋值计算，必要的话还可以将所需的<br>条件语句编写进公式里。最后则是将计算结果以数值、布尔或字符串的形式在图表上输出。<br>现在我们来试着建立一个技术分析类的公式应用。首先，需要确立我们的指标里需要什么信息，以及需<br>要通过何种计算从而得到我们想要的结果。比如，现在我们需要得到两条移动平均线，那么首先可以确<br>定，要输出的是两个数值型的变量的值，然后我们就可以在公式中进行定义与赋值了。<br>有如下代码：</p>
<pre><code>Params //参数的声明
numeric length1(10);
numeric length2(20);
Vars //变量的声明
numeric ma1;
numeric ma2;
Begin
ma1 = averageFC(close,length1);
ma2 = averageFC(close,length2); // 给变量的赋值
PlotNumeric(&quot;ma1&quot;,ma1,0,cyan);
PlotNumeric(&quot;ma2&quot;,ma2,0,Magenta); //输出计算出来的平均值
End
</code></pre><p>以上公式先声明参数与变量，然后在 Begin 与 End 之间对公式的主体进行了赋值与输出。</p>
<h2 id="交易指令函数"><a href="#交易指令函数" class="headerlink" title="交易指令函数"></a>交易指令函数</h2><p>交易开拓者提供 Buy，SellShort， BuyToCover，Sell，A_SendOrder 这五个函数来做下单的动作<br>指令。</p>
<p>Buy，SellShort， BuyToCover，Sell 这四个函数可以针对历史数据在图表上做出讯号标识，同时在实<br>时行情中也可以及时地发出下单委托的动作。因为可以对历史数据的图表上做出讯号的标识记录，交易<br>设置的性能测试也需要由这几个函数参与计算的公式应用方可实现。</p>
<p>Buy —- 对当前合约发出买入开仓的指令，如果图表讯号显示当前持有空仓，则会先平掉空仓，再开多<br>仓；</p>
<p>SellShort —- 对当前合约发出卖出开仓的指令，如果图表讯号显示当前持有多仓，则会先平掉多仓，再<br>开空仓；</p>
<p>BuyToCover —- 对当前合约发出平空仓的指令，当图表讯号显示有空头持仓时，方可执行此指令；</p>
<p>Sell —- 对当前合约发出平多仓的指令，当图表讯号显示有多头持仓时，方可执行此指令；</p>
<pre><code>if(condition1 &amp;&amp; marketposition!=1) //条件满足且没有持多仓情况下开多
{
 buy();
}else if(condition2 &amp;&amp; marketposition!=-1) //条件满足且没有持空仓时开空
{
sellshort();
}
</code></pre><h2 id="调试语句输出"><a href="#调试语句输出" class="headerlink" title="调试语句输出"></a>调试语句输出</h2><pre><code>If(close&gt;open)
 Commentary(&quot;收阳=&quot;+Text(close)); // 在收阳的 K 线上显示收盘价
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/04/29/量化投资基础知识/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Airthink">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Airthink">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/04/29/量化投资基础知识/" itemprop="url">量化投资基础知识</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-04-29T21:07:22+08:00">
                2021-04-29
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/投资/" itemprop="url" rel="index">
                    <span itemprop="name">投资</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="夏普比率（SharpeRatio）"><a href="#夏普比率（SharpeRatio）" class="headerlink" title="夏普比率（SharpeRatio）"></a>夏普比率（SharpeRatio）</h2><p>夏普比率可以理解为风险调整后的收益，衡量的是每承受一单位风险，会产生多少超额报酬。既然重点在回报上，当然是希望同样的风险，能获得更高的回报；或者说当回报相同时，风险更小。</p>
<p>敲黑板：夏普比率越大越好</p>
<h2 id="最大回撤率（DrawDown）"><a href="#最大回撤率（DrawDown）" class="headerlink" title="最大回撤率（DrawDown）"></a>最大回撤率（DrawDown）</h2><p>在选定周期内任一时点往后推，基金净值在最低点时的收益下跌幅度的最大值。最大回撤代表投资者可能面临的最大亏损。</p>
<p>敲黑板：最大回撤率越小越好</p>
<h2 id="年度收益率（Annual-Return）"><a href="#年度收益率（Annual-Return）" class="headerlink" title="年度收益率（Annual Return）"></a>年度收益率（Annual Return）</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/02/28/考驾照/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Airthink">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Airthink">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/02/28/考驾照/" itemprop="url">考驾照</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-02-28T09:09:19+08:00">
                2021-02-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/驾照/" itemprop="url" rel="index">
                    <span itemprop="name">驾照</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><em>系安全带，查看方向盘是否回正，挡位是否在空挡，手刹是否拉起</em></p>
<h2 id="坡道定点停车和起步"><a href="#坡道定点停车和起步" class="headerlink" title="坡道定点停车和起步"></a>坡道定点停车和起步</h2><p>一档上坡，要对好边缘线，与右侧边缘线保持30cm。</p>
<p>左后视镜可看到坡起实线踩离合踩刹车。</p>
<p>拉起手刹停留超过3秒钟，放下手刹。</p>
<p>缓抬离合至车身抖动保持不动，松掉刹车，完成起步。</p>
<h2 id="侧方位停车"><a href="#侧方位停车" class="headerlink" title="侧方位停车"></a>侧方位停车</h2><p>一档行车，车身离边缘线30cm-50cm为宜，当从右侧后视镜看到库位前角时候，踩离合踩刹车停车。</p>
<p>挂倒挡，松刹车慢松离合开始倒车，当库位前角从右侧后视镜消失时，向右打满方向盘，继续倒车。</p>
<p>观察左后视镜，当库位后角出现，回正方向盘继续倒车。</p>
<p>当左侧车门把手越过库位左侧虚线（左后车轮），向左打死方向盘继续倒车。</p>
<p>观察右后视镜，当车身与右侧边线平行踩离合踩刹车，完成入库。</p>
<p>挂一档，打左转向灯，松离合向前行驶，当车头中间将触及行车道左侧线向右回正方向盘继续行驶，完成出库。</p>
<h2 id="直角转弯"><a href="#直角转弯" class="headerlink" title="直角转弯"></a>直角转弯</h2><p>一档行车，车身离右侧边缘线30cm为宜，进入项目打开左转向灯，当听到直角转弯关闭左转向灯。</p>
<p>观察左侧后视镜，当超过直角边五指向左打死方向盘，继续行驶。</p>
<p>观察右侧后视镜，车身与右侧边缘线平行回正方向盘，继续向前驶出项目。</p>
<h2 id="曲线行驶"><a href="#曲线行驶" class="headerlink" title="曲线行驶"></a>曲线行驶</h2><p>一档行车进入曲线行驶，当左侧大灯触及右侧曲线边缘线时，向左打一圈方向盘，保持左侧大灯沿着右侧边缘线行驶，直至第一个弯出来。</p>
<p>当左侧大灯触及左侧边缘线回正方向盘。</p>
<p>当右侧大灯触及左侧边缘线，当向右打一圈方向盘，保持右侧大灯贴左侧边缘线行驶，当驶出第二个弯，回正方向盘。</p>
<h2 id="倒车入库"><a href="#倒车入库" class="headerlink" title="倒车入库"></a>倒车入库</h2><p>。。。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/02/12/本杰明巴顿奇事/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Airthink">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Airthink">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/02/12/本杰明巴顿奇事/" itemprop="url">本杰明巴顿奇事</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-02-12T13:06:43+08:00">
                2021-02-12
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/电影台词/" itemprop="url" rel="index">
                    <span itemprop="name">电影台词</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <pre><code>一直很好奇，街上是什么样子的？
下个街角又是怎么样？

Always had a healthy curiouly , what was up the street ? Or around the next corner ?

有时候，我感觉一切和前一天大不一样了。

Some days I feel different than the day before.

每个人在某种程度上都对自己有不同的认识，但是我们最后都会去往同一个地方，只是走的路不同罢了。

Everybody feels different about themselves , one way or another . Butwe’re all going the same way . Just taking different roads to get there ,that’s all . You’re on your own road .

有时候我觉得很可笑，那些在我们记忆里占据着很小一部分的人们，却往往给我们留下了最深刻的印象。
It’s funny how sometimes the people we remember the least , make the greatest impression on us .

我们注定要失去我们所爱的人，要不然我们怎么会知道，他们对我们有多么的重要。
We’re meant to lose the people we love . How else would we know how importantthey are to us ?

长大是件很有意思的事，不经意间就发生了，本来是这样一个人，然后突然间变成了另一个人，不再是原来那样子。

Growing up’s a funny thing , Sneak up on you . One person is there , than suddenly somebodyelse has taken here place . She wasn`t all albows and knees anymore.

你可以像疯狗那样对周围的一切愤愤不平，你可以诅咒命运，但是等到最后一刻，你还是得平静的放手而去。

You can be as mad as a mad dog at the way things went . You could swear, curse the fates . But when it comes to the end , you have to let go .

我们的生命因为各种各样的机遇而变得更有意义。

Our lives are defined by opportunities。

有些时候我们就活在即将发生冲撞的轨道上，浑然不知无论它是意外发生还是蓄谋已久，对此我们都无能为力。

Sometimes we’re on a collision course and we just don’t know it . Whether it’s by accident or by design , there’s not a thing we can do about it .

一件事无论太晚或者对于我来说太早，
都不会阻拦你成为你想成为的那个人，
这个过程没有时间的期限，只要你想，随时都可以开始，
要改变或者保留原状都无所谓，
做事本不应该有所束缚，
我们可以办好这件事却也可以把它搞砸，
但我希望最终你能成为你想成为的人。

For what it’s worth, it’s never too late,
Or in my case, too early,
To be whoever you want to be.
There’s no time limit, stop whenever you want.
You can change or stay the same.
There’s no rules to this thing.
We can make the best or the worst of it.
I hope you make the best of it.

我希望你有时能驻足于这个令你感到惊叹的世界，
体会你从未有过的感觉；
我希望你能见到其他与你观点不同的人们；
我希望你能有一个值得自豪的人生，
如果你想象的生活不一样；
我希望你能有勇气重新再来。

I hope you see things that startle you.
I hope you feel things you never felt before.
I hope you meet people with a different point of view.
I hope you live a life you’re proud of.
If you find that you are not,
I hope you have the strength to start all over again.
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/02/10/树莓派初始化设置/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Airthink">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Airthink">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/02/10/树莓派初始化设置/" itemprop="url">树莓派初始化设置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-02-10T20:15:54+08:00">
                2021-02-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>先执行<br>sudo apt-get install vim</p>
<p>WIFI设置<br>每当重新安装树莓派的系统或者初始化一块全新的树莓派都会遇到这样的问题：连接WIFI。</p>
<p>那当我们没有显示器和键盘的情况下怎末可以将树莓连接到当前的WIFI网络呢？</p>
<p>方法非常简单，首先在SD卡的根目录下添加一个名为 wpa_supplicant.conf的文件，然后在该文件内添加以下的内容：</p>
<pre><code>country=CN
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1

network={
    ssid=&quot;AlexVB&quot;
    key_mgmt=WPA-PSK
    psk=&quot;*********&quot;
    priority=1
}
</code></pre><p>密码设置<br>树莓派很多功能都需要解锁root权限后才能完成，比如下载安装，更改文件等等。</p>
<p>在命令行界面执行以下命令，再输入两次想设置的root密码，执行后设置成功。</p>
<pre><code>sudo passwd root
</code></pre><p>输入以下命令开启root权限：</p>
<pre><code>sudo passwd --unlock root
</code></pre><p>更改pi用户密码：</p>
<pre><code>sudo passwd pi
</code></pre><p>python设置<br>树莓派的python默认版本是python2.7，如果想用python3.x的话，树莓派有自带的python3.5，此乃大坑，不需要再下载python3，直接把python和自带的python3建立软链接就OK。</p>
<pre><code>which python

/usr/bin/python

which python3

/usr/bin/python3
</code></pre><p>注意：不能直接就把python链接到python3上，会报错，先把原来的python2备份一下。<br>ln: 无法创建符号链接’/usr/bin/python’: 文件已存在</p>
<pre><code>sudo mv /usr/bin/python  /usr/bin/python2

sudo ln -s /usr/bin/python3 /usr/bin/python
</code></pre><p>之后在终端输入python就可以看到python的默认版本改为python3.5了。<br>在这里插入图片描述</p>
<p>更改软件源<br>树莓派系统安装后默认使用国外的镜像源来更新软件，由于不可描述原因，国内访问速度非常慢，因此需要换成国内源。</p>
<p>树莓派官方提供了一个更新源列表，在这里我们使用中科大的软件源和系统源。</p>
<p>首先还是要备份原来的源文件：</p>
<pre><code>sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak

sudo cp /etc/apt/sources.list.d/raspi.list /etc/apt/sources.list.d/raspi.list.bak
</code></pre><p>修改软件更新源，执行如下命令：</p>
<pre><code>sudo vim /etc/apt/sources.list
</code></pre><p>将原来的内容注释掉，改为中科大的源：</p>
<pre><code>deb http://mirrors.ustc.edu.cn/raspbian/raspbian/ stretch main contrib non-free rpi
</code></pre><p>在这里插入图片描述<br>修改系统更新源，执行如下命令：</p>
<pre><code>sudo vim /etc/apt/sources.list.d/raspi.list
</code></pre><p>将原来的内容注释掉，改为中科大的源：</p>
<pre><code>deb http://mirrors.ustc.edu.cn/archive.raspberrypi.org/debian/ stretch main ui
</code></pre><p>在这里插入图片描述<br>之后就可以快速更新和安装了。</p>
<pre><code>sudo apt-get update

sudo apt-get upgrade -y
</code></pre><p>这时候可能会有提示“有些没有软件包是自动安装的但是当前已经不需要了，可以使用如下命令卸载：    </p>
<pre><code>sudo apt autoremove
</code></pre><p>！！千万别用！！<br>更改pip源<br>pip更换为国内源，可以大大的提高安装成功率和速度。</p>
<p>不管你用的是pip3还是pip，方法都是一样的，如下：</p>
<pre><code>sudo vim /etc/pip.conf
</code></pre><p>更改文件内容：</p>
<pre><code>index-url = https://mirrors.aliyun.com/pypi/simple
</code></pre><p>输入法</p>
<p>sudo apt-get install scim-pinyin</p>
<p>一、安装</p>
<pre><code>1.安装mongodb

        sudo apt-get install mongodb

2. 启动服务

        /usr/bin/mongod -f /etc/mongodb.conf

3.启动命令行

        /usr/bin/mongo 

        此时可以看到版本是MongoDB shell version: 2.4.14

4.关闭mongo
      /usr/bin/mongod -shutdown -dbpath=/home/data/mongodb
</code></pre><p>二、配置</p>
<pre><code>1.配置主机ip：

          sudo vim /etc/mongodb.conf

          加入如下：127.0.0.1，自己的ip

2.配置防火墙，让局域网环境可以访问数据库

          2.1  安装：sudo apt-get install ufw

          2.2  启用：sudo ufw enable

          2.3  禁止外部访问 sudo ufw default deny

          2.4  启用局域网mongodb端口访问：       sudo ufw allow from 192.168.0.0/8 
</code></pre><p>三、使用</p>
<pre><code>1.pymongo下载

            这里注意，最新版本pymongo是不兼容MongoDB2.4的，所以下载的时候记得下载老版本

                  pip install pymongo==3.1.1

 2.使用

                  使用起来非常方便：连接、关闭、增删改查。具体操作见官网文档：

                  http://api.mongodb.com/python/current/index.html
</code></pre><p>python3.7导入gevent模块报错的解决方案</p>
<pre><code>RuntimeWarning: greenlet.greenlet size changed, may indicate binary incompatibility. Expected 144, got 128
  return f(*args, **kwds)

pip3 install -U --force-reinstall --no-binary :all: gevent
</code></pre><p>安装64位</p>
<p>官方64位测试版系统下载地址</p>
<pre><code>https://www.raspberrypi.org/forums/viewtopic.php?f=117&amp;t=275370
</code></pre><p>换源</p>
<pre><code>sudo vim /etc/apt/sources.list

deb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster main contrib non-free
deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster main contrib non-free
deb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-updates main contrib non-free
deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-updates main contrib non-free
deb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-backports main contrib non-free
deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-backports main contrib non-free
deb https://mirrors.tuna.tsinghua.edu.cn/debian-security buster/updates main contrib non-free
deb-src https://mirrors.tuna.tsinghua.edu.cn/debian-security buster/updates main contrib non-free


sudo vim /etc/apt/sources.list.d/raspi.list

deb http://mirrors.tuna.tsinghua.edu.cn/raspberrypi/ buster main ui
</code></pre><p>更新 sudo apt-get update</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/12/07/compose/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Airthink">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Airthink">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/12/07/compose/" itemprop="url">compose</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-12-07T21:19:37+08:00">
                2020-12-07
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/compose/" itemprop="url" rel="index">
                    <span itemprop="name">compose</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="如何写docker-compose-yml，Docker-compose-file-参考文档"><a href="#如何写docker-compose-yml，Docker-compose-file-参考文档" class="headerlink" title="如何写docker-compose.yml，Docker compose file 参考文档"></a>如何写docker-compose.yml，Docker compose file 参考文档</h1><h2 id="Compose-简介"><a href="#Compose-简介" class="headerlink" title="Compose 简介"></a>Compose 简介</h2><p>Compose 文件是一个YAML文件，用于定义services、netword和volumes。 Compose 文件的默认路径为./docker-compose.yaml(后缀为.yml和.yaml都可以)。</p>
<p>Compose 是用于定义和运行多容器 Docker 应用程序的工具。通过 Compose，您可以使用 YML 文件来配置应用程序需要的所有服务。然后，使用一个命令，就可以从 YML 文件配置中创建并启动所有服务。</p>
<p>Compose 使用的三个步骤：</p>
<p>使用 Dockerfile 定义应用程序的环境。</p>
<p>使用 docker-compose.yml 定义构成应用程序的服务，这样它们可以在隔离环境中一起运行。</p>
<p>最后，执行 docker-compose up 命令来启动并运行整个应用程序。</p>
<h2 id="安装-Docker-Compose"><a href="#安装-Docker-Compose" class="headerlink" title="安装 Docker Compose"></a>安装 Docker Compose</h2><pre><code>sudo curl -L https://github.com/docker/compose/releases/download/1.21.2/docker-compose-$(uname -s)-$(uname -m) -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

docker-compose -v
</code></pre><h2 id="工程、服务、容器"><a href="#工程、服务、容器" class="headerlink" title="工程、服务、容器"></a>工程、服务、容器</h2><p>Docker Compose 将所管理的容器分为三层，分别是工程（project）、服务（service）、容器（container）</p>
<p>Docker Compose 运行目录下的所有文件（docker-compose.yml）组成一个工程,一个工程包含多个服务，每个服务中定义了容器运行的镜像、参数、依赖，一个服务可包括多个容器实例</p>
<p>Docker Compose默认的模板文件是docker-compose.yml，其中定义的每个服务都必须通过image指令指定镜像或使用Dockerfile的build指令进行自动构建，其它大部分指令跟docker run中选项类似。</p>
<p>如果使用Dockerfile的build指令，则在Dockerfile中设置的选项如CMD、EXPOSE、VOLUME、ENV等将会自动被获取，无需在docker-comopse.yml文件中再次设置。</p>
<p>如果使用image指定为镜像名称或镜像ID时镜像在本地不存在，Compose将会尝试去拉取这个镜像。</p>
<p>典型的docker-comopse.yml文件格式</p>
<pre><code>version: &apos;2&apos;
services:
  web:
    image: dockercloud/hello-world
    ports:
      - 8080
    networks:
      - front-tier
      - back-tier

  redis:
    image: redis
    links:
      - web
    networks:
      - back-tier

  lb:
    image: dockercloud/haproxy
    ports:
      - 80:80
    links:
      - web
    networks:
      - front-tier
      - back-tier
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock 

networks:
  front-tier:
    driver: bridge
  back-tier:
driver: bridge
</code></pre><h2 id="docker-compose-yml"><a href="#docker-compose-yml" class="headerlink" title="docker-compose.yml"></a>docker-compose.yml</h2><p>version：指定 docker-compose.yml 文件的写法格式<br>services：多个容器集合<br>build：配置构建时，Compose 会利用它自动构建镜像，该值可以是一个路径，也可以是一个对象，用于指定 Dockerfile 参数</p>
<p>Compose文件是一个定义服务services、网络networks和卷volumes的YAML文件，默认路径是./docker-compose.yml，可使用.yml或.yaml作为文件扩展名。</p>
<p>服务services定义包含应用于为该服务启动的每个容器的配置，类似传递命令行参数一样docker container create。同样，网络networks和卷volumes的定义类似于docker network create和docker volume create。正如docker container create在Dockerfile指定选项，如CMD、EXPOSE、VOLUME、ENV，在默认情况下，不需要在docker-compose.yml配置中再次指定。可以使用Bash类${VARIABLE}语法在配置值中使用环境变量。</p>
<p>标准配置文件应该包含version、services、networks三部分，其中最关键的是services和networks两个部分。</p>
<h3 id="images"><a href="#images" class="headerlink" title="images"></a>images</h3><p>images用来指定服务的镜像名称或镜像ID，如果镜像在本地不存在，compose将会尝试去拉取这个镜像。</p>
<pre><code>services:
  web:
    image:redis
</code></pre><h3 id="volumes"><a href="#volumes" class="headerlink" title="volumes"></a>volumes</h3><p>volumes指令用于设置数据卷挂载路径，数据卷挂载路径可以是一个目录或一个已经存在的数据卷容器，可以设置宿主机路径HOST:CONTAINER或加上访问模式HOST:CONTAINER:ro。使用ro表示对于容器来说数据卷是只读的，这样可以有效地保护宿主机的文件系统。</p>
<pre><code>volumes:
  # 指定一个容器内的路径，Docker会自动创建一个数据卷。
  - /var/lib/mysql
  # 使用绝对路径挂载数据卷
  - /opt/data:/var/lib/mysql
  # 以compose配置文件所在目录为根的相对路径作为数据卷挂载到容器
  - ./cache:/tmp/cache
  # 使用用户的相对路径
  - ~/configs:/etc/configs:ro
</code></pre><h3 id="networks"><a href="#networks" class="headerlink" title="networks"></a>networks</h3><p>networks指令用于设置指定网络</p>
<pre><code>services:
  some-service:
    networks:
      - some-network
</code></pre><h2 id="多服务"><a href="#多服务" class="headerlink" title="多服务"></a>多服务</h2><pre><code>version: &apos;2&apos;

services:

 service-eureka: 
   image: java
   volumes:
     - /Users/objcat/jar/service-eureka.jar:/usr/local/service-eureka.jar
   ports:
     - 8081:8081
   command:
     - /bin/sh
     - -c
     - |
       echo 192.168.1.126 servicehost &gt;&gt; /etc/hosts
       java -jar /usr/local/service-eureka.jar

 service-a: 
   image: java
   volumes:
     - /Users/objcat/jar/service-a.jar:/usr/local/service-a.jar
   ports:
     - 8082:8082
   command:
     - /bin/sh
     - -c
     - |
       echo 192.168.1.126 servicehost &gt;&gt; /etc/hosts
       java -jar /usr/local/service-a.jar

 service-b: 
   image: java
   volumes:
     - /Users/objcat/jar/service-b.jar:/usr/local/service-b.jar
   ports:
     - 8083:8083
   command:
     - /bin/sh
     - -c
     - |
       echo 192.168.1.126 servicehost &gt;&gt; /etc/hosts
       java -jar /usr/local/service-b.jar
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/12/07/arctic/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Airthink">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Airthink">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/12/07/arctic/" itemprop="url">arctic</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-12-07T21:16:24+08:00">
                2020-12-07
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/arctic/" itemprop="url" rel="index">
                    <span itemprop="name">arctic</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="北极介绍"><a href="#北极介绍" class="headerlink" title="北极介绍"></a>北极介绍</h1><p>北极是位于MongoDB之上的时间序列/数据框架数据库。Arctic支持将许多数据类型序列号以存储在mongo文档模型中。</p>
<h2 id="为什么使用北极"><a href="#为什么使用北极" class="headerlink" title="为什么使用北极"></a>为什么使用北极</h2><ul>
<li>序列化许多数据类型，例如Pandas DataFrames,Numpy数组,Python对象等,SO不必手动处理不同的数据类型。</li>
<li>默认情况下客户端使用LZ4压缩，以节省大量网络/磁盘空间。</li>
<li>允许对队形的不同阶段进行版本控制并快照状态（某种程度上类似于git）,并允许自由的试验,然后紧还原快照。【仅限VersionStore】</li>
<li>是否为您进行分块（将数据拆分为较小的部分）</li>
<li>添加了可以在Mongo的auth上构建的Users and Per User Libraries的概念。</li>
<li>拥有不同类型的商店，每种都有其自身的优势。Versionstore允许您对版本和快照内容进行版本控制，TickStore用于存储和高效检索流数据，ChunkStore允许您对数据块进行分块并有效地检索范围。</li>
<li>限制对Mongo的数据访问，从而防止对未索引/未分片的集合进行临时查询</li>
</ul>
<h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><p>Arctic提供了一个包装器,用于处理与Mongo的连接。该Arctic实际连接到北极。</p>
<pre><code>conn = Arctic(&apos;127.0.0.1&apos;)
</code></pre><p>仅此连接句柄可以执行许多操作。最基本的是list_libraries和initiailize_library。</p>
<p>北极将数据分为不同的库。它们可能是不同的用户，不同的市场，不同的地理区域等。库名称是字符串，完全由用户定义。</p>
<pre><code>conn.list_libraries()
[]
</code></pre><p>在这种情况下，系统上没有库，因此可以对其进行初始化。</p>
<pre><code>&gt;&gt;&gt; conn.initialize_library(&apos;library_name&apos;)
&gt;&gt;&gt; conn.list_libraries()
[u&apos;library_name&apos;]
</code></pre><p>initialize_library有一个名为arg的可选参数，lib_type默认为VersionStore（稍后会在Arctic存储引擎类型中提供更多信息）。</p>
<p>库初始化后，可以像这样访问它：</p>
<pre><code>&gt;&gt;&gt; lib = conn[&apos;library_name&apos;]
</code></pre><p>使用此库的句柄，我们可以开始从Arctic存储和检索数据。</p>
<p>（注意，大多数存储引擎的支持相同的基本方法（read，write，等），但每个人都有自己一套独特的方法为好）</p>
<p>write最基本的形式是北极symbol和数据。的symbol是，用于存储/检索数据的用户定义键。在data多数情况下是一个熊猫数据帧，虽然有些存储引擎支持其他类型的（所有支持dataframes，和一些支持类型的字典，并与pickle对象）。</p>
<p>read如您所料，会symbol读取数据。不同的存储引擎具有不同的参数，这些参数使您可以对数据进行子集设置（稍后会详细介绍）。</p>
<pre><code>&gt;&gt;&gt; data = pd.DataFrame(.....)
&gt;&gt;&gt; lib.write(&apos;symbolname&apos;, data)
&gt;&gt;&gt; df = lib.read(&apos;symbolname&apos;)
&gt;&gt;&gt; df
                data
date
2016-01-01       1
2016-01-02       2
2016-01-03       3
</code></pre><p>其他基本方法：</p>
<ul>
<li>library.list_symbols()<br> 符合您的期望-列出给定库中的所有符号 [‘US_EQUITIES’, ‘EUR_EQUITIES’, …]</li>
<li>arctic.get_quota(library_name)， arctic.set_quota(library_name, quota_in_bytes)</li>
<li>北极内部设置库的配额，这样它们就不会占用太多空间。您可以使用这两种方法检查和设置配额。请注意，这些操作针对 Arctic对象，而非库。</li>
</ul>
<h2 id="北极存储引擎"><a href="#北极存储引擎" class="headerlink" title="北极存储引擎"></a>北极存储引擎</h2><p>Arctic的设计具有很高的可扩展性，目前支持多种不同的用例。要了解Arctic的功能，必须了解其使用的存储模型。北极目前支持三个存储引擎</p>
<ul>
<li>TickStore</li>
<li>版本库</li>
<li>块存储</li>
</ul>
<p>每一个都有各种功能，旨在支持特定和通用的用例。</p>
<h1 id="快速开始"><a href="#快速开始" class="headerlink" title="快速开始"></a>快速开始</h1><h2 id="安装北极"><a href="#安装北极" class="headerlink" title="安装北极"></a>安装北极</h2><pre><code>pip install git+https://github.com/manahl/arctic.git
</code></pre><h2 id="运行一个mongo"><a href="#运行一个mongo" class="headerlink" title="运行一个mongo"></a>运行一个mongo</h2><pre><code>mongod --dbpath &lt;path/to/db_directory&gt;
</code></pre><h2 id="使用VersionStore"><a href="#使用VersionStore" class="headerlink" title="使用VersionStore"></a>使用VersionStore</h2><pre><code>from arctic import Arctic
import quandl

# Connect to Local MONGODB
store = Arctic(&apos;localhost&apos;)

# Create the library - defaults to VersionStore
store.initialize_library(&apos;NASDAQ&apos;)

# Access the library
library = store[&apos;NASDAQ&apos;]

# Load some data - maybe from Quandl
aapl = quandl.get(&quot;WIKI/AAPL&quot;, authtoken=&quot;your token here&quot;)

# Store the data in the library
library.write(&apos;AAPL&apos;, aapl, metadata={&apos;source&apos;: &apos;Quandl&apos;})

# Reading the data
item = library.read(&apos;AAPL&apos;)
aapl = item.data
metadata = item.metadata
</code></pre><h1 id="存储引擎版本库"><a href="#存储引擎版本库" class="headerlink" title="存储引擎版本库"></a>存储引擎版本库</h1><p>VersionStore在MongoDB中序列化并存储Pandas对象，numpy数组以及其他python类型。修改versioneda时，对象是并且创建了新版本symbol。</p>
<h2 id="使用VersionStore读写数据"><a href="#使用VersionStore读写数据" class="headerlink" title="使用VersionStore读写数据"></a>使用VersionStore读写数据</h2><pre><code>from arctic import Arctic

a = Arctic(‘localhost’)
a.initialize_library(&apos;vstore&apos;)
lib = a[‘vstore’]
</code></pre><p>此时，您有一个空的VersionStore库。您不需要指定存储类型，因为VersionStore是Arctic中的默认库类型。您可以通过几种方式向其中写入数据。最基本的就是使用该write方法。写采用以下参数：</p>
<pre><code>symbol, data, metadata=None, prune_previous_version=True, **kwargs
</code></pre><p>symbol是用于在北极存储/检索数据的名称。data是要存储在MongoDB中的数据。metadata是可选的用户定义元数据。它一定是一个dict。prune_previous_versions将删除/删除数据的先前版本（前提是快照中未包含它们）。kwargs被传递给各个写处理程序。有针对不同数据类型的写处理程序。</p>
<p>write用于写入和替换数据。如果test使用一个数据集写入符号，然后使用另一个数据集再次写入符号，则原始数据将被替换为新版本的数据。</p>
<pre><code>&gt;&gt;&gt; from pandas import DataFrame, MultiIndex
&gt;&gt;&gt; from datetime import datetime as dt


&gt;&gt;&gt; df = DataFrame(data={&apos;data&apos;: [1, 2, 3]},
                   index=MultiIndex.from_tuples([(dt(2016, 1, 1), 1),
                                                 (dt(2016, 1, 2), 1),
                                                 (dt(2016, 1, 3), 1)],
                                                names=[&apos;date&apos;, &apos;id&apos;]))
&gt;&gt;&gt; lib.write(&apos;test&apos;, df)
VersionedItem(symbol=test,library=arctic.vstore,data=&lt;class &apos;NoneType&apos;&gt;,version=1,metadata=None,host=127.0.0.1)

&gt;&gt;&gt; lib.read(&apos;test&apos;).data
               data
date       id      
2016-01-01 1      1
2016-01-02 1      2
2016-01-03 1      3


&gt;&gt;&gt; df = DataFrame(data={&apos;data&apos;: [100, 200, 300]},
                   index=MultiIndex.from_tuples([(dt(2016, 1, 1), 1),
                                                 (dt(2016, 1, 2), 1),
                                                 (dt(2016, 1, 3), 1)],
                                               names=[&apos;date&apos;, &apos;id&apos;]))

&gt;&gt;&gt; lib.write(&apos;test&apos;, df)
VersionedItem(symbol=test,library=arctic.vstore,data=&lt;class &apos;NoneType&apos;&gt;,version=2,metadata=None,host=127.0.0.1)

&gt;&gt;&gt; lib.read(&apos;test&apos;).data
               data
date       id      
2016-01-01 1    100
2016-01-02 1    200
2016-01-03 1    300
</code></pre><p>write返回一个VersionedItem对象。VersionedItem包含以下成员：</p>
<p>符号<br>图书馆<br>版本-写入数据的版本号<br>元数据-元数据（如果存在），或无<br>数据（对于写入，它为None；对于读取，它包含从数据库读取的数据）。<br>主办<br>您还应注意，VersionStorewrite有效覆盖了已写入的数据。在上面的示例中，第二个示例用新数据帧write替换了符号test中的数据。原始数据（版本1）仍然可用，但必须以其版本号引用才能检索它。该read方法采用以下参数：</p>
<pre><code>symbol, as_of=None, date_range=None, from_version=None, allow_secondary=None, **kwargs
</code></pre><p>as_of允许您检索特定时间点的数据。您可以通过多种方式定义该时间点。</p>
<ul>
<li>快照的名称（字符串）</li>
<li>版本号（整数）</li>
<li>日期时间（datetime.datetime）</li>
</ul>
<p>date_range使您可以通过Arctic DateRange对象对数据进行子集化。DateRanges允许您指定日期范围（“ 2016-01-01”，“ 2016-09-30”），开始日期和结束日期以及开放式范围（无，“ 2016-09-30”）。范围可以在任一端打开。allow_secondary使您可以覆盖默认行为，以允许或禁止从mongo集群的辅助成员读取。</p>
<pre><code>&gt;&gt;&gt; lib.read(&apos;test&apos;).data
               data
date       id      
2016-01-01 1    100
2016-01-02 1    200
2016-01-03 1    300

&gt;&gt;&gt; lib.read(&apos;test&apos;, as_of=1).data

date       id  data    
2016-01-01 1      1
2016-01-02 1      2
2016-01-03 1      3


&gt;&gt;&gt; from arctic.date import DateRange
&gt;&gt;&gt; lib.read(&apos;test&apos;, date_range=DateRange(&apos;2016-01-01&apos;, &apos;2016-01-01&apos;)).data

date       id  data    
2016-01-01 1    100
</code></pre><p>DateRange仅适用于pandas DataFrame，并且该数据帧必须具有datetime索引。</p>
<p>写入数据的另一种方法是使用append方法。append接受以下参数：</p>
<pre><code>symbol, data, metadata=None, prune_previous_version=True, upsert=True, **kwargs
</code></pre><p>upsert是唯一的新论据。upsert表示如果该符号不存在，它将创建它。如果upsert出现False错误，因为将没有现有数据要追加。</p>
<pre><code>&gt;&gt;&gt; lib.append(&apos;new&apos;, df, upsert=False)
~/arctic/arctic/store/version_store.py in append(self, symbol, data, metadata, prune_previous_version, upsert, **kwargs)
    505             return self.write(symbol=symbol, data=data, prune_previous_version=prune_previous_version, metadata=metadata)
    506 
--&gt; 507         assert previous_version is not None
    508         dirty_append = False
    509 

AssertionError: 
</code></pre><blockquote>
<blockquote>
<blockquote>
<p>lib.append(‘new’, df, upsert=True)<br>VersionedItem(symbol=new,library=arctic.vstore,data=<class 'nonetype'="">,version=1,metadata=None,host=127.0.0.1)</class></p>
</blockquote>
</blockquote>
</blockquote>
<h2 id="实用方法"><a href="#实用方法" class="headerlink" title="实用方法"></a>实用方法</h2><ul>
<li>删除</li>
<li>has_symbol</li>
<li>list_versions</li>
<li>read_metadata</li>
<li>write_metadata</li>
<li>restore_version</li>
</ul>
<p>delete符合您的预期-从库中删除符号。它只有一个参数symbol。has_symbol并且list_symbols将返回有关库符号的当前状态信息。他们的签名是：</p>
<pre><code>list_symbols(self, all_symbols=False, snapshot=None, regex=None, **kwargs)

def has_symbol(self, symbol, as_of=None)
</code></pre><p>for list_symbols，all_symbols如果设置为，则将true从所有快照返回所有符号，即使该符号已在当前版本中删除（但已保存在快照中）也是如此。snapshot允许您在指定的下方列出符号snapshot。regex允许您提供正则表达式以进一步限制查询返回的符号列表。北极使用MongoDB的$regex功能。Mongo支持PERL语法正则表达式；更多信息在这里</p>
<p>has_symbol返回True或False基于符号是否存在。您可以version通过将此检查限制为特定检查as_of。</p>
<pre><code>&gt;&gt;&gt; lib.delete(&apos;new&apos;)

&gt;&gt;&gt; lib.list_symbols()
[&apos;test&apos;]

&gt;&gt;&gt; lib.has_symbol(&apos;new&apos;)
False

&gt;&gt;&gt; lib.write(&apos;test2&apos;, df)

&gt;&gt;&gt; lib.list_symbols(regex=&quot;.*2&quot;)
[&apos;test2&apos;]
</code></pre><p>read_metadata并write_metadata允许您直接为给定符号读取/设置用户定义的元数据。</p>
<pre><code>&gt;&gt;&gt; lib.read_metadata(&apos;test2&apos;)
VersionedItem(symbol=test2,library=arctic.vstore,data=&lt;class &apos;NoneType&apos;&gt;,version=1,metadata=None,host=127.0.0.1)

&gt;&gt;&gt; lib.read_metadata(&apos;test2&apos;).metadata

&gt;&gt;&gt; lib.write_metadata(&apos;test2&apos;, {&apos;meta&apos;: &apos;data&apos;})
VersionedItem(symbol=test2,library=arctic.vstore,data=&lt;class &apos;NoneType&apos;&gt;,version=2,metadata={&apos;meta&apos;: &apos;data&apos;},host=127.0.0.1)

&gt;&gt;&gt; lib.read_metadata(&apos;test2&apos;).metadata
{&apos;meta&apos;: &apos;data&apos;}
</code></pre><p>restore_version使您可以将最新版本设置为旧版本。您可以list_versions用来查看有关版本当前状态的信息。</p>
<pre><code>&gt;&gt;&gt; lib.list_versions(&apos;test&apos;) 
[{&apos;symbol&apos;: &apos;test&apos;,
  &apos;version&apos;: 3,
  &apos;deleted&apos;: False,
  &apos;date&apos;: datetime.datetime(2018, 8, 16, 17, 59, 47, tzinfo=tzfile(&apos;/usr/share/zoneinfo/America/New_York&apos;)),
  &apos;snapshots&apos;: []},
 {&apos;symbol&apos;: &apos;test&apos;,
  &apos;version&apos;: 2,
  &apos;deleted&apos;: False,
  &apos;date&apos;: datetime.datetime(2018, 8, 15, 18, 0, 33, tzinfo=tzfile(&apos;/usr/share/zoneinfo/America/New_York&apos;)),
  &apos;snapshots&apos;: []}]


&gt;&gt;&gt; lib.restore_version(&apos;test&apos;, 2)
VersionedItem(symbol=test,library=arctic.vstore,data=&lt;class &apos;NoneType&apos;&gt;,version=4,metadata=None,host=127.0.0.1)

&gt;&gt;&gt; lib.read(&apos;test&apos;).data
               data
date       id      
2016-01-01 1    100
2016-01-02 1    200
2016-01-03 1    300

&gt;&gt;&gt; lib.list_versions(&apos;test&apos;) 
[{&apos;symbol&apos;: &apos;test&apos;,
  &apos;version&apos;: 4,
  &apos;deleted&apos;: False,
  &apos;date&apos;: datetime.datetime(2018, 8, 16, 18, 54, 10, tzinfo=tzfile(&apos;/usr/share/zoneinfo/America/New_York&apos;)),
  &apos;snapshots&apos;: []},
 {&apos;symbol&apos;: &apos;test&apos;,
  &apos;version&apos;: 3,
  &apos;deleted&apos;: False,
  &apos;date&apos;: datetime.datetime(2018, 8, 16, 17, 59, 47, tzinfo=tzfile(&apos;/usr/share/zoneinfo/America/New_York&apos;)),
  &apos;snapshots&apos;: []},
 {&apos;symbol&apos;: &apos;test&apos;,
  &apos;version&apos;: 2,
  &apos;deleted&apos;: False,
  &apos;date&apos;: datetime.datetime(2018, 8, 15, 18, 0, 33, tzinfo=tzfile(&apos;/usr/share/zoneinfo/America/New_York&apos;)),
  &apos;snapshots&apos;: []}]
</code></pre><p>使用restore_version不会删除最新版本，它只是使用用户提供的版本引用的数据创建了一个新版本。</p>
<h2 id="快照"><a href="#快照" class="headerlink" title="快照"></a>快照</h2><p>VersionStore允许您创建数据快照并为其分配名称。快照中仍包含属于快照的一部分的数据。快照方法是：</p>
<ul>
<li>快照</li>
<li>delete_snapshot</li>
<li>list_snapshots</li>
</ul>
<p>snapshot允许您创建快照。它的签名很简单</p>
<pre><code>snap_name, metadata=None, skip_symbols=None, versions=None
</code></pre><p>snap_name是要创建的快照的名称。metadata允许您向快照提供用户定义的元数据。skip_symbols允许您从快照中排除符号。versions允许您指定要包含在快照中的特定版本。</p>
<p>delete_snapshot和list_snapshot功能分别类似于delete和list_versions。list_snapshots返回snapshot映射到metadata快照的名称的字典。</p>
<pre><code>&gt;&gt;&gt; lib.list_symbols()
[&apos;test&apos;, &apos;test2&apos;]

&gt;&gt;&gt; lib.snapshot(&apos;backup&apos;)

&gt;&gt;&gt; lib.list_snapshots()
{&apos;backup&apos;: None}

&gt;&gt;&gt; lib.list_symbols(snapshot=&apos;backup&apos;)
[&apos;test&apos;, &apos;test2&apos;]

&gt;&gt;&gt; lib.delete(&apos;test&apos;)

&gt;&gt;&gt; lib.delete(&apos;test2&apos;)

&gt;&gt;&gt; lib.list_symbols()
[]

&gt;&gt;&gt; lib.list_symbols(snapshot=&apos;backup&apos;)
[&apos;test&apos;, &apos;test2&apos;]

&gt;&gt;&gt; lib.read(&apos;test&apos;)
~/arctic/arctic/store/version_store.py in _read_metadata(self, symbol, as_of, read_preference)
    455         metadata = _version.get(&apos;metadata&apos;, None)
    456         if metadata is not None and metadata.get(&apos;deleted&apos;, False) is True:
--&gt; 457             raise NoDataFoundException(&quot;No data found for %s in library %s&quot; % (symbol, self._arctic_lib.get_name()))
    458 
    459         return _version

NoDataFoundException: No data found for test in library arctic.vstore


&gt;&gt;&gt; lib.read(&apos;test&apos;, as_of=&apos;backup&apos;)
VersionedItem(symbol=test,library=arctic.vstore,data=&lt;class &apos;pandas.core.frame.DataFrame&apos;&gt;,version=4,metadata=None,host=127.0.0.1)

&gt;&gt;&gt; lib.read(&apos;test&apos;, as_of=&apos;backup&apos;).data 
               data
date       id      
2016-01-01 1    100
2016-01-02 1    200
2016-01-03 1    300
</code></pre><h1 id="API参考"><a href="#API参考" class="headerlink" title="API参考"></a>API参考</h1><p>附加</p>
<pre><code>append(symbol, item)
    Appends data from item to symbol&apos;s data in the database.

    Is not idempotent

    Parameters
    ----------
    symbol: str
        the symbol for the given item in the DB
    item: DataFrame or Series
        the data to append
</code></pre><p>用法示例：</p>
<pre><code>&gt;&gt;&gt; df = DataFrame(data={&apos;data&apos;: [100, 200, 300]},
                  index=MultiIndex.from_tuples([(dt(2016, 1, 1), 1),
                                                (dt(2016, 1, 2), 1),
                                                (dt(2016, 1, 3), 1)],
                                               names=[&apos;date&apos;, &apos;id&apos;]))


&gt;&gt;&gt; lib.write(&apos;test&apos;, df, chunk_size=&apos;M&apos;)
&gt;&gt;&gt; lib.read(&apos;test&apos;)
               data
date       id
2016-01-01 1    100
2016-01-02 1    200
2016-01-03 1    300

&gt;&gt;&gt; lib.append(&apos;test&apos;, df)
&gt;&gt;&gt; lib.append(&apos;test&apos;, df)
&gt;&gt;&gt; lib.read(&apos;test&apos;)
               data
date       id
2016-01-01 1    100
           1    100
           1    100
2016-01-02 1    200
           1    200
           1    200
2016-01-03 1    300
           1    300
           1    300
</code></pre><p>删除</p>
<pre><code>delete(symbol, chunk_range=None)
    Delete all chunks for a symbol, or optionally, chunks within a range

    Parameters
    ----------
    symbol : str
        symbol name for the item
    chunk_range: range object
        a date range to delete
</code></pre><p>用法示例：</p>
<pre><code>&gt;&gt;&gt; lib.read(&apos;test&apos;)
               data
date       id
2016-01-01 1    100
2016-01-03 1    300

&gt;&gt;&gt; lib.delete(&apos;test&apos;, chunk_range=pd.date_range(&apos;2016-01-01&apos;, &apos;2016-01-01&apos;))
&gt;&gt;&gt; lib.read(&apos;test&apos;)
               data
date       id
2016-01-03 1    300
</code></pre><p>get_chunk_ranges</p>
<pre><code>get_chunk_ranges(symbol, chunk_range=None, reverse=False)
    Returns a generator of (Start, End) tuples for each chunk in the symbol

    Parameters
    ----------
    symbol: str
        the symbol for the given item in the DB
    chunk_range: None, or a range object
        allows you to subset the chunks by range
    reverse: boolean

    Returns
    -------
    generator
</code></pre><p>用法示例：</p>
<pre><code>&gt;&gt;&gt; list(lib.get_chunk_ranges(&apos;new_name&apos;))
[(&apos;2016-01-01&apos;, &apos;2016-01-01&apos;), (&apos;2016-01-03&apos;, &apos;2016-01-03&apos;)]
</code></pre><p>获取信息</p>
<pre><code>get_info(symbol)
    Returns information about the symbol, in a dictionary

    Parameters
    ----------
    symbol: str
        the symbol for the given item in the DB

    Returns
    -------
    dictionary
</code></pre><p>迭代器</p>
<pre><code>iterator(symbol, chunk_range=None):
    Returns a generator that accesses each chunk in ascending order

    Parameters
    ----------
    symbol: str
        the symbol for the given item in the DB
    chunk_range: None, or a range object
        allows you to subset the chunks by range

    Returns
    -------
    generator
</code></pre><p>list_symbols</p>
<pre><code>list_symbols()
    Returns all symbols in the library

    Returns
    -------
    list of str
</code></pre><p>读</p>
<pre><code>read(symbol, chunk_range=None, filter_data=True, **kwargs)
    Reads data for a given symbol from the database.

    Parameters
    ----------
    symbol: str
        the symbol to retrieve
    chunk_range: object
        corresponding range object for the specified chunker (for
        DateChunker it is a DateRange object or a DatetimeIndex,
        as returned by pandas.date_range
    filter_data: boolean
        perform chunk level filtering on the data (see filter in _chunker)
        only applicable when chunk_range is specified
    kwargs: ?
        values passed to the serializer. Varies by serializer

    Returns
    -------
    DataFrame or Series
</code></pre><p>用法示例：</p>
<pre><code>&gt;&gt;&gt; dr = pd.date_range(start=&apos;2010-01-01&apos;, periods=1000, freq=&apos;D&apos;)
&gt;&gt;&gt; df = DataFrame(data={&apos;data&apos;: np.random.randint(0, 100, size=1000),
                         &apos;date&apos;: dr
                        })

&gt;&gt;&gt; lib.write(&apos;symbol_name&apos;, df, chunk_size=&apos;M&apos;)
&gt;&gt;&gt; lib.read(&apos;symbol_name&apos;, chunk_range=pd.date_range(&apos;2012-09-01&apos;, &apos;2016-01-01&apos;))
    data       date
0     61 2012-09-01
1     69 2012-09-02
2     96 2012-09-03
3     23 2012-09-04
4     66 2012-09-05
5     54 2012-09-06
6     21 2012-09-07
7     92 2012-09-08
8     95 2012-09-09
9     24 2012-09-10
10    87 2012-09-11
11    33 2012-09-12
12    59 2012-09-13
13    54 2012-09-14
14    48 2012-09-15
15    67 2012-09-16
16    73 2012-09-17
17    72 2012-09-18
18     6 2012-09-19
19    24 2012-09-20
20     8 2012-09-21
21    50 2012-09-22
22    40 2012-09-23
23    45 2012-09-24
24     8 2012-09-25
25    73 2012-09-26
</code></pre><p>改名</p>
<pre><code>rename(from_symbol, to_symbol)
    Rename a symbol

    Parameters
    ----------
    from_symbol: str
        the existing symbol that will be renamed
    to_symbol: str
        the new symbol name
</code></pre><p>reverse_iterator</p>
<pre><code>reverse_iterator(symbol, chunk_range=None):
    Returns a generator that accesses each chunk in descending order

    Parameters
    ----------
    symbol: str
        the symbol for the given item in the DB
    chunk_range: None, or a range object
        allows you to subset the chunks by range

    Returns
    -------
    generator
</code></pre><p>更新</p>
<pre><code>update(symbol, item, chunk_range=None, upsert=False, **kwargs)
    Overwrites data in DB with data in item for the given symbol.

    Is idempotent

    Parameters
    ----------
    symbol: str
        the symbol for the given item in the DB
    item: DataFrame or Series
        the data to update
    chunk_range: None, or a range object
        If a range is specified, it will clear/delete the data within the
        range and overwrite it with the data in item. This allows the user
        to update with data that might only be a subset of the
        original data.
    upsert: bool
        if True, will write the data even if the symbol does not exist.
    kwargs:
        optional keyword args passed to write during an upsert. Includes:
        chunk_size
        chunker
</code></pre><p>写</p>
<pre><code>write(symbol, item, chunker=DateChunker(), **kwargs)
    Writes data from item to symbol in the database

    Parameters
    ----------
    symbol: str
        the symbol that will be used to reference the written data
    item: Dataframe or Series
        the data to write the database
    chunker: Object of type Chunker
        A chunker that chunks the data in item
    kwargs:
        optional keyword args that are passed to the chunker. Includes:
        chunk_size:
            used by chunker to break data into discrete chunks.
            see specific chunkers for more information about this param.
</code></pre><p>用法示例：</p>
<pre><code>&gt;&gt;&gt; dr = pd.date_range(start=&apos;2010-01-01&apos;, periods=1000, freq=&apos;D&apos;)
&gt;&gt;&gt; df = DataFrame(data={&apos;data&apos;: np.random.randint(0, 100, size=1000),
                         &apos;date&apos;: dr
                        })

&gt;&gt;&gt; lib.write(&apos;symbol_name&apos;, df, chunk_size=&apos;M&apos;)
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/11/30/量化投资/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Airthink">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Airthink">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/11/30/量化投资/" itemprop="url">量化投资</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-11-30T07:53:05+08:00">
                2020-11-30
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/投资/" itemprop="url" rel="index">
                    <span itemprop="name">投资</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>关于量化投资的学习和思考</p>
<h1 id="数学角度看量化"><a href="#数学角度看量化" class="headerlink" title="数学角度看量化"></a>数学角度看量化</h1><p>在量化投资单纯从数学角度看，一个交易系统/交易模型仅仅是一个从行情序列到资金曲线的映射。</p>
<p>f(ts,para) = E</p>
<p>其中f是一个交易系统，ts是某一个投资标的（股票、期货、期权、外汇等）的行情时间序列para是交易系统的参数组，E是资金曲线。</p>
<p>任何一个模型都会有参数，有参数就会碰到参数寻优，过拟合等问题。</p>
<p>参数优化是基于历史数据进行的策略优化。而历史并不能完全重演。历史中表现优秀的参数，在交易中未必会表现很好。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="Airthink">
          <p class="site-author-name" itemprop="name">Airthink</p>
           
              <p class="site-description motion-element" itemprop="description">The Pursuit of Happyness</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">48</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">19</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/ikangbow" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2018 - 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-snowflake-o"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Airthink</span>
</div>



        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

</body>
</html>
